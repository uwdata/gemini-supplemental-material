{"version":3,"sources":["animation.js","util/util.js","parser/resolveCollector.js","schedule.js","parser/conflictChecker.js","../node_modules/uri-js/src/util.ts","../node_modules/uri-js/src/regexps-uri.ts","../node_modules/uri-js/src/regexps-iri.ts","../node_modules/uri-js/node_modules/punycode/punycode.es6.js","../node_modules/uri-js/src/uri.ts","../node_modules/uri-js/src/schemes/http.ts","../node_modules/uri-js/src/schemes/https.ts","../node_modules/uri-js/src/schemes/mailto.ts","../node_modules/uri-js/src/schemes/urn.ts","../node_modules/uri-js/src/schemes/urn-uuid.ts","../node_modules/uri-js/src/index.ts","../node_modules/fast-deep-equal/index.js","../node_modules/ajv/lib/compile/util.js","../node_modules/ajv/lib/compile/ucs2length.js","../node_modules/ajv/lib/compile/schema_obj.js","../node_modules/json-schema-traverse/index.js","../node_modules/ajv/lib/compile/resolve.js","../node_modules/ajv/lib/compile/error_classes.js","../node_modules/fast-json-stable-stringify/index.js","../node_modules/ajv/lib/dotjs/validate.js","../node_modules/ajv/lib/compile/index.js","../node_modules/ajv/lib/cache.js","../node_modules/ajv/lib/compile/formats.js","../node_modules/ajv/lib/dotjs/ref.js","../node_modules/ajv/lib/dotjs/_limit.js","../node_modules/ajv/lib/dotjs/_limitItems.js","../node_modules/ajv/lib/dotjs/_limitLength.js","../node_modules/ajv/lib/dotjs/_limitProperties.js","../node_modules/ajv/lib/dotjs/index.js","../node_modules/ajv/lib/dotjs/allOf.js","../node_modules/ajv/lib/dotjs/anyOf.js","../node_modules/ajv/lib/dotjs/comment.js","../node_modules/ajv/lib/dotjs/const.js","../node_modules/ajv/lib/dotjs/contains.js","../node_modules/ajv/lib/dotjs/dependencies.js","../node_modules/ajv/lib/dotjs/enum.js","../node_modules/ajv/lib/dotjs/format.js","../node_modules/ajv/lib/dotjs/if.js","../node_modules/ajv/lib/dotjs/items.js","../node_modules/ajv/lib/dotjs/multipleOf.js","../node_modules/ajv/lib/dotjs/not.js","../node_modules/ajv/lib/dotjs/oneOf.js","../node_modules/ajv/lib/dotjs/pattern.js","../node_modules/ajv/lib/dotjs/properties.js","../node_modules/ajv/lib/dotjs/propertyNames.js","../node_modules/ajv/lib/dotjs/required.js","../node_modules/ajv/lib/dotjs/uniqueItems.js","../node_modules/ajv/lib/compile/rules.js","../node_modules/ajv/lib/data.js","../node_modules/ajv/lib/compile/async.js","../node_modules/ajv/lib/dotjs/custom.js","../node_modules/ajv/lib/definition_schema.js","../node_modules/ajv/lib/keyword.js","../node_modules/ajv/lib/ajv.js","../node_modules/vega-expression/src/ast.js","../node_modules/vega-expression/src/parser.js","../node_modules/vega-expression/src/constants.js","../node_modules/vega-util/src/accessor.js","../node_modules/vega-util/src/error.js","../node_modules/vega-util/src/isArray.js","../node_modules/vega-util/src/isString.js","../node_modules/vega-util/src/stringValue.js","../node_modules/vega-util/src/isObject.js","../node_modules/vega-util/src/accessors.js","../node_modules/vega-util/src/field.js","../node_modules/vega-util/src/splitAccessPath.js","../node_modules/vega-util/src/isFunction.js","../node_modules/vega-util/src/hasOwnProperty.js","../node_modules/vega-util/src/toSet.js","../node_modules/vega-expression/src/functions.js","../node_modules/vega-expression/src/codegen.js","default/browser.js","default/ease.js","default/vegaConfig.js","default/util.js","default/style.js","default/encode/vegaDefault.js","default/encode/legend.js","default/encode/index.js","default/encode/mark.js","default/encode/axis.js","actuator/util.js","changeFetcher/state/util.js","enumerator.js","parser/stepEnumerator.js","parser/index.js","parser/specChecker.js","util/vgDataHelper.js","changeFetcher/state/dataJoin.js","changeFetcher/state/compute/util.js","changeFetcher/state/compute/mark.js","changeFetcher/state/compute/axis.js","changeFetcher/state/compute/legend.js","changeFetcher/state/compute/view.js","util/vgSpecHelper.js","changeFetcher/change.js","changeFetcher/state/index.js","actuator/vega-render-util.js","actuator/mark/interpolatePathYH.js","actuator/mark/interpolateHelper.js","actuator/attributeFetcher.js","actuator/staggering.js","actuator/timings.js","actuator/mark/mark.js","actuator/mark/areaLine.js","actuator/axis.js","actuator/legend.js","actuator/index.js","actuator/view.js","resolver.js","gemini.js","recommender/util.js","recommender/diffDetector.js","recommender/diffApplier.js","recommender/markCompChecker.js","recommender/pseudoTimelineValidator.js","recommender/pseudoTimelineEnumerator.js","recommender/designGuidelines.js","recommender/pseudoTimelineEvaluator.js","recommender/timelineGenerator.js","recommender/index.js","util/vl2vg4gemini.js","index.js","js/util.js","js/recomControl.js","js/init.js","components/CodeCol.js","components/util.js","components/AnimContainer.js","components/VisCol.js","components/RecomModal.js","components/ExampleSelect.js","components/GeminiSpecSelect.js","App.js","serviceWorker.js","webpack:///./src/index.js?b635"],"names":["Animation","schedule","rawInfo","spec","this","moments","status","logs","_queue","timestamp","message","info","push","targetElm","globalSTime","Date","_start","starting","log","i","moment","_end","then","delay","Math","max","time","Promise","resolve","setTimeout","length","steps","forEach","step","sTime","eTime","result","template","workingSteps","filter","item","stringifyDatumValue","value","toString","deepEqual","obj1","obj2","isDate","Number","undefined","props1","Object","keys","props2","prop","prototype","hasOwnProperty","call","copy","obj","JSON","parse","stringify","copy2","reduce","acc","curr","flatten","arrays","concat","o","getMonth","enumArr","arr","newArrs","newArr","Array","isArray","get","props","isNullOrUndefined","isNumber","x","isNaN","roundUp","num","d","round","pow","variance","nums","mu","mean","sum","isEmpty","parsedBlock","parsedSteps","resolves","collect","block","sync","blk","r","alterIds","alterId","split","alterName","map","unique","findIndex","indexOf","head","splice","contains","v","accessor","containAll","sample","N","tempThis","slice","sampled","floor","random","shuffle","j","clone","exclude","items","Schedule","newParsedSteps","stp","stepId","tracks","name","trackName","compName","compType","track","assign","scaleOrderResovles","counter","dividers","totalCount","sort","a","b","console","warn","divider","q","remainder","newSteps","findConflicts","tracksWithAlterId","conflicts","sortedSteps","stp1","stp2","conflictedSteps","sets","xl","str","HEXDIG$$","merge","PCT_ENCODED$","subexp","SUB_DELIMS$$","RESERVED$$","isIRI","DEC_OCTET_RELAXED$","ALPHA$$","H16$","LS32$","IPV6ADDRESS1$","IPV6ADDRESS2$","IPV6ADDRESS3$","IPV6ADDRESS4$","IPV6ADDRESS5$","IPV6ADDRESS6$","IPV6ADDRESS7$","IPV6ADDRESS8$","IPV6ADDRESS9$","join","ZONEID$","UNRESERVED$$","PCHAR$","RegExp","IPV4ADDRESS$","IPV6ADDRESS$","buildExps","maxInt","regexPunycode","regexNonASCII","regexSeparators","errors","stringFromCharCode","String","RangeError","parts","string","encoded","array","fn","output","extra","digitToBasic","digit","flag","adapt","k","firstTime","delta","baseMinusTMin","base","decode","inputLength","input","n","bias","basic","index","oldi","w","codePoint","t","baseMinusT","out","encode","ucs2decode","currentValue","basicLength","handledCPCount","m","handledCPCountPlusOne","qMinusT","punycode","mapDomain","SCHEMES","c","chr","e","newStr","il","parseInt","c2","c3","decodeUnreserved","decStr","pctDecChars","protocol","components","matches","host","address","zone","last","first","firstFields","lastFields","isLastFieldIPv4Address","fieldCount","lastFieldsStart","fields","_normalizeIPv4","longestZeroFields","field","lastLongest","newHost","newFirst","newLast","URI_PARSE","NO_MATCH_IS_UNDEFINED","options","uriString","_normalizeIPv6","schemeHandler","uriTokens","$1","$2","RDS1","RDS2","RDS3","RDS5","im","Error","s","authority","_recomposeAuthority","removeDotSegments","skipNormalization","target","serialize","relative","IRI_PROTOCOL","URI_PROTOCOL","handler","http","O","VCHAR$$","UNRESERVED","PCT_ENCODED","NOT_LOCAL_PART","NOT_HFNAME","NOT_HFVALUE","mailtoComponents","to","unknownHeaders","headers","hfields","hfield","toAddrs","unescapeComponent","addr","toAddr","atIdx","localPart","domain","URN_PARSE","urnComponents","scheme","nid","nss","urnScheme","uriComponents","UUID","uuidComponents","uuid","https","mailto","urn","schemelessOptions","source","resolveComponents","uri","typeOf","uriA","uriB","equal","constructor","flags","valueOf","key","checkDataType","checkDataTypes","dataTypes","data","code","types","toHash","object","null","number","integer","coerceToTypes","optionCoerceTypes","COERCE_TO_TYPES","getProperty","escapeQuotes","require$$0","ucs2length","len","pos","charCodeAt","varOccurences","dataVar","match","varReplace","expr","replace","cleanUpCode","EMPTY_ELSE","EMPTY_IF_NO_ELSE","EMPTY_IF_WITH_ELSE","finalCleanUpCode","async","ERRORS_REGEXP","REMOVE_ERRORS_ASYNC","RETURN_ASYNC","REMOVE_ERRORS","ROOTDATA_REGEXP","REMOVE_ROOTDATA","schemaHasRules","schema","rules","schemaHasRulesExcept","exceptKeyword","schemaUnknownRules","toQuotedString","getPathExpr","currentPath","jsonPointers","joinPaths","getPath","path","escapeJsonPointer","getData","$data","lvl","paths","up","jsonPointer","JSON_POINTER","test","RELATIVE_JSON_POINTER","segments","segment","unescapeJsonPointer","unescapeFragment","decodeURIComponent","escapeFragment","encodeURIComponent","dataType","negate","EQUAL","AND","OK","NOT","hash","IDENTIFIER","SINGLE_QUOTE","util","traverse","module","exports","opts","cb","_traverse","pre","post","jsonPtr","rootSchema","parentJsonPtr","parentKeyword","parentSchema","keyIndex","sch","arrayKeywords","propsKeywords","keywords","allKeys","skipKeywords","additionalItems","additionalProperties","propertyNames","not","allOf","anyOf","oneOf","definitions","properties","patternProperties","dependencies","default","enum","const","required","maximum","minimum","exclusiveMaximum","exclusiveMinimum","multipleOf","maxLength","minLength","pattern","format","maxItems","minItems","uniqueItems","maxProperties","minProperties","compile","root","ref","refVal","_refs","_schemas","SchemaObject","inlineRef","_opts","inlineRefs","validate","_compile","baseId","res","resolveSchema","p","URI","refPath","_getFullPath","getFullPath","_getId","id","normalizeId","resolveRecursive","getJsonPointer","parsedRef","resolveUrl","fullPath","url","ids","schemaId","baseIds","fullPaths","localRefs","self","PREVENT_SCOPE_CHANGE","fragment","part","$ref","SIMPLE_INLINED","limit","checkNoRef","countKeys","count","Infinity","normalize","TRAILING_SLASH_HASH","Validation","errorSubclass","ajv","validation","MissingRef","MissingRefError","missingRef","missingSchema","Subclass","create","cmp","f","cycles","node","aobj","bobj","seen","toJSON","isFinite","TypeError","seenIndex","it","$keyword","$ruleType","$async","$refKeywords","RULES","all","$id","strictKeywords","$unknownKwd","$keywordsMsg","logger","isTop","sourceCode","processCode","$lvl","level","$dataLvl","dataLevel","$schema","$schemaPath","schemaPath","$errSchemaPath","errSchemaPath","$breakOnError","allErrors","$valid","$$outStack","createErrors","errorPath","messages","verbose","__err","pop","compositeRule","$top","rootId","dataPathArr","useDefaults","strictDefaults","$defaultMsg","$closingBraces1","$closingBraces2","$typeSchema","type","$typeIsArray","nullable","extendRefs","$comment","coerceTypes","$coerceToTypes","$rulesGroup","$shouldUseGroup","$method","$dataType","$coerced","$bracesCoercion","arr1","$type","$i","l1","$parentData","arr2","i2","l2","arr3","$propertyKey","i3","l3","$sch","$passData","useDefault","arr4","l4","arr5","$rule","i5","l5","$shouldUseRule","$code","keyword","implements","impl","$ruleImplementsSomeKeyword","ValidationError","errorClasses","refs","patterns","patternsHash","defaults","defaultsHash","customRules","checkCompiling","compilation","_compilations","compiling","callValidate","apply","arguments","formats","_formats","localCompile","cv","endCompiling","_schema","_root","isRoot","validateGenerator","resolveRef","usePattern","useCustomRule","vars","refValCode","patternCode","defaultCode","customRuleCode","Function","makeValidate","error","_refVal","refCode","refIndex","resolvedRef","rootRefId","addLocalRef","localSchema","refId","replaceLocalRef","removeLocalRef","inline","regexStr","valueStr","stableStringify","rule","validateSchema","deps","definition","every","errorsText","macro","compIndex","statement","Cache","_cache","put","del","clear","DATE","DAYS","TIME","HOSTNAME","URITEMPLATE","URL","JSON_POINTER_URI_FRAGMENT","mode","date","year","month","day","isLeapYear","full","hour","minute","second","timeZone","fast","email","hostname","ipv4","ipv6","regex","dateTime","DATE_TIME_SEPARATOR","NOT_URI_FRAGMENT","Z_ANCHOR","$schemaValue","$isData","$isMax","$exclusiveKeyword","$schemaExcl","$isDataExcl","$op","$notOp","$errorKeyword","$schemaValueExcl","$exclusive","$exclType","$exclIsNumber","$opStr","$opExpr","unicode","$refCode","$refVal","$message","missingRefs","$it","$nextValid","passContext","__callValidate","$closingBraces","$currentBaseId","$allSchemasEmpty","$errs","$wasComposite","$idx","$dataNxt","$nextData","$nonEmptySchema","$schemaDeps","$propertyDeps","$ownProperties","ownProperties","$property","$deps","$currentErrorPath","$useData","$prop","$propertyPath","$missingProperty","_errorDataPathProperty","$vSchema","$unknownFormats","unknownFormats","$allowUnknown","$format","$isObject","$formatType","$formatRef","$thenSch","$elseSch","$thenPresent","$elsePresent","$ifClause","$additionalItems","$currErrSchemaPath","require$$11","require$$12","require$$13","require$$14","multipleOfPrecision","$allErrorsOption","$prevValid","$passingSchemas","$key","$dataProperties","$schemaKeys","$pProperties","$pPropertyKeys","$aProperties","$someProperties","$noAdditional","$additionalIsSchema","$removeAdditional","removeAdditional","$checkAdditional","$required","loopRequired","$requiredHash","i1","$pProperty","$additionalProperty","$useDefaults","$hasDefault","i4","$invalidName","$propertySch","$loopRequired","$itemType","require$$23","KEYWORDS","metaSchema","keywordsJsonPointers","compileAsync","meta","callback","loadSchema","loadMetaSchemaOf","schemaObj","_addSchema","_compileAsync","loadMissingSchema","added","schemaPromise","_loadingSchemas","removePromise","addSchema","getSchema","$compile","$inline","$macro","$ruleValidate","$validateCode","$definition","$rDef","$validateSchema","$ruleErrs","$ruleErr","$asyncKeyword","statements","$parentDataProperty","def_callRuleValidate","modifying","valid","def_customError","simpleTypes","validateKeyword","_addRule","ruleGroup","rg","custom","throwError","_validateKeyword","definitionSchema","Ajv","schemaKeyRef","_meta","_skipValidation","checkUnique","addMetaSchema","skipValidation","throwOrLogError","defaultMeta","META_SCHEMA_ID","keyRef","_getSchemaObj","compileSchema","_fragments","_getSchemaFragment","removeSchema","_removeAllSchemas","cacheKey","addFormat","separator","text","dataPath","shouldAddSchema","cached","addUsedSchema","recursiveMeta","willValidate","currentOpts","_metaOpts","_validate","addKeyword","customKeyword","getKeyword","removeKeyword","$dataMetaSchema","META_IGNORE_OPTIONS","META_SUPPORT_DATA","noop","setLogger","cache","ALL","group","implKeywords","ruleModules","_get$IdOrId","_get$Id","chooseGetId","errorDataPath","metaOpts","getMetaSchemaOptions","addInitialFormats","addInitialKeywords","$dataSchema","addDefaultMetaSchema","optsSchemas","schemas","addInitialSchemas","TokenName","lookahead","ASTNode","visit","visitor","elements","left","right","args","unshift","callee","consequent","alternate","property","argument","children","ILLEGAL","RegexNonAsciiIdentifierStart","RegexNonAsciiIdentifierPart","assert","condition","isDecimalDigit","ch","isHexDigit","isOctalDigit","isWhiteSpace","isLineTerminator","isIdentifierStart","fromCharCode","isIdentifierPart","skipComment","scanHexEscape","prefix","toLowerCase","scanUnicodeCodePointEscape","cu1","cu2","getEscapedIdentifier","substr","scanIdentifier","start","getIdentifier","end","scanPunctuator","code2","ch2","ch3","ch4","ch1","scanNumericLiteral","scanHexLiteral","octal","scanOctalLiteral","parseFloat","scanRegExp","body","classMarker","terminated","literal","scanRegExpBody","search","scanRegExpFlags","tmp","$0","exception","testRegExp","advance","quote","scanStringLiteral","lex","token","peek","finishBinaryExpression","operator","finishCallExpression","finishIdentifier","finishLiteral","raw","finishMemberExpression","computed","member","finishProperty","kind","messageFormat","msg","whole","description","throwUnexpected","expect","matchKeyword","parseArrayInitialiser","parseConditionalExpression","finishArrayExpression","parseObjectPropertyKey","parseObjectProperty","parseObjectInitialiser","finishObjectExpression","legalKeywords","parsePrimaryExpression","parseExpression","parseGroupExpression","parseArguments","parseNonComputedMember","isIdentifierName","parseNonComputedProperty","parseComputedMember","parsePostfixExpression","parseLeftHandSideExpressionAllowCall","parseUnaryExpression","finishUnaryExpression","binaryPrecedence","prec","marker","markers","stack","parseBinaryExpression","finishConditionalExpression","NaN","E","LN2","LN10","LOG2E","LOG10E","PI","SQRT1_2","SQRT2","MIN_VALUE","MAX_VALUE","fname","_","$","isString","empty","substring","splitAccessPath","stringValue","hop","codegen","cast","lastIndexOf","fncall","abs","acos","asin","atan","atan2","ceil","cos","exp","min","sin","sqrt","tan","clamp","now","utc","datetime","hours","minutes","seconds","milliseconds","timezoneoffset","utcdate","utcday","utcyear","utcmonth","utchours","utcminutes","utcseconds","utcmilliseconds","indexof","lastindexof","reverse","upper","lower","trim","regexp","if","opt","whitelist","toSet","blacklist","constants","Constants","functions","Functions","globalvar","fieldvar","globals","memberDepth","outputGlobal","isFunction","ast","generator","Generators","Literal","Identifier","MemberExpression","stripQuotes","CallExpression","ArrayExpression","BinaryExpression","UnaryExpression","ConditionalExpression","LogicalExpression","ObjectExpression","Property","textDefault","fill","font","fontSize","opacity","baseline","BR_PROP_DEFAULT","none","rect","gradient","tick","grid","symbol","stroke","line","area","strokeWidth","trail","title","DEFAULT_EASE","vegaConfig","padding","autosize","background","events","allow","mark","arc","image","shape","size","style","fontWeight","point","circle","square","cell","orient","anchor","offset","subtitlePadding","axis","minExtent","maxExtent","bandPosition","domainWidth","domainColor","gridWidth","gridColor","labels","labelAngle","labelLimit","labelOffset","labelPadding","ticks","tickColor","tickOffset","tickRound","tickSize","tickWidth","titlePadding","axisBand","projection","legend","gridAlign","columnPadding","rowPadding","symbolDirection","gradientDirection","gradientLength","gradientThickness","gradientStrokeColor","gradientStrokeWidth","gradientLabelOffset","labelAlign","labelBaseline","labelOverlap","symbolLimit","symbolType","symbolSize","symbolOffset","symbolStrokeWidth","symbolBaseFillColor","symbolBaseStrokeColor","titleLimit","titleOrient","layout","direction","range","category","ordinal","heatmap","ramp","diverging","extent","encodify","DEFAULT_STYLE","styles","EMPTY_ENCODE","enter","exit","update","axisCompPos","scName","scale","y","band","titleAngle","tickLength","attr","vgConfig","axisLabelAlign","legendLabelAlign","lableAngle","scaleType","axisTextDpos","LEGEND_SYMBOL_CHANNEL","DEFAULT_ENCODE_LEGEND","defaultTitleEncode","vg.EMPTY_ENCODE","defaultEncode","grLength","grThickness","grLabelOffset","dx","dy","signal","vg.legendLablePos","align","vg.legendLabelAlign","vg.baseline","angle","vg.lableAngle","symbols","channel","width","height","entries","pairs","bands","mult","x2","y2","vg.legendBandPos","DEFAULT_ENCODE","vg.axisCompPos","vg.axisTextDpos","vg.axisLabelAlign","vg.tickLength","gridScale","vg.gridLength","vg.titleAngle","vg.titlePos","getEaseFn","easeFnName","toUpperCase","findAfterSibling","scene","getJoinInfo","__gemini__","findComp","role","svgRender","vegaScene","svg","vega.SVGRenderer","initialize","document","createElement","render","DOMParser","parseFromString","documentElement","gradientRender","d3RootSelection","vega.sceneFromJSON","vega.sceneToJSON","gradientDom","getElementsByTagName","firstElementChild","d3DefsSelection","select","append","appendChild","window","location","origin","pathname","propMap","tweaks","propName","val","defs","excludes","elmType","twk","computeScale","scales","scNames","getScales","initial","final","isLinearMarktype","mtype","computeHasFacet","compSpec","parent","from","facet","getFacet","isGroupingMarktype","marktype","findMark","marks","markName","findData","dataName","findFilter","transform","find","Enumerator","enumDef","views","workingSpec","enumVals","computeFilteringValues","vega.View","vega.parse","computeNewSpec","renderer","run","getStops","stopN","currSpec","easeFn","ease","staggering","stop_n","view","_runtime","extractData","getId","found","datum","identifyData","currDataKeys","joinDataInfo","newDataKeys","cKey","nKey","accMap","set","encodes","dSet","_getScales","elem","d_i","d_f","bind","valI","valF","d3.interpolate","filteringValues","values","stepSize","iVal","sVis","fVal","eVis","vgCodegen","parsedASTNode","newFilterExpr","enumerateSteps","enumDefs","enumerator","foundEnumDef","enumedConcatBlock","fetchEnumVal","enumerated","def","timeline","totalDuration","staggerings","enumerators","by","overlap","order","subStaggering","autoScaleOrder","markStep","component","change","timing","axisStep","domainDimension","legendStep","pauseStep","viewStep","duration","ratio","specChecker","newSpec","parsedTimelineBlock","readBlock","assignTiming","timePointer","alternates","alterTimeStamp","alter","mainSteps","attachStaggering","enumeratorDef","attachEnumerators","collectResolves","tracksPerAlterId","allAlterIds","conflictsPerAlterId","conflictedAlterIds","conf","checkConflict","multiplier","readSyncBlock","readConcatBlock","concatBlock","concatenated","alternateConcats","newMult","reformedBlocks","newBlock","permutateOnlyContainNames","concatenated_i","blocks","names","filtered","indices","containNames","permutate","workingArr","permutatedOne","syncBlock","newBlocks","stgDef","facetData","facetDef","groupby","d3\n    .nest","unpackData","unpacked","getMarkData","isGroupingMtype","hasFacet","getEmptyLegendData","getLegendData","returnData","pair","labelG","bandG","gradientG","entryG","getAxisData","subComp","computeIdMaker","joinThem","iData","fData","computeId","updateData","enterData","exitData","takenChecker","iDatum","foundIndex","fDatum","animSet","joinKey","setJoinInfo","extendedIDatum","extendedFDatum","taken","attachAggData","aggData","rawData","aggId","agg","rawDatum","aggDatum","f_i","as","appendPostfix","postFix","getAggregate","aggregate","sSpec","eSpec","dataSource_f","dset","trsfm","dataSource_i","dataPreservedScale","tempSpec","scaleSpec","sc","computeKeptEncode","manualEncode","referenceEncode","keptEncode","replacePositionAttrs","targetMarktype","targetEncode","POSITION_ATTRS","replaceRules","replaceBy","remove","hasAll","removedAttrs","lastState","eView","isAdd","isRemove","doEnter","doExit","aggregates","marktypes","signals","signalsFinal","sgName","finalScaleNames","styleEncodes","styleEncode","manualEncodeEnterWithoutInitial","intermediate","doTicks","doLabels","doAxisG","doTitle","doDomain","doGrid","compState","sameDomainDimension","scaleDefs","scaleDef","allEncodes","subComps","axisGDatumFinal","scenegraph","axisGEncodeBaseFinal","subComponent","subCompEncode","getAxisSubCompEncodes","doSymbols","doEntries","doGradient","doLegendG","legendTypes","legendType","defaultSubcompEncode","comps","compEncode","which","getLegendSubCompEncodes","finalSignalNames","viewHeight","viewWidth","fRootDatum","getLegendType","legendCompSpec","isBand","getComponents","vgSpec","collectComp","currComp","newComp","axes","legends","newMark","getChanges","sComponents","eComponents","IDENTIFIERS","comp","merged","sComp","matchedId","eComp","getViewChange","_viewWidth","_viewHeight","_origin","attachChanges","changes","getDefaultChange","attachStates","state","sView","sComps","initialState","baseEncode","axisGDatumInitial","iRootDatum","initializeState","ending","getMoments","label","initialData","enumed","newRawInfo","computeStates","preFetchCurrData","nextData","currData","computeDatumId","subCompEncName","iDataSubComp","fDataSubComp","ci","cf","iDataAnimSets","fDataAnimSets","getComputeId","stops","doUpdate","joinFields","isGroupingMarktypes","facets","groupedData","unpackedData","sameData","joinData","lastStep","updatedSpec","lastMarkComp","old","newI","newAxis","newLegend","updateSpec","scaleOrderValid","foundScale","vals","d2","scaleDomain","legendEnumDefs","identifyDatum","textOffset","h","lineHeight","getStyle","transformItem","typeMap","M","L","H","V","C","S","Q","T","A","commandObject","commandString","param","commandToString","command","params","convertToSameType","aCommand","bCommand","conversionMap","x1","y1","readFromBKeys","aConverted","bKey","bValue","aValue","includes","extend","commandsToExtend","referenceCommands","numPointsToExtend","initialCommandIndex","counts","refCommand","minDistance","minCommand","distance","extended","numExtended","commandToAdd","extend2","alongTo","subM","subMinDistance","subDistance","interpolatePath","aNormalized","bNormalized","aPoints","bPoints","aCommands","bCommands","aProcessed","bProcessed","stringInterpolator","d3.interpolateString","interpolatePath2","hasZ","aExtent","d3.extent","bExtent","aHeadI","bHeadI","aTop","bTop","aBottom","bBottom","hasBottom","interpolateOutline","tail","isBottom","getBody","getHead","getTail","bodyMin","bodyMax","isTail","commands","isShrink","phases","phase","rectInterpolator","oldD","getRect","d3.select","encode_i","encode_f","scale_i","primary","secondary","scale_f","signal_i","signal_f","symbolInterpolator","getShape","shape_i","shape_f","shape_i_diminished","shape_f_diminished","isMorph","areaLineInterpolatorWithScales","interpolateStyle","alongTos","marktype_i","marktype_f","alongTo_i","alongTo_f","paths_11","areaLineDToData","paths_12","paths_21","paths_22","isValidPath","interpolator_scale1","interpolator_scale2","areaLineInterpolator","dataA","dataB","_encodes","computeIdA","computeIdB","La","Lb","computeLineInterpolator","linePaths","intp","interpolators","fromPath","toPath","fromData","toData","toBeAssembled","pathPairs","interpolator1","interpolator2","fetchAttributes","d3Selection","prevData","attrTween","getPropVal","tempP","asTween","styleTween","propInfo","trfD","transformD","decodeEncode","alignFactor","center","getBBox","newD","xc","vega\n        .pathRectangle","isUpdate","closest","rectD","initialMarktype","getFill","decodedValue","_encode","hasProp","isDiminished","cornerRadius","subEncode","yc","vega\n          .pathRectangle","context","d3.path","vega.pathSymbols","draw","newData","defaultD","newVal","bandwidth","d3\n          .line","d3\n            .area","y0","x0","vega.pathTrail","defined","inherit","subScales","enAttr","subEnAttr","getVal","evalSignalVal","finalVal","bw","fValPrimary","fValSecondary","signalVal","VEGA_FUNCTIONS","vega.timeFormat","vega.timeUnitSpecifier","vegaExpression.codegen","fnDef","extraFunctions","extraFunctionNames","codegenVal","vegaExpression.parse","ORDER","ascending","d3.ascending","descending","d3.descending","getOrderFn","staggeredTiming","grouped","dataWithTiming","__staggering_id__","d3\n      .nest","sortKeys","d3.easeLinear","delta_e","alpha","durations","delayAcc","delays","dur","currDelay","timings","groups","g","getFlattenTimings","g_t","computeTiming","finalData","stepTiming","joinSet","enumStepComputeTiming","datum_i","getDatum","datum_f","getSvgElmType","markType","addMark","before","hasGroup","insert","INITIAL_STATUS","LEGEND_CHANNELS","LIBRARY","joinKeyGen","subcomp","initialOrFinal","done","subComponents","transitionStatus","selectAll","doneMaker","rootMark","rootScene","sib","newLegendScene","getElementsByClassName","addLegend","d3.selectAll","fLegendG","transition","fLegendD","enterPairSubGs","selection","svgElmType","subCompEnumerator","getValues","computedScales","calculateGetValeus","allProps","initials","subCompTransition","interpolateAlongEnumMaker","tween","textInterpolator","innerHTML","nextDataLabels","currDataLabels","d3.local","each","enterPairsI","enterPairsIsubG","enterSymbolsI","enterLabelsI","actingScales","enterPairsF","enterSymbolsF","enterLabelsF","exitPairsI","exitPairsF","exitSymbolsF","exitLabelsF","updatePairsF","updateSymbolsF","updateLabelsF","gradientSubComp","bandsG","titleG","enterTitleI","enterTitleF","exitTitleF","subCompName","subCompG","subCompSvgElmType","subCompProps","subCompSelection","enterSubCompI","enterSubCompF","exitSubCompF","updateSubCompF","gradCompSelection","vgDatum","gradientId","color","updateGradientFill","animVis","defaultDo","newAxisScene","prior","axisSubG","addAxis","fAxisG","calculateGetValues","tickG","TICK_ATTRS","newBoundTicks","initialTicks","enterTicksI","enterTicksF","exitTicksI","exitTicksF","LABEL_ATTRS","newBoundLabels","initialLabels","enterLabelI","enterLabelF","exitLabelI","exitLabelF","gridG","GRID_ATTRS","newBoundGrids","initialGrids","grids","enterGridI","enterGridF","exitGridI","exitGridF","TITLE_ATTRS","DOMAIN_ATTRS","domainG","iDomainEnter","fDomainEnter","iDomainExit","fDomainExit","interpolate","others","MARK_ATTRS","svgElmTypes","isValidMarktype","newBoundMarks","initialMarks","animMarks","setAttribute","animMarksI","animMarksF","newTimings","encodeInitial","enterI","setType","enterF","exitI","exitF","doStatusUpdate","filterUpdate","updateF","areaLine","MARK_ATTRS_DATA_INTERPOLATE","isAreaLineMarktype","pahtData","nuancedAttr","markGs","d3\n          .selectAll","d3\n          .select","enterIG","parentName","d3\n        .selectAll","d3\n        .select","exitMark","enterFMark","exitMarks","markG","classed","getProp","isAllDone","exitIMark","exitFMark","updateFMark","enterIMark","marktypeChange","svgEncode","getAttribute","_w","_h","rootEncode","pause","mTypeI","mTypeF","extendedSchedule","mainTimeline","getTimeline","extendedTimeline","scheduleAlternator","getTimelineAlternator","validateScaleOrder","altTimeline","foundTrack","attachAnimTemplates","Actuator","Gemini","startVisSpec","endVisSpec","runAsync","finalTimeline","CHANNEL_TO_ATTRS","attrs","CHANNELS","CHANNEL_TO_ATTRS_OBJ","getSubEncodeByChannel","otherEncode","channelRelatedAttrs","ch2Attrs","getCoreAttr","coreAttr","detectDiffs","userInput","signalDiffs","detectSignalDiffs","scaleDiffs","detectScaleDiffs","compDiffs","detectMarkDiffs","detectAxisDiffs","detectLegendDiffs","viewDiffs","detectViewDiff","appendCompScaleDiff","usedScales","compScaleDiffDetails","compScaleDiff","scaleName","markDiffs","deltaW","deltaH","add","enAttrs_i","enAttrs_f","usedEnAttrs","encodeDiffs","subEncode_i","subEncode_f","opacityVal_i","opacityVal_f","rangeDelta","isDiffData","userInputScales","scaleDiff","rangeVals_i","rangeVals_f","domainVals_i","domainVals_f","domainValueDiff","userInputDomainDimensionDiff","domainSpaceDiff","stayDiscrete","legendDiffs","legend_i","legend_f","legendGDatum","axisDiffs","axis_i","axis_f","axisGDatum","paddingDiff","MIN_POS_DELTA","same","sg_f","sg_i","diff","column","row","iFields","fFields","sharedFields","mappedIData","mappedFData","MarkSummary","markDiff","vegaView","extraDiffsByMarktypeChange","extraDiff","applyDiff","containAnyAttrSet","possibleAttrSets","hasAttrs","pseudoTimeline","stageN","pseudoTl","yAxisViewChange","xAxisViewChange","markViewChanges","stage","pseudoStep","when","otherAxis","side","checkViewAxisConstraint","viewChanges","vc","markViewChange","rightLegendVCs","bottomLegendVCs","checkViewLegendConstraint","markPseduoSteps","factorSets","current","checkMarkConstraint","enumeratePseudoTimelines","diffs","pseudoTimelines","enumedMarksPusedoSteps","allFactors","diffInfo","extraFactorsByMarktype","chName","chDiff","findAllFactors","skippingCondition","SkippingConditions","factorAssignment","factorLen","quotient","assignment","getFactorAssignment","applyingFactors","factor","factorId","check","reasons","markCompSummary","isXEncodeValid","isYEncodeValid","checkMarkComp","applyingDiffs","applyMarkDiffs","newSkippingCondition","reason","include","register","appFctrs","fctrSets","prevFactorSet","factorSet","newPseudoStep","applied","extraByMarktype","axespseudoSteps","factors","getAxisPseudoSteps","legendspseudoSteps","getLegendPseudoSteps","arrs","enumArrFn","allArrs","enumArraysByItems","enumTlByStep","currSync","pStep","increase","decrease","appendDiff","incOrDec","needViewDiff","appendViewDiff","xAxisPStep","yAxisPStep","aPStep","newStage","gridChangingAxisPStep","appendGridChanges","appendTiming","pseudoSteps","deltaProp","hasViwRelatedScaleDiff","Tl","newTls","newTl","registered","satisfying","condF","sameDomain","foundFactor","diffDomain","noFactors","fctr","PERCEPTION_COST","cost","with","without","PENALTY_COMBOS","chunks","DISCOUNT_COMBOS","contain","evaluate","stageCosts","cappedStageCosts","totalCost","getCost","comboCost","piece","DG.DISCOUNT_COMBOS","DG.PENALTY_COMBOS","totalDiscount","combo","isChunk","subCondition","getComboCost","cap","tiebreaker","tiebreaker2","stepCost","DG.PERCEPTION_COST","with_without","sat","generateTimeline","includeMeta","defaultOpt","global","markCompDiff","scaleFactros","encodeFactors","encodeChange","relatedFactors","blankEncode","blankExitEncode","getBlankEncodeChange","dataSet","generateMarkCompStep","scaleDomainDimension","generateAxisCompStep","generateLegendCompStep","pseudoViewStep","generateViewCompStep","detected","pseudoTls","eval","compareCost","vl2vg4gemini","vlSpec","vegaLite.compile","vegaAxes","axesScales","d3.nest","rollup","axisWithGrid","axisWithoutGrid","zindex","mergeDuplicatedAxes","appendNamesOnGuides","animate","asJSON","objEqual","getUserInput","recomParameters","dataJoinKey","xDomainChange","xScaleDomainDimension","yDomainChange","yScaleDomainDimension","setUserInput","newParams","setState","loadExamples","exampleList","loadedExamples","d3","example","setupExample","exampleURL","editor","sVisEditor","eVisEditor","sSpecURL","eSpecURL","dataObj","setValue","gemSpecs","vegaEmbed","actions","recoms","noRecom","gemini","currExample","selectedSpecIndex","CodeCol","recomModalShow","currTab","monaco","process","languages","json","jsonDefaults","setDiagnosticsOptions","fileMatch","editorId","attachEditorRefs","editorRef","getModel","specType","newValue","onSpecChange","tabKey","TABKEY_TO_EDITORREF","sSpecText","eSpecText","lineNumbersMinChars","minimap","enabled","scrollBeyondLastLine","selectOnLineNumbers","indentSize","tabSize","wordWrap","wordWrapColumn","wordWrapMinified","wrappingIndent","language","allowToVegaButton","Col","className","xs","Tabs","onSelect","onTabChange","activeKey","Tab","eventKey","theme","gemSpecText","onChange","genChangeHandler","editorDidMount","genEditorDidMount","editorWillMount","Button","variant","disabled","onClick","genToVegaBtnClickHandler","Component","drawVis","targetElmQuery","messageBox","querySelector","classList","AnimContainer","updateAnimViewWithDebounce","debounce","updateAnimView","buttonDescription","controlBtnVariant","controlBtnDisabled","data-target-id","onControlBtnClick","hasBuffer","overflow","showMetaInfo","whiteSpace","prevProps","gemSpec","event","play","anim","onEnd","animDivElm","getElementById","bufferDivElm","reset","dataset","targetId","VisCol","debouncedUpdateSVis","updateSVis","debouncedUpdateEVis","updateEVis","Row","RecomModal","debouncedUpdateDuration","updateRecomParam","debouncedUpdateDataJoinKey","Modal","show","modalShow","onHide","aria-labelledby","Header","closeButton","Title","Body","InputGroup","Prepend","Text","htmlFor","Form","Control","onChangeStageN","placeholder","aria-label","aria-describedby","defaultValue","onChangeDuration","onChangeDataJoinKey","onChangeXScaleDomainDimension","onChangeYScaleDomainDimension","recom","md","stringHash","Card","getCustomizeBtnClickHandler","Footer","dataJoinInputElm","durationElm","updateRecomParameters","setValueOnEditor","ExampleSelect","maxWidth","examples","eg","GeminiSpecSelect","selectedGemSpecs","gemSpecJSON","updateSelectedSpecIndex","App","paramChange","newRecoms","newSpecText","newSpecState","onRecomHide","Container","fluid","showRecom","addEventListener","parsed","opener","postMessage","React","Boolean","ReactDOM","navigator","serviceWorker","ready","registration","unregister","catch"],"mappings":"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QotB,IAAK,aACrB,CAAEptB,KAAM,QAASotB,IAAK,WACtB,CAAEptB,KAAM,QAASotB,IAAK,QACtB,CAAEptB,KAAM,QAASotB,IAAK,YACtB,CAAEptB,KAAM,QAASotB,IAAK,cACtB,CAAEptB,KAAM,QAASotB,IAAK,UAExB,MACF,IAAK,OAUL,IAAK,OAUL,IAAK,SACHvvC,EAASA,EAAOiC,OAAO,CACrB,CAAEkgB,KAAM,OAAQotB,IAAK,aACrB,CAAEptB,KAAM,OAAQotB,IAAK,MACrB,CAAEptB,KAAM,OAAQotB,IAAK,MACrB,CAAEptB,KAAM,QAASotB,IAAK,eACtB,CAAEptB,KAAM,QAASotB,IAAK,UACtB,CAAEptB,KAAM,QAASotB,IAAK,aAExB,MACF,IAAK,OACHvvC,EAASA,EAAOiC,OAAO,CACrB,CAAEkgB,KAAM,YAAaotB,IAAK,KAC1B,CAAEptB,KAAM,OAAQotB,IAAK,aACrB,CAAEptB,KAAM,QAASotB,IAAK,WACtB,CAAEptB,KAAM,QAASotB,IAAK,QACtB,CAAEptB,KAAM,QAASotB,IAAK,eACtB,CAAEptB,KAAM,QAASotB,IAAK,YAExB,MACF,IAAK,WACHvvC,EAASA,EAAOiC,OAAO,CACrB,CAAEkgB,KAAM,OAAQotB,IAAK,KACrB,CAAEptB,KAAM,QAASotB,IAAK,WACtB,CAAEptB,KAAM,QAASotB,IAAK,OAAQC,KAAMnB,IACpC,CAAElsB,KAAM,QAASotB,IAAK,eACtB,CAAEptB,KAAM,QAASotB,IAAK,YAExB,MACF,IAAK,OACHvvC,EAASA,EAAOiC,OAAO,CACrB,CAAEkgB,KAAM,OAAQotB,IAAK,aACrB,CAAEptB,KAAM,OAAQotB,IAAK,MACrB,CAAEptB,KAAM,OAAQotB,IAAK,MACrB,CAAEptB,KAAM,QAASotB,IAAK,eACtB,CAAEptB,KAAM,QAASotB,IAAK,UACtB,CAAEptB,KAAM,QAASotB,IAAK,aAExB,MACF,IAAK,SACHvvC,EAASA,EAAOiC,OAAO,CACrB,CAAEkgB,KAAM,YAAaotB,IAAK,KAC1B,CAAEptB,KAAM,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","file":"static/js/main.5292fd06.chunk.js","sourcesContent":["class Animation {\n  constructor(schedule, rawInfo, spec) {\n    this.schedule = schedule;\n    this.moments = this.schedule.moments;\n    this.status = \"ready\";\n    this.spec = spec;\n    this.logs = [];\n    this._queue = [];\n    this.rawInfo = rawInfo;\n  }\n\n  log(timestamp, message, info) {\n    if (typeof message === \"string\" && typeof timestamp === \"number\") {\n      this.logs.push({\n        timestamp,\n        message,\n        info\n      });\n    }\n    return this.logs;\n  }\n\n  async play(targetElm) {\n    this.status = \"playing\";\n    // get moments and sort by sTime\n    const { moments } = this;\n\n    const globalSTime = new Date();\n    this._start(moments[0].starting, targetElm);\n    this.log(new Date() - globalSTime, \"0-th moment\");\n\n    for (let i = 1; i < moments.length; i++) {\n      const moment = moments[i];\n\n      await this._end(moment).then(() => {\n        const delay = Math.max(moment.time - (new Date() - globalSTime), 0);\n        return new Promise(resolve => setTimeout(() => resolve(), delay));\n      });\n      this._start(moment.starting, targetElm);\n      this.log(new Date() - globalSTime, `${i}-th moment`);\n\n      if (i === moments.length - 1) {\n        this.status = \"ready\";\n        return;\n      }\n    }\n  }\n\n  _start(steps, targetElm) {\n    steps.forEach(step => {\n      this._queue.push({\n        sTime: step.sTime,\n        eTime: step.eTime,\n        step,\n        result: step.template(this.rawInfo, step, targetElm) // contains the promise\n      });\n    });\n  }\n\n  async _end(moment) {\n    const { time } = moment;\n\n    const workingSteps = this._queue.filter(item => item.eTime === time);\n    for (let i = 0; i < workingSteps.length; i++) {\n      await workingSteps[i].result;\n    }\n  }\n}\n\nexport { Animation };\n","Array.prototype.contains = function(v, accessor) {\n  accessor =\n    accessor ||\n    (d => {\n      return d;\n    });\n  for (let i = 0; i < this.length; i++) {\n    if (accessor(this[i]) === accessor(v)) return true;\n  }\n  return false;\n};\nArray.prototype.containAll = function(arr, accessor) {\n  accessor =\n    accessor ||\n    (d => {\n      return d;\n    });\n  for (let i = 0; i < arr.length; i++) {\n    if (!this.contains(arr[i], accessor)) return false;\n  }\n  return true;\n};\n\nArray.prototype.unique = function(accessor) {\n  const arr = [];\n  for (let i = 0; i < this.length; i++) {\n    if (!arr.contains(this[i], accessor)) {\n      arr.push(this[i]);\n    }\n  }\n  return arr;\n};\n\nArray.prototype.sample = function(N) {\n  const tempThis = this.slice();\n  const sampled = [];\n  for (let i = 0; i < N; i++) {\n    sampled.push(\n      tempThis.splice([Math.floor(Math.random() * tempThis.length)], 1)[0]\n    );\n  }\n  return sampled;\n};\n\nArray.prototype.shuffle = function() {\n  for (let i = this.length; i; i--) {\n    const j = Math.floor(Math.random() * i);\n    [this[i - 1], this[j]] = [this[j], this[i - 1]];\n  }\n  return this;\n};\nArray.prototype.clone = function() {\n  return JSON.parse(JSON.stringify(this));\n};\nfunction stringifyDatumValue(value) {\n  if (value === null) {\n    return \"__null__\";\n  }\n  return value.toString();\n}\nfunction deepEqual(obj1, obj2) {\n  if (obj1 === obj2) {\n    return true;\n  }\n  if (isDate(obj1) && isDate(obj2)) {\n    return Number(obj1) === Number(obj2);\n  }\n  if (\n    typeof obj1 === \"object\" &&\n    obj1 !== undefined &&\n    typeof obj2 === \"object\" &&\n    obj2 !== undefined\n  ) {\n    const props1 = Object.keys(obj1);\n    const props2 = Object.keys(obj2);\n    if (props1.length !== props2.length) {\n      return false;\n    }\n\n    for (let i = 0; i < props1.length; i++) {\n      const prop = props1[i];\n\n      if (!Object.prototype.hasOwnProperty.call(obj2, prop) || !deepEqual(obj1[prop], obj2[prop])) {\n        return false;\n      }\n    }\n    return true;\n  }\n  return false;\n}\n\nfunction copy(obj) {\n  if (obj === undefined) {\n    return undefined;\n  }\n  return JSON.parse(JSON.stringify(obj));\n}\n// create a new obj that has the same keys pointing the same values/functions;\nfunction copy2(obj) {\n  return Object.keys(obj).reduce((acc, curr) => {\n    acc[curr] = obj[curr];\n    return acc;\n  }, {});\n}\nfunction flatten(arrays) {\n  return arrays.reduce((acc, curr) => {\n    acc = acc.concat(curr);\n    return acc;\n  }, []);\n}\n\nfunction permutate(arr) {\n  if (arr.length === 2) {\n    return [arr, [arr[1], arr[0]]];\n  }\n  return arr.reduce((acc, anchor, i) => {\n    const workingArr = copy(arr);\n    workingArr.splice(i, 1);\n\n    acc = acc.concat(\n      permutate(workingArr).map(newArr => {\n        return [anchor].concat(newArr);\n      })\n    );\n    return acc;\n  }, []);\n}\nfunction isDate(o) {\n  return o !== undefined && typeof o.getMonth === \"function\";\n}\n\nfunction enumArr(arr, item) {\n  const newArrs = [];\n  for (let i = 0; i < arr.length; i++) {\n    const newArr = copy(arr);\n    if (Array.isArray(newArr[i])) {\n      newArr[i].push(item);\n    } else {\n      newArr[i] = [newArr[i], item];\n    }\n    newArrs.push(newArr);\n  }\n  return newArrs;\n}\n\nfunction enumArraysByItems(arrs, items, enumArrFn = enumArr) {\n  let newArrs = copy(arrs);\n  items.forEach(item => {\n    newArrs = newArrs.reduce((allArrs, arr) => {\n      return (allArrs = allArrs.concat(enumArrFn(arr, item)));\n    }, []);\n  });\n  return newArrs;\n}\n\nfunction get(o, ...props) {\n  return props.reduce((obj, prop) => {\n    return !isNullOrUndefined(obj) && !isNullOrUndefined(obj[prop])\n      ? obj[prop]\n      : undefined;\n  }, o);\n}\n\nfunction isNullOrUndefined(obj) {\n  return obj === null || obj === undefined;\n}\nfunction isNumber(x) {\n  return typeof x === \"number\" && !isNaN(x);\n}\nfunction roundUp(num, d = 5) {\n  return Math.round(Math.pow(10, d) * num) / Math.pow(10, d);\n}\nArray.prototype.exclude = function(items, accessor = x => x) {\n  const newArr = this.slice();\n  for (const item of items) {\n    const i = newArr.findIndex(x => accessor(x) === accessor(item));\n    if (i >= 0) {\n      newArr.splice(i, 1);\n    }\n  }\n  return newArr;\n};\nfunction variance(nums) {\n  const mu = mean(nums);\n  return (\n    nums.reduce((acc, num) => (acc += Math.pow(num - mu, 2)), 0) / nums.length\n  );\n}\nfunction mean(nums) {\n  return nums.reduce((sum, num) => sum + num, 0) / nums.length;\n}\n\nfunction isEmpty(o) {\n  return typeof o === \"object\" && Object.keys(o).length === 0;\n}\n\nexport {\n  deepEqual,\n  copy,\n  copy2,\n  flatten,\n  permutate,\n  isNumber,\n  enumArraysByItems,\n  get,\n  roundUp,\n  variance,\n  mean,\n  isEmpty,\n  stringifyDatumValue\n};\n","export default function(parsedBlock, parsedSteps) {\n  let resolves = collect(parsedBlock);\n  // 1-2. collect the alternative timelines. (alterIds)\n  resolves.forEach(r => {\n    r.alterIds = parsedSteps\n      .filter(\n        step => step.alterId &&\n          (step.alterId.split(\":\")[0] === r.alterName)\n      )\n      .map(step => step.alterId)\n      .unique();\n\n    // Place \":main\" at first\n    const i = r.alterIds.findIndex(d => d.indexOf(\":main\") >= 0);\n    const head = r.alterIds.splice(i, 1);\n    r.alterIds = head.concat(r.alterIds);\n  });\n  return resolves;\n}\n\nfunction collect(block) {\n  let resolves = [];\n\n  if (block.sync) {\n    block.sync.forEach(blk => {\n      resolves = resolves.concat(collect(blk));\n    });\n  } else if (block.concat) {\n    block.concat.forEach(blk => {\n      resolves = resolves.concat(collect(blk));\n    });\n  }\n  if (block.resolve) {\n    resolves.push(block.resolve);\n  }\n  return resolves;\n}","class Schedule {\n  constructor(parsedSteps) {\n    // Assgin the sTime and eTime\n\n    let newParsedSteps = parsedSteps.map((stp, i) => {\n      return { ...stp, stepId: i };\n    });\n\n    this.tracks = newParsedSteps\n      .map(d => {\n        const trackName = (d.trackName = d.compName\n          ? `${d.compType}.${d.compName}`\n          : d.compType);\n\n        return {\n          name: trackName,\n          compType: d.compType,\n          compName: d.compName\n        };\n      })\n      .unique(d => d.name)\n      .map(track => {\n        return {\n          ...track,\n          steps: newParsedSteps.filter(d => d.trackName === track.name)\n        };\n      });\n  }\n\n\n  getTimeline(alterId) {\n    return this.tracks.map(track => {\n      return Object.assign({}, track, {\n        steps: track.steps.filter(\n          step => step.alterId === undefined || step.alterId.indexOf(alterId) >= 0\n        )\n      });\n    });\n  }\n\n  getTimelineAlternator(scaleOrderResovles) {\n    let counter = 0;\n    let dividers = scaleOrderResovles.reduce(\n      (acc, r, i) => {\n        acc.push(r.alterIds.length * acc[i]);\n        return acc;\n      },\n      [1]\n    );\n    const totalCount = dividers[dividers.length - 1];\n    dividers = dividers.slice(0, dividers.length - 1).sort((a, b) => b - a);\n    return () => {\n      counter += 1;\n      counter %= totalCount;\n      if (counter === 0) {\n        console.warn(\"Gemini cannot find the order to resolve.\");\n        return false;\n      }\n      return dividers.reduce(\n        (acc, divider, i) => {\n          const q = Math.floor(acc.remainder / divider);\n          acc.remainder -= q * divider;\n          const resolve = scaleOrderResovles[i];\n\n          const alterId = resolve.alterIds[q];\n\n          acc.tracks = acc.tracks.map(track => {\n            const newSteps = track.steps.filter(step => {\n              if (step.alterId === undefined) {\n                return true;\n              }\n              if (\n                step.alterId.split(\":\")[0] === alterId.split(\":\")[0] &&\n                step.alterId.split(\":\")[1] !== alterId.split(\":\")[1]\n              ) {\n                return false;\n              }\n\n              return true;\n            });\n            return Object.assign({}, track, { steps: newSteps });\n          });\n\n          return acc;\n        },\n        { tracks: this.tracks, remainder: counter }\n      ).tracks;\n    };\n  }\n\n\n}\n\n\n\n\n\nexport {Schedule};","export default function check(schedule, resolves) {\n  // 3. check if there is any component whose steps are overlapped by themselves.\n  let tracksPerAlterId = [{ alterId: \":main\", tracks: schedule.tracks }];\n  if (resolves.length > 0) {\n    tracksPerAlterId = resolves\n      .reduce((allAlterIds, resolve) => {\n        return allAlterIds.concat(resolve.alterIds);\n      }, [])\n      .map(alterId => {\n        return {\n          tracks: schedule.tracks.map(track => {\n            return {\n              ...track,\n              steps: track.steps.filter(\n                stp => !stp.alterId || alterId === stp.alterId\n              )\n            };\n          }),\n          alterId\n        };\n      });\n  }\n  const conflictsPerAlterId = tracksPerAlterId.map(findConflicts);\n  const conflictedAlterIds = conflictsPerAlterId\n    .filter(conflicts => conflicts.length > 0)\n    .map(conflicts => conflicts.alterId);\n\n  if (conflictedAlterIds.length === tracksPerAlterId.length) {\n    if (conflictsPerAlterId.length > 1) {\n      throw new Error(\n        \"All possible timelines have 1+ schedule conflict.\",\n        conflictsPerAlterId\n      );\n    } else {\n      throw new Error(\n        \"The timeline has 1+ schedule conflict.\",\n        conflictsPerAlterId\n      );\n    }\n  } else if (conflictedAlterIds.length > 0) {\n    if (\n      conflictsPerAlterId.find(conflicts =>\n        conflicts.find(conf => conf.alterId.indexOf(\":main\") >= 0)\n      )\n    ) {\n      console.warn(\n        \"The main timeline (specified timeline) has 1+ schedule conflict.\",\n        conflictsPerAlterId\n      );\n    } else {\n      console.warn(\n        \"Some possible timelines have 1+ schedule conflict.\",\n        conflictsPerAlterId\n      );\n    }\n  }\n  schedule.tracks = schedule.tracks.map(track => {\n    return {\n      ...track,\n      steps: track.steps.filter(\n        stp => conflictedAlterIds.indexOf(stp.alterId) < 0\n      )\n    };\n  });\n  resolves = resolves.map(resolve => {\n    return {\n      ...resolve,\n      alterIds: resolve.alterIds.filter(\n        id => conflictedAlterIds.indexOf(id) < 0\n      )\n    };\n  });\n\n  return {conflictsPerAlterId};\n}\n\n\nfunction findConflicts(tracksWithAlterId) {\n  const conflicts = [];\n  const { tracks } = tracksWithAlterId;\n  const { alterId } = tracksWithAlterId;\n\n  for (const track of tracks) {\n    const sortedSteps = track.steps.sort(\n      (stp1, stp2) => stp1.sTime - stp2.sTime\n    );\n    for (let i = 0; i < sortedSteps.length - 1; i++) {\n      if (sortedSteps[i].eTime > sortedSteps[i + 1].sTime) {\n        conflicts.push({\n          alterId,\n          conflictedSteps: [sortedSteps[i], sortedSteps[i + 1]],\n          compName: track.compName,\n          compType: track.compType\n        });\n      }\n    }\n  }\n\n  return conflicts;\n}","export function merge(...sets:Array<string>):string {\n\tif (sets.length > 1) {\n\t\tsets[0] = sets[0].slice(0, -1);\n\t\tconst xl = sets.length - 1;\n\t\tfor (let x = 1; x < xl; ++x) {\n\t\t\tsets[x] = sets[x].slice(1, -1);\n\t\t}\n\t\tsets[xl] = sets[xl].slice(1);\n\t\treturn sets.join('');\n\t} else {\n\t\treturn sets[0];\n\t}\n}\n\nexport function subexp(str:string):string {\n\treturn \"(?:\" + str + \")\";\n}\n\nexport function typeOf(o:any):string {\n\treturn o === undefined ? \"undefined\" : (o === null ? \"null\" : Object.prototype.toString.call(o).split(\" \").pop().split(\"]\").shift().toLowerCase());\n}\n\nexport function toUpperCase(str:string):string {\n\treturn str.toUpperCase();\n}\n\nexport function toArray(obj:any):Array<any> {\n\treturn obj !== undefined && obj !== null ? (obj instanceof Array ? obj : (typeof obj.length !== \"number\" || obj.split || obj.setInterval || obj.call ? [obj] : Array.prototype.slice.call(obj))) : [];\n}\n\n\nexport function assign(target: object, source: any): any {\n\tconst obj = target as any;\n\tif (source) {\n\t\tfor (const key in source) {\n\t\t\tobj[key] = source[key];\n\t\t}\n\t}\n\treturn obj;\n}","import { URIRegExps } from \"./uri\";\nimport { merge, subexp } from \"./util\";\n\nexport function buildExps(isIRI:boolean):URIRegExps {\n\tconst\n\t\tALPHA$$ = \"[A-Za-z]\",\n\t\tCR$ = \"[\\\\x0D]\",\n\t\tDIGIT$$ = \"[0-9]\",\n\t\tDQUOTE$$ = \"[\\\\x22]\",\n\t\tHEXDIG$$ = merge(DIGIT$$, \"[A-Fa-f]\"),  //case-insensitive\n\t\tLF$$ = \"[\\\\x0A]\",\n\t\tSP$$ = \"[\\\\x20]\",\n\t\tPCT_ENCODED$ = subexp(subexp(\"%[EFef]\" + HEXDIG$$ + \"%\" + HEXDIG$$ + HEXDIG$$ + \"%\" + HEXDIG$$ + HEXDIG$$) + \"|\" + subexp(\"%[89A-Fa-f]\" + HEXDIG$$ + \"%\" + HEXDIG$$ + HEXDIG$$) + \"|\" + subexp(\"%\" + HEXDIG$$ + HEXDIG$$)),  //expanded\n\t\tGEN_DELIMS$$ = \"[\\\\:\\\\/\\\\?\\\\#\\\\[\\\\]\\\\@]\",\n\t\tSUB_DELIMS$$ = \"[\\\\!\\\\$\\\\&\\\\'\\\\(\\\\)\\\\*\\\\+\\\\,\\\\;\\\\=]\",\n\t\tRESERVED$$ = merge(GEN_DELIMS$$, SUB_DELIMS$$),\n\t\tUCSCHAR$$ = isIRI ? \"[\\\\xA0-\\\\u200D\\\\u2010-\\\\u2029\\\\u202F-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF]\" : \"[]\",  //subset, excludes bidi control characters\n\t\tIPRIVATE$$ = isIRI ? \"[\\\\uE000-\\\\uF8FF]\" : \"[]\",  //subset\n\t\tUNRESERVED$$ = merge(ALPHA$$, DIGIT$$, \"[\\\\-\\\\.\\\\_\\\\~]\", UCSCHAR$$),\n\t\tSCHEME$ = subexp(ALPHA$$ + merge(ALPHA$$, DIGIT$$, \"[\\\\+\\\\-\\\\.]\") + \"*\"),\n\t\tUSERINFO$ = subexp(subexp(PCT_ENCODED$ + \"|\" + merge(UNRESERVED$$, SUB_DELIMS$$, \"[\\\\:]\")) + \"*\"),\n\t\tDEC_OCTET$ = subexp(subexp(\"25[0-5]\") + \"|\" + subexp(\"2[0-4]\" + DIGIT$$) + \"|\" + subexp(\"1\" + DIGIT$$ + DIGIT$$) + \"|\" + subexp(\"[1-9]\" + DIGIT$$) + \"|\" + DIGIT$$),\n\t\tDEC_OCTET_RELAXED$ = subexp(subexp(\"25[0-5]\") + \"|\" + subexp(\"2[0-4]\" + DIGIT$$) + \"|\" + subexp(\"1\" + DIGIT$$ + DIGIT$$) + \"|\" + subexp(\"0?[1-9]\" + DIGIT$$) + \"|0?0?\" + DIGIT$$),  //relaxed parsing rules\n\t\tIPV4ADDRESS$ = subexp(DEC_OCTET_RELAXED$ + \"\\\\.\" + DEC_OCTET_RELAXED$ + \"\\\\.\" + DEC_OCTET_RELAXED$ + \"\\\\.\" + DEC_OCTET_RELAXED$),\n\t\tH16$ = subexp(HEXDIG$$ + \"{1,4}\"),\n\t\tLS32$ = subexp(subexp(H16$ + \"\\\\:\" + H16$) + \"|\" + IPV4ADDRESS$),\n\t\tIPV6ADDRESS1$ = subexp(                                                            subexp(H16$ + \"\\\\:\") + \"{6}\" + LS32$), //                           6( h16 \":\" ) ls32\n\t\tIPV6ADDRESS2$ = subexp(                                                 \"\\\\:\\\\:\" + subexp(H16$ + \"\\\\:\") + \"{5}\" + LS32$), //                      \"::\" 5( h16 \":\" ) ls32\n\t\tIPV6ADDRESS3$ = subexp(subexp(                                 H16$) + \"?\\\\:\\\\:\" + subexp(H16$ + \"\\\\:\") + \"{4}\" + LS32$), //[               h16 ] \"::\" 4( h16 \":\" ) ls32\n\t\tIPV6ADDRESS4$ = subexp(subexp(subexp(H16$ + \"\\\\:\") + \"{0,1}\" + H16$) + \"?\\\\:\\\\:\" + subexp(H16$ + \"\\\\:\") + \"{3}\" + LS32$), //[ *1( h16 \":\" ) h16 ] \"::\" 3( h16 \":\" ) ls32\n\t\tIPV6ADDRESS5$ = subexp(subexp(subexp(H16$ + \"\\\\:\") + \"{0,2}\" + H16$) + \"?\\\\:\\\\:\" + subexp(H16$ + \"\\\\:\") + \"{2}\" + LS32$), //[ *2( h16 \":\" ) h16 ] \"::\" 2( h16 \":\" ) ls32\n\t\tIPV6ADDRESS6$ = subexp(subexp(subexp(H16$ + \"\\\\:\") + \"{0,3}\" + H16$) + \"?\\\\:\\\\:\" +        H16$ + \"\\\\:\"          + LS32$), //[ *3( h16 \":\" ) h16 ] \"::\"    h16 \":\"   ls32\n\t\tIPV6ADDRESS7$ = subexp(subexp(subexp(H16$ + \"\\\\:\") + \"{0,4}\" + H16$) + \"?\\\\:\\\\:\"                                + LS32$), //[ *4( h16 \":\" ) h16 ] \"::\"              ls32\n\t\tIPV6ADDRESS8$ = subexp(subexp(subexp(H16$ + \"\\\\:\") + \"{0,5}\" + H16$) + \"?\\\\:\\\\:\"                                + H16$ ), //[ *5( h16 \":\" ) h16 ] \"::\"              h16\n\t\tIPV6ADDRESS9$ = subexp(subexp(subexp(H16$ + \"\\\\:\") + \"{0,6}\" + H16$) + \"?\\\\:\\\\:\"                                       ), //[ *6( h16 \":\" ) h16 ] \"::\"\n\t\tIPV6ADDRESS$ = subexp([IPV6ADDRESS1$, IPV6ADDRESS2$, IPV6ADDRESS3$, IPV6ADDRESS4$, IPV6ADDRESS5$, IPV6ADDRESS6$, IPV6ADDRESS7$, IPV6ADDRESS8$, IPV6ADDRESS9$].join(\"|\")),\n\t\tZONEID$ = subexp(subexp(UNRESERVED$$ + \"|\" + PCT_ENCODED$) + \"+\"),  //RFC 6874\n\t\tIPV6ADDRZ$ = subexp(IPV6ADDRESS$ + \"\\\\%25\" + ZONEID$),  //RFC 6874\n\t\tIPV6ADDRZ_RELAXED$ = subexp(IPV6ADDRESS$ + subexp(\"\\\\%25|\\\\%(?!\" + HEXDIG$$ + \"{2})\") + ZONEID$),  //RFC 6874, with relaxed parsing rules\n\t\tIPVFUTURE$ = subexp(\"[vV]\" + HEXDIG$$ + \"+\\\\.\" + merge(UNRESERVED$$, SUB_DELIMS$$, \"[\\\\:]\") + \"+\"),\n\t\tIP_LITERAL$ = subexp(\"\\\\[\" + subexp(IPV6ADDRZ_RELAXED$ + \"|\" + IPV6ADDRESS$ + \"|\" + IPVFUTURE$) + \"\\\\]\"),  //RFC 6874\n\t\tREG_NAME$ = subexp(subexp(PCT_ENCODED$ + \"|\" + merge(UNRESERVED$$, SUB_DELIMS$$)) + \"*\"),\n\t\tHOST$ = subexp(IP_LITERAL$ + \"|\" + IPV4ADDRESS$ + \"(?!\" + REG_NAME$ + \")\" + \"|\" + REG_NAME$),\n\t\tPORT$ = subexp(DIGIT$$ + \"*\"),\n\t\tAUTHORITY$ = subexp(subexp(USERINFO$ + \"@\") + \"?\" + HOST$ + subexp(\"\\\\:\" + PORT$) + \"?\"),\n\t\tPCHAR$ = subexp(PCT_ENCODED$ + \"|\" + merge(UNRESERVED$$, SUB_DELIMS$$, \"[\\\\:\\\\@]\")),\n\t\tSEGMENT$ = subexp(PCHAR$ + \"*\"),\n\t\tSEGMENT_NZ$ = subexp(PCHAR$ + \"+\"),\n\t\tSEGMENT_NZ_NC$ = subexp(subexp(PCT_ENCODED$ + \"|\" + merge(UNRESERVED$$, SUB_DELIMS$$, \"[\\\\@]\")) + \"+\"),\n\t\tPATH_ABEMPTY$ = subexp(subexp(\"\\\\/\" + SEGMENT$) + \"*\"),\n\t\tPATH_ABSOLUTE$ = subexp(\"\\\\/\" + subexp(SEGMENT_NZ$ + PATH_ABEMPTY$) + \"?\"),  //simplified\n\t\tPATH_NOSCHEME$ = subexp(SEGMENT_NZ_NC$ + PATH_ABEMPTY$),  //simplified\n\t\tPATH_ROOTLESS$ = subexp(SEGMENT_NZ$ + PATH_ABEMPTY$),  //simplified\n\t\tPATH_EMPTY$ = \"(?!\" + PCHAR$ + \")\",\n\t\tPATH$ = subexp(PATH_ABEMPTY$ + \"|\" + PATH_ABSOLUTE$ + \"|\" + PATH_NOSCHEME$ + \"|\" + PATH_ROOTLESS$ + \"|\" + PATH_EMPTY$),\n\t\tQUERY$ = subexp(subexp(PCHAR$ + \"|\" + merge(\"[\\\\/\\\\?]\", IPRIVATE$$)) + \"*\"),\n\t\tFRAGMENT$ = subexp(subexp(PCHAR$ + \"|[\\\\/\\\\?]\") + \"*\"),\n\t\tHIER_PART$ = subexp(subexp(\"\\\\/\\\\/\" + AUTHORITY$ + PATH_ABEMPTY$) + \"|\" + PATH_ABSOLUTE$ + \"|\" + PATH_ROOTLESS$ + \"|\" + PATH_EMPTY$),\n\t\tURI$ = subexp(SCHEME$ + \"\\\\:\" + HIER_PART$ + subexp(\"\\\\?\" + QUERY$) + \"?\" + subexp(\"\\\\#\" + FRAGMENT$) + \"?\"),\n\t\tRELATIVE_PART$ = subexp(subexp(\"\\\\/\\\\/\" + AUTHORITY$ + PATH_ABEMPTY$) + \"|\" + PATH_ABSOLUTE$ + \"|\" + PATH_NOSCHEME$ + \"|\" + PATH_EMPTY$),\n\t\tRELATIVE$ = subexp(RELATIVE_PART$ + subexp(\"\\\\?\" + QUERY$) + \"?\" + subexp(\"\\\\#\" + FRAGMENT$) + \"?\"),\n\t\tURI_REFERENCE$ = subexp(URI$ + \"|\" + RELATIVE$),\n\t\tABSOLUTE_URI$ = subexp(SCHEME$ + \"\\\\:\" + HIER_PART$ + subexp(\"\\\\?\" + QUERY$) + \"?\"),\n\n\t\tGENERIC_REF$ = \"^(\" + SCHEME$ + \")\\\\:\" + subexp(subexp(\"\\\\/\\\\/(\" + subexp(\"(\" + USERINFO$ + \")@\") + \"?(\" + HOST$ + \")\" + subexp(\"\\\\:(\" + PORT$ + \")\") + \"?)\") + \"?(\" + PATH_ABEMPTY$ + \"|\" + PATH_ABSOLUTE$ + \"|\" + PATH_ROOTLESS$ + \"|\" + PATH_EMPTY$ + \")\") + subexp(\"\\\\?(\" + QUERY$ + \")\") + \"?\" + subexp(\"\\\\#(\" + FRAGMENT$ + \")\") + \"?$\",\n\t\tRELATIVE_REF$ = \"^(){0}\" + subexp(subexp(\"\\\\/\\\\/(\" + subexp(\"(\" + USERINFO$ + \")@\") + \"?(\" + HOST$ + \")\" + subexp(\"\\\\:(\" + PORT$ + \")\") + \"?)\") + \"?(\" + PATH_ABEMPTY$ + \"|\" + PATH_ABSOLUTE$ + \"|\" + PATH_NOSCHEME$ + \"|\" + PATH_EMPTY$ + \")\") + subexp(\"\\\\?(\" + QUERY$ + \")\") + \"?\" + subexp(\"\\\\#(\" + FRAGMENT$ + \")\") + \"?$\",\n\t\tABSOLUTE_REF$ = \"^(\" + SCHEME$ + \")\\\\:\" + subexp(subexp(\"\\\\/\\\\/(\" + subexp(\"(\" + USERINFO$ + \")@\") + \"?(\" + HOST$ + \")\" + subexp(\"\\\\:(\" + PORT$ + \")\") + \"?)\") + \"?(\" + PATH_ABEMPTY$ + \"|\" + PATH_ABSOLUTE$ + \"|\" + PATH_ROOTLESS$ + \"|\" + PATH_EMPTY$ + \")\") + subexp(\"\\\\?(\" + QUERY$ + \")\") + \"?$\",\n\t\tSAMEDOC_REF$ = \"^\" + subexp(\"\\\\#(\" + FRAGMENT$ + \")\") + \"?$\",\n\t\tAUTHORITY_REF$ = \"^\" + subexp(\"(\" + USERINFO$ + \")@\") + \"?(\" + HOST$ + \")\" + subexp(\"\\\\:(\" + PORT$ + \")\") + \"?$\"\n\t;\n\n\treturn {\n\t\tNOT_SCHEME : new RegExp(merge(\"[^]\", ALPHA$$, DIGIT$$, \"[\\\\+\\\\-\\\\.]\"), \"g\"),\n\t\tNOT_USERINFO : new RegExp(merge(\"[^\\\\%\\\\:]\", UNRESERVED$$, SUB_DELIMS$$), \"g\"),\n\t\tNOT_HOST : new RegExp(merge(\"[^\\\\%\\\\[\\\\]\\\\:]\", UNRESERVED$$, SUB_DELIMS$$), \"g\"),\n\t\tNOT_PATH : new RegExp(merge(\"[^\\\\%\\\\/\\\\:\\\\@]\", UNRESERVED$$, SUB_DELIMS$$), \"g\"),\n\t\tNOT_PATH_NOSCHEME : new RegExp(merge(\"[^\\\\%\\\\/\\\\@]\", UNRESERVED$$, SUB_DELIMS$$), \"g\"),\n\t\tNOT_QUERY : new RegExp(merge(\"[^\\\\%]\", UNRESERVED$$, SUB_DELIMS$$, \"[\\\\:\\\\@\\\\/\\\\?]\", IPRIVATE$$), \"g\"),\n\t\tNOT_FRAGMENT : new RegExp(merge(\"[^\\\\%]\", UNRESERVED$$, SUB_DELIMS$$, \"[\\\\:\\\\@\\\\/\\\\?]\"), \"g\"),\n\t\tESCAPE : new RegExp(merge(\"[^]\", UNRESERVED$$, SUB_DELIMS$$), \"g\"),\n\t\tUNRESERVED : new RegExp(UNRESERVED$$, \"g\"),\n\t\tOTHER_CHARS : new RegExp(merge(\"[^\\\\%]\", UNRESERVED$$, RESERVED$$), \"g\"),\n\t\tPCT_ENCODED : new RegExp(PCT_ENCODED$, \"g\"),\n\t\tIPV4ADDRESS : new RegExp(\"^(\" + IPV4ADDRESS$ + \")$\"),\n\t\tIPV6ADDRESS : new RegExp(\"^\\\\[?(\" + IPV6ADDRESS$ + \")\" + subexp(subexp(\"\\\\%25|\\\\%(?!\" + HEXDIG$$ + \"{2})\") + \"(\" + ZONEID$ + \")\") + \"?\\\\]?$\")  //RFC 6874, with relaxed parsing rules\n\t};\n}\n\nexport default buildExps(false);\n","import { URIRegExps } from \"./uri\";\nimport { buildExps } from \"./regexps-uri\";\n\nexport default buildExps(true);\n","'use strict';\n\n/** Highest positive signed 32-bit float value */\nconst maxInt = 2147483647; // aka. 0x7FFFFFFF or 2^31-1\n\n/** Bootstring parameters */\nconst base = 36;\nconst tMin = 1;\nconst tMax = 26;\nconst skew = 38;\nconst damp = 700;\nconst initialBias = 72;\nconst initialN = 128; // 0x80\nconst delimiter = '-'; // '\\x2D'\n\n/** Regular expressions */\nconst regexPunycode = /^xn--/;\nconst regexNonASCII = /[^\\0-\\x7E]/; // non-ASCII chars\nconst regexSeparators = /[\\x2E\\u3002\\uFF0E\\uFF61]/g; // RFC 3490 separators\n\n/** Error messages */\nconst errors = {\n\t'overflow': 'Overflow: input needs wider integers to process',\n\t'not-basic': 'Illegal input >= 0x80 (not a basic code point)',\n\t'invalid-input': 'Invalid input'\n};\n\n/** Convenience shortcuts */\nconst baseMinusTMin = base - tMin;\nconst floor = Math.floor;\nconst stringFromCharCode = String.fromCharCode;\n\n/*--------------------------------------------------------------------------*/\n\n/**\n * A generic error utility function.\n * @private\n * @param {String} type The error type.\n * @returns {Error} Throws a `RangeError` with the applicable error message.\n */\nfunction error(type) {\n\tthrow new RangeError(errors[type]);\n}\n\n/**\n * A generic `Array#map` utility function.\n * @private\n * @param {Array} array The array to iterate over.\n * @param {Function} callback The function that gets called for every array\n * item.\n * @returns {Array} A new array of values returned by the callback function.\n */\nfunction map(array, fn) {\n\tconst result = [];\n\tlet length = array.length;\n\twhile (length--) {\n\t\tresult[length] = fn(array[length]);\n\t}\n\treturn result;\n}\n\n/**\n * A simple `Array#map`-like wrapper to work with domain name strings or email\n * addresses.\n * @private\n * @param {String} domain The domain name or email address.\n * @param {Function} callback The function that gets called for every\n * character.\n * @returns {Array} A new string of characters returned by the callback\n * function.\n */\nfunction mapDomain(string, fn) {\n\tconst parts = string.split('@');\n\tlet result = '';\n\tif (parts.length > 1) {\n\t\t// In email addresses, only the domain name should be punycoded. Leave\n\t\t// the local part (i.e. everything up to `@`) intact.\n\t\tresult = parts[0] + '@';\n\t\tstring = parts[1];\n\t}\n\t// Avoid `split(regex)` for IE8 compatibility. See #17.\n\tstring = string.replace(regexSeparators, '\\x2E');\n\tconst labels = string.split('.');\n\tconst encoded = map(labels, fn).join('.');\n\treturn result + encoded;\n}\n\n/**\n * Creates an array containing the numeric code points of each Unicode\n * character in the string. While JavaScript uses UCS-2 internally,\n * this function will convert a pair of surrogate halves (each of which\n * UCS-2 exposes as separate characters) into a single code point,\n * matching UTF-16.\n * @see `punycode.ucs2.encode`\n * @see <https://mathiasbynens.be/notes/javascript-encoding>\n * @memberOf punycode.ucs2\n * @name decode\n * @param {String} string The Unicode input string (UCS-2).\n * @returns {Array} The new array of code points.\n */\nfunction ucs2decode(string) {\n\tconst output = [];\n\tlet counter = 0;\n\tconst length = string.length;\n\twhile (counter < length) {\n\t\tconst value = string.charCodeAt(counter++);\n\t\tif (value >= 0xD800 && value <= 0xDBFF && counter < length) {\n\t\t\t// It's a high surrogate, and there is a next character.\n\t\t\tconst extra = string.charCodeAt(counter++);\n\t\t\tif ((extra & 0xFC00) == 0xDC00) { // Low surrogate.\n\t\t\t\toutput.push(((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000);\n\t\t\t} else {\n\t\t\t\t// It's an unmatched surrogate; only append this code unit, in case the\n\t\t\t\t// next code unit is the high surrogate of a surrogate pair.\n\t\t\t\toutput.push(value);\n\t\t\t\tcounter--;\n\t\t\t}\n\t\t} else {\n\t\t\toutput.push(value);\n\t\t}\n\t}\n\treturn output;\n}\n\n/**\n * Creates a string based on an array of numeric code points.\n * @see `punycode.ucs2.decode`\n * @memberOf punycode.ucs2\n * @name encode\n * @param {Array} codePoints The array of numeric code points.\n * @returns {String} The new Unicode string (UCS-2).\n */\nconst ucs2encode = array => String.fromCodePoint(...array);\n\n/**\n * Converts a basic code point into a digit/integer.\n * @see `digitToBasic()`\n * @private\n * @param {Number} codePoint The basic numeric code point value.\n * @returns {Number} The numeric value of a basic code point (for use in\n * representing integers) in the range `0` to `base - 1`, or `base` if\n * the code point does not represent a value.\n */\nconst basicToDigit = function(codePoint) {\n\tif (codePoint - 0x30 < 0x0A) {\n\t\treturn codePoint - 0x16;\n\t}\n\tif (codePoint - 0x41 < 0x1A) {\n\t\treturn codePoint - 0x41;\n\t}\n\tif (codePoint - 0x61 < 0x1A) {\n\t\treturn codePoint - 0x61;\n\t}\n\treturn base;\n};\n\n/**\n * Converts a digit/integer into a basic code point.\n * @see `basicToDigit()`\n * @private\n * @param {Number} digit The numeric value of a basic code point.\n * @returns {Number} The basic code point whose value (when used for\n * representing integers) is `digit`, which needs to be in the range\n * `0` to `base - 1`. If `flag` is non-zero, the uppercase form is\n * used; else, the lowercase form is used. The behavior is undefined\n * if `flag` is non-zero and `digit` has no uppercase form.\n */\nconst digitToBasic = function(digit, flag) {\n\t//  0..25 map to ASCII a..z or A..Z\n\t// 26..35 map to ASCII 0..9\n\treturn digit + 22 + 75 * (digit < 26) - ((flag != 0) << 5);\n};\n\n/**\n * Bias adaptation function as per section 3.4 of RFC 3492.\n * https://tools.ietf.org/html/rfc3492#section-3.4\n * @private\n */\nconst adapt = function(delta, numPoints, firstTime) {\n\tlet k = 0;\n\tdelta = firstTime ? floor(delta / damp) : delta >> 1;\n\tdelta += floor(delta / numPoints);\n\tfor (/* no initialization */; delta > baseMinusTMin * tMax >> 1; k += base) {\n\t\tdelta = floor(delta / baseMinusTMin);\n\t}\n\treturn floor(k + (baseMinusTMin + 1) * delta / (delta + skew));\n};\n\n/**\n * Converts a Punycode string of ASCII-only symbols to a string of Unicode\n * symbols.\n * @memberOf punycode\n * @param {String} input The Punycode string of ASCII-only symbols.\n * @returns {String} The resulting string of Unicode symbols.\n */\nconst decode = function(input) {\n\t// Don't use UCS-2.\n\tconst output = [];\n\tconst inputLength = input.length;\n\tlet i = 0;\n\tlet n = initialN;\n\tlet bias = initialBias;\n\n\t// Handle the basic code points: let `basic` be the number of input code\n\t// points before the last delimiter, or `0` if there is none, then copy\n\t// the first basic code points to the output.\n\n\tlet basic = input.lastIndexOf(delimiter);\n\tif (basic < 0) {\n\t\tbasic = 0;\n\t}\n\n\tfor (let j = 0; j < basic; ++j) {\n\t\t// if it's not a basic code point\n\t\tif (input.charCodeAt(j) >= 0x80) {\n\t\t\terror('not-basic');\n\t\t}\n\t\toutput.push(input.charCodeAt(j));\n\t}\n\n\t// Main decoding loop: start just after the last delimiter if any basic code\n\t// points were copied; start at the beginning otherwise.\n\n\tfor (let index = basic > 0 ? basic + 1 : 0; index < inputLength; /* no final expression */) {\n\n\t\t// `index` is the index of the next character to be consumed.\n\t\t// Decode a generalized variable-length integer into `delta`,\n\t\t// which gets added to `i`. The overflow checking is easier\n\t\t// if we increase `i` as we go, then subtract off its starting\n\t\t// value at the end to obtain `delta`.\n\t\tlet oldi = i;\n\t\tfor (let w = 1, k = base; /* no condition */; k += base) {\n\n\t\t\tif (index >= inputLength) {\n\t\t\t\terror('invalid-input');\n\t\t\t}\n\n\t\t\tconst digit = basicToDigit(input.charCodeAt(index++));\n\n\t\t\tif (digit >= base || digit > floor((maxInt - i) / w)) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\ti += digit * w;\n\t\t\tconst t = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\n\t\t\tif (digit < t) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tconst baseMinusT = base - t;\n\t\t\tif (w > floor(maxInt / baseMinusT)) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tw *= baseMinusT;\n\n\t\t}\n\n\t\tconst out = output.length + 1;\n\t\tbias = adapt(i - oldi, out, oldi == 0);\n\n\t\t// `i` was supposed to wrap around from `out` to `0`,\n\t\t// incrementing `n` each time, so we'll fix that now:\n\t\tif (floor(i / out) > maxInt - n) {\n\t\t\terror('overflow');\n\t\t}\n\n\t\tn += floor(i / out);\n\t\ti %= out;\n\n\t\t// Insert `n` at position `i` of the output.\n\t\toutput.splice(i++, 0, n);\n\n\t}\n\n\treturn String.fromCodePoint(...output);\n};\n\n/**\n * Converts a string of Unicode symbols (e.g. a domain name label) to a\n * Punycode string of ASCII-only symbols.\n * @memberOf punycode\n * @param {String} input The string of Unicode symbols.\n * @returns {String} The resulting Punycode string of ASCII-only symbols.\n */\nconst encode = function(input) {\n\tconst output = [];\n\n\t// Convert the input in UCS-2 to an array of Unicode code points.\n\tinput = ucs2decode(input);\n\n\t// Cache the length.\n\tlet inputLength = input.length;\n\n\t// Initialize the state.\n\tlet n = initialN;\n\tlet delta = 0;\n\tlet bias = initialBias;\n\n\t// Handle the basic code points.\n\tfor (const currentValue of input) {\n\t\tif (currentValue < 0x80) {\n\t\t\toutput.push(stringFromCharCode(currentValue));\n\t\t}\n\t}\n\n\tlet basicLength = output.length;\n\tlet handledCPCount = basicLength;\n\n\t// `handledCPCount` is the number of code points that have been handled;\n\t// `basicLength` is the number of basic code points.\n\n\t// Finish the basic string with a delimiter unless it's empty.\n\tif (basicLength) {\n\t\toutput.push(delimiter);\n\t}\n\n\t// Main encoding loop:\n\twhile (handledCPCount < inputLength) {\n\n\t\t// All non-basic code points < n have been handled already. Find the next\n\t\t// larger one:\n\t\tlet m = maxInt;\n\t\tfor (const currentValue of input) {\n\t\t\tif (currentValue >= n && currentValue < m) {\n\t\t\t\tm = currentValue;\n\t\t\t}\n\t\t}\n\n\t\t// Increase `delta` enough to advance the decoder's <n,i> state to <m,0>,\n\t\t// but guard against overflow.\n\t\tconst handledCPCountPlusOne = handledCPCount + 1;\n\t\tif (m - n > floor((maxInt - delta) / handledCPCountPlusOne)) {\n\t\t\terror('overflow');\n\t\t}\n\n\t\tdelta += (m - n) * handledCPCountPlusOne;\n\t\tn = m;\n\n\t\tfor (const currentValue of input) {\n\t\t\tif (currentValue < n && ++delta > maxInt) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\t\t\tif (currentValue == n) {\n\t\t\t\t// Represent delta as a generalized variable-length integer.\n\t\t\t\tlet q = delta;\n\t\t\t\tfor (let k = base; /* no condition */; k += base) {\n\t\t\t\t\tconst t = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\t\t\t\t\tif (q < t) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tconst qMinusT = q - t;\n\t\t\t\t\tconst baseMinusT = base - t;\n\t\t\t\t\toutput.push(\n\t\t\t\t\t\tstringFromCharCode(digitToBasic(t + qMinusT % baseMinusT, 0))\n\t\t\t\t\t);\n\t\t\t\t\tq = floor(qMinusT / baseMinusT);\n\t\t\t\t}\n\n\t\t\t\toutput.push(stringFromCharCode(digitToBasic(q, 0)));\n\t\t\t\tbias = adapt(delta, handledCPCountPlusOne, handledCPCount == basicLength);\n\t\t\t\tdelta = 0;\n\t\t\t\t++handledCPCount;\n\t\t\t}\n\t\t}\n\n\t\t++delta;\n\t\t++n;\n\n\t}\n\treturn output.join('');\n};\n\n/**\n * Converts a Punycode string representing a domain name or an email address\n * to Unicode. Only the Punycoded parts of the input will be converted, i.e.\n * it doesn't matter if you call it on a string that has already been\n * converted to Unicode.\n * @memberOf punycode\n * @param {String} input The Punycoded domain name or email address to\n * convert to Unicode.\n * @returns {String} The Unicode representation of the given Punycode\n * string.\n */\nconst toUnicode = function(input) {\n\treturn mapDomain(input, function(string) {\n\t\treturn regexPunycode.test(string)\n\t\t\t? decode(string.slice(4).toLowerCase())\n\t\t\t: string;\n\t});\n};\n\n/**\n * Converts a Unicode string representing a domain name or an email address to\n * Punycode. Only the non-ASCII parts of the domain name will be converted,\n * i.e. it doesn't matter if you call it with a domain that's already in\n * ASCII.\n * @memberOf punycode\n * @param {String} input The domain name or email address to convert, as a\n * Unicode string.\n * @returns {String} The Punycode representation of the given domain name or\n * email address.\n */\nconst toASCII = function(input) {\n\treturn mapDomain(input, function(string) {\n\t\treturn regexNonASCII.test(string)\n\t\t\t? 'xn--' + encode(string)\n\t\t\t: string;\n\t});\n};\n\n/*--------------------------------------------------------------------------*/\n\n/** Define the public API */\nconst punycode = {\n\t/**\n\t * A string representing the current Punycode.js version number.\n\t * @memberOf punycode\n\t * @type String\n\t */\n\t'version': '2.1.0',\n\t/**\n\t * An object of methods to convert from JavaScript's internal character\n\t * representation (UCS-2) to Unicode code points, and back.\n\t * @see <https://mathiasbynens.be/notes/javascript-encoding>\n\t * @memberOf punycode\n\t * @type Object\n\t */\n\t'ucs2': {\n\t\t'decode': ucs2decode,\n\t\t'encode': ucs2encode\n\t},\n\t'decode': decode,\n\t'encode': encode,\n\t'toASCII': toASCII,\n\t'toUnicode': toUnicode\n};\n\nexport default punycode;\n","/**\n * URI.js\n *\n * @fileoverview An RFC 3986 compliant, scheme extendable URI parsing/validating/resolving library for JavaScript.\n * @author <a href=\"mailto:gary.court@gmail.com\">Gary Court</a>\n * @see http://github.com/garycourt/uri-js\n */\n\n/**\n * Copyright 2011 Gary Court. All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without modification, are\n * permitted provided that the following conditions are met:\n *\n *    1. Redistributions of source code must retain the above copyright notice, this list of\n *       conditions and the following disclaimer.\n *\n *    2. Redistributions in binary form must reproduce the above copyright notice, this list\n *       of conditions and the following disclaimer in the documentation and/or other materials\n *       provided with the distribution.\n *\n * THIS SOFTWARE IS PROVIDED BY GARY COURT ``AS IS'' AND ANY EXPRESS OR IMPLIED\n * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL GARY COURT OR\n * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON\n * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING\n * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF\n * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * The views and conclusions contained in the software and documentation are those of the\n * authors and should not be interpreted as representing official policies, either expressed\n * or implied, of Gary Court.\n */\n\nimport URI_PROTOCOL from \"./regexps-uri\";\nimport IRI_PROTOCOL from \"./regexps-iri\";\nimport punycode from \"punycode\";\nimport { toUpperCase, typeOf, assign } from \"./util\";\n\nexport interface URIComponents {\n\tscheme?:string;\n\tuserinfo?:string;\n\thost?:string;\n\tport?:number|string;\n\tpath?:string;\n\tquery?:string;\n\tfragment?:string;\n\treference?:string;\n\terror?:string;\n}\n\nexport interface URIOptions {\n\tscheme?:string;\n\treference?:string;\n\ttolerant?:boolean;\n\tabsolutePath?:boolean;\n\tiri?:boolean;\n\tunicodeSupport?:boolean;\n\tdomainHost?:boolean;\n}\n\nexport interface URISchemeHandler<Components extends URIComponents = URIComponents, Options extends URIOptions = URIOptions, ParentComponents extends URIComponents = URIComponents> {\n\tscheme:string;\n\tparse(components:ParentComponents, options:Options):Components;\n\tserialize(components:Components, options:Options):ParentComponents;\n\tunicodeSupport?:boolean;\n\tdomainHost?:boolean;\n\tabsolutePath?:boolean;\n}\n\nexport interface URIRegExps {\n\tNOT_SCHEME : RegExp,\n\tNOT_USERINFO : RegExp,\n\tNOT_HOST : RegExp,\n\tNOT_PATH : RegExp,\n\tNOT_PATH_NOSCHEME : RegExp,\n\tNOT_QUERY : RegExp,\n\tNOT_FRAGMENT : RegExp,\n\tESCAPE : RegExp,\n\tUNRESERVED : RegExp,\n\tOTHER_CHARS : RegExp,\n\tPCT_ENCODED : RegExp,\n\tIPV4ADDRESS : RegExp,\n\tIPV6ADDRESS : RegExp,\n}\n\nexport const SCHEMES:{[scheme:string]:URISchemeHandler} = {};\n\nexport function pctEncChar(chr:string):string {\n\tconst c = chr.charCodeAt(0);\n\tlet e:string;\n\n\tif (c < 16) e = \"%0\" + c.toString(16).toUpperCase();\n\telse if (c < 128) e = \"%\" + c.toString(16).toUpperCase();\n\telse if (c < 2048) e = \"%\" + ((c >> 6) | 192).toString(16).toUpperCase() + \"%\" + ((c & 63) | 128).toString(16).toUpperCase();\n\telse e = \"%\" + ((c >> 12) | 224).toString(16).toUpperCase() + \"%\" + (((c >> 6) & 63) | 128).toString(16).toUpperCase() + \"%\" + ((c & 63) | 128).toString(16).toUpperCase();\n\n\treturn e;\n}\n\nexport function pctDecChars(str:string):string {\n\tlet newStr = \"\";\n\tlet i = 0;\n\tconst il = str.length;\n\n\twhile (i < il) {\n\t\tconst c = parseInt(str.substr(i + 1, 2), 16);\n\n\t\tif (c < 128) {\n\t\t\tnewStr += String.fromCharCode(c);\n\t\t\ti += 3;\n\t\t}\n\t\telse if (c >= 194 && c < 224) {\n\t\t\tif ((il - i) >= 6) {\n\t\t\t\tconst c2 = parseInt(str.substr(i + 4, 2), 16);\n\t\t\t\tnewStr += String.fromCharCode(((c & 31) << 6) | (c2 & 63));\n\t\t\t} else {\n\t\t\t\tnewStr += str.substr(i, 6);\n\t\t\t}\n\t\t\ti += 6;\n\t\t}\n\t\telse if (c >= 224) {\n\t\t\tif ((il - i) >= 9) {\n\t\t\t\tconst c2 = parseInt(str.substr(i + 4, 2), 16);\n\t\t\t\tconst c3 = parseInt(str.substr(i + 7, 2), 16);\n\t\t\t\tnewStr += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));\n\t\t\t} else {\n\t\t\t\tnewStr += str.substr(i, 9);\n\t\t\t}\n\t\t\ti += 9;\n\t\t}\n\t\telse {\n\t\t\tnewStr += str.substr(i, 3);\n\t\t\ti += 3;\n\t\t}\n\t}\n\n\treturn newStr;\n}\n\nfunction _normalizeComponentEncoding(components:URIComponents, protocol:URIRegExps) {\n\tfunction decodeUnreserved(str:string):string {\n\t\tconst decStr = pctDecChars(str);\n\t\treturn (!decStr.match(protocol.UNRESERVED) ? str : decStr);\n\t}\n\n\tif (components.scheme) components.scheme = String(components.scheme).replace(protocol.PCT_ENCODED, decodeUnreserved).toLowerCase().replace(protocol.NOT_SCHEME, \"\");\n\tif (components.userinfo !== undefined) components.userinfo = String(components.userinfo).replace(protocol.PCT_ENCODED, decodeUnreserved).replace(protocol.NOT_USERINFO, pctEncChar).replace(protocol.PCT_ENCODED, toUpperCase);\n\tif (components.host !== undefined) components.host = String(components.host).replace(protocol.PCT_ENCODED, decodeUnreserved).toLowerCase().replace(protocol.NOT_HOST, pctEncChar).replace(protocol.PCT_ENCODED, toUpperCase);\n\tif (components.path !== undefined) components.path = String(components.path).replace(protocol.PCT_ENCODED, decodeUnreserved).replace((components.scheme ? protocol.NOT_PATH : protocol.NOT_PATH_NOSCHEME), pctEncChar).replace(protocol.PCT_ENCODED, toUpperCase);\n\tif (components.query !== undefined) components.query = String(components.query).replace(protocol.PCT_ENCODED, decodeUnreserved).replace(protocol.NOT_QUERY, pctEncChar).replace(protocol.PCT_ENCODED, toUpperCase);\n\tif (components.fragment !== undefined) components.fragment = String(components.fragment).replace(protocol.PCT_ENCODED, decodeUnreserved).replace(protocol.NOT_FRAGMENT, pctEncChar).replace(protocol.PCT_ENCODED, toUpperCase);\n\n\treturn components;\n};\n\nfunction _stripLeadingZeros(str:string):string {\n\treturn str.replace(/^0*(.*)/, \"$1\") || \"0\";\n}\n\nfunction _normalizeIPv4(host:string, protocol:URIRegExps):string {\n\tconst matches = host.match(protocol.IPV4ADDRESS) || [];\n\tconst [, address] = matches;\n\t\n\tif (address) {\n\t\treturn address.split(\".\").map(_stripLeadingZeros).join(\".\");\n\t} else {\n\t\treturn host;\n\t}\n}\n\nfunction _normalizeIPv6(host:string, protocol:URIRegExps):string {\n\tconst matches = host.match(protocol.IPV6ADDRESS) || [];\n\tconst [, address, zone] = matches;\n\n\tif (address) {\n\t\tconst [last, first] = address.toLowerCase().split('::').reverse();\n\t\tconst firstFields = first ? first.split(\":\").map(_stripLeadingZeros) : [];\n\t\tconst lastFields = last.split(\":\").map(_stripLeadingZeros);\n\t\tconst isLastFieldIPv4Address = protocol.IPV4ADDRESS.test(lastFields[lastFields.length - 1]);\n\t\tconst fieldCount = isLastFieldIPv4Address ? 7 : 8;\n\t\tconst lastFieldsStart = lastFields.length - fieldCount;\n\t\tconst fields = Array<string>(fieldCount);\n\n\t\tfor (let x = 0; x < fieldCount; ++x) {\n\t\t\tfields[x] = firstFields[x] || lastFields[lastFieldsStart + x] || '';\n\t\t}\n\n\t\tif (isLastFieldIPv4Address) {\n\t\t\tfields[fieldCount - 1] = _normalizeIPv4(fields[fieldCount - 1], protocol);\n\t\t}\n\n\t\tconst allZeroFields = fields.reduce<Array<{index:number,length:number}>>((acc, field, index) => {\n\t\t\tif (!field || field === \"0\") {\n\t\t\t\tconst lastLongest = acc[acc.length - 1];\n\t\t\t\tif (lastLongest && lastLongest.index + lastLongest.length === index) {\n\t\t\t\t\tlastLongest.length++;\n\t\t\t\t} else {\n\t\t\t\t\tacc.push({ index, length : 1 });\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn acc;\n\t\t}, []);\n\n\t\tconst longestZeroFields = allZeroFields.sort((a, b) => b.length - a.length)[0];\n\n\t\tlet newHost:string;\n\t\tif (longestZeroFields && longestZeroFields.length > 1) {\n\t\t\tconst newFirst = fields.slice(0, longestZeroFields.index) ;\n\t\t\tconst newLast = fields.slice(longestZeroFields.index + longestZeroFields.length);\n\t\t\tnewHost = newFirst.join(\":\") + \"::\" + newLast.join(\":\");\n\t\t} else {\n\t\t\tnewHost = fields.join(\":\");\n\t\t}\n\n\t\tif (zone) {\n\t\t\tnewHost += \"%\" + zone;\n\t\t}\n\n\t\treturn newHost;\n\t} else {\n\t\treturn host;\n\t}\n}\n\nconst URI_PARSE = /^(?:([^:\\/?#]+):)?(?:\\/\\/((?:([^\\/?#@]*)@)?(\\[[^\\/?#\\]]+\\]|[^\\/?#:]*)(?:\\:(\\d*))?))?([^?#]*)(?:\\?([^#]*))?(?:#((?:.|\\n|\\r)*))?/i;\nconst NO_MATCH_IS_UNDEFINED = (<RegExpMatchArray>(\"\").match(/(){0}/))[1] === undefined;\n\nexport function parse(uriString:string, options:URIOptions = {}):URIComponents {\n\tconst components:URIComponents = {};\n\tconst protocol = (options.iri !== false ? IRI_PROTOCOL : URI_PROTOCOL);\n\n\tif (options.reference === \"suffix\") uriString = (options.scheme ? options.scheme + \":\" : \"\") + \"//\" + uriString;\n\n\tconst matches = uriString.match(URI_PARSE);\n\n\tif (matches) {\n\t\tif (NO_MATCH_IS_UNDEFINED) {\n\t\t\t//store each component\n\t\t\tcomponents.scheme = matches[1];\n\t\t\tcomponents.userinfo = matches[3];\n\t\t\tcomponents.host = matches[4];\n\t\t\tcomponents.port = parseInt(matches[5], 10);\n\t\t\tcomponents.path = matches[6] || \"\";\n\t\t\tcomponents.query = matches[7];\n\t\t\tcomponents.fragment = matches[8];\n\n\t\t\t//fix port number\n\t\t\tif (isNaN(components.port)) {\n\t\t\t\tcomponents.port = matches[5];\n\t\t\t}\n\t\t} else {  //IE FIX for improper RegExp matching\n\t\t\t//store each component\n\t\t\tcomponents.scheme = matches[1] || undefined;\n\t\t\tcomponents.userinfo = (uriString.indexOf(\"@\") !== -1 ? matches[3] : undefined);\n\t\t\tcomponents.host = (uriString.indexOf(\"//\") !== -1 ? matches[4] : undefined);\n\t\t\tcomponents.port = parseInt(matches[5], 10);\n\t\t\tcomponents.path = matches[6] || \"\";\n\t\t\tcomponents.query = (uriString.indexOf(\"?\") !== -1 ? matches[7] : undefined);\n\t\t\tcomponents.fragment = (uriString.indexOf(\"#\") !== -1 ? matches[8] : undefined);\n\n\t\t\t//fix port number\n\t\t\tif (isNaN(components.port)) {\n\t\t\t\tcomponents.port = (uriString.match(/\\/\\/(?:.|\\n)*\\:(?:\\/|\\?|\\#|$)/) ? matches[4] : undefined);\n\t\t\t}\n\t\t}\n\n\t\tif (components.host) {\n\t\t\t//normalize IP hosts\n\t\t\tcomponents.host = _normalizeIPv6(_normalizeIPv4(components.host, protocol), protocol);\n\t\t}\n\n\t\t//determine reference type\n\t\tif (components.scheme === undefined && components.userinfo === undefined && components.host === undefined && components.port === undefined && !components.path && components.query === undefined) {\n\t\t\tcomponents.reference = \"same-document\";\n\t\t} else if (components.scheme === undefined) {\n\t\t\tcomponents.reference = \"relative\";\n\t\t} else if (components.fragment === undefined) {\n\t\t\tcomponents.reference = \"absolute\";\n\t\t} else {\n\t\t\tcomponents.reference = \"uri\";\n\t\t}\n\n\t\t//check for reference errors\n\t\tif (options.reference && options.reference !== \"suffix\" && options.reference !== components.reference) {\n\t\t\tcomponents.error = components.error || \"URI is not a \" + options.reference + \" reference.\";\n\t\t}\n\n\t\t//find scheme handler\n\t\tconst schemeHandler = SCHEMES[(options.scheme || components.scheme || \"\").toLowerCase()];\n\n\t\t//check if scheme can't handle IRIs\n\t\tif (!options.unicodeSupport && (!schemeHandler || !schemeHandler.unicodeSupport)) {\n\t\t\t//if host component is a domain name\n\t\t\tif (components.host && (options.domainHost || (schemeHandler && schemeHandler.domainHost))) {\n\t\t\t\t//convert Unicode IDN -> ASCII IDN\n\t\t\t\ttry {\n\t\t\t\t\tcomponents.host = punycode.toASCII(components.host.replace(protocol.PCT_ENCODED, pctDecChars).toLowerCase());\n\t\t\t\t} catch (e) {\n\t\t\t\t\tcomponents.error = components.error || \"Host's domain name can not be converted to ASCII via punycode: \" + e;\n\t\t\t\t}\n\t\t\t}\n\t\t\t//convert IRI -> URI\n\t\t\t_normalizeComponentEncoding(components, URI_PROTOCOL);\n\t\t} else {\n\t\t\t//normalize encodings\n\t\t\t_normalizeComponentEncoding(components, protocol);\n\t\t}\n\n\t\t//perform scheme specific parsing\n\t\tif (schemeHandler && schemeHandler.parse) {\n\t\t\tschemeHandler.parse(components, options);\n\t\t}\n\t} else {\n\t\tcomponents.error = components.error || \"URI can not be parsed.\";\n\t}\n\n\treturn components;\n};\n\nfunction _recomposeAuthority(components:URIComponents, options:URIOptions):string|undefined {\n\tconst protocol = (options.iri !== false ? IRI_PROTOCOL : URI_PROTOCOL);\n\tconst uriTokens:Array<string> = [];\n\n\tif (components.userinfo !== undefined) {\n\t\turiTokens.push(components.userinfo);\n\t\turiTokens.push(\"@\");\n\t}\n\n\tif (components.host !== undefined) {\n\t\t//normalize IP hosts, add brackets and escape zone separator for IPv6\n\t\turiTokens.push(_normalizeIPv6(_normalizeIPv4(String(components.host), protocol), protocol).replace(protocol.IPV6ADDRESS, (_, $1, $2) => \"[\" + $1 + ($2 ? \"%25\" + $2 : \"\") + \"]\"));\n\t}\n\n\tif (typeof components.port === \"number\") {\n\t\turiTokens.push(\":\");\n\t\turiTokens.push(components.port.toString(10));\n\t}\n\n\treturn uriTokens.length ? uriTokens.join(\"\") : undefined;\n};\n\nconst RDS1 = /^\\.\\.?\\//;\nconst RDS2 = /^\\/\\.(\\/|$)/;\nconst RDS3 = /^\\/\\.\\.(\\/|$)/;\nconst RDS4 = /^\\.\\.?$/;\nconst RDS5 = /^\\/?(?:.|\\n)*?(?=\\/|$)/;\n\nexport function removeDotSegments(input:string):string {\n\tconst output:Array<string> = [];\n\n\twhile (input.length) {\n\t\tif (input.match(RDS1)) {\n\t\t\tinput = input.replace(RDS1, \"\");\n\t\t} else if (input.match(RDS2)) {\n\t\t\tinput = input.replace(RDS2, \"/\");\n\t\t} else if (input.match(RDS3)) {\n\t\t\tinput = input.replace(RDS3, \"/\");\n\t\t\toutput.pop();\n\t\t} else if (input === \".\" || input === \"..\") {\n\t\t\tinput = \"\";\n\t\t} else {\n\t\t\tconst im = input.match(RDS5);\n\t\t\tif (im) {\n\t\t\t\tconst s = im[0];\n\t\t\t\tinput = input.slice(s.length);\n\t\t\t\toutput.push(s);\n\t\t\t} else {\n\t\t\t\tthrow new Error(\"Unexpected dot segment condition\");\n\t\t\t}\n\t\t}\n\t}\n\n\treturn output.join(\"\");\n};\n\nexport function serialize(components:URIComponents, options:URIOptions = {}):string {\n\tconst protocol = (options.iri ? IRI_PROTOCOL : URI_PROTOCOL);\n\tconst uriTokens:Array<string> = [];\n\n\t//find scheme handler\n\tconst schemeHandler = SCHEMES[(options.scheme || components.scheme || \"\").toLowerCase()];\n\n\t//perform scheme specific serialization\n\tif (schemeHandler && schemeHandler.serialize) schemeHandler.serialize(components, options);\n\n\tif (components.host) {\n\t\t//if host component is an IPv6 address\n\t\tif (protocol.IPV6ADDRESS.test(components.host)) {\n\t\t\t//TODO: normalize IPv6 address as per RFC 5952\n\t\t}\n\n\t\t//if host component is a domain name\n\t\telse if (options.domainHost || (schemeHandler && schemeHandler.domainHost)) {\n\t\t\t//convert IDN via punycode\n\t\t\ttry {\n\t\t\t\tcomponents.host = (!options.iri ? punycode.toASCII(components.host.replace(protocol.PCT_ENCODED, pctDecChars).toLowerCase()) : punycode.toUnicode(components.host));\n\t\t\t} catch (e) {\n\t\t\t\tcomponents.error = components.error || \"Host's domain name can not be converted to \" + (!options.iri ? \"ASCII\" : \"Unicode\") + \" via punycode: \" + e;\n\t\t\t}\n\t\t}\n\t}\n\n\t//normalize encoding\n\t_normalizeComponentEncoding(components, protocol);\n\n\tif (options.reference !== \"suffix\" && components.scheme) {\n\t\turiTokens.push(components.scheme);\n\t\turiTokens.push(\":\");\n\t}\n\n\tconst authority = _recomposeAuthority(components, options);\n\tif (authority !== undefined) {\n\t\tif (options.reference !== \"suffix\") {\n\t\t\turiTokens.push(\"//\");\n\t\t}\n\n\t\turiTokens.push(authority);\n\n\t\tif (components.path && components.path.charAt(0) !== \"/\") {\n\t\t\turiTokens.push(\"/\");\n\t\t}\n\t}\n\n\tif (components.path !== undefined) {\n\t\tlet s = components.path;\n\n\t\tif (!options.absolutePath && (!schemeHandler || !schemeHandler.absolutePath)) {\n\t\t\ts = removeDotSegments(s);\n\t\t}\n\n\t\tif (authority === undefined) {\n\t\t\ts = s.replace(/^\\/\\//, \"/%2F\");  //don't allow the path to start with \"//\"\n\t\t}\n\n\t\turiTokens.push(s);\n\t}\n\n\tif (components.query !== undefined) {\n\t\turiTokens.push(\"?\");\n\t\turiTokens.push(components.query);\n\t}\n\n\tif (components.fragment !== undefined) {\n\t\turiTokens.push(\"#\");\n\t\turiTokens.push(components.fragment);\n\t}\n\n\treturn uriTokens.join(\"\");  //merge tokens into a string\n};\n\nexport function resolveComponents(base:URIComponents, relative:URIComponents, options:URIOptions = {}, skipNormalization?:boolean):URIComponents {\n\tconst target:URIComponents = {};\n\n\tif (!skipNormalization) {\n\t\tbase = parse(serialize(base, options), options);  //normalize base components\n\t\trelative = parse(serialize(relative, options), options);  //normalize relative components\n\t}\n\toptions = options || {};\n\n\tif (!options.tolerant && relative.scheme) {\n\t\ttarget.scheme = relative.scheme;\n\t\t//target.authority = relative.authority;\n\t\ttarget.userinfo = relative.userinfo;\n\t\ttarget.host = relative.host;\n\t\ttarget.port = relative.port;\n\t\ttarget.path = removeDotSegments(relative.path || \"\");\n\t\ttarget.query = relative.query;\n\t} else {\n\t\tif (relative.userinfo !== undefined || relative.host !== undefined || relative.port !== undefined) {\n\t\t\t//target.authority = relative.authority;\n\t\t\ttarget.userinfo = relative.userinfo;\n\t\t\ttarget.host = relative.host;\n\t\t\ttarget.port = relative.port;\n\t\t\ttarget.path = removeDotSegments(relative.path || \"\");\n\t\t\ttarget.query = relative.query;\n\t\t} else {\n\t\t\tif (!relative.path) {\n\t\t\t\ttarget.path = base.path;\n\t\t\t\tif (relative.query !== undefined) {\n\t\t\t\t\ttarget.query = relative.query;\n\t\t\t\t} else {\n\t\t\t\t\ttarget.query = base.query;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (relative.path.charAt(0) === \"/\") {\n\t\t\t\t\ttarget.path = removeDotSegments(relative.path);\n\t\t\t\t} else {\n\t\t\t\t\tif ((base.userinfo !== undefined || base.host !== undefined || base.port !== undefined) && !base.path) {\n\t\t\t\t\t\ttarget.path = \"/\" + relative.path;\n\t\t\t\t\t} else if (!base.path) {\n\t\t\t\t\t\ttarget.path = relative.path;\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttarget.path = base.path.slice(0, base.path.lastIndexOf(\"/\") + 1) + relative.path;\n\t\t\t\t\t}\n\t\t\t\t\ttarget.path = removeDotSegments(target.path);\n\t\t\t\t}\n\t\t\t\ttarget.query = relative.query;\n\t\t\t}\n\t\t\t//target.authority = base.authority;\n\t\t\ttarget.userinfo = base.userinfo;\n\t\t\ttarget.host = base.host;\n\t\t\ttarget.port = base.port;\n\t\t}\n\t\ttarget.scheme = base.scheme;\n\t}\n\n\ttarget.fragment = relative.fragment;\n\n\treturn target;\n};\n\nexport function resolve(baseURI:string, relativeURI:string, options?:URIOptions):string {\n\tconst schemelessOptions = assign({ scheme : 'null' }, options);\n\treturn serialize(resolveComponents(parse(baseURI, schemelessOptions), parse(relativeURI, schemelessOptions), schemelessOptions, true), schemelessOptions);\n};\n\nexport function normalize(uri:string, options?:URIOptions):string;\nexport function normalize(uri:URIComponents, options?:URIOptions):URIComponents;\nexport function normalize(uri:any, options?:URIOptions):any {\n\tif (typeof uri === \"string\") {\n\t\turi = serialize(parse(uri, options), options);\n\t} else if (typeOf(uri) === \"object\") {\n\t\turi = parse(serialize(<URIComponents>uri, options), options);\n\t}\n\n\treturn uri;\n};\n\nexport function equal(uriA:string, uriB:string, options?: URIOptions):boolean;\nexport function equal(uriA:URIComponents, uriB:URIComponents, options?:URIOptions):boolean;\nexport function equal(uriA:any, uriB:any, options?:URIOptions):boolean {\n\tif (typeof uriA === \"string\") {\n\t\turiA = serialize(parse(uriA, options), options);\n\t} else if (typeOf(uriA) === \"object\") {\n\t\turiA = serialize(<URIComponents>uriA, options);\n\t}\n\n\tif (typeof uriB === \"string\") {\n\t\turiB = serialize(parse(uriB, options), options);\n\t} else if (typeOf(uriB) === \"object\") {\n\t\turiB = serialize(<URIComponents>uriB, options);\n\t}\n\n\treturn uriA === uriB;\n};\n\nexport function escapeComponent(str:string, options?:URIOptions):string {\n\treturn str && str.toString().replace((!options || !options.iri ? URI_PROTOCOL.ESCAPE : IRI_PROTOCOL.ESCAPE), pctEncChar);\n};\n\nexport function unescapeComponent(str:string, options?:URIOptions):string {\n\treturn str && str.toString().replace((!options || !options.iri ? URI_PROTOCOL.PCT_ENCODED : IRI_PROTOCOL.PCT_ENCODED), pctDecChars);\n};\n","import { URISchemeHandler, URIComponents, URIOptions } from \"../uri\";\n\nconst handler:URISchemeHandler = {\n\tscheme : \"http\",\n\n\tdomainHost : true,\n\n\tparse : function (components:URIComponents, options:URIOptions):URIComponents {\n\t\t//report missing host\n\t\tif (!components.host) {\n\t\t\tcomponents.error = components.error || \"HTTP URIs must have a host.\";\n\t\t}\n\n\t\treturn components;\n\t},\n\n\tserialize : function (components:URIComponents, options:URIOptions):URIComponents {\n\t\t//normalize the default port\n\t\tif (components.port === (String(components.scheme).toLowerCase() !== \"https\" ? 80 : 443) || components.port === \"\") {\n\t\t\tcomponents.port = undefined;\n\t\t}\n\t\t\n\t\t//normalize the empty path\n\t\tif (!components.path) {\n\t\t\tcomponents.path = \"/\";\n\t\t}\n\n\t\t//NOTE: We do not parse query strings for HTTP URIs\n\t\t//as WWW Form Url Encoded query strings are part of the HTML4+ spec,\n\t\t//and not the HTTP spec.\n\n\t\treturn components;\n\t}\n};\n\nexport default handler;","import { URISchemeHandler, URIComponents, URIOptions } from \"../uri\";\nimport http from \"./http\";\n\nconst handler:URISchemeHandler = {\n\tscheme : \"https\",\n\tdomainHost : http.domainHost,\n\tparse : http.parse,\n\tserialize : http.serialize\n}\n\nexport default handler;","import { URISchemeHandler, URIComponents, URIOptions } from \"../uri\";\nimport { pctEncChar, pctDecChars, unescapeComponent } from \"../uri\";\nimport punycode from \"punycode\";\nimport { merge, subexp, toUpperCase, toArray } from \"../util\";\n\nexport interface MailtoHeaders {\n\t[hfname:string]:string\n}\n\nexport interface MailtoComponents extends URIComponents {\n\tto:Array<string>,\n\theaders?:MailtoHeaders,\n\tsubject?:string,\n\tbody?:string\n}\n\nconst O:MailtoHeaders = {};\nconst isIRI = true;\n\n//RFC 3986\nconst UNRESERVED$$ = \"[A-Za-z0-9\\\\-\\\\.\\\\_\\\\~\" + (isIRI ? \"\\\\xA0-\\\\u200D\\\\u2010-\\\\u2029\\\\u202F-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFEF\" : \"\") + \"]\";\nconst HEXDIG$$ = \"[0-9A-Fa-f]\";  //case-insensitive\nconst PCT_ENCODED$ = subexp(subexp(\"%[EFef]\" + HEXDIG$$ + \"%\" + HEXDIG$$ + HEXDIG$$ + \"%\" + HEXDIG$$ + HEXDIG$$) + \"|\" + subexp(\"%[89A-Fa-f]\" + HEXDIG$$ + \"%\" + HEXDIG$$ + HEXDIG$$) + \"|\" + subexp(\"%\" + HEXDIG$$ + HEXDIG$$));  //expanded\n\n//RFC 5322, except these symbols as per RFC 6068: @ : / ? # [ ] & ; =\n//const ATEXT$$ = \"[A-Za-z0-9\\\\!\\\\#\\\\$\\\\%\\\\&\\\\'\\\\*\\\\+\\\\-\\\\/\\\\=\\\\?\\\\^\\\\_\\\\`\\\\{\\\\|\\\\}\\\\~]\";\n//const WSP$$ = \"[\\\\x20\\\\x09]\";\n//const OBS_QTEXT$$ = \"[\\\\x01-\\\\x08\\\\x0B\\\\x0C\\\\x0E-\\\\x1F\\\\x7F]\";  //(%d1-8 / %d11-12 / %d14-31 / %d127)\n//const QTEXT$$ = merge(\"[\\\\x21\\\\x23-\\\\x5B\\\\x5D-\\\\x7E]\", OBS_QTEXT$$);  //%d33 / %d35-91 / %d93-126 / obs-qtext\n//const VCHAR$$ = \"[\\\\x21-\\\\x7E]\";\n//const WSP$$ = \"[\\\\x20\\\\x09]\";\n//const OBS_QP$ = subexp(\"\\\\\\\\\" + merge(\"[\\\\x00\\\\x0D\\\\x0A]\", OBS_QTEXT$$));  //%d0 / CR / LF / obs-qtext\n//const FWS$ = subexp(subexp(WSP$$ + \"*\" + \"\\\\x0D\\\\x0A\") + \"?\" + WSP$$ + \"+\");\n//const QUOTED_PAIR$ = subexp(subexp(\"\\\\\\\\\" + subexp(VCHAR$$ + \"|\" + WSP$$)) + \"|\" + OBS_QP$);\n//const QUOTED_STRING$ = subexp('\\\\\"' + subexp(FWS$ + \"?\" + QCONTENT$) + \"*\" + FWS$ + \"?\" + '\\\\\"');\nconst ATEXT$$ = \"[A-Za-z0-9\\\\!\\\\$\\\\%\\\\'\\\\*\\\\+\\\\-\\\\^\\\\_\\\\`\\\\{\\\\|\\\\}\\\\~]\";\nconst QTEXT$$ = \"[\\\\!\\\\$\\\\%\\\\'\\\\(\\\\)\\\\*\\\\+\\\\,\\\\-\\\\.0-9\\\\<\\\\>A-Z\\\\x5E-\\\\x7E]\";\nconst VCHAR$$ = merge(QTEXT$$, \"[\\\\\\\"\\\\\\\\]\");\nconst DOT_ATOM_TEXT$ = subexp(ATEXT$$ + \"+\" + subexp(\"\\\\.\" + ATEXT$$ + \"+\") + \"*\");\nconst QUOTED_PAIR$ = subexp(\"\\\\\\\\\" + VCHAR$$);\nconst QCONTENT$ = subexp(QTEXT$$ + \"|\" + QUOTED_PAIR$);\nconst QUOTED_STRING$ = subexp('\\\\\"' + QCONTENT$ + \"*\" + '\\\\\"');\n\n//RFC 6068\nconst DTEXT_NO_OBS$$ = \"[\\\\x21-\\\\x5A\\\\x5E-\\\\x7E]\";  //%d33-90 / %d94-126\nconst SOME_DELIMS$$ = \"[\\\\!\\\\$\\\\'\\\\(\\\\)\\\\*\\\\+\\\\,\\\\;\\\\:\\\\@]\";\nconst QCHAR$ = subexp(UNRESERVED$$ + \"|\" + PCT_ENCODED$ + \"|\" + SOME_DELIMS$$);\nconst DOMAIN$ = subexp(DOT_ATOM_TEXT$ + \"|\" + \"\\\\[\" + DTEXT_NO_OBS$$ + \"*\" + \"\\\\]\");\nconst LOCAL_PART$ = subexp(DOT_ATOM_TEXT$ + \"|\" + QUOTED_STRING$);\nconst ADDR_SPEC$ = subexp(LOCAL_PART$ + \"\\\\@\" + DOMAIN$);\nconst TO$ = subexp(ADDR_SPEC$ + subexp(\"\\\\,\" + ADDR_SPEC$) + \"*\");\nconst HFNAME$ = subexp(QCHAR$ + \"*\");\nconst HFVALUE$ = HFNAME$;\nconst HFIELD$ = subexp(HFNAME$ + \"\\\\=\" + HFVALUE$);\nconst HFIELDS2$ = subexp(HFIELD$ + subexp(\"\\\\&\" + HFIELD$) + \"*\");\nconst HFIELDS$ = subexp(\"\\\\?\" + HFIELDS2$);\nconst MAILTO_URI = new RegExp(\"^mailto\\\\:\" + TO$ + \"?\" + HFIELDS$ + \"?$\");\n\nconst UNRESERVED = new RegExp(UNRESERVED$$, \"g\");\nconst PCT_ENCODED = new RegExp(PCT_ENCODED$, \"g\");\nconst NOT_LOCAL_PART = new RegExp(merge(\"[^]\", ATEXT$$, \"[\\\\.]\", '[\\\\\"]', VCHAR$$), \"g\");\nconst NOT_DOMAIN = new RegExp(merge(\"[^]\", ATEXT$$, \"[\\\\.]\", \"[\\\\[]\", DTEXT_NO_OBS$$, \"[\\\\]]\"), \"g\");\nconst NOT_HFNAME = new RegExp(merge(\"[^]\", UNRESERVED$$, SOME_DELIMS$$), \"g\");\nconst NOT_HFVALUE = NOT_HFNAME;\nconst TO = new RegExp(\"^\" + TO$ + \"$\");\nconst HFIELDS = new RegExp(\"^\" + HFIELDS2$ + \"$\");\n\nfunction decodeUnreserved(str:string):string {\n\tconst decStr = pctDecChars(str);\n\treturn (!decStr.match(UNRESERVED) ? str : decStr);\n}\n\nconst handler:URISchemeHandler<MailtoComponents> =  {\n\tscheme : \"mailto\",\n\n\tparse : function (components:URIComponents, options:URIOptions):MailtoComponents {\n\t\tconst mailtoComponents = components as MailtoComponents;\n\t\tconst to = mailtoComponents.to = (mailtoComponents.path ? mailtoComponents.path.split(\",\") : []);\n\t\tmailtoComponents.path = undefined;\n\n\t\tif (mailtoComponents.query) {\n\t\t\tlet unknownHeaders = false\n\t\t\tconst headers:MailtoHeaders = {};\n\t\t\tconst hfields = mailtoComponents.query.split(\"&\");\n\n\t\t\tfor (let x = 0, xl = hfields.length; x < xl; ++x) {\n\t\t\t\tconst hfield = hfields[x].split(\"=\");\n\n\t\t\t\tswitch (hfield[0]) {\n\t\t\t\t\tcase \"to\":\n\t\t\t\t\t\tconst toAddrs = hfield[1].split(\",\");\n\t\t\t\t\t\tfor (let x = 0, xl = toAddrs.length; x < xl; ++x) {\n\t\t\t\t\t\t\tto.push(toAddrs[x]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"subject\":\n\t\t\t\t\t\tmailtoComponents.subject = unescapeComponent(hfield[1], options);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"body\":\n\t\t\t\t\t\tmailtoComponents.body = unescapeComponent(hfield[1], options);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tunknownHeaders = true;\n\t\t\t\t\t\theaders[unescapeComponent(hfield[0], options)] = unescapeComponent(hfield[1], options);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (unknownHeaders) mailtoComponents.headers = headers;\n\t\t}\n\n\t\tmailtoComponents.query = undefined;\n\n\t\tfor (let x = 0, xl = to.length; x < xl; ++x) {\n\t\t\tconst addr = to[x].split(\"@\");\n\n\t\t\taddr[0] = unescapeComponent(addr[0]);\n\n\t\t\tif (!options.unicodeSupport) {\n\t\t\t\t//convert Unicode IDN -> ASCII IDN\n\t\t\t\ttry {\n\t\t\t\t\taddr[1] = punycode.toASCII(unescapeComponent(addr[1], options).toLowerCase());\n\t\t\t\t} catch (e) {\n\t\t\t\t\tmailtoComponents.error = mailtoComponents.error || \"Email address's domain name can not be converted to ASCII via punycode: \" + e;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\taddr[1] = unescapeComponent(addr[1], options).toLowerCase();\n\t\t\t}\n\n\t\t\tto[x] = addr.join(\"@\");\n\t\t}\n\n\t\treturn mailtoComponents;\n\t},\n\n\tserialize : function (mailtoComponents:MailtoComponents, options:URIOptions):URIComponents {\n\t\tconst components = mailtoComponents as URIComponents;\n\t\tconst to = toArray(mailtoComponents.to);\n\t\tif (to) {\n\t\t\tfor (let x = 0, xl = to.length; x < xl; ++x) {\n\t\t\t\tconst toAddr = String(to[x]);\n\t\t\t\tconst atIdx = toAddr.lastIndexOf(\"@\");\n\t\t\t\tconst localPart = (toAddr.slice(0, atIdx)).replace(PCT_ENCODED, decodeUnreserved).replace(PCT_ENCODED, toUpperCase).replace(NOT_LOCAL_PART, pctEncChar);\n\t\t\t\tlet domain = toAddr.slice(atIdx + 1);\n\n\t\t\t\t//convert IDN via punycode\n\t\t\t\ttry {\n\t\t\t\t\tdomain = (!options.iri ? punycode.toASCII(unescapeComponent(domain, options).toLowerCase()) : punycode.toUnicode(domain));\n\t\t\t\t} catch (e) {\n\t\t\t\t\tcomponents.error = components.error || \"Email address's domain name can not be converted to \" + (!options.iri ? \"ASCII\" : \"Unicode\") + \" via punycode: \" + e;\n\t\t\t\t}\n\n\t\t\t\tto[x] = localPart + \"@\" + domain;\n\t\t\t}\n\n\t\t\tcomponents.path = to.join(\",\");\n\t\t}\n\n\t\tconst headers = mailtoComponents.headers = mailtoComponents.headers || {};\n\n\t\tif (mailtoComponents.subject) headers[\"subject\"] = mailtoComponents.subject;\n\t\tif (mailtoComponents.body) headers[\"body\"] = mailtoComponents.body;\n\n\t\tconst fields = [];\n\t\tfor (const name in headers) {\n\t\t\tif (headers[name] !== O[name]) {\n\t\t\t\tfields.push(\n\t\t\t\t\tname.replace(PCT_ENCODED, decodeUnreserved).replace(PCT_ENCODED, toUpperCase).replace(NOT_HFNAME, pctEncChar) +\n\t\t\t\t\t\"=\" +\n\t\t\t\t\theaders[name].replace(PCT_ENCODED, decodeUnreserved).replace(PCT_ENCODED, toUpperCase).replace(NOT_HFVALUE, pctEncChar)\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\tif (fields.length) {\n\t\t\tcomponents.query = fields.join(\"&\");\n\t\t}\n\n\t\treturn components;\n\t}\n}\n\nexport default handler;","import { URISchemeHandler, URIComponents, URIOptions } from \"../uri\";\nimport { pctEncChar, SCHEMES } from \"../uri\";\n\nexport interface URNComponents extends URIComponents {\n\tnid?:string;\n\tnss?:string;\n}\n\nexport interface URNOptions extends URIOptions {\n\tnid?:string;\n}\n\nconst NID$ = \"(?:[0-9A-Za-z][0-9A-Za-z\\\\-]{1,31})\";\nconst PCT_ENCODED$ = \"(?:\\\\%[0-9A-Fa-f]{2})\";\nconst TRANS$$ = \"[0-9A-Za-z\\\\(\\\\)\\\\+\\\\,\\\\-\\\\.\\\\:\\\\=\\\\@\\\\;\\\\$\\\\_\\\\!\\\\*\\\\'\\\\/\\\\?\\\\#]\";\nconst NSS$ = \"(?:(?:\" + PCT_ENCODED$ + \"|\" + TRANS$$ + \")+)\";\nconst URN_SCHEME = new RegExp(\"^urn\\\\:(\" + NID$ + \")$\");\nconst URN_PATH = new RegExp(\"^(\" + NID$ + \")\\\\:(\" + NSS$ + \")$\");\nconst URN_PARSE = /^([^\\:]+)\\:(.*)/;\nconst URN_EXCLUDED = /[\\x00-\\x20\\\\\\\"\\&\\<\\>\\[\\]\\^\\`\\{\\|\\}\\~\\x7F-\\xFF]/g;\n\n//RFC 2141\nconst handler:URISchemeHandler<URNComponents,URNOptions> = {\n\tscheme : \"urn\",\n\n\tparse : function (components:URIComponents, options:URNOptions):URNComponents {\n\t\tconst matches = components.path && components.path.match(URN_PARSE);\n\t\tlet urnComponents = components as URNComponents;\n\n\t\tif (matches) {\n\t\t\tconst scheme = options.scheme || urnComponents.scheme || \"urn\";\n\t\t\tconst nid = matches[1].toLowerCase();\n\t\t\tconst nss = matches[2];\n\t\t\tconst urnScheme = `${scheme}:${options.nid || nid}`;\n\t\t\tconst schemeHandler = SCHEMES[urnScheme];\n\n\t\t\turnComponents.nid = nid;\n\t\t\turnComponents.nss = nss;\n\t\t\turnComponents.path = undefined;\n\n\t\t\tif (schemeHandler) {\n\t\t\t\turnComponents = schemeHandler.parse(urnComponents, options) as URNComponents;\n\t\t\t}\n\t\t} else {\n\t\t\turnComponents.error = urnComponents.error || \"URN can not be parsed.\";\n\t\t}\n\n\t\treturn urnComponents;\n\t},\n\n\tserialize : function (urnComponents:URNComponents, options:URNOptions):URIComponents {\n\t\tconst scheme = options.scheme || urnComponents.scheme || \"urn\";\n\t\tconst nid = urnComponents.nid;\n\t\tconst urnScheme = `${scheme}:${options.nid || nid}`;\n\t\tconst schemeHandler = SCHEMES[urnScheme];\n\n\t\tif (schemeHandler) {\n\t\t\turnComponents = schemeHandler.serialize(urnComponents, options) as URNComponents;\n\t\t}\n\n\t\tconst uriComponents = urnComponents as URIComponents;\n\t\tconst nss = urnComponents.nss;\n\t\turiComponents.path = `${nid || options.nid}:${nss}`;\n\n\t\treturn uriComponents;\n\t},\n};\n\nexport default handler;","import { URISchemeHandler, URIComponents, URIOptions } from \"../uri\";\nimport { URNComponents } from \"./urn\";\nimport { SCHEMES } from \"../uri\";\n\nexport interface UUIDComponents extends URNComponents {\n\tuuid?: string;\n}\n\nconst UUID = /^[0-9A-Fa-f]{8}(?:\\-[0-9A-Fa-f]{4}){3}\\-[0-9A-Fa-f]{12}$/;\nconst UUID_PARSE = /^[0-9A-Fa-f\\-]{36}/;\n\n//RFC 4122\nconst handler:URISchemeHandler<UUIDComponents, URIOptions, URNComponents> = {\n\tscheme : \"urn:uuid\",\n\n\tparse : function (urnComponents:URNComponents, options:URIOptions):UUIDComponents {\n\t\tconst uuidComponents = urnComponents as UUIDComponents;\n\t\tuuidComponents.uuid = uuidComponents.nss;\n\t\tuuidComponents.nss = undefined;\n\n\t\tif (!options.tolerant && (!uuidComponents.uuid || !uuidComponents.uuid.match(UUID))) {\n\t\t\tuuidComponents.error = uuidComponents.error || \"UUID is not valid.\";\n\t\t}\n\n\t\treturn uuidComponents;\n\t},\n\n\tserialize : function (uuidComponents:UUIDComponents, options:URIOptions):URNComponents {\n\t\tconst urnComponents = uuidComponents as URNComponents;\n\t\t//normalize UUID\n\t\turnComponents.nss = (uuidComponents.uuid || \"\").toLowerCase();\n\t\treturn urnComponents;\n\t},\n};\n\nexport default handler;","import { SCHEMES } from \"./uri\";\n\nimport http from \"./schemes/http\";\nSCHEMES[http.scheme] = http;\n\nimport https from \"./schemes/https\";\nSCHEMES[https.scheme] = https;\n\nimport mailto from \"./schemes/mailto\";\nSCHEMES[mailto.scheme] = mailto;\n\nimport urn from \"./schemes/urn\";\nSCHEMES[urn.scheme] = urn;\n\nimport uuid from \"./schemes/urn-uuid\";\nSCHEMES[uuid.scheme] = uuid;\n\nexport * from \"./uri\";\n","'use strict';\n\n// do not edit .js files directly - edit src/index.jst\n\n\n\nmodule.exports = function equal(a, b) {\n  if (a === b) return true;\n\n  if (a && b && typeof a == 'object' && typeof b == 'object') {\n    if (a.constructor !== b.constructor) return false;\n\n    var length, i, keys;\n    if (Array.isArray(a)) {\n      length = a.length;\n      if (length != b.length) return false;\n      for (i = length; i-- !== 0;)\n        if (!equal(a[i], b[i])) return false;\n      return true;\n    }\n\n\n\n    if (a.constructor === RegExp) return a.source === b.source && a.flags === b.flags;\n    if (a.valueOf !== Object.prototype.valueOf) return a.valueOf() === b.valueOf();\n    if (a.toString !== Object.prototype.toString) return a.toString() === b.toString();\n\n    keys = Object.keys(a);\n    length = keys.length;\n    if (length !== Object.keys(b).length) return false;\n\n    for (i = length; i-- !== 0;)\n      if (!Object.prototype.hasOwnProperty.call(b, keys[i])) return false;\n\n    for (i = length; i-- !== 0;) {\n      var key = keys[i];\n\n      if (!equal(a[key], b[key])) return false;\n    }\n\n    return true;\n  }\n\n  // true if both NaN, false otherwise\n  return a!==a && b!==b;\n};\n","'use strict';\n\n\nmodule.exports = {\n  copy: copy,\n  checkDataType: checkDataType,\n  checkDataTypes: checkDataTypes,\n  coerceToTypes: coerceToTypes,\n  toHash: toHash,\n  getProperty: getProperty,\n  escapeQuotes: escapeQuotes,\n  equal: require('fast-deep-equal'),\n  ucs2length: require('./ucs2length'),\n  varOccurences: varOccurences,\n  varReplace: varReplace,\n  cleanUpCode: cleanUpCode,\n  finalCleanUpCode: finalCleanUpCode,\n  schemaHasRules: schemaHasRules,\n  schemaHasRulesExcept: schemaHasRulesExcept,\n  schemaUnknownRules: schemaUnknownRules,\n  toQuotedString: toQuotedString,\n  getPathExpr: getPathExpr,\n  getPath: getPath,\n  getData: getData,\n  unescapeFragment: unescapeFragment,\n  unescapeJsonPointer: unescapeJsonPointer,\n  escapeFragment: escapeFragment,\n  escapeJsonPointer: escapeJsonPointer\n};\n\n\nfunction copy(o, to) {\n  to = to || {};\n  for (var key in o) to[key] = o[key];\n  return to;\n}\n\n\nfunction checkDataType(dataType, data, negate) {\n  var EQUAL = negate ? ' !== ' : ' === '\n    , AND = negate ? ' || ' : ' && '\n    , OK = negate ? '!' : ''\n    , NOT = negate ? '' : '!';\n  switch (dataType) {\n    case 'null': return data + EQUAL + 'null';\n    case 'array': return OK + 'Array.isArray(' + data + ')';\n    case 'object': return '(' + OK + data + AND +\n                          'typeof ' + data + EQUAL + '\"object\"' + AND +\n                          NOT + 'Array.isArray(' + data + '))';\n    case 'integer': return '(typeof ' + data + EQUAL + '\"number\"' + AND +\n                           NOT + '(' + data + ' % 1)' +\n                           AND + data + EQUAL + data + ')';\n    default: return 'typeof ' + data + EQUAL + '\"' + dataType + '\"';\n  }\n}\n\n\nfunction checkDataTypes(dataTypes, data) {\n  switch (dataTypes.length) {\n    case 1: return checkDataType(dataTypes[0], data, true);\n    default:\n      var code = '';\n      var types = toHash(dataTypes);\n      if (types.array && types.object) {\n        code = types.null ? '(': '(!' + data + ' || ';\n        code += 'typeof ' + data + ' !== \"object\")';\n        delete types.null;\n        delete types.array;\n        delete types.object;\n      }\n      if (types.number) delete types.integer;\n      for (var t in types)\n        code += (code ? ' && ' : '' ) + checkDataType(t, data, true);\n\n      return code;\n  }\n}\n\n\nvar COERCE_TO_TYPES = toHash([ 'string', 'number', 'integer', 'boolean', 'null' ]);\nfunction coerceToTypes(optionCoerceTypes, dataTypes) {\n  if (Array.isArray(dataTypes)) {\n    var types = [];\n    for (var i=0; i<dataTypes.length; i++) {\n      var t = dataTypes[i];\n      if (COERCE_TO_TYPES[t]) types[types.length] = t;\n      else if (optionCoerceTypes === 'array' && t === 'array') types[types.length] = t;\n    }\n    if (types.length) return types;\n  } else if (COERCE_TO_TYPES[dataTypes]) {\n    return [dataTypes];\n  } else if (optionCoerceTypes === 'array' && dataTypes === 'array') {\n    return ['array'];\n  }\n}\n\n\nfunction toHash(arr) {\n  var hash = {};\n  for (var i=0; i<arr.length; i++) hash[arr[i]] = true;\n  return hash;\n}\n\n\nvar IDENTIFIER = /^[a-z$_][a-z$_0-9]*$/i;\nvar SINGLE_QUOTE = /'|\\\\/g;\nfunction getProperty(key) {\n  return typeof key == 'number'\n          ? '[' + key + ']'\n          : IDENTIFIER.test(key)\n            ? '.' + key\n            : \"['\" + escapeQuotes(key) + \"']\";\n}\n\n\nfunction escapeQuotes(str) {\n  return str.replace(SINGLE_QUOTE, '\\\\$&')\n            .replace(/\\n/g, '\\\\n')\n            .replace(/\\r/g, '\\\\r')\n            .replace(/\\f/g, '\\\\f')\n            .replace(/\\t/g, '\\\\t');\n}\n\n\nfunction varOccurences(str, dataVar) {\n  dataVar += '[^0-9]';\n  var matches = str.match(new RegExp(dataVar, 'g'));\n  return matches ? matches.length : 0;\n}\n\n\nfunction varReplace(str, dataVar, expr) {\n  dataVar += '([^0-9])';\n  expr = expr.replace(/\\$/g, '$$$$');\n  return str.replace(new RegExp(dataVar, 'g'), expr + '$1');\n}\n\n\nvar EMPTY_ELSE = /else\\s*{\\s*}/g\n  , EMPTY_IF_NO_ELSE = /if\\s*\\([^)]+\\)\\s*\\{\\s*\\}(?!\\s*else)/g\n  , EMPTY_IF_WITH_ELSE = /if\\s*\\(([^)]+)\\)\\s*\\{\\s*\\}\\s*else(?!\\s*if)/g;\nfunction cleanUpCode(out) {\n  return out.replace(EMPTY_ELSE, '')\n            .replace(EMPTY_IF_NO_ELSE, '')\n            .replace(EMPTY_IF_WITH_ELSE, 'if (!($1))');\n}\n\n\nvar ERRORS_REGEXP = /[^v.]errors/g\n  , REMOVE_ERRORS = /var errors = 0;|var vErrors = null;|validate.errors = vErrors;/g\n  , REMOVE_ERRORS_ASYNC = /var errors = 0;|var vErrors = null;/g\n  , RETURN_VALID = 'return errors === 0;'\n  , RETURN_TRUE = 'validate.errors = null; return true;'\n  , RETURN_ASYNC = /if \\(errors === 0\\) return data;\\s*else throw new ValidationError\\(vErrors\\);/\n  , RETURN_DATA_ASYNC = 'return data;'\n  , ROOTDATA_REGEXP = /[^A-Za-z_$]rootData[^A-Za-z0-9_$]/g\n  , REMOVE_ROOTDATA = /if \\(rootData === undefined\\) rootData = data;/;\n\nfunction finalCleanUpCode(out, async) {\n  var matches = out.match(ERRORS_REGEXP);\n  if (matches && matches.length == 2) {\n    out = async\n          ? out.replace(REMOVE_ERRORS_ASYNC, '')\n               .replace(RETURN_ASYNC, RETURN_DATA_ASYNC)\n          : out.replace(REMOVE_ERRORS, '')\n               .replace(RETURN_VALID, RETURN_TRUE);\n  }\n\n  matches = out.match(ROOTDATA_REGEXP);\n  if (!matches || matches.length !== 3) return out;\n  return out.replace(REMOVE_ROOTDATA, '');\n}\n\n\nfunction schemaHasRules(schema, rules) {\n  if (typeof schema == 'boolean') return !schema;\n  for (var key in schema) if (rules[key]) return true;\n}\n\n\nfunction schemaHasRulesExcept(schema, rules, exceptKeyword) {\n  if (typeof schema == 'boolean') return !schema && exceptKeyword != 'not';\n  for (var key in schema) if (key != exceptKeyword && rules[key]) return true;\n}\n\n\nfunction schemaUnknownRules(schema, rules) {\n  if (typeof schema == 'boolean') return;\n  for (var key in schema) if (!rules[key]) return key;\n}\n\n\nfunction toQuotedString(str) {\n  return '\\'' + escapeQuotes(str) + '\\'';\n}\n\n\nfunction getPathExpr(currentPath, expr, jsonPointers, isNumber) {\n  var path = jsonPointers // false by default\n              ? '\\'/\\' + ' + expr + (isNumber ? '' : '.replace(/~/g, \\'~0\\').replace(/\\\\//g, \\'~1\\')')\n              : (isNumber ? '\\'[\\' + ' + expr + ' + \\']\\'' : '\\'[\\\\\\'\\' + ' + expr + ' + \\'\\\\\\']\\'');\n  return joinPaths(currentPath, path);\n}\n\n\nfunction getPath(currentPath, prop, jsonPointers) {\n  var path = jsonPointers // false by default\n              ? toQuotedString('/' + escapeJsonPointer(prop))\n              : toQuotedString(getProperty(prop));\n  return joinPaths(currentPath, path);\n}\n\n\nvar JSON_POINTER = /^\\/(?:[^~]|~0|~1)*$/;\nvar RELATIVE_JSON_POINTER = /^([0-9]+)(#|\\/(?:[^~]|~0|~1)*)?$/;\nfunction getData($data, lvl, paths) {\n  var up, jsonPointer, data, matches;\n  if ($data === '') return 'rootData';\n  if ($data[0] == '/') {\n    if (!JSON_POINTER.test($data)) throw new Error('Invalid JSON-pointer: ' + $data);\n    jsonPointer = $data;\n    data = 'rootData';\n  } else {\n    matches = $data.match(RELATIVE_JSON_POINTER);\n    if (!matches) throw new Error('Invalid JSON-pointer: ' + $data);\n    up = +matches[1];\n    jsonPointer = matches[2];\n    if (jsonPointer == '#') {\n      if (up >= lvl) throw new Error('Cannot access property/index ' + up + ' levels up, current level is ' + lvl);\n      return paths[lvl - up];\n    }\n\n    if (up > lvl) throw new Error('Cannot access data ' + up + ' levels up, current level is ' + lvl);\n    data = 'data' + ((lvl - up) || '');\n    if (!jsonPointer) return data;\n  }\n\n  var expr = data;\n  var segments = jsonPointer.split('/');\n  for (var i=0; i<segments.length; i++) {\n    var segment = segments[i];\n    if (segment) {\n      data += getProperty(unescapeJsonPointer(segment));\n      expr += ' && ' + data;\n    }\n  }\n  return expr;\n}\n\n\nfunction joinPaths (a, b) {\n  if (a == '\"\"') return b;\n  return (a + ' + ' + b).replace(/' \\+ '/g, '');\n}\n\n\nfunction unescapeFragment(str) {\n  return unescapeJsonPointer(decodeURIComponent(str));\n}\n\n\nfunction escapeFragment(str) {\n  return encodeURIComponent(escapeJsonPointer(str));\n}\n\n\nfunction escapeJsonPointer(str) {\n  return str.replace(/~/g, '~0').replace(/\\//g, '~1');\n}\n\n\nfunction unescapeJsonPointer(str) {\n  return str.replace(/~1/g, '/').replace(/~0/g, '~');\n}\n","'use strict';\n\n// https://mathiasbynens.be/notes/javascript-encoding\n// https://github.com/bestiejs/punycode.js - punycode.ucs2.decode\nmodule.exports = function ucs2length(str) {\n  var length = 0\n    , len = str.length\n    , pos = 0\n    , value;\n  while (pos < len) {\n    length++;\n    value = str.charCodeAt(pos++);\n    if (value >= 0xD800 && value <= 0xDBFF && pos < len) {\n      // high surrogate, and there is a next character\n      value = str.charCodeAt(pos);\n      if ((value & 0xFC00) == 0xDC00) pos++; // low surrogate\n    }\n  }\n  return length;\n};\n","'use strict';\n\nvar util = require('./util');\n\nmodule.exports = SchemaObject;\n\nfunction SchemaObject(obj) {\n  util.copy(obj, this);\n}\n","'use strict';\n\nvar traverse = module.exports = function (schema, opts, cb) {\n  // Legacy support for v0.3.1 and earlier.\n  if (typeof opts == 'function') {\n    cb = opts;\n    opts = {};\n  }\n\n  cb = opts.cb || cb;\n  var pre = (typeof cb == 'function') ? cb : cb.pre || function() {};\n  var post = cb.post || function() {};\n\n  _traverse(opts, pre, post, schema, '', schema);\n};\n\n\ntraverse.keywords = {\n  additionalItems: true,\n  items: true,\n  contains: true,\n  additionalProperties: true,\n  propertyNames: true,\n  not: true\n};\n\ntraverse.arrayKeywords = {\n  items: true,\n  allOf: true,\n  anyOf: true,\n  oneOf: true\n};\n\ntraverse.propsKeywords = {\n  definitions: true,\n  properties: true,\n  patternProperties: true,\n  dependencies: true\n};\n\ntraverse.skipKeywords = {\n  default: true,\n  enum: true,\n  const: true,\n  required: true,\n  maximum: true,\n  minimum: true,\n  exclusiveMaximum: true,\n  exclusiveMinimum: true,\n  multipleOf: true,\n  maxLength: true,\n  minLength: true,\n  pattern: true,\n  format: true,\n  maxItems: true,\n  minItems: true,\n  uniqueItems: true,\n  maxProperties: true,\n  minProperties: true\n};\n\n\nfunction _traverse(opts, pre, post, schema, jsonPtr, rootSchema, parentJsonPtr, parentKeyword, parentSchema, keyIndex) {\n  if (schema && typeof schema == 'object' && !Array.isArray(schema)) {\n    pre(schema, jsonPtr, rootSchema, parentJsonPtr, parentKeyword, parentSchema, keyIndex);\n    for (var key in schema) {\n      var sch = schema[key];\n      if (Array.isArray(sch)) {\n        if (key in traverse.arrayKeywords) {\n          for (var i=0; i<sch.length; i++)\n            _traverse(opts, pre, post, sch[i], jsonPtr + '/' + key + '/' + i, rootSchema, jsonPtr, key, schema, i);\n        }\n      } else if (key in traverse.propsKeywords) {\n        if (sch && typeof sch == 'object') {\n          for (var prop in sch)\n            _traverse(opts, pre, post, sch[prop], jsonPtr + '/' + key + '/' + escapeJsonPtr(prop), rootSchema, jsonPtr, key, schema, prop);\n        }\n      } else if (key in traverse.keywords || (opts.allKeys && !(key in traverse.skipKeywords))) {\n        _traverse(opts, pre, post, sch, jsonPtr + '/' + key, rootSchema, jsonPtr, key, schema);\n      }\n    }\n    post(schema, jsonPtr, rootSchema, parentJsonPtr, parentKeyword, parentSchema, keyIndex);\n  }\n}\n\n\nfunction escapeJsonPtr(str) {\n  return str.replace(/~/g, '~0').replace(/\\//g, '~1');\n}\n","'use strict';\n\nvar URI = require('uri-js')\n  , equal = require('fast-deep-equal')\n  , util = require('./util')\n  , SchemaObject = require('./schema_obj')\n  , traverse = require('json-schema-traverse');\n\nmodule.exports = resolve;\n\nresolve.normalizeId = normalizeId;\nresolve.fullPath = getFullPath;\nresolve.url = resolveUrl;\nresolve.ids = resolveIds;\nresolve.inlineRef = inlineRef;\nresolve.schema = resolveSchema;\n\n/**\n * [resolve and compile the references ($ref)]\n * @this   Ajv\n * @param  {Function} compile reference to schema compilation funciton (localCompile)\n * @param  {Object} root object with information about the root schema for the current schema\n * @param  {String} ref reference to resolve\n * @return {Object|Function} schema object (if the schema can be inlined) or validation function\n */\nfunction resolve(compile, root, ref) {\n  /* jshint validthis: true */\n  var refVal = this._refs[ref];\n  if (typeof refVal == 'string') {\n    if (this._refs[refVal]) refVal = this._refs[refVal];\n    else return resolve.call(this, compile, root, refVal);\n  }\n\n  refVal = refVal || this._schemas[ref];\n  if (refVal instanceof SchemaObject) {\n    return inlineRef(refVal.schema, this._opts.inlineRefs)\n            ? refVal.schema\n            : refVal.validate || this._compile(refVal);\n  }\n\n  var res = resolveSchema.call(this, root, ref);\n  var schema, v, baseId;\n  if (res) {\n    schema = res.schema;\n    root = res.root;\n    baseId = res.baseId;\n  }\n\n  if (schema instanceof SchemaObject) {\n    v = schema.validate || compile.call(this, schema.schema, root, undefined, baseId);\n  } else if (schema !== undefined) {\n    v = inlineRef(schema, this._opts.inlineRefs)\n        ? schema\n        : compile.call(this, schema, root, undefined, baseId);\n  }\n\n  return v;\n}\n\n\n/**\n * Resolve schema, its root and baseId\n * @this Ajv\n * @param  {Object} root root object with properties schema, refVal, refs\n * @param  {String} ref  reference to resolve\n * @return {Object} object with properties schema, root, baseId\n */\nfunction resolveSchema(root, ref) {\n  /* jshint validthis: true */\n  var p = URI.parse(ref)\n    , refPath = _getFullPath(p)\n    , baseId = getFullPath(this._getId(root.schema));\n  if (Object.keys(root.schema).length === 0 || refPath !== baseId) {\n    var id = normalizeId(refPath);\n    var refVal = this._refs[id];\n    if (typeof refVal == 'string') {\n      return resolveRecursive.call(this, root, refVal, p);\n    } else if (refVal instanceof SchemaObject) {\n      if (!refVal.validate) this._compile(refVal);\n      root = refVal;\n    } else {\n      refVal = this._schemas[id];\n      if (refVal instanceof SchemaObject) {\n        if (!refVal.validate) this._compile(refVal);\n        if (id == normalizeId(ref))\n          return { schema: refVal, root: root, baseId: baseId };\n        root = refVal;\n      } else {\n        return;\n      }\n    }\n    if (!root.schema) return;\n    baseId = getFullPath(this._getId(root.schema));\n  }\n  return getJsonPointer.call(this, p, baseId, root.schema, root);\n}\n\n\n/* @this Ajv */\nfunction resolveRecursive(root, ref, parsedRef) {\n  /* jshint validthis: true */\n  var res = resolveSchema.call(this, root, ref);\n  if (res) {\n    var schema = res.schema;\n    var baseId = res.baseId;\n    root = res.root;\n    var id = this._getId(schema);\n    if (id) baseId = resolveUrl(baseId, id);\n    return getJsonPointer.call(this, parsedRef, baseId, schema, root);\n  }\n}\n\n\nvar PREVENT_SCOPE_CHANGE = util.toHash(['properties', 'patternProperties', 'enum', 'dependencies', 'definitions']);\n/* @this Ajv */\nfunction getJsonPointer(parsedRef, baseId, schema, root) {\n  /* jshint validthis: true */\n  parsedRef.fragment = parsedRef.fragment || '';\n  if (parsedRef.fragment.slice(0,1) != '/') return;\n  var parts = parsedRef.fragment.split('/');\n\n  for (var i = 1; i < parts.length; i++) {\n    var part = parts[i];\n    if (part) {\n      part = util.unescapeFragment(part);\n      schema = schema[part];\n      if (schema === undefined) break;\n      var id;\n      if (!PREVENT_SCOPE_CHANGE[part]) {\n        id = this._getId(schema);\n        if (id) baseId = resolveUrl(baseId, id);\n        if (schema.$ref) {\n          var $ref = resolveUrl(baseId, schema.$ref);\n          var res = resolveSchema.call(this, root, $ref);\n          if (res) {\n            schema = res.schema;\n            root = res.root;\n            baseId = res.baseId;\n          }\n        }\n      }\n    }\n  }\n  if (schema !== undefined && schema !== root.schema)\n    return { schema: schema, root: root, baseId: baseId };\n}\n\n\nvar SIMPLE_INLINED = util.toHash([\n  'type', 'format', 'pattern',\n  'maxLength', 'minLength',\n  'maxProperties', 'minProperties',\n  'maxItems', 'minItems',\n  'maximum', 'minimum',\n  'uniqueItems', 'multipleOf',\n  'required', 'enum'\n]);\nfunction inlineRef(schema, limit) {\n  if (limit === false) return false;\n  if (limit === undefined || limit === true) return checkNoRef(schema);\n  else if (limit) return countKeys(schema) <= limit;\n}\n\n\nfunction checkNoRef(schema) {\n  var item;\n  if (Array.isArray(schema)) {\n    for (var i=0; i<schema.length; i++) {\n      item = schema[i];\n      if (typeof item == 'object' && !checkNoRef(item)) return false;\n    }\n  } else {\n    for (var key in schema) {\n      if (key == '$ref') return false;\n      item = schema[key];\n      if (typeof item == 'object' && !checkNoRef(item)) return false;\n    }\n  }\n  return true;\n}\n\n\nfunction countKeys(schema) {\n  var count = 0, item;\n  if (Array.isArray(schema)) {\n    for (var i=0; i<schema.length; i++) {\n      item = schema[i];\n      if (typeof item == 'object') count += countKeys(item);\n      if (count == Infinity) return Infinity;\n    }\n  } else {\n    for (var key in schema) {\n      if (key == '$ref') return Infinity;\n      if (SIMPLE_INLINED[key]) {\n        count++;\n      } else {\n        item = schema[key];\n        if (typeof item == 'object') count += countKeys(item) + 1;\n        if (count == Infinity) return Infinity;\n      }\n    }\n  }\n  return count;\n}\n\n\nfunction getFullPath(id, normalize) {\n  if (normalize !== false) id = normalizeId(id);\n  var p = URI.parse(id);\n  return _getFullPath(p);\n}\n\n\nfunction _getFullPath(p) {\n  return URI.serialize(p).split('#')[0] + '#';\n}\n\n\nvar TRAILING_SLASH_HASH = /#\\/?$/;\nfunction normalizeId(id) {\n  return id ? id.replace(TRAILING_SLASH_HASH, '') : '';\n}\n\n\nfunction resolveUrl(baseId, id) {\n  id = normalizeId(id);\n  return URI.resolve(baseId, id);\n}\n\n\n/* @this Ajv */\nfunction resolveIds(schema) {\n  var schemaId = normalizeId(this._getId(schema));\n  var baseIds = {'': schemaId};\n  var fullPaths = {'': getFullPath(schemaId, false)};\n  var localRefs = {};\n  var self = this;\n\n  traverse(schema, {allKeys: true}, function(sch, jsonPtr, rootSchema, parentJsonPtr, parentKeyword, parentSchema, keyIndex) {\n    if (jsonPtr === '') return;\n    var id = self._getId(sch);\n    var baseId = baseIds[parentJsonPtr];\n    var fullPath = fullPaths[parentJsonPtr] + '/' + parentKeyword;\n    if (keyIndex !== undefined)\n      fullPath += '/' + (typeof keyIndex == 'number' ? keyIndex : util.escapeFragment(keyIndex));\n\n    if (typeof id == 'string') {\n      id = baseId = normalizeId(baseId ? URI.resolve(baseId, id) : id);\n\n      var refVal = self._refs[id];\n      if (typeof refVal == 'string') refVal = self._refs[refVal];\n      if (refVal && refVal.schema) {\n        if (!equal(sch, refVal.schema))\n          throw new Error('id \"' + id + '\" resolves to more than one schema');\n      } else if (id != normalizeId(fullPath)) {\n        if (id[0] == '#') {\n          if (localRefs[id] && !equal(sch, localRefs[id]))\n            throw new Error('id \"' + id + '\" resolves to more than one schema');\n          localRefs[id] = sch;\n        } else {\n          self._refs[id] = fullPath;\n        }\n      }\n    }\n    baseIds[jsonPtr] = baseId;\n    fullPaths[jsonPtr] = fullPath;\n  });\n\n  return localRefs;\n}\n","'use strict';\n\nvar resolve = require('./resolve');\n\nmodule.exports = {\n  Validation: errorSubclass(ValidationError),\n  MissingRef: errorSubclass(MissingRefError)\n};\n\n\nfunction ValidationError(errors) {\n  this.message = 'validation failed';\n  this.errors = errors;\n  this.ajv = this.validation = true;\n}\n\n\nMissingRefError.message = function (baseId, ref) {\n  return 'can\\'t resolve reference ' + ref + ' from id ' + baseId;\n};\n\n\nfunction MissingRefError(baseId, ref, message) {\n  this.message = message || MissingRefError.message(baseId, ref);\n  this.missingRef = resolve.url(baseId, ref);\n  this.missingSchema = resolve.normalizeId(resolve.fullPath(this.missingRef));\n}\n\n\nfunction errorSubclass(Subclass) {\n  Subclass.prototype = Object.create(Error.prototype);\n  Subclass.prototype.constructor = Subclass;\n  return Subclass;\n}\n","'use strict';\n\nmodule.exports = function (data, opts) {\n    if (!opts) opts = {};\n    if (typeof opts === 'function') opts = { cmp: opts };\n    var cycles = (typeof opts.cycles === 'boolean') ? opts.cycles : false;\n\n    var cmp = opts.cmp && (function (f) {\n        return function (node) {\n            return function (a, b) {\n                var aobj = { key: a, value: node[a] };\n                var bobj = { key: b, value: node[b] };\n                return f(aobj, bobj);\n            };\n        };\n    })(opts.cmp);\n\n    var seen = [];\n    return (function stringify (node) {\n        if (node && node.toJSON && typeof node.toJSON === 'function') {\n            node = node.toJSON();\n        }\n\n        if (node === undefined) return;\n        if (typeof node == 'number') return isFinite(node) ? '' + node : 'null';\n        if (typeof node !== 'object') return JSON.stringify(node);\n\n        var i, out;\n        if (Array.isArray(node)) {\n            out = '[';\n            for (i = 0; i < node.length; i++) {\n                if (i) out += ',';\n                out += stringify(node[i]) || 'null';\n            }\n            return out + ']';\n        }\n\n        if (node === null) return 'null';\n\n        if (seen.indexOf(node) !== -1) {\n            if (cycles) return JSON.stringify('__cycle__');\n            throw new TypeError('Converting circular structure to JSON');\n        }\n\n        var seenIndex = seen.push(node) - 1;\n        var keys = Object.keys(node).sort(cmp && cmp(node));\n        out = '';\n        for (i = 0; i < keys.length; i++) {\n            var key = keys[i];\n            var value = stringify(node[key]);\n\n            if (!value) continue;\n            if (out) out += ',';\n            out += JSON.stringify(key) + ':' + value;\n        }\n        seen.splice(seenIndex, 1);\n        return '{' + out + '}';\n    })(data);\n};\n","'use strict';\nmodule.exports = function generate_validate(it, $keyword, $ruleType) {\n  var out = '';\n  var $async = it.schema.$async === true,\n    $refKeywords = it.util.schemaHasRulesExcept(it.schema, it.RULES.all, '$ref'),\n    $id = it.self._getId(it.schema);\n  if (it.opts.strictKeywords) {\n    var $unknownKwd = it.util.schemaUnknownRules(it.schema, it.RULES.keywords);\n    if ($unknownKwd) {\n      var $keywordsMsg = 'unknown keyword: ' + $unknownKwd;\n      if (it.opts.strictKeywords === 'log') it.logger.warn($keywordsMsg);\n      else throw new Error($keywordsMsg);\n    }\n  }\n  if (it.isTop) {\n    out += ' var validate = ';\n    if ($async) {\n      it.async = true;\n      out += 'async ';\n    }\n    out += 'function(data, dataPath, parentData, parentDataProperty, rootData) { \\'use strict\\'; ';\n    if ($id && (it.opts.sourceCode || it.opts.processCode)) {\n      out += ' ' + ('/\\*# sourceURL=' + $id + ' */') + ' ';\n    }\n  }\n  if (typeof it.schema == 'boolean' || !($refKeywords || it.schema.$ref)) {\n    var $keyword = 'false schema';\n    var $lvl = it.level;\n    var $dataLvl = it.dataLevel;\n    var $schema = it.schema[$keyword];\n    var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n    var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n    var $breakOnError = !it.opts.allErrors;\n    var $errorKeyword;\n    var $data = 'data' + ($dataLvl || '');\n    var $valid = 'valid' + $lvl;\n    if (it.schema === false) {\n      if (it.isTop) {\n        $breakOnError = true;\n      } else {\n        out += ' var ' + ($valid) + ' = false; ';\n      }\n      var $$outStack = $$outStack || [];\n      $$outStack.push(out);\n      out = ''; /* istanbul ignore else */\n      if (it.createErrors !== false) {\n        out += ' { keyword: \\'' + ($errorKeyword || 'false schema') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: {} ';\n        if (it.opts.messages !== false) {\n          out += ' , message: \\'boolean schema is false\\' ';\n        }\n        if (it.opts.verbose) {\n          out += ' , schema: false , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n        }\n        out += ' } ';\n      } else {\n        out += ' {} ';\n      }\n      var __err = out;\n      out = $$outStack.pop();\n      if (!it.compositeRule && $breakOnError) {\n        /* istanbul ignore if */\n        if (it.async) {\n          out += ' throw new ValidationError([' + (__err) + ']); ';\n        } else {\n          out += ' validate.errors = [' + (__err) + ']; return false; ';\n        }\n      } else {\n        out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n      }\n    } else {\n      if (it.isTop) {\n        if ($async) {\n          out += ' return data; ';\n        } else {\n          out += ' validate.errors = null; return true; ';\n        }\n      } else {\n        out += ' var ' + ($valid) + ' = true; ';\n      }\n    }\n    if (it.isTop) {\n      out += ' }; return validate; ';\n    }\n    return out;\n  }\n  if (it.isTop) {\n    var $top = it.isTop,\n      $lvl = it.level = 0,\n      $dataLvl = it.dataLevel = 0,\n      $data = 'data';\n    it.rootId = it.resolve.fullPath(it.self._getId(it.root.schema));\n    it.baseId = it.baseId || it.rootId;\n    delete it.isTop;\n    it.dataPathArr = [undefined];\n    if (it.schema.default !== undefined && it.opts.useDefaults && it.opts.strictDefaults) {\n      var $defaultMsg = 'default is ignored in the schema root';\n      if (it.opts.strictDefaults === 'log') it.logger.warn($defaultMsg);\n      else throw new Error($defaultMsg);\n    }\n    out += ' var vErrors = null; ';\n    out += ' var errors = 0;     ';\n    out += ' if (rootData === undefined) rootData = data; ';\n  } else {\n    var $lvl = it.level,\n      $dataLvl = it.dataLevel,\n      $data = 'data' + ($dataLvl || '');\n    if ($id) it.baseId = it.resolve.url(it.baseId, $id);\n    if ($async && !it.async) throw new Error('async schema in sync schema');\n    out += ' var errs_' + ($lvl) + ' = errors;';\n  }\n  var $valid = 'valid' + $lvl,\n    $breakOnError = !it.opts.allErrors,\n    $closingBraces1 = '',\n    $closingBraces2 = '';\n  var $errorKeyword;\n  var $typeSchema = it.schema.type,\n    $typeIsArray = Array.isArray($typeSchema);\n  if ($typeSchema && it.opts.nullable && it.schema.nullable === true) {\n    if ($typeIsArray) {\n      if ($typeSchema.indexOf('null') == -1) $typeSchema = $typeSchema.concat('null');\n    } else if ($typeSchema != 'null') {\n      $typeSchema = [$typeSchema, 'null'];\n      $typeIsArray = true;\n    }\n  }\n  if ($typeIsArray && $typeSchema.length == 1) {\n    $typeSchema = $typeSchema[0];\n    $typeIsArray = false;\n  }\n  if (it.schema.$ref && $refKeywords) {\n    if (it.opts.extendRefs == 'fail') {\n      throw new Error('$ref: validation keywords used in schema at path \"' + it.errSchemaPath + '\" (see option extendRefs)');\n    } else if (it.opts.extendRefs !== true) {\n      $refKeywords = false;\n      it.logger.warn('$ref: keywords ignored in schema at path \"' + it.errSchemaPath + '\"');\n    }\n  }\n  if (it.schema.$comment && it.opts.$comment) {\n    out += ' ' + (it.RULES.all.$comment.code(it, '$comment'));\n  }\n  if ($typeSchema) {\n    if (it.opts.coerceTypes) {\n      var $coerceToTypes = it.util.coerceToTypes(it.opts.coerceTypes, $typeSchema);\n    }\n    var $rulesGroup = it.RULES.types[$typeSchema];\n    if ($coerceToTypes || $typeIsArray || $rulesGroup === true || ($rulesGroup && !$shouldUseGroup($rulesGroup))) {\n      var $schemaPath = it.schemaPath + '.type',\n        $errSchemaPath = it.errSchemaPath + '/type';\n      var $schemaPath = it.schemaPath + '.type',\n        $errSchemaPath = it.errSchemaPath + '/type',\n        $method = $typeIsArray ? 'checkDataTypes' : 'checkDataType';\n      out += ' if (' + (it.util[$method]($typeSchema, $data, true)) + ') { ';\n      if ($coerceToTypes) {\n        var $dataType = 'dataType' + $lvl,\n          $coerced = 'coerced' + $lvl;\n        out += ' var ' + ($dataType) + ' = typeof ' + ($data) + '; ';\n        if (it.opts.coerceTypes == 'array') {\n          out += ' if (' + ($dataType) + ' == \\'object\\' && Array.isArray(' + ($data) + ')) ' + ($dataType) + ' = \\'array\\'; ';\n        }\n        out += ' var ' + ($coerced) + ' = undefined; ';\n        var $bracesCoercion = '';\n        var arr1 = $coerceToTypes;\n        if (arr1) {\n          var $type, $i = -1,\n            l1 = arr1.length - 1;\n          while ($i < l1) {\n            $type = arr1[$i += 1];\n            if ($i) {\n              out += ' if (' + ($coerced) + ' === undefined) { ';\n              $bracesCoercion += '}';\n            }\n            if (it.opts.coerceTypes == 'array' && $type != 'array') {\n              out += ' if (' + ($dataType) + ' == \\'array\\' && ' + ($data) + '.length == 1) { ' + ($coerced) + ' = ' + ($data) + ' = ' + ($data) + '[0]; ' + ($dataType) + ' = typeof ' + ($data) + ';  } ';\n            }\n            if ($type == 'string') {\n              out += ' if (' + ($dataType) + ' == \\'number\\' || ' + ($dataType) + ' == \\'boolean\\') ' + ($coerced) + ' = \\'\\' + ' + ($data) + '; else if (' + ($data) + ' === null) ' + ($coerced) + ' = \\'\\'; ';\n            } else if ($type == 'number' || $type == 'integer') {\n              out += ' if (' + ($dataType) + ' == \\'boolean\\' || ' + ($data) + ' === null || (' + ($dataType) + ' == \\'string\\' && ' + ($data) + ' && ' + ($data) + ' == +' + ($data) + ' ';\n              if ($type == 'integer') {\n                out += ' && !(' + ($data) + ' % 1)';\n              }\n              out += ')) ' + ($coerced) + ' = +' + ($data) + '; ';\n            } else if ($type == 'boolean') {\n              out += ' if (' + ($data) + ' === \\'false\\' || ' + ($data) + ' === 0 || ' + ($data) + ' === null) ' + ($coerced) + ' = false; else if (' + ($data) + ' === \\'true\\' || ' + ($data) + ' === 1) ' + ($coerced) + ' = true; ';\n            } else if ($type == 'null') {\n              out += ' if (' + ($data) + ' === \\'\\' || ' + ($data) + ' === 0 || ' + ($data) + ' === false) ' + ($coerced) + ' = null; ';\n            } else if (it.opts.coerceTypes == 'array' && $type == 'array') {\n              out += ' if (' + ($dataType) + ' == \\'string\\' || ' + ($dataType) + ' == \\'number\\' || ' + ($dataType) + ' == \\'boolean\\' || ' + ($data) + ' == null) ' + ($coerced) + ' = [' + ($data) + ']; ';\n            }\n          }\n        }\n        out += ' ' + ($bracesCoercion) + ' if (' + ($coerced) + ' === undefined) {   ';\n        var $$outStack = $$outStack || [];\n        $$outStack.push(out);\n        out = ''; /* istanbul ignore else */\n        if (it.createErrors !== false) {\n          out += ' { keyword: \\'' + ($errorKeyword || 'type') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { type: \\'';\n          if ($typeIsArray) {\n            out += '' + ($typeSchema.join(\",\"));\n          } else {\n            out += '' + ($typeSchema);\n          }\n          out += '\\' } ';\n          if (it.opts.messages !== false) {\n            out += ' , message: \\'should be ';\n            if ($typeIsArray) {\n              out += '' + ($typeSchema.join(\",\"));\n            } else {\n              out += '' + ($typeSchema);\n            }\n            out += '\\' ';\n          }\n          if (it.opts.verbose) {\n            out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n          }\n          out += ' } ';\n        } else {\n          out += ' {} ';\n        }\n        var __err = out;\n        out = $$outStack.pop();\n        if (!it.compositeRule && $breakOnError) {\n          /* istanbul ignore if */\n          if (it.async) {\n            out += ' throw new ValidationError([' + (__err) + ']); ';\n          } else {\n            out += ' validate.errors = [' + (__err) + ']; return false; ';\n          }\n        } else {\n          out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n        }\n        out += ' } else {  ';\n        var $parentData = $dataLvl ? 'data' + (($dataLvl - 1) || '') : 'parentData',\n          $parentDataProperty = $dataLvl ? it.dataPathArr[$dataLvl] : 'parentDataProperty';\n        out += ' ' + ($data) + ' = ' + ($coerced) + '; ';\n        if (!$dataLvl) {\n          out += 'if (' + ($parentData) + ' !== undefined)';\n        }\n        out += ' ' + ($parentData) + '[' + ($parentDataProperty) + '] = ' + ($coerced) + '; } ';\n      } else {\n        var $$outStack = $$outStack || [];\n        $$outStack.push(out);\n        out = ''; /* istanbul ignore else */\n        if (it.createErrors !== false) {\n          out += ' { keyword: \\'' + ($errorKeyword || 'type') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { type: \\'';\n          if ($typeIsArray) {\n            out += '' + ($typeSchema.join(\",\"));\n          } else {\n            out += '' + ($typeSchema);\n          }\n          out += '\\' } ';\n          if (it.opts.messages !== false) {\n            out += ' , message: \\'should be ';\n            if ($typeIsArray) {\n              out += '' + ($typeSchema.join(\",\"));\n            } else {\n              out += '' + ($typeSchema);\n            }\n            out += '\\' ';\n          }\n          if (it.opts.verbose) {\n            out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n          }\n          out += ' } ';\n        } else {\n          out += ' {} ';\n        }\n        var __err = out;\n        out = $$outStack.pop();\n        if (!it.compositeRule && $breakOnError) {\n          /* istanbul ignore if */\n          if (it.async) {\n            out += ' throw new ValidationError([' + (__err) + ']); ';\n          } else {\n            out += ' validate.errors = [' + (__err) + ']; return false; ';\n          }\n        } else {\n          out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n        }\n      }\n      out += ' } ';\n    }\n  }\n  if (it.schema.$ref && !$refKeywords) {\n    out += ' ' + (it.RULES.all.$ref.code(it, '$ref')) + ' ';\n    if ($breakOnError) {\n      out += ' } if (errors === ';\n      if ($top) {\n        out += '0';\n      } else {\n        out += 'errs_' + ($lvl);\n      }\n      out += ') { ';\n      $closingBraces2 += '}';\n    }\n  } else {\n    var arr2 = it.RULES;\n    if (arr2) {\n      var $rulesGroup, i2 = -1,\n        l2 = arr2.length - 1;\n      while (i2 < l2) {\n        $rulesGroup = arr2[i2 += 1];\n        if ($shouldUseGroup($rulesGroup)) {\n          if ($rulesGroup.type) {\n            out += ' if (' + (it.util.checkDataType($rulesGroup.type, $data)) + ') { ';\n          }\n          if (it.opts.useDefaults) {\n            if ($rulesGroup.type == 'object' && it.schema.properties) {\n              var $schema = it.schema.properties,\n                $schemaKeys = Object.keys($schema);\n              var arr3 = $schemaKeys;\n              if (arr3) {\n                var $propertyKey, i3 = -1,\n                  l3 = arr3.length - 1;\n                while (i3 < l3) {\n                  $propertyKey = arr3[i3 += 1];\n                  var $sch = $schema[$propertyKey];\n                  if ($sch.default !== undefined) {\n                    var $passData = $data + it.util.getProperty($propertyKey);\n                    if (it.compositeRule) {\n                      if (it.opts.strictDefaults) {\n                        var $defaultMsg = 'default is ignored for: ' + $passData;\n                        if (it.opts.strictDefaults === 'log') it.logger.warn($defaultMsg);\n                        else throw new Error($defaultMsg);\n                      }\n                    } else {\n                      out += ' if (' + ($passData) + ' === undefined ';\n                      if (it.opts.useDefaults == 'empty') {\n                        out += ' || ' + ($passData) + ' === null || ' + ($passData) + ' === \\'\\' ';\n                      }\n                      out += ' ) ' + ($passData) + ' = ';\n                      if (it.opts.useDefaults == 'shared') {\n                        out += ' ' + (it.useDefault($sch.default)) + ' ';\n                      } else {\n                        out += ' ' + (JSON.stringify($sch.default)) + ' ';\n                      }\n                      out += '; ';\n                    }\n                  }\n                }\n              }\n            } else if ($rulesGroup.type == 'array' && Array.isArray(it.schema.items)) {\n              var arr4 = it.schema.items;\n              if (arr4) {\n                var $sch, $i = -1,\n                  l4 = arr4.length - 1;\n                while ($i < l4) {\n                  $sch = arr4[$i += 1];\n                  if ($sch.default !== undefined) {\n                    var $passData = $data + '[' + $i + ']';\n                    if (it.compositeRule) {\n                      if (it.opts.strictDefaults) {\n                        var $defaultMsg = 'default is ignored for: ' + $passData;\n                        if (it.opts.strictDefaults === 'log') it.logger.warn($defaultMsg);\n                        else throw new Error($defaultMsg);\n                      }\n                    } else {\n                      out += ' if (' + ($passData) + ' === undefined ';\n                      if (it.opts.useDefaults == 'empty') {\n                        out += ' || ' + ($passData) + ' === null || ' + ($passData) + ' === \\'\\' ';\n                      }\n                      out += ' ) ' + ($passData) + ' = ';\n                      if (it.opts.useDefaults == 'shared') {\n                        out += ' ' + (it.useDefault($sch.default)) + ' ';\n                      } else {\n                        out += ' ' + (JSON.stringify($sch.default)) + ' ';\n                      }\n                      out += '; ';\n                    }\n                  }\n                }\n              }\n            }\n          }\n          var arr5 = $rulesGroup.rules;\n          if (arr5) {\n            var $rule, i5 = -1,\n              l5 = arr5.length - 1;\n            while (i5 < l5) {\n              $rule = arr5[i5 += 1];\n              if ($shouldUseRule($rule)) {\n                var $code = $rule.code(it, $rule.keyword, $rulesGroup.type);\n                if ($code) {\n                  out += ' ' + ($code) + ' ';\n                  if ($breakOnError) {\n                    $closingBraces1 += '}';\n                  }\n                }\n              }\n            }\n          }\n          if ($breakOnError) {\n            out += ' ' + ($closingBraces1) + ' ';\n            $closingBraces1 = '';\n          }\n          if ($rulesGroup.type) {\n            out += ' } ';\n            if ($typeSchema && $typeSchema === $rulesGroup.type && !$coerceToTypes) {\n              out += ' else { ';\n              var $schemaPath = it.schemaPath + '.type',\n                $errSchemaPath = it.errSchemaPath + '/type';\n              var $$outStack = $$outStack || [];\n              $$outStack.push(out);\n              out = ''; /* istanbul ignore else */\n              if (it.createErrors !== false) {\n                out += ' { keyword: \\'' + ($errorKeyword || 'type') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { type: \\'';\n                if ($typeIsArray) {\n                  out += '' + ($typeSchema.join(\",\"));\n                } else {\n                  out += '' + ($typeSchema);\n                }\n                out += '\\' } ';\n                if (it.opts.messages !== false) {\n                  out += ' , message: \\'should be ';\n                  if ($typeIsArray) {\n                    out += '' + ($typeSchema.join(\",\"));\n                  } else {\n                    out += '' + ($typeSchema);\n                  }\n                  out += '\\' ';\n                }\n                if (it.opts.verbose) {\n                  out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n                }\n                out += ' } ';\n              } else {\n                out += ' {} ';\n              }\n              var __err = out;\n              out = $$outStack.pop();\n              if (!it.compositeRule && $breakOnError) {\n                /* istanbul ignore if */\n                if (it.async) {\n                  out += ' throw new ValidationError([' + (__err) + ']); ';\n                } else {\n                  out += ' validate.errors = [' + (__err) + ']; return false; ';\n                }\n              } else {\n                out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n              }\n              out += ' } ';\n            }\n          }\n          if ($breakOnError) {\n            out += ' if (errors === ';\n            if ($top) {\n              out += '0';\n            } else {\n              out += 'errs_' + ($lvl);\n            }\n            out += ') { ';\n            $closingBraces2 += '}';\n          }\n        }\n      }\n    }\n  }\n  if ($breakOnError) {\n    out += ' ' + ($closingBraces2) + ' ';\n  }\n  if ($top) {\n    if ($async) {\n      out += ' if (errors === 0) return data;           ';\n      out += ' else throw new ValidationError(vErrors); ';\n    } else {\n      out += ' validate.errors = vErrors; ';\n      out += ' return errors === 0;       ';\n    }\n    out += ' }; return validate;';\n  } else {\n    out += ' var ' + ($valid) + ' = errors === errs_' + ($lvl) + ';';\n  }\n  out = it.util.cleanUpCode(out);\n  if ($top) {\n    out = it.util.finalCleanUpCode(out, $async);\n  }\n\n  function $shouldUseGroup($rulesGroup) {\n    var rules = $rulesGroup.rules;\n    for (var i = 0; i < rules.length; i++)\n      if ($shouldUseRule(rules[i])) return true;\n  }\n\n  function $shouldUseRule($rule) {\n    return it.schema[$rule.keyword] !== undefined || ($rule.implements && $ruleImplementsSomeKeyword($rule));\n  }\n\n  function $ruleImplementsSomeKeyword($rule) {\n    var impl = $rule.implements;\n    for (var i = 0; i < impl.length; i++)\n      if (it.schema[impl[i]] !== undefined) return true;\n  }\n  return out;\n}\n","'use strict';\n\nvar resolve = require('./resolve')\n  , util = require('./util')\n  , errorClasses = require('./error_classes')\n  , stableStringify = require('fast-json-stable-stringify');\n\nvar validateGenerator = require('../dotjs/validate');\n\n/**\n * Functions below are used inside compiled validations function\n */\n\nvar ucs2length = util.ucs2length;\nvar equal = require('fast-deep-equal');\n\n// this error is thrown by async schemas to return validation errors via exception\nvar ValidationError = errorClasses.Validation;\n\nmodule.exports = compile;\n\n\n/**\n * Compiles schema to validation function\n * @this   Ajv\n * @param  {Object} schema schema object\n * @param  {Object} root object with information about the root schema for this schema\n * @param  {Object} localRefs the hash of local references inside the schema (created by resolve.id), used for inline resolution\n * @param  {String} baseId base ID for IDs in the schema\n * @return {Function} validation function\n */\nfunction compile(schema, root, localRefs, baseId) {\n  /* jshint validthis: true, evil: true */\n  /* eslint no-shadow: 0 */\n  var self = this\n    , opts = this._opts\n    , refVal = [ undefined ]\n    , refs = {}\n    , patterns = []\n    , patternsHash = {}\n    , defaults = []\n    , defaultsHash = {}\n    , customRules = [];\n\n  root = root || { schema: schema, refVal: refVal, refs: refs };\n\n  var c = checkCompiling.call(this, schema, root, baseId);\n  var compilation = this._compilations[c.index];\n  if (c.compiling) return (compilation.callValidate = callValidate);\n\n  var formats = this._formats;\n  var RULES = this.RULES;\n\n  try {\n    var v = localCompile(schema, root, localRefs, baseId);\n    compilation.validate = v;\n    var cv = compilation.callValidate;\n    if (cv) {\n      cv.schema = v.schema;\n      cv.errors = null;\n      cv.refs = v.refs;\n      cv.refVal = v.refVal;\n      cv.root = v.root;\n      cv.$async = v.$async;\n      if (opts.sourceCode) cv.source = v.source;\n    }\n    return v;\n  } finally {\n    endCompiling.call(this, schema, root, baseId);\n  }\n\n  /* @this   {*} - custom context, see passContext option */\n  function callValidate() {\n    /* jshint validthis: true */\n    var validate = compilation.validate;\n    var result = validate.apply(this, arguments);\n    callValidate.errors = validate.errors;\n    return result;\n  }\n\n  function localCompile(_schema, _root, localRefs, baseId) {\n    var isRoot = !_root || (_root && _root.schema == _schema);\n    if (_root.schema != root.schema)\n      return compile.call(self, _schema, _root, localRefs, baseId);\n\n    var $async = _schema.$async === true;\n\n    var sourceCode = validateGenerator({\n      isTop: true,\n      schema: _schema,\n      isRoot: isRoot,\n      baseId: baseId,\n      root: _root,\n      schemaPath: '',\n      errSchemaPath: '#',\n      errorPath: '\"\"',\n      MissingRefError: errorClasses.MissingRef,\n      RULES: RULES,\n      validate: validateGenerator,\n      util: util,\n      resolve: resolve,\n      resolveRef: resolveRef,\n      usePattern: usePattern,\n      useDefault: useDefault,\n      useCustomRule: useCustomRule,\n      opts: opts,\n      formats: formats,\n      logger: self.logger,\n      self: self\n    });\n\n    sourceCode = vars(refVal, refValCode) + vars(patterns, patternCode)\n                   + vars(defaults, defaultCode) + vars(customRules, customRuleCode)\n                   + sourceCode;\n\n    if (opts.processCode) sourceCode = opts.processCode(sourceCode);\n    // console.log('\\n\\n\\n *** \\n', JSON.stringify(sourceCode));\n    var validate;\n    try {\n      var makeValidate = new Function(\n        'self',\n        'RULES',\n        'formats',\n        'root',\n        'refVal',\n        'defaults',\n        'customRules',\n        'equal',\n        'ucs2length',\n        'ValidationError',\n        sourceCode\n      );\n\n      validate = makeValidate(\n        self,\n        RULES,\n        formats,\n        root,\n        refVal,\n        defaults,\n        customRules,\n        equal,\n        ucs2length,\n        ValidationError\n      );\n\n      refVal[0] = validate;\n    } catch(e) {\n      self.logger.error('Error compiling schema, function code:', sourceCode);\n      throw e;\n    }\n\n    validate.schema = _schema;\n    validate.errors = null;\n    validate.refs = refs;\n    validate.refVal = refVal;\n    validate.root = isRoot ? validate : _root;\n    if ($async) validate.$async = true;\n    if (opts.sourceCode === true) {\n      validate.source = {\n        code: sourceCode,\n        patterns: patterns,\n        defaults: defaults\n      };\n    }\n\n    return validate;\n  }\n\n  function resolveRef(baseId, ref, isRoot) {\n    ref = resolve.url(baseId, ref);\n    var refIndex = refs[ref];\n    var _refVal, refCode;\n    if (refIndex !== undefined) {\n      _refVal = refVal[refIndex];\n      refCode = 'refVal[' + refIndex + ']';\n      return resolvedRef(_refVal, refCode);\n    }\n    if (!isRoot && root.refs) {\n      var rootRefId = root.refs[ref];\n      if (rootRefId !== undefined) {\n        _refVal = root.refVal[rootRefId];\n        refCode = addLocalRef(ref, _refVal);\n        return resolvedRef(_refVal, refCode);\n      }\n    }\n\n    refCode = addLocalRef(ref);\n    var v = resolve.call(self, localCompile, root, ref);\n    if (v === undefined) {\n      var localSchema = localRefs && localRefs[ref];\n      if (localSchema) {\n        v = resolve.inlineRef(localSchema, opts.inlineRefs)\n            ? localSchema\n            : compile.call(self, localSchema, root, localRefs, baseId);\n      }\n    }\n\n    if (v === undefined) {\n      removeLocalRef(ref);\n    } else {\n      replaceLocalRef(ref, v);\n      return resolvedRef(v, refCode);\n    }\n  }\n\n  function addLocalRef(ref, v) {\n    var refId = refVal.length;\n    refVal[refId] = v;\n    refs[ref] = refId;\n    return 'refVal' + refId;\n  }\n\n  function removeLocalRef(ref) {\n    delete refs[ref];\n  }\n\n  function replaceLocalRef(ref, v) {\n    var refId = refs[ref];\n    refVal[refId] = v;\n  }\n\n  function resolvedRef(refVal, code) {\n    return typeof refVal == 'object' || typeof refVal == 'boolean'\n            ? { code: code, schema: refVal, inline: true }\n            : { code: code, $async: refVal && !!refVal.$async };\n  }\n\n  function usePattern(regexStr) {\n    var index = patternsHash[regexStr];\n    if (index === undefined) {\n      index = patternsHash[regexStr] = patterns.length;\n      patterns[index] = regexStr;\n    }\n    return 'pattern' + index;\n  }\n\n  function useDefault(value) {\n    switch (typeof value) {\n      case 'boolean':\n      case 'number':\n        return '' + value;\n      case 'string':\n        return util.toQuotedString(value);\n      case 'object':\n        if (value === null) return 'null';\n        var valueStr = stableStringify(value);\n        var index = defaultsHash[valueStr];\n        if (index === undefined) {\n          index = defaultsHash[valueStr] = defaults.length;\n          defaults[index] = value;\n        }\n        return 'default' + index;\n    }\n  }\n\n  function useCustomRule(rule, schema, parentSchema, it) {\n    if (self._opts.validateSchema !== false) {\n      var deps = rule.definition.dependencies;\n      if (deps && !deps.every(function(keyword) {\n        return Object.prototype.hasOwnProperty.call(parentSchema, keyword);\n      }))\n        throw new Error('parent schema must have all required keywords: ' + deps.join(','));\n\n      var validateSchema = rule.definition.validateSchema;\n      if (validateSchema) {\n        var valid = validateSchema(schema);\n        if (!valid) {\n          var message = 'keyword schema is invalid: ' + self.errorsText(validateSchema.errors);\n          if (self._opts.validateSchema == 'log') self.logger.error(message);\n          else throw new Error(message);\n        }\n      }\n    }\n\n    var compile = rule.definition.compile\n      , inline = rule.definition.inline\n      , macro = rule.definition.macro;\n\n    var validate;\n    if (compile) {\n      validate = compile.call(self, schema, parentSchema, it);\n    } else if (macro) {\n      validate = macro.call(self, schema, parentSchema, it);\n      if (opts.validateSchema !== false) self.validateSchema(validate, true);\n    } else if (inline) {\n      validate = inline.call(self, it, rule.keyword, schema, parentSchema);\n    } else {\n      validate = rule.definition.validate;\n      if (!validate) return;\n    }\n\n    if (validate === undefined)\n      throw new Error('custom keyword \"' + rule.keyword + '\"failed to compile');\n\n    var index = customRules.length;\n    customRules[index] = validate;\n\n    return {\n      code: 'customRule' + index,\n      validate: validate\n    };\n  }\n}\n\n\n/**\n * Checks if the schema is currently compiled\n * @this   Ajv\n * @param  {Object} schema schema to compile\n * @param  {Object} root root object\n * @param  {String} baseId base schema ID\n * @return {Object} object with properties \"index\" (compilation index) and \"compiling\" (boolean)\n */\nfunction checkCompiling(schema, root, baseId) {\n  /* jshint validthis: true */\n  var index = compIndex.call(this, schema, root, baseId);\n  if (index >= 0) return { index: index, compiling: true };\n  index = this._compilations.length;\n  this._compilations[index] = {\n    schema: schema,\n    root: root,\n    baseId: baseId\n  };\n  return { index: index, compiling: false };\n}\n\n\n/**\n * Removes the schema from the currently compiled list\n * @this   Ajv\n * @param  {Object} schema schema to compile\n * @param  {Object} root root object\n * @param  {String} baseId base schema ID\n */\nfunction endCompiling(schema, root, baseId) {\n  /* jshint validthis: true */\n  var i = compIndex.call(this, schema, root, baseId);\n  if (i >= 0) this._compilations.splice(i, 1);\n}\n\n\n/**\n * Index of schema compilation in the currently compiled list\n * @this   Ajv\n * @param  {Object} schema schema to compile\n * @param  {Object} root root object\n * @param  {String} baseId base schema ID\n * @return {Integer} compilation index\n */\nfunction compIndex(schema, root, baseId) {\n  /* jshint validthis: true */\n  for (var i=0; i<this._compilations.length; i++) {\n    var c = this._compilations[i];\n    if (c.schema == schema && c.root == root && c.baseId == baseId) return i;\n  }\n  return -1;\n}\n\n\nfunction patternCode(i, patterns) {\n  return 'var pattern' + i + ' = new RegExp(' + util.toQuotedString(patterns[i]) + ');';\n}\n\n\nfunction defaultCode(i) {\n  return 'var default' + i + ' = defaults[' + i + '];';\n}\n\n\nfunction refValCode(i, refVal) {\n  return refVal[i] === undefined ? '' : 'var refVal' + i + ' = refVal[' + i + '];';\n}\n\n\nfunction customRuleCode(i) {\n  return 'var customRule' + i + ' = customRules[' + i + '];';\n}\n\n\nfunction vars(arr, statement) {\n  if (!arr.length) return '';\n  var code = '';\n  for (var i=0; i<arr.length; i++)\n    code += statement(i, arr);\n  return code;\n}\n","'use strict';\n\n\nvar Cache = module.exports = function Cache() {\n  this._cache = {};\n};\n\n\nCache.prototype.put = function Cache_put(key, value) {\n  this._cache[key] = value;\n};\n\n\nCache.prototype.get = function Cache_get(key) {\n  return this._cache[key];\n};\n\n\nCache.prototype.del = function Cache_del(key) {\n  delete this._cache[key];\n};\n\n\nCache.prototype.clear = function Cache_clear() {\n  this._cache = {};\n};\n","'use strict';\n\nvar util = require('./util');\n\nvar DATE = /^(\\d\\d\\d\\d)-(\\d\\d)-(\\d\\d)$/;\nvar DAYS = [0,31,28,31,30,31,30,31,31,30,31,30,31];\nvar TIME = /^(\\d\\d):(\\d\\d):(\\d\\d)(\\.\\d+)?(z|[+-]\\d\\d(?::?\\d\\d)?)?$/i;\nvar HOSTNAME = /^(?=.{1,253}\\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\\.?$/i;\nvar URI = /^(?:[a-z][a-z0-9+\\-.]*:)(?:\\/?\\/(?:(?:[a-z0-9\\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\\.[a-z0-9\\-._~!$&'()*+,;=:]+)\\]|(?:(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)|(?:[a-z0-9\\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\\d*)?(?:\\/(?:[a-z0-9\\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\\/(?:(?:[a-z0-9\\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\\/(?:[a-z0-9\\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\\/(?:[a-z0-9\\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\\?(?:[a-z0-9\\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;\nvar URIREF = /^(?:[a-z][a-z0-9+\\-.]*:)?(?:\\/?\\/(?:(?:[a-z0-9\\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\\.[a-z0-9\\-._~!$&'()*+,;=:]+)\\]|(?:(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)|(?:[a-z0-9\\-._~!$&'\"()*+,;=]|%[0-9a-f]{2})*)(?::\\d*)?(?:\\/(?:[a-z0-9\\-._~!$&'\"()*+,;=:@]|%[0-9a-f]{2})*)*|\\/(?:(?:[a-z0-9\\-._~!$&'\"()*+,;=:@]|%[0-9a-f]{2})+(?:\\/(?:[a-z0-9\\-._~!$&'\"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\\-._~!$&'\"()*+,;=:@]|%[0-9a-f]{2})+(?:\\/(?:[a-z0-9\\-._~!$&'\"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\\?(?:[a-z0-9\\-._~!$&'\"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\\-._~!$&'\"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;\n// uri-template: https://tools.ietf.org/html/rfc6570\nvar URITEMPLATE = /^(?:(?:[^\\x00-\\x20\"'<>%\\\\^`{|}]|%[0-9a-f]{2})|\\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\\*)?)*\\})*$/i;\n// For the source: https://gist.github.com/dperini/729294\n// For test cases: https://mathiasbynens.be/demo/url-regex\n// @todo Delete current URL in favour of the commented out URL rule when this issue is fixed https://github.com/eslint/eslint/issues/7983.\n// var URL = /^(?:(?:https?|ftp):\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!10(?:\\.\\d{1,3}){3})(?!127(?:\\.\\d{1,3}){3})(?!169\\.254(?:\\.\\d{1,3}){2})(?!192\\.168(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u{00a1}-\\u{ffff}0-9]+-?)*[a-z\\u{00a1}-\\u{ffff}0-9]+)(?:\\.(?:[a-z\\u{00a1}-\\u{ffff}0-9]+-?)*[a-z\\u{00a1}-\\u{ffff}0-9]+)*(?:\\.(?:[a-z\\u{00a1}-\\u{ffff}]{2,})))(?::\\d{2,5})?(?:\\/[^\\s]*)?$/iu;\nvar URL = /^(?:(?:http[s\\u017F]?|ftp):\\/\\/)(?:(?:[\\0-\\x08\\x0E-\\x1F!-\\x9F\\xA1-\\u167F\\u1681-\\u1FFF\\u200B-\\u2027\\u202A-\\u202E\\u2030-\\u205E\\u2060-\\u2FFF\\u3001-\\uD7FF\\uE000-\\uFEFE\\uFF00-\\uFFFF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]|[\\uD800-\\uDBFF](?![\\uDC00-\\uDFFF])|(?:[^\\uD800-\\uDBFF]|^)[\\uDC00-\\uDFFF])+(?::(?:[\\0-\\x08\\x0E-\\x1F!-\\x9F\\xA1-\\u167F\\u1681-\\u1FFF\\u200B-\\u2027\\u202A-\\u202E\\u2030-\\u205E\\u2060-\\u2FFF\\u3001-\\uD7FF\\uE000-\\uFEFE\\uFF00-\\uFFFF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]|[\\uD800-\\uDBFF](?![\\uDC00-\\uDFFF])|(?:[^\\uD800-\\uDBFF]|^)[\\uDC00-\\uDFFF])*)?@)?(?:(?!10(?:\\.[0-9]{1,3}){3})(?!127(?:\\.[0-9]{1,3}){3})(?!169\\.254(?:\\.[0-9]{1,3}){2})(?!192\\.168(?:\\.[0-9]{1,3}){2})(?!172\\.(?:1[6-9]|2[0-9]|3[01])(?:\\.[0-9]{1,3}){2})(?:[1-9][0-9]?|1[0-9][0-9]|2[01][0-9]|22[0-3])(?:\\.(?:1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])){2}(?:\\.(?:[1-9][0-9]?|1[0-9][0-9]|2[0-4][0-9]|25[0-4]))|(?:(?:(?:[0-9KSa-z\\xA1-\\uD7FF\\uE000-\\uFFFF]|[\\uD800-\\uDBFF](?![\\uDC00-\\uDFFF])|(?:[^\\uD800-\\uDBFF]|^)[\\uDC00-\\uDFFF])+-?)*(?:[0-9KSa-z\\xA1-\\uD7FF\\uE000-\\uFFFF]|[\\uD800-\\uDBFF](?![\\uDC00-\\uDFFF])|(?:[^\\uD800-\\uDBFF]|^)[\\uDC00-\\uDFFF])+)(?:\\.(?:(?:[0-9KSa-z\\xA1-\\uD7FF\\uE000-\\uFFFF]|[\\uD800-\\uDBFF](?![\\uDC00-\\uDFFF])|(?:[^\\uD800-\\uDBFF]|^)[\\uDC00-\\uDFFF])+-?)*(?:[0-9KSa-z\\xA1-\\uD7FF\\uE000-\\uFFFF]|[\\uD800-\\uDBFF](?![\\uDC00-\\uDFFF])|(?:[^\\uD800-\\uDBFF]|^)[\\uDC00-\\uDFFF])+)*(?:\\.(?:(?:[KSa-z\\xA1-\\uD7FF\\uE000-\\uFFFF]|[\\uD800-\\uDBFF](?![\\uDC00-\\uDFFF])|(?:[^\\uD800-\\uDBFF]|^)[\\uDC00-\\uDFFF]){2,})))(?::[0-9]{2,5})?(?:\\/(?:[\\0-\\x08\\x0E-\\x1F!-\\x9F\\xA1-\\u167F\\u1681-\\u1FFF\\u200B-\\u2027\\u202A-\\u202E\\u2030-\\u205E\\u2060-\\u2FFF\\u3001-\\uD7FF\\uE000-\\uFEFE\\uFF00-\\uFFFF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]|[\\uD800-\\uDBFF](?![\\uDC00-\\uDFFF])|(?:[^\\uD800-\\uDBFF]|^)[\\uDC00-\\uDFFF])*)?$/i;\nvar UUID = /^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i;\nvar JSON_POINTER = /^(?:\\/(?:[^~/]|~0|~1)*)*$/;\nvar JSON_POINTER_URI_FRAGMENT = /^#(?:\\/(?:[a-z0-9_\\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i;\nvar RELATIVE_JSON_POINTER = /^(?:0|[1-9][0-9]*)(?:#|(?:\\/(?:[^~/]|~0|~1)*)*)$/;\n\n\nmodule.exports = formats;\n\nfunction formats(mode) {\n  mode = mode == 'full' ? 'full' : 'fast';\n  return util.copy(formats[mode]);\n}\n\n\nformats.fast = {\n  // date: http://tools.ietf.org/html/rfc3339#section-5.6\n  date: /^\\d\\d\\d\\d-[0-1]\\d-[0-3]\\d$/,\n  // date-time: http://tools.ietf.org/html/rfc3339#section-5.6\n  time: /^(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)(?:\\.\\d+)?(?:z|[+-]\\d\\d(?::?\\d\\d)?)?$/i,\n  'date-time': /^\\d\\d\\d\\d-[0-1]\\d-[0-3]\\d[t\\s](?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)(?:\\.\\d+)?(?:z|[+-]\\d\\d(?::?\\d\\d)?)$/i,\n  // uri: https://github.com/mafintosh/is-my-json-valid/blob/master/formats.js\n  uri: /^(?:[a-z][a-z0-9+-.]*:)(?:\\/?\\/)?[^\\s]*$/i,\n  'uri-reference': /^(?:(?:[a-z][a-z0-9+-.]*:)?\\/?\\/)?(?:[^\\\\\\s#][^\\s#]*)?(?:#[^\\\\\\s]*)?$/i,\n  'uri-template': URITEMPLATE,\n  url: URL,\n  // email (sources from jsen validator):\n  // http://stackoverflow.com/questions/201323/using-a-regular-expression-to-validate-an-email-address#answer-8829363\n  // http://www.w3.org/TR/html5/forms.html#valid-e-mail-address (search for 'willful violation')\n  email: /^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,\n  hostname: HOSTNAME,\n  // optimized https://www.safaribooksonline.com/library/view/regular-expressions-cookbook/9780596802837/ch07s16.html\n  ipv4: /^(?:(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)$/,\n  // optimized http://stackoverflow.com/questions/53497/regular-expression-that-matches-valid-ipv6-addresses\n  ipv6: /^\\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:)))(?:%.+)?\\s*$/i,\n  regex: regex,\n  // uuid: http://tools.ietf.org/html/rfc4122\n  uuid: UUID,\n  // JSON-pointer: https://tools.ietf.org/html/rfc6901\n  // uri fragment: https://tools.ietf.org/html/rfc3986#appendix-A\n  'json-pointer': JSON_POINTER,\n  'json-pointer-uri-fragment': JSON_POINTER_URI_FRAGMENT,\n  // relative JSON-pointer: http://tools.ietf.org/html/draft-luff-relative-json-pointer-00\n  'relative-json-pointer': RELATIVE_JSON_POINTER\n};\n\n\nformats.full = {\n  date: date,\n  time: time,\n  'date-time': date_time,\n  uri: uri,\n  'uri-reference': URIREF,\n  'uri-template': URITEMPLATE,\n  url: URL,\n  email: /^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,\n  hostname: HOSTNAME,\n  ipv4: /^(?:(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)$/,\n  ipv6: /^\\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:)))(?:%.+)?\\s*$/i,\n  regex: regex,\n  uuid: UUID,\n  'json-pointer': JSON_POINTER,\n  'json-pointer-uri-fragment': JSON_POINTER_URI_FRAGMENT,\n  'relative-json-pointer': RELATIVE_JSON_POINTER\n};\n\n\nfunction isLeapYear(year) {\n  // https://tools.ietf.org/html/rfc3339#appendix-C\n  return year % 4 === 0 && (year % 100 !== 0 || year % 400 === 0);\n}\n\n\nfunction date(str) {\n  // full-date from http://tools.ietf.org/html/rfc3339#section-5.6\n  var matches = str.match(DATE);\n  if (!matches) return false;\n\n  var year = +matches[1];\n  var month = +matches[2];\n  var day = +matches[3];\n\n  return month >= 1 && month <= 12 && day >= 1 &&\n          day <= (month == 2 && isLeapYear(year) ? 29 : DAYS[month]);\n}\n\n\nfunction time(str, full) {\n  var matches = str.match(TIME);\n  if (!matches) return false;\n\n  var hour = matches[1];\n  var minute = matches[2];\n  var second = matches[3];\n  var timeZone = matches[5];\n  return ((hour <= 23 && minute <= 59 && second <= 59) ||\n          (hour == 23 && minute == 59 && second == 60)) &&\n         (!full || timeZone);\n}\n\n\nvar DATE_TIME_SEPARATOR = /t|\\s/i;\nfunction date_time(str) {\n  // http://tools.ietf.org/html/rfc3339#section-5.6\n  var dateTime = str.split(DATE_TIME_SEPARATOR);\n  return dateTime.length == 2 && date(dateTime[0]) && time(dateTime[1], true);\n}\n\n\nvar NOT_URI_FRAGMENT = /\\/|:/;\nfunction uri(str) {\n  // http://jmrware.com/articles/2009/uri_regexp/URI_regex.html + optional protocol + required \".\"\n  return NOT_URI_FRAGMENT.test(str) && URI.test(str);\n}\n\n\nvar Z_ANCHOR = /[^\\\\]\\\\Z/;\nfunction regex(str) {\n  if (Z_ANCHOR.test(str)) return false;\n  try {\n    new RegExp(str);\n    return true;\n  } catch(e) {\n    return false;\n  }\n}\n","'use strict';\nmodule.exports = function generate_ref(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $valid = 'valid' + $lvl;\n  var $async, $refCode;\n  if ($schema == '#' || $schema == '#/') {\n    if (it.isRoot) {\n      $async = it.async;\n      $refCode = 'validate';\n    } else {\n      $async = it.root.schema.$async === true;\n      $refCode = 'root.refVal[0]';\n    }\n  } else {\n    var $refVal = it.resolveRef(it.baseId, $schema, it.isRoot);\n    if ($refVal === undefined) {\n      var $message = it.MissingRefError.message(it.baseId, $schema);\n      if (it.opts.missingRefs == 'fail') {\n        it.logger.error($message);\n        var $$outStack = $$outStack || [];\n        $$outStack.push(out);\n        out = ''; /* istanbul ignore else */\n        if (it.createErrors !== false) {\n          out += ' { keyword: \\'' + ('$ref') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { ref: \\'' + (it.util.escapeQuotes($schema)) + '\\' } ';\n          if (it.opts.messages !== false) {\n            out += ' , message: \\'can\\\\\\'t resolve reference ' + (it.util.escapeQuotes($schema)) + '\\' ';\n          }\n          if (it.opts.verbose) {\n            out += ' , schema: ' + (it.util.toQuotedString($schema)) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n          }\n          out += ' } ';\n        } else {\n          out += ' {} ';\n        }\n        var __err = out;\n        out = $$outStack.pop();\n        if (!it.compositeRule && $breakOnError) {\n          /* istanbul ignore if */\n          if (it.async) {\n            out += ' throw new ValidationError([' + (__err) + ']); ';\n          } else {\n            out += ' validate.errors = [' + (__err) + ']; return false; ';\n          }\n        } else {\n          out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n        }\n        if ($breakOnError) {\n          out += ' if (false) { ';\n        }\n      } else if (it.opts.missingRefs == 'ignore') {\n        it.logger.warn($message);\n        if ($breakOnError) {\n          out += ' if (true) { ';\n        }\n      } else {\n        throw new it.MissingRefError(it.baseId, $schema, $message);\n      }\n    } else if ($refVal.inline) {\n      var $it = it.util.copy(it);\n      $it.level++;\n      var $nextValid = 'valid' + $it.level;\n      $it.schema = $refVal.schema;\n      $it.schemaPath = '';\n      $it.errSchemaPath = $schema;\n      var $code = it.validate($it).replace(/validate\\.schema/g, $refVal.code);\n      out += ' ' + ($code) + ' ';\n      if ($breakOnError) {\n        out += ' if (' + ($nextValid) + ') { ';\n      }\n    } else {\n      $async = $refVal.$async === true || (it.async && $refVal.$async !== false);\n      $refCode = $refVal.code;\n    }\n  }\n  if ($refCode) {\n    var $$outStack = $$outStack || [];\n    $$outStack.push(out);\n    out = '';\n    if (it.opts.passContext) {\n      out += ' ' + ($refCode) + '.call(this, ';\n    } else {\n      out += ' ' + ($refCode) + '( ';\n    }\n    out += ' ' + ($data) + ', (dataPath || \\'\\')';\n    if (it.errorPath != '\"\"') {\n      out += ' + ' + (it.errorPath);\n    }\n    var $parentData = $dataLvl ? 'data' + (($dataLvl - 1) || '') : 'parentData',\n      $parentDataProperty = $dataLvl ? it.dataPathArr[$dataLvl] : 'parentDataProperty';\n    out += ' , ' + ($parentData) + ' , ' + ($parentDataProperty) + ', rootData)  ';\n    var __callValidate = out;\n    out = $$outStack.pop();\n    if ($async) {\n      if (!it.async) throw new Error('async schema referenced by sync schema');\n      if ($breakOnError) {\n        out += ' var ' + ($valid) + '; ';\n      }\n      out += ' try { await ' + (__callValidate) + '; ';\n      if ($breakOnError) {\n        out += ' ' + ($valid) + ' = true; ';\n      }\n      out += ' } catch (e) { if (!(e instanceof ValidationError)) throw e; if (vErrors === null) vErrors = e.errors; else vErrors = vErrors.concat(e.errors); errors = vErrors.length; ';\n      if ($breakOnError) {\n        out += ' ' + ($valid) + ' = false; ';\n      }\n      out += ' } ';\n      if ($breakOnError) {\n        out += ' if (' + ($valid) + ') { ';\n      }\n    } else {\n      out += ' if (!' + (__callValidate) + ') { if (vErrors === null) vErrors = ' + ($refCode) + '.errors; else vErrors = vErrors.concat(' + ($refCode) + '.errors); errors = vErrors.length; } ';\n      if ($breakOnError) {\n        out += ' else { ';\n      }\n    }\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate__limit(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $errorKeyword;\n  var $data = 'data' + ($dataLvl || '');\n  var $isData = it.opts.$data && $schema && $schema.$data,\n    $schemaValue;\n  if ($isData) {\n    out += ' var schema' + ($lvl) + ' = ' + (it.util.getData($schema.$data, $dataLvl, it.dataPathArr)) + '; ';\n    $schemaValue = 'schema' + $lvl;\n  } else {\n    $schemaValue = $schema;\n  }\n  var $isMax = $keyword == 'maximum',\n    $exclusiveKeyword = $isMax ? 'exclusiveMaximum' : 'exclusiveMinimum',\n    $schemaExcl = it.schema[$exclusiveKeyword],\n    $isDataExcl = it.opts.$data && $schemaExcl && $schemaExcl.$data,\n    $op = $isMax ? '<' : '>',\n    $notOp = $isMax ? '>' : '<',\n    $errorKeyword = undefined;\n  if ($isDataExcl) {\n    var $schemaValueExcl = it.util.getData($schemaExcl.$data, $dataLvl, it.dataPathArr),\n      $exclusive = 'exclusive' + $lvl,\n      $exclType = 'exclType' + $lvl,\n      $exclIsNumber = 'exclIsNumber' + $lvl,\n      $opExpr = 'op' + $lvl,\n      $opStr = '\\' + ' + $opExpr + ' + \\'';\n    out += ' var schemaExcl' + ($lvl) + ' = ' + ($schemaValueExcl) + '; ';\n    $schemaValueExcl = 'schemaExcl' + $lvl;\n    out += ' var ' + ($exclusive) + '; var ' + ($exclType) + ' = typeof ' + ($schemaValueExcl) + '; if (' + ($exclType) + ' != \\'boolean\\' && ' + ($exclType) + ' != \\'undefined\\' && ' + ($exclType) + ' != \\'number\\') { ';\n    var $errorKeyword = $exclusiveKeyword;\n    var $$outStack = $$outStack || [];\n    $$outStack.push(out);\n    out = ''; /* istanbul ignore else */\n    if (it.createErrors !== false) {\n      out += ' { keyword: \\'' + ($errorKeyword || '_exclusiveLimit') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: {} ';\n      if (it.opts.messages !== false) {\n        out += ' , message: \\'' + ($exclusiveKeyword) + ' should be boolean\\' ';\n      }\n      if (it.opts.verbose) {\n        out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n      }\n      out += ' } ';\n    } else {\n      out += ' {} ';\n    }\n    var __err = out;\n    out = $$outStack.pop();\n    if (!it.compositeRule && $breakOnError) {\n      /* istanbul ignore if */\n      if (it.async) {\n        out += ' throw new ValidationError([' + (__err) + ']); ';\n      } else {\n        out += ' validate.errors = [' + (__err) + ']; return false; ';\n      }\n    } else {\n      out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n    }\n    out += ' } else if ( ';\n    if ($isData) {\n      out += ' (' + ($schemaValue) + ' !== undefined && typeof ' + ($schemaValue) + ' != \\'number\\') || ';\n    }\n    out += ' ' + ($exclType) + ' == \\'number\\' ? ( (' + ($exclusive) + ' = ' + ($schemaValue) + ' === undefined || ' + ($schemaValueExcl) + ' ' + ($op) + '= ' + ($schemaValue) + ') ? ' + ($data) + ' ' + ($notOp) + '= ' + ($schemaValueExcl) + ' : ' + ($data) + ' ' + ($notOp) + ' ' + ($schemaValue) + ' ) : ( (' + ($exclusive) + ' = ' + ($schemaValueExcl) + ' === true) ? ' + ($data) + ' ' + ($notOp) + '= ' + ($schemaValue) + ' : ' + ($data) + ' ' + ($notOp) + ' ' + ($schemaValue) + ' ) || ' + ($data) + ' !== ' + ($data) + ') { var op' + ($lvl) + ' = ' + ($exclusive) + ' ? \\'' + ($op) + '\\' : \\'' + ($op) + '=\\'; ';\n    if ($schema === undefined) {\n      $errorKeyword = $exclusiveKeyword;\n      $errSchemaPath = it.errSchemaPath + '/' + $exclusiveKeyword;\n      $schemaValue = $schemaValueExcl;\n      $isData = $isDataExcl;\n    }\n  } else {\n    var $exclIsNumber = typeof $schemaExcl == 'number',\n      $opStr = $op;\n    if ($exclIsNumber && $isData) {\n      var $opExpr = '\\'' + $opStr + '\\'';\n      out += ' if ( ';\n      if ($isData) {\n        out += ' (' + ($schemaValue) + ' !== undefined && typeof ' + ($schemaValue) + ' != \\'number\\') || ';\n      }\n      out += ' ( ' + ($schemaValue) + ' === undefined || ' + ($schemaExcl) + ' ' + ($op) + '= ' + ($schemaValue) + ' ? ' + ($data) + ' ' + ($notOp) + '= ' + ($schemaExcl) + ' : ' + ($data) + ' ' + ($notOp) + ' ' + ($schemaValue) + ' ) || ' + ($data) + ' !== ' + ($data) + ') { ';\n    } else {\n      if ($exclIsNumber && $schema === undefined) {\n        $exclusive = true;\n        $errorKeyword = $exclusiveKeyword;\n        $errSchemaPath = it.errSchemaPath + '/' + $exclusiveKeyword;\n        $schemaValue = $schemaExcl;\n        $notOp += '=';\n      } else {\n        if ($exclIsNumber) $schemaValue = Math[$isMax ? 'min' : 'max']($schemaExcl, $schema);\n        if ($schemaExcl === ($exclIsNumber ? $schemaValue : true)) {\n          $exclusive = true;\n          $errorKeyword = $exclusiveKeyword;\n          $errSchemaPath = it.errSchemaPath + '/' + $exclusiveKeyword;\n          $notOp += '=';\n        } else {\n          $exclusive = false;\n          $opStr += '=';\n        }\n      }\n      var $opExpr = '\\'' + $opStr + '\\'';\n      out += ' if ( ';\n      if ($isData) {\n        out += ' (' + ($schemaValue) + ' !== undefined && typeof ' + ($schemaValue) + ' != \\'number\\') || ';\n      }\n      out += ' ' + ($data) + ' ' + ($notOp) + ' ' + ($schemaValue) + ' || ' + ($data) + ' !== ' + ($data) + ') { ';\n    }\n  }\n  $errorKeyword = $errorKeyword || $keyword;\n  var $$outStack = $$outStack || [];\n  $$outStack.push(out);\n  out = ''; /* istanbul ignore else */\n  if (it.createErrors !== false) {\n    out += ' { keyword: \\'' + ($errorKeyword || '_limit') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { comparison: ' + ($opExpr) + ', limit: ' + ($schemaValue) + ', exclusive: ' + ($exclusive) + ' } ';\n    if (it.opts.messages !== false) {\n      out += ' , message: \\'should be ' + ($opStr) + ' ';\n      if ($isData) {\n        out += '\\' + ' + ($schemaValue);\n      } else {\n        out += '' + ($schemaValue) + '\\'';\n      }\n    }\n    if (it.opts.verbose) {\n      out += ' , schema:  ';\n      if ($isData) {\n        out += 'validate.schema' + ($schemaPath);\n      } else {\n        out += '' + ($schema);\n      }\n      out += '         , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n    }\n    out += ' } ';\n  } else {\n    out += ' {} ';\n  }\n  var __err = out;\n  out = $$outStack.pop();\n  if (!it.compositeRule && $breakOnError) {\n    /* istanbul ignore if */\n    if (it.async) {\n      out += ' throw new ValidationError([' + (__err) + ']); ';\n    } else {\n      out += ' validate.errors = [' + (__err) + ']; return false; ';\n    }\n  } else {\n    out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n  }\n  out += ' } ';\n  if ($breakOnError) {\n    out += ' else { ';\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate__limitItems(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $errorKeyword;\n  var $data = 'data' + ($dataLvl || '');\n  var $isData = it.opts.$data && $schema && $schema.$data,\n    $schemaValue;\n  if ($isData) {\n    out += ' var schema' + ($lvl) + ' = ' + (it.util.getData($schema.$data, $dataLvl, it.dataPathArr)) + '; ';\n    $schemaValue = 'schema' + $lvl;\n  } else {\n    $schemaValue = $schema;\n  }\n  var $op = $keyword == 'maxItems' ? '>' : '<';\n  out += 'if ( ';\n  if ($isData) {\n    out += ' (' + ($schemaValue) + ' !== undefined && typeof ' + ($schemaValue) + ' != \\'number\\') || ';\n  }\n  out += ' ' + ($data) + '.length ' + ($op) + ' ' + ($schemaValue) + ') { ';\n  var $errorKeyword = $keyword;\n  var $$outStack = $$outStack || [];\n  $$outStack.push(out);\n  out = ''; /* istanbul ignore else */\n  if (it.createErrors !== false) {\n    out += ' { keyword: \\'' + ($errorKeyword || '_limitItems') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { limit: ' + ($schemaValue) + ' } ';\n    if (it.opts.messages !== false) {\n      out += ' , message: \\'should NOT have ';\n      if ($keyword == 'maxItems') {\n        out += 'more';\n      } else {\n        out += 'fewer';\n      }\n      out += ' than ';\n      if ($isData) {\n        out += '\\' + ' + ($schemaValue) + ' + \\'';\n      } else {\n        out += '' + ($schema);\n      }\n      out += ' items\\' ';\n    }\n    if (it.opts.verbose) {\n      out += ' , schema:  ';\n      if ($isData) {\n        out += 'validate.schema' + ($schemaPath);\n      } else {\n        out += '' + ($schema);\n      }\n      out += '         , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n    }\n    out += ' } ';\n  } else {\n    out += ' {} ';\n  }\n  var __err = out;\n  out = $$outStack.pop();\n  if (!it.compositeRule && $breakOnError) {\n    /* istanbul ignore if */\n    if (it.async) {\n      out += ' throw new ValidationError([' + (__err) + ']); ';\n    } else {\n      out += ' validate.errors = [' + (__err) + ']; return false; ';\n    }\n  } else {\n    out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n  }\n  out += '} ';\n  if ($breakOnError) {\n    out += ' else { ';\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate__limitLength(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $errorKeyword;\n  var $data = 'data' + ($dataLvl || '');\n  var $isData = it.opts.$data && $schema && $schema.$data,\n    $schemaValue;\n  if ($isData) {\n    out += ' var schema' + ($lvl) + ' = ' + (it.util.getData($schema.$data, $dataLvl, it.dataPathArr)) + '; ';\n    $schemaValue = 'schema' + $lvl;\n  } else {\n    $schemaValue = $schema;\n  }\n  var $op = $keyword == 'maxLength' ? '>' : '<';\n  out += 'if ( ';\n  if ($isData) {\n    out += ' (' + ($schemaValue) + ' !== undefined && typeof ' + ($schemaValue) + ' != \\'number\\') || ';\n  }\n  if (it.opts.unicode === false) {\n    out += ' ' + ($data) + '.length ';\n  } else {\n    out += ' ucs2length(' + ($data) + ') ';\n  }\n  out += ' ' + ($op) + ' ' + ($schemaValue) + ') { ';\n  var $errorKeyword = $keyword;\n  var $$outStack = $$outStack || [];\n  $$outStack.push(out);\n  out = ''; /* istanbul ignore else */\n  if (it.createErrors !== false) {\n    out += ' { keyword: \\'' + ($errorKeyword || '_limitLength') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { limit: ' + ($schemaValue) + ' } ';\n    if (it.opts.messages !== false) {\n      out += ' , message: \\'should NOT be ';\n      if ($keyword == 'maxLength') {\n        out += 'longer';\n      } else {\n        out += 'shorter';\n      }\n      out += ' than ';\n      if ($isData) {\n        out += '\\' + ' + ($schemaValue) + ' + \\'';\n      } else {\n        out += '' + ($schema);\n      }\n      out += ' characters\\' ';\n    }\n    if (it.opts.verbose) {\n      out += ' , schema:  ';\n      if ($isData) {\n        out += 'validate.schema' + ($schemaPath);\n      } else {\n        out += '' + ($schema);\n      }\n      out += '         , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n    }\n    out += ' } ';\n  } else {\n    out += ' {} ';\n  }\n  var __err = out;\n  out = $$outStack.pop();\n  if (!it.compositeRule && $breakOnError) {\n    /* istanbul ignore if */\n    if (it.async) {\n      out += ' throw new ValidationError([' + (__err) + ']); ';\n    } else {\n      out += ' validate.errors = [' + (__err) + ']; return false; ';\n    }\n  } else {\n    out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n  }\n  out += '} ';\n  if ($breakOnError) {\n    out += ' else { ';\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate__limitProperties(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $errorKeyword;\n  var $data = 'data' + ($dataLvl || '');\n  var $isData = it.opts.$data && $schema && $schema.$data,\n    $schemaValue;\n  if ($isData) {\n    out += ' var schema' + ($lvl) + ' = ' + (it.util.getData($schema.$data, $dataLvl, it.dataPathArr)) + '; ';\n    $schemaValue = 'schema' + $lvl;\n  } else {\n    $schemaValue = $schema;\n  }\n  var $op = $keyword == 'maxProperties' ? '>' : '<';\n  out += 'if ( ';\n  if ($isData) {\n    out += ' (' + ($schemaValue) + ' !== undefined && typeof ' + ($schemaValue) + ' != \\'number\\') || ';\n  }\n  out += ' Object.keys(' + ($data) + ').length ' + ($op) + ' ' + ($schemaValue) + ') { ';\n  var $errorKeyword = $keyword;\n  var $$outStack = $$outStack || [];\n  $$outStack.push(out);\n  out = ''; /* istanbul ignore else */\n  if (it.createErrors !== false) {\n    out += ' { keyword: \\'' + ($errorKeyword || '_limitProperties') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { limit: ' + ($schemaValue) + ' } ';\n    if (it.opts.messages !== false) {\n      out += ' , message: \\'should NOT have ';\n      if ($keyword == 'maxProperties') {\n        out += 'more';\n      } else {\n        out += 'fewer';\n      }\n      out += ' than ';\n      if ($isData) {\n        out += '\\' + ' + ($schemaValue) + ' + \\'';\n      } else {\n        out += '' + ($schema);\n      }\n      out += ' properties\\' ';\n    }\n    if (it.opts.verbose) {\n      out += ' , schema:  ';\n      if ($isData) {\n        out += 'validate.schema' + ($schemaPath);\n      } else {\n        out += '' + ($schema);\n      }\n      out += '         , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n    }\n    out += ' } ';\n  } else {\n    out += ' {} ';\n  }\n  var __err = out;\n  out = $$outStack.pop();\n  if (!it.compositeRule && $breakOnError) {\n    /* istanbul ignore if */\n    if (it.async) {\n      out += ' throw new ValidationError([' + (__err) + ']); ';\n    } else {\n      out += ' validate.errors = [' + (__err) + ']; return false; ';\n    }\n  } else {\n    out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n  }\n  out += '} ';\n  if ($breakOnError) {\n    out += ' else { ';\n  }\n  return out;\n}\n","'use strict';\n\n//all requires must be explicit because browserify won't work with dynamic requires\nmodule.exports = {\n  '$ref': require('./ref'),\n  allOf: require('./allOf'),\n  anyOf: require('./anyOf'),\n  '$comment': require('./comment'),\n  const: require('./const'),\n  contains: require('./contains'),\n  dependencies: require('./dependencies'),\n  'enum': require('./enum'),\n  format: require('./format'),\n  'if': require('./if'),\n  items: require('./items'),\n  maximum: require('./_limit'),\n  minimum: require('./_limit'),\n  maxItems: require('./_limitItems'),\n  minItems: require('./_limitItems'),\n  maxLength: require('./_limitLength'),\n  minLength: require('./_limitLength'),\n  maxProperties: require('./_limitProperties'),\n  minProperties: require('./_limitProperties'),\n  multipleOf: require('./multipleOf'),\n  not: require('./not'),\n  oneOf: require('./oneOf'),\n  pattern: require('./pattern'),\n  properties: require('./properties'),\n  propertyNames: require('./propertyNames'),\n  required: require('./required'),\n  uniqueItems: require('./uniqueItems'),\n  validate: require('./validate')\n};\n","'use strict';\nmodule.exports = function generate_allOf(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $it = it.util.copy(it);\n  var $closingBraces = '';\n  $it.level++;\n  var $nextValid = 'valid' + $it.level;\n  var $currentBaseId = $it.baseId,\n    $allSchemasEmpty = true;\n  var arr1 = $schema;\n  if (arr1) {\n    var $sch, $i = -1,\n      l1 = arr1.length - 1;\n    while ($i < l1) {\n      $sch = arr1[$i += 1];\n      if ((it.opts.strictKeywords ? typeof $sch == 'object' && Object.keys($sch).length > 0 : it.util.schemaHasRules($sch, it.RULES.all))) {\n        $allSchemasEmpty = false;\n        $it.schema = $sch;\n        $it.schemaPath = $schemaPath + '[' + $i + ']';\n        $it.errSchemaPath = $errSchemaPath + '/' + $i;\n        out += '  ' + (it.validate($it)) + ' ';\n        $it.baseId = $currentBaseId;\n        if ($breakOnError) {\n          out += ' if (' + ($nextValid) + ') { ';\n          $closingBraces += '}';\n        }\n      }\n    }\n  }\n  if ($breakOnError) {\n    if ($allSchemasEmpty) {\n      out += ' if (true) { ';\n    } else {\n      out += ' ' + ($closingBraces.slice(0, -1)) + ' ';\n    }\n  }\n  out = it.util.cleanUpCode(out);\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_anyOf(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $valid = 'valid' + $lvl;\n  var $errs = 'errs__' + $lvl;\n  var $it = it.util.copy(it);\n  var $closingBraces = '';\n  $it.level++;\n  var $nextValid = 'valid' + $it.level;\n  var $noEmptySchema = $schema.every(function($sch) {\n    return (it.opts.strictKeywords ? typeof $sch == 'object' && Object.keys($sch).length > 0 : it.util.schemaHasRules($sch, it.RULES.all));\n  });\n  if ($noEmptySchema) {\n    var $currentBaseId = $it.baseId;\n    out += ' var ' + ($errs) + ' = errors; var ' + ($valid) + ' = false;  ';\n    var $wasComposite = it.compositeRule;\n    it.compositeRule = $it.compositeRule = true;\n    var arr1 = $schema;\n    if (arr1) {\n      var $sch, $i = -1,\n        l1 = arr1.length - 1;\n      while ($i < l1) {\n        $sch = arr1[$i += 1];\n        $it.schema = $sch;\n        $it.schemaPath = $schemaPath + '[' + $i + ']';\n        $it.errSchemaPath = $errSchemaPath + '/' + $i;\n        out += '  ' + (it.validate($it)) + ' ';\n        $it.baseId = $currentBaseId;\n        out += ' ' + ($valid) + ' = ' + ($valid) + ' || ' + ($nextValid) + '; if (!' + ($valid) + ') { ';\n        $closingBraces += '}';\n      }\n    }\n    it.compositeRule = $it.compositeRule = $wasComposite;\n    out += ' ' + ($closingBraces) + ' if (!' + ($valid) + ') {   var err =   '; /* istanbul ignore else */\n    if (it.createErrors !== false) {\n      out += ' { keyword: \\'' + ('anyOf') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: {} ';\n      if (it.opts.messages !== false) {\n        out += ' , message: \\'should match some schema in anyOf\\' ';\n      }\n      if (it.opts.verbose) {\n        out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n      }\n      out += ' } ';\n    } else {\n      out += ' {} ';\n    }\n    out += ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n    if (!it.compositeRule && $breakOnError) {\n      /* istanbul ignore if */\n      if (it.async) {\n        out += ' throw new ValidationError(vErrors); ';\n      } else {\n        out += ' validate.errors = vErrors; return false; ';\n      }\n    }\n    out += ' } else {  errors = ' + ($errs) + '; if (vErrors !== null) { if (' + ($errs) + ') vErrors.length = ' + ($errs) + '; else vErrors = null; } ';\n    if (it.opts.allErrors) {\n      out += ' } ';\n    }\n    out = it.util.cleanUpCode(out);\n  } else {\n    if ($breakOnError) {\n      out += ' if (true) { ';\n    }\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_comment(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $schema = it.schema[$keyword];\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $comment = it.util.toQuotedString($schema);\n  if (it.opts.$comment === true) {\n    out += ' console.log(' + ($comment) + ');';\n  } else if (typeof it.opts.$comment == 'function') {\n    out += ' self._opts.$comment(' + ($comment) + ', ' + (it.util.toQuotedString($errSchemaPath)) + ', validate.root.schema);';\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_const(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $valid = 'valid' + $lvl;\n  var $isData = it.opts.$data && $schema && $schema.$data,\n    $schemaValue;\n  if ($isData) {\n    out += ' var schema' + ($lvl) + ' = ' + (it.util.getData($schema.$data, $dataLvl, it.dataPathArr)) + '; ';\n    $schemaValue = 'schema' + $lvl;\n  } else {\n    $schemaValue = $schema;\n  }\n  if (!$isData) {\n    out += ' var schema' + ($lvl) + ' = validate.schema' + ($schemaPath) + ';';\n  }\n  out += 'var ' + ($valid) + ' = equal(' + ($data) + ', schema' + ($lvl) + '); if (!' + ($valid) + ') {   ';\n  var $$outStack = $$outStack || [];\n  $$outStack.push(out);\n  out = ''; /* istanbul ignore else */\n  if (it.createErrors !== false) {\n    out += ' { keyword: \\'' + ('const') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { allowedValue: schema' + ($lvl) + ' } ';\n    if (it.opts.messages !== false) {\n      out += ' , message: \\'should be equal to constant\\' ';\n    }\n    if (it.opts.verbose) {\n      out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n    }\n    out += ' } ';\n  } else {\n    out += ' {} ';\n  }\n  var __err = out;\n  out = $$outStack.pop();\n  if (!it.compositeRule && $breakOnError) {\n    /* istanbul ignore if */\n    if (it.async) {\n      out += ' throw new ValidationError([' + (__err) + ']); ';\n    } else {\n      out += ' validate.errors = [' + (__err) + ']; return false; ';\n    }\n  } else {\n    out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n  }\n  out += ' }';\n  if ($breakOnError) {\n    out += ' else { ';\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_contains(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $valid = 'valid' + $lvl;\n  var $errs = 'errs__' + $lvl;\n  var $it = it.util.copy(it);\n  var $closingBraces = '';\n  $it.level++;\n  var $nextValid = 'valid' + $it.level;\n  var $idx = 'i' + $lvl,\n    $dataNxt = $it.dataLevel = it.dataLevel + 1,\n    $nextData = 'data' + $dataNxt,\n    $currentBaseId = it.baseId,\n    $nonEmptySchema = (it.opts.strictKeywords ? typeof $schema == 'object' && Object.keys($schema).length > 0 : it.util.schemaHasRules($schema, it.RULES.all));\n  out += 'var ' + ($errs) + ' = errors;var ' + ($valid) + ';';\n  if ($nonEmptySchema) {\n    var $wasComposite = it.compositeRule;\n    it.compositeRule = $it.compositeRule = true;\n    $it.schema = $schema;\n    $it.schemaPath = $schemaPath;\n    $it.errSchemaPath = $errSchemaPath;\n    out += ' var ' + ($nextValid) + ' = false; for (var ' + ($idx) + ' = 0; ' + ($idx) + ' < ' + ($data) + '.length; ' + ($idx) + '++) { ';\n    $it.errorPath = it.util.getPathExpr(it.errorPath, $idx, it.opts.jsonPointers, true);\n    var $passData = $data + '[' + $idx + ']';\n    $it.dataPathArr[$dataNxt] = $idx;\n    var $code = it.validate($it);\n    $it.baseId = $currentBaseId;\n    if (it.util.varOccurences($code, $nextData) < 2) {\n      out += ' ' + (it.util.varReplace($code, $nextData, $passData)) + ' ';\n    } else {\n      out += ' var ' + ($nextData) + ' = ' + ($passData) + '; ' + ($code) + ' ';\n    }\n    out += ' if (' + ($nextValid) + ') break; }  ';\n    it.compositeRule = $it.compositeRule = $wasComposite;\n    out += ' ' + ($closingBraces) + ' if (!' + ($nextValid) + ') {';\n  } else {\n    out += ' if (' + ($data) + '.length == 0) {';\n  }\n  var $$outStack = $$outStack || [];\n  $$outStack.push(out);\n  out = ''; /* istanbul ignore else */\n  if (it.createErrors !== false) {\n    out += ' { keyword: \\'' + ('contains') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: {} ';\n    if (it.opts.messages !== false) {\n      out += ' , message: \\'should contain a valid item\\' ';\n    }\n    if (it.opts.verbose) {\n      out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n    }\n    out += ' } ';\n  } else {\n    out += ' {} ';\n  }\n  var __err = out;\n  out = $$outStack.pop();\n  if (!it.compositeRule && $breakOnError) {\n    /* istanbul ignore if */\n    if (it.async) {\n      out += ' throw new ValidationError([' + (__err) + ']); ';\n    } else {\n      out += ' validate.errors = [' + (__err) + ']; return false; ';\n    }\n  } else {\n    out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n  }\n  out += ' } else { ';\n  if ($nonEmptySchema) {\n    out += '  errors = ' + ($errs) + '; if (vErrors !== null) { if (' + ($errs) + ') vErrors.length = ' + ($errs) + '; else vErrors = null; } ';\n  }\n  if (it.opts.allErrors) {\n    out += ' } ';\n  }\n  out = it.util.cleanUpCode(out);\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_dependencies(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $errs = 'errs__' + $lvl;\n  var $it = it.util.copy(it);\n  var $closingBraces = '';\n  $it.level++;\n  var $nextValid = 'valid' + $it.level;\n  var $schemaDeps = {},\n    $propertyDeps = {},\n    $ownProperties = it.opts.ownProperties;\n  for ($property in $schema) {\n    var $sch = $schema[$property];\n    var $deps = Array.isArray($sch) ? $propertyDeps : $schemaDeps;\n    $deps[$property] = $sch;\n  }\n  out += 'var ' + ($errs) + ' = errors;';\n  var $currentErrorPath = it.errorPath;\n  out += 'var missing' + ($lvl) + ';';\n  for (var $property in $propertyDeps) {\n    $deps = $propertyDeps[$property];\n    if ($deps.length) {\n      out += ' if ( ' + ($data) + (it.util.getProperty($property)) + ' !== undefined ';\n      if ($ownProperties) {\n        out += ' && Object.prototype.hasOwnProperty.call(' + ($data) + ', \\'' + (it.util.escapeQuotes($property)) + '\\') ';\n      }\n      if ($breakOnError) {\n        out += ' && ( ';\n        var arr1 = $deps;\n        if (arr1) {\n          var $propertyKey, $i = -1,\n            l1 = arr1.length - 1;\n          while ($i < l1) {\n            $propertyKey = arr1[$i += 1];\n            if ($i) {\n              out += ' || ';\n            }\n            var $prop = it.util.getProperty($propertyKey),\n              $useData = $data + $prop;\n            out += ' ( ( ' + ($useData) + ' === undefined ';\n            if ($ownProperties) {\n              out += ' || ! Object.prototype.hasOwnProperty.call(' + ($data) + ', \\'' + (it.util.escapeQuotes($propertyKey)) + '\\') ';\n            }\n            out += ') && (missing' + ($lvl) + ' = ' + (it.util.toQuotedString(it.opts.jsonPointers ? $propertyKey : $prop)) + ') ) ';\n          }\n        }\n        out += ')) {  ';\n        var $propertyPath = 'missing' + $lvl,\n          $missingProperty = '\\' + ' + $propertyPath + ' + \\'';\n        if (it.opts._errorDataPathProperty) {\n          it.errorPath = it.opts.jsonPointers ? it.util.getPathExpr($currentErrorPath, $propertyPath, true) : $currentErrorPath + ' + ' + $propertyPath;\n        }\n        var $$outStack = $$outStack || [];\n        $$outStack.push(out);\n        out = ''; /* istanbul ignore else */\n        if (it.createErrors !== false) {\n          out += ' { keyword: \\'' + ('dependencies') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { property: \\'' + (it.util.escapeQuotes($property)) + '\\', missingProperty: \\'' + ($missingProperty) + '\\', depsCount: ' + ($deps.length) + ', deps: \\'' + (it.util.escapeQuotes($deps.length == 1 ? $deps[0] : $deps.join(\", \"))) + '\\' } ';\n          if (it.opts.messages !== false) {\n            out += ' , message: \\'should have ';\n            if ($deps.length == 1) {\n              out += 'property ' + (it.util.escapeQuotes($deps[0]));\n            } else {\n              out += 'properties ' + (it.util.escapeQuotes($deps.join(\", \")));\n            }\n            out += ' when property ' + (it.util.escapeQuotes($property)) + ' is present\\' ';\n          }\n          if (it.opts.verbose) {\n            out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n          }\n          out += ' } ';\n        } else {\n          out += ' {} ';\n        }\n        var __err = out;\n        out = $$outStack.pop();\n        if (!it.compositeRule && $breakOnError) {\n          /* istanbul ignore if */\n          if (it.async) {\n            out += ' throw new ValidationError([' + (__err) + ']); ';\n          } else {\n            out += ' validate.errors = [' + (__err) + ']; return false; ';\n          }\n        } else {\n          out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n        }\n      } else {\n        out += ' ) { ';\n        var arr2 = $deps;\n        if (arr2) {\n          var $propertyKey, i2 = -1,\n            l2 = arr2.length - 1;\n          while (i2 < l2) {\n            $propertyKey = arr2[i2 += 1];\n            var $prop = it.util.getProperty($propertyKey),\n              $missingProperty = it.util.escapeQuotes($propertyKey),\n              $useData = $data + $prop;\n            if (it.opts._errorDataPathProperty) {\n              it.errorPath = it.util.getPath($currentErrorPath, $propertyKey, it.opts.jsonPointers);\n            }\n            out += ' if ( ' + ($useData) + ' === undefined ';\n            if ($ownProperties) {\n              out += ' || ! Object.prototype.hasOwnProperty.call(' + ($data) + ', \\'' + (it.util.escapeQuotes($propertyKey)) + '\\') ';\n            }\n            out += ') {  var err =   '; /* istanbul ignore else */\n            if (it.createErrors !== false) {\n              out += ' { keyword: \\'' + ('dependencies') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { property: \\'' + (it.util.escapeQuotes($property)) + '\\', missingProperty: \\'' + ($missingProperty) + '\\', depsCount: ' + ($deps.length) + ', deps: \\'' + (it.util.escapeQuotes($deps.length == 1 ? $deps[0] : $deps.join(\", \"))) + '\\' } ';\n              if (it.opts.messages !== false) {\n                out += ' , message: \\'should have ';\n                if ($deps.length == 1) {\n                  out += 'property ' + (it.util.escapeQuotes($deps[0]));\n                } else {\n                  out += 'properties ' + (it.util.escapeQuotes($deps.join(\", \")));\n                }\n                out += ' when property ' + (it.util.escapeQuotes($property)) + ' is present\\' ';\n              }\n              if (it.opts.verbose) {\n                out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n              }\n              out += ' } ';\n            } else {\n              out += ' {} ';\n            }\n            out += ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } ';\n          }\n        }\n      }\n      out += ' }   ';\n      if ($breakOnError) {\n        $closingBraces += '}';\n        out += ' else { ';\n      }\n    }\n  }\n  it.errorPath = $currentErrorPath;\n  var $currentBaseId = $it.baseId;\n  for (var $property in $schemaDeps) {\n    var $sch = $schemaDeps[$property];\n    if ((it.opts.strictKeywords ? typeof $sch == 'object' && Object.keys($sch).length > 0 : it.util.schemaHasRules($sch, it.RULES.all))) {\n      out += ' ' + ($nextValid) + ' = true; if ( ' + ($data) + (it.util.getProperty($property)) + ' !== undefined ';\n      if ($ownProperties) {\n        out += ' && Object.prototype.hasOwnProperty.call(' + ($data) + ', \\'' + (it.util.escapeQuotes($property)) + '\\') ';\n      }\n      out += ') { ';\n      $it.schema = $sch;\n      $it.schemaPath = $schemaPath + it.util.getProperty($property);\n      $it.errSchemaPath = $errSchemaPath + '/' + it.util.escapeFragment($property);\n      out += '  ' + (it.validate($it)) + ' ';\n      $it.baseId = $currentBaseId;\n      out += ' }  ';\n      if ($breakOnError) {\n        out += ' if (' + ($nextValid) + ') { ';\n        $closingBraces += '}';\n      }\n    }\n  }\n  if ($breakOnError) {\n    out += '   ' + ($closingBraces) + ' if (' + ($errs) + ' == errors) {';\n  }\n  out = it.util.cleanUpCode(out);\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_enum(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $valid = 'valid' + $lvl;\n  var $isData = it.opts.$data && $schema && $schema.$data,\n    $schemaValue;\n  if ($isData) {\n    out += ' var schema' + ($lvl) + ' = ' + (it.util.getData($schema.$data, $dataLvl, it.dataPathArr)) + '; ';\n    $schemaValue = 'schema' + $lvl;\n  } else {\n    $schemaValue = $schema;\n  }\n  var $i = 'i' + $lvl,\n    $vSchema = 'schema' + $lvl;\n  if (!$isData) {\n    out += ' var ' + ($vSchema) + ' = validate.schema' + ($schemaPath) + ';';\n  }\n  out += 'var ' + ($valid) + ';';\n  if ($isData) {\n    out += ' if (schema' + ($lvl) + ' === undefined) ' + ($valid) + ' = true; else if (!Array.isArray(schema' + ($lvl) + ')) ' + ($valid) + ' = false; else {';\n  }\n  out += '' + ($valid) + ' = false;for (var ' + ($i) + '=0; ' + ($i) + '<' + ($vSchema) + '.length; ' + ($i) + '++) if (equal(' + ($data) + ', ' + ($vSchema) + '[' + ($i) + '])) { ' + ($valid) + ' = true; break; }';\n  if ($isData) {\n    out += '  }  ';\n  }\n  out += ' if (!' + ($valid) + ') {   ';\n  var $$outStack = $$outStack || [];\n  $$outStack.push(out);\n  out = ''; /* istanbul ignore else */\n  if (it.createErrors !== false) {\n    out += ' { keyword: \\'' + ('enum') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { allowedValues: schema' + ($lvl) + ' } ';\n    if (it.opts.messages !== false) {\n      out += ' , message: \\'should be equal to one of the allowed values\\' ';\n    }\n    if (it.opts.verbose) {\n      out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n    }\n    out += ' } ';\n  } else {\n    out += ' {} ';\n  }\n  var __err = out;\n  out = $$outStack.pop();\n  if (!it.compositeRule && $breakOnError) {\n    /* istanbul ignore if */\n    if (it.async) {\n      out += ' throw new ValidationError([' + (__err) + ']); ';\n    } else {\n      out += ' validate.errors = [' + (__err) + ']; return false; ';\n    }\n  } else {\n    out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n  }\n  out += ' }';\n  if ($breakOnError) {\n    out += ' else { ';\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_format(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  if (it.opts.format === false) {\n    if ($breakOnError) {\n      out += ' if (true) { ';\n    }\n    return out;\n  }\n  var $isData = it.opts.$data && $schema && $schema.$data,\n    $schemaValue;\n  if ($isData) {\n    out += ' var schema' + ($lvl) + ' = ' + (it.util.getData($schema.$data, $dataLvl, it.dataPathArr)) + '; ';\n    $schemaValue = 'schema' + $lvl;\n  } else {\n    $schemaValue = $schema;\n  }\n  var $unknownFormats = it.opts.unknownFormats,\n    $allowUnknown = Array.isArray($unknownFormats);\n  if ($isData) {\n    var $format = 'format' + $lvl,\n      $isObject = 'isObject' + $lvl,\n      $formatType = 'formatType' + $lvl;\n    out += ' var ' + ($format) + ' = formats[' + ($schemaValue) + ']; var ' + ($isObject) + ' = typeof ' + ($format) + ' == \\'object\\' && !(' + ($format) + ' instanceof RegExp) && ' + ($format) + '.validate; var ' + ($formatType) + ' = ' + ($isObject) + ' && ' + ($format) + '.type || \\'string\\'; if (' + ($isObject) + ') { ';\n    if (it.async) {\n      out += ' var async' + ($lvl) + ' = ' + ($format) + '.async; ';\n    }\n    out += ' ' + ($format) + ' = ' + ($format) + '.validate; } if (  ';\n    if ($isData) {\n      out += ' (' + ($schemaValue) + ' !== undefined && typeof ' + ($schemaValue) + ' != \\'string\\') || ';\n    }\n    out += ' (';\n    if ($unknownFormats != 'ignore') {\n      out += ' (' + ($schemaValue) + ' && !' + ($format) + ' ';\n      if ($allowUnknown) {\n        out += ' && self._opts.unknownFormats.indexOf(' + ($schemaValue) + ') == -1 ';\n      }\n      out += ') || ';\n    }\n    out += ' (' + ($format) + ' && ' + ($formatType) + ' == \\'' + ($ruleType) + '\\' && !(typeof ' + ($format) + ' == \\'function\\' ? ';\n    if (it.async) {\n      out += ' (async' + ($lvl) + ' ? await ' + ($format) + '(' + ($data) + ') : ' + ($format) + '(' + ($data) + ')) ';\n    } else {\n      out += ' ' + ($format) + '(' + ($data) + ') ';\n    }\n    out += ' : ' + ($format) + '.test(' + ($data) + '))))) {';\n  } else {\n    var $format = it.formats[$schema];\n    if (!$format) {\n      if ($unknownFormats == 'ignore') {\n        it.logger.warn('unknown format \"' + $schema + '\" ignored in schema at path \"' + it.errSchemaPath + '\"');\n        if ($breakOnError) {\n          out += ' if (true) { ';\n        }\n        return out;\n      } else if ($allowUnknown && $unknownFormats.indexOf($schema) >= 0) {\n        if ($breakOnError) {\n          out += ' if (true) { ';\n        }\n        return out;\n      } else {\n        throw new Error('unknown format \"' + $schema + '\" is used in schema at path \"' + it.errSchemaPath + '\"');\n      }\n    }\n    var $isObject = typeof $format == 'object' && !($format instanceof RegExp) && $format.validate;\n    var $formatType = $isObject && $format.type || 'string';\n    if ($isObject) {\n      var $async = $format.async === true;\n      $format = $format.validate;\n    }\n    if ($formatType != $ruleType) {\n      if ($breakOnError) {\n        out += ' if (true) { ';\n      }\n      return out;\n    }\n    if ($async) {\n      if (!it.async) throw new Error('async format in sync schema');\n      var $formatRef = 'formats' + it.util.getProperty($schema) + '.validate';\n      out += ' if (!(await ' + ($formatRef) + '(' + ($data) + '))) { ';\n    } else {\n      out += ' if (! ';\n      var $formatRef = 'formats' + it.util.getProperty($schema);\n      if ($isObject) $formatRef += '.validate';\n      if (typeof $format == 'function') {\n        out += ' ' + ($formatRef) + '(' + ($data) + ') ';\n      } else {\n        out += ' ' + ($formatRef) + '.test(' + ($data) + ') ';\n      }\n      out += ') { ';\n    }\n  }\n  var $$outStack = $$outStack || [];\n  $$outStack.push(out);\n  out = ''; /* istanbul ignore else */\n  if (it.createErrors !== false) {\n    out += ' { keyword: \\'' + ('format') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { format:  ';\n    if ($isData) {\n      out += '' + ($schemaValue);\n    } else {\n      out += '' + (it.util.toQuotedString($schema));\n    }\n    out += '  } ';\n    if (it.opts.messages !== false) {\n      out += ' , message: \\'should match format \"';\n      if ($isData) {\n        out += '\\' + ' + ($schemaValue) + ' + \\'';\n      } else {\n        out += '' + (it.util.escapeQuotes($schema));\n      }\n      out += '\"\\' ';\n    }\n    if (it.opts.verbose) {\n      out += ' , schema:  ';\n      if ($isData) {\n        out += 'validate.schema' + ($schemaPath);\n      } else {\n        out += '' + (it.util.toQuotedString($schema));\n      }\n      out += '         , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n    }\n    out += ' } ';\n  } else {\n    out += ' {} ';\n  }\n  var __err = out;\n  out = $$outStack.pop();\n  if (!it.compositeRule && $breakOnError) {\n    /* istanbul ignore if */\n    if (it.async) {\n      out += ' throw new ValidationError([' + (__err) + ']); ';\n    } else {\n      out += ' validate.errors = [' + (__err) + ']; return false; ';\n    }\n  } else {\n    out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n  }\n  out += ' } ';\n  if ($breakOnError) {\n    out += ' else { ';\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_if(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $valid = 'valid' + $lvl;\n  var $errs = 'errs__' + $lvl;\n  var $it = it.util.copy(it);\n  $it.level++;\n  var $nextValid = 'valid' + $it.level;\n  var $thenSch = it.schema['then'],\n    $elseSch = it.schema['else'],\n    $thenPresent = $thenSch !== undefined && (it.opts.strictKeywords ? typeof $thenSch == 'object' && Object.keys($thenSch).length > 0 : it.util.schemaHasRules($thenSch, it.RULES.all)),\n    $elsePresent = $elseSch !== undefined && (it.opts.strictKeywords ? typeof $elseSch == 'object' && Object.keys($elseSch).length > 0 : it.util.schemaHasRules($elseSch, it.RULES.all)),\n    $currentBaseId = $it.baseId;\n  if ($thenPresent || $elsePresent) {\n    var $ifClause;\n    $it.createErrors = false;\n    $it.schema = $schema;\n    $it.schemaPath = $schemaPath;\n    $it.errSchemaPath = $errSchemaPath;\n    out += ' var ' + ($errs) + ' = errors; var ' + ($valid) + ' = true;  ';\n    var $wasComposite = it.compositeRule;\n    it.compositeRule = $it.compositeRule = true;\n    out += '  ' + (it.validate($it)) + ' ';\n    $it.baseId = $currentBaseId;\n    $it.createErrors = true;\n    out += '  errors = ' + ($errs) + '; if (vErrors !== null) { if (' + ($errs) + ') vErrors.length = ' + ($errs) + '; else vErrors = null; }  ';\n    it.compositeRule = $it.compositeRule = $wasComposite;\n    if ($thenPresent) {\n      out += ' if (' + ($nextValid) + ') {  ';\n      $it.schema = it.schema['then'];\n      $it.schemaPath = it.schemaPath + '.then';\n      $it.errSchemaPath = it.errSchemaPath + '/then';\n      out += '  ' + (it.validate($it)) + ' ';\n      $it.baseId = $currentBaseId;\n      out += ' ' + ($valid) + ' = ' + ($nextValid) + '; ';\n      if ($thenPresent && $elsePresent) {\n        $ifClause = 'ifClause' + $lvl;\n        out += ' var ' + ($ifClause) + ' = \\'then\\'; ';\n      } else {\n        $ifClause = '\\'then\\'';\n      }\n      out += ' } ';\n      if ($elsePresent) {\n        out += ' else { ';\n      }\n    } else {\n      out += ' if (!' + ($nextValid) + ') { ';\n    }\n    if ($elsePresent) {\n      $it.schema = it.schema['else'];\n      $it.schemaPath = it.schemaPath + '.else';\n      $it.errSchemaPath = it.errSchemaPath + '/else';\n      out += '  ' + (it.validate($it)) + ' ';\n      $it.baseId = $currentBaseId;\n      out += ' ' + ($valid) + ' = ' + ($nextValid) + '; ';\n      if ($thenPresent && $elsePresent) {\n        $ifClause = 'ifClause' + $lvl;\n        out += ' var ' + ($ifClause) + ' = \\'else\\'; ';\n      } else {\n        $ifClause = '\\'else\\'';\n      }\n      out += ' } ';\n    }\n    out += ' if (!' + ($valid) + ') {   var err =   '; /* istanbul ignore else */\n    if (it.createErrors !== false) {\n      out += ' { keyword: \\'' + ('if') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { failingKeyword: ' + ($ifClause) + ' } ';\n      if (it.opts.messages !== false) {\n        out += ' , message: \\'should match \"\\' + ' + ($ifClause) + ' + \\'\" schema\\' ';\n      }\n      if (it.opts.verbose) {\n        out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n      }\n      out += ' } ';\n    } else {\n      out += ' {} ';\n    }\n    out += ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n    if (!it.compositeRule && $breakOnError) {\n      /* istanbul ignore if */\n      if (it.async) {\n        out += ' throw new ValidationError(vErrors); ';\n      } else {\n        out += ' validate.errors = vErrors; return false; ';\n      }\n    }\n    out += ' }   ';\n    if ($breakOnError) {\n      out += ' else { ';\n    }\n    out = it.util.cleanUpCode(out);\n  } else {\n    if ($breakOnError) {\n      out += ' if (true) { ';\n    }\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_items(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $valid = 'valid' + $lvl;\n  var $errs = 'errs__' + $lvl;\n  var $it = it.util.copy(it);\n  var $closingBraces = '';\n  $it.level++;\n  var $nextValid = 'valid' + $it.level;\n  var $idx = 'i' + $lvl,\n    $dataNxt = $it.dataLevel = it.dataLevel + 1,\n    $nextData = 'data' + $dataNxt,\n    $currentBaseId = it.baseId;\n  out += 'var ' + ($errs) + ' = errors;var ' + ($valid) + ';';\n  if (Array.isArray($schema)) {\n    var $additionalItems = it.schema.additionalItems;\n    if ($additionalItems === false) {\n      out += ' ' + ($valid) + ' = ' + ($data) + '.length <= ' + ($schema.length) + '; ';\n      var $currErrSchemaPath = $errSchemaPath;\n      $errSchemaPath = it.errSchemaPath + '/additionalItems';\n      out += '  if (!' + ($valid) + ') {   ';\n      var $$outStack = $$outStack || [];\n      $$outStack.push(out);\n      out = ''; /* istanbul ignore else */\n      if (it.createErrors !== false) {\n        out += ' { keyword: \\'' + ('additionalItems') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { limit: ' + ($schema.length) + ' } ';\n        if (it.opts.messages !== false) {\n          out += ' , message: \\'should NOT have more than ' + ($schema.length) + ' items\\' ';\n        }\n        if (it.opts.verbose) {\n          out += ' , schema: false , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n        }\n        out += ' } ';\n      } else {\n        out += ' {} ';\n      }\n      var __err = out;\n      out = $$outStack.pop();\n      if (!it.compositeRule && $breakOnError) {\n        /* istanbul ignore if */\n        if (it.async) {\n          out += ' throw new ValidationError([' + (__err) + ']); ';\n        } else {\n          out += ' validate.errors = [' + (__err) + ']; return false; ';\n        }\n      } else {\n        out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n      }\n      out += ' } ';\n      $errSchemaPath = $currErrSchemaPath;\n      if ($breakOnError) {\n        $closingBraces += '}';\n        out += ' else { ';\n      }\n    }\n    var arr1 = $schema;\n    if (arr1) {\n      var $sch, $i = -1,\n        l1 = arr1.length - 1;\n      while ($i < l1) {\n        $sch = arr1[$i += 1];\n        if ((it.opts.strictKeywords ? typeof $sch == 'object' && Object.keys($sch).length > 0 : it.util.schemaHasRules($sch, it.RULES.all))) {\n          out += ' ' + ($nextValid) + ' = true; if (' + ($data) + '.length > ' + ($i) + ') { ';\n          var $passData = $data + '[' + $i + ']';\n          $it.schema = $sch;\n          $it.schemaPath = $schemaPath + '[' + $i + ']';\n          $it.errSchemaPath = $errSchemaPath + '/' + $i;\n          $it.errorPath = it.util.getPathExpr(it.errorPath, $i, it.opts.jsonPointers, true);\n          $it.dataPathArr[$dataNxt] = $i;\n          var $code = it.validate($it);\n          $it.baseId = $currentBaseId;\n          if (it.util.varOccurences($code, $nextData) < 2) {\n            out += ' ' + (it.util.varReplace($code, $nextData, $passData)) + ' ';\n          } else {\n            out += ' var ' + ($nextData) + ' = ' + ($passData) + '; ' + ($code) + ' ';\n          }\n          out += ' }  ';\n          if ($breakOnError) {\n            out += ' if (' + ($nextValid) + ') { ';\n            $closingBraces += '}';\n          }\n        }\n      }\n    }\n    if (typeof $additionalItems == 'object' && (it.opts.strictKeywords ? typeof $additionalItems == 'object' && Object.keys($additionalItems).length > 0 : it.util.schemaHasRules($additionalItems, it.RULES.all))) {\n      $it.schema = $additionalItems;\n      $it.schemaPath = it.schemaPath + '.additionalItems';\n      $it.errSchemaPath = it.errSchemaPath + '/additionalItems';\n      out += ' ' + ($nextValid) + ' = true; if (' + ($data) + '.length > ' + ($schema.length) + ') {  for (var ' + ($idx) + ' = ' + ($schema.length) + '; ' + ($idx) + ' < ' + ($data) + '.length; ' + ($idx) + '++) { ';\n      $it.errorPath = it.util.getPathExpr(it.errorPath, $idx, it.opts.jsonPointers, true);\n      var $passData = $data + '[' + $idx + ']';\n      $it.dataPathArr[$dataNxt] = $idx;\n      var $code = it.validate($it);\n      $it.baseId = $currentBaseId;\n      if (it.util.varOccurences($code, $nextData) < 2) {\n        out += ' ' + (it.util.varReplace($code, $nextData, $passData)) + ' ';\n      } else {\n        out += ' var ' + ($nextData) + ' = ' + ($passData) + '; ' + ($code) + ' ';\n      }\n      if ($breakOnError) {\n        out += ' if (!' + ($nextValid) + ') break; ';\n      }\n      out += ' } }  ';\n      if ($breakOnError) {\n        out += ' if (' + ($nextValid) + ') { ';\n        $closingBraces += '}';\n      }\n    }\n  } else if ((it.opts.strictKeywords ? typeof $schema == 'object' && Object.keys($schema).length > 0 : it.util.schemaHasRules($schema, it.RULES.all))) {\n    $it.schema = $schema;\n    $it.schemaPath = $schemaPath;\n    $it.errSchemaPath = $errSchemaPath;\n    out += '  for (var ' + ($idx) + ' = ' + (0) + '; ' + ($idx) + ' < ' + ($data) + '.length; ' + ($idx) + '++) { ';\n    $it.errorPath = it.util.getPathExpr(it.errorPath, $idx, it.opts.jsonPointers, true);\n    var $passData = $data + '[' + $idx + ']';\n    $it.dataPathArr[$dataNxt] = $idx;\n    var $code = it.validate($it);\n    $it.baseId = $currentBaseId;\n    if (it.util.varOccurences($code, $nextData) < 2) {\n      out += ' ' + (it.util.varReplace($code, $nextData, $passData)) + ' ';\n    } else {\n      out += ' var ' + ($nextData) + ' = ' + ($passData) + '; ' + ($code) + ' ';\n    }\n    if ($breakOnError) {\n      out += ' if (!' + ($nextValid) + ') break; ';\n    }\n    out += ' }';\n  }\n  if ($breakOnError) {\n    out += ' ' + ($closingBraces) + ' if (' + ($errs) + ' == errors) {';\n  }\n  out = it.util.cleanUpCode(out);\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_multipleOf(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $isData = it.opts.$data && $schema && $schema.$data,\n    $schemaValue;\n  if ($isData) {\n    out += ' var schema' + ($lvl) + ' = ' + (it.util.getData($schema.$data, $dataLvl, it.dataPathArr)) + '; ';\n    $schemaValue = 'schema' + $lvl;\n  } else {\n    $schemaValue = $schema;\n  }\n  out += 'var division' + ($lvl) + ';if (';\n  if ($isData) {\n    out += ' ' + ($schemaValue) + ' !== undefined && ( typeof ' + ($schemaValue) + ' != \\'number\\' || ';\n  }\n  out += ' (division' + ($lvl) + ' = ' + ($data) + ' / ' + ($schemaValue) + ', ';\n  if (it.opts.multipleOfPrecision) {\n    out += ' Math.abs(Math.round(division' + ($lvl) + ') - division' + ($lvl) + ') > 1e-' + (it.opts.multipleOfPrecision) + ' ';\n  } else {\n    out += ' division' + ($lvl) + ' !== parseInt(division' + ($lvl) + ') ';\n  }\n  out += ' ) ';\n  if ($isData) {\n    out += '  )  ';\n  }\n  out += ' ) {   ';\n  var $$outStack = $$outStack || [];\n  $$outStack.push(out);\n  out = ''; /* istanbul ignore else */\n  if (it.createErrors !== false) {\n    out += ' { keyword: \\'' + ('multipleOf') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { multipleOf: ' + ($schemaValue) + ' } ';\n    if (it.opts.messages !== false) {\n      out += ' , message: \\'should be multiple of ';\n      if ($isData) {\n        out += '\\' + ' + ($schemaValue);\n      } else {\n        out += '' + ($schemaValue) + '\\'';\n      }\n    }\n    if (it.opts.verbose) {\n      out += ' , schema:  ';\n      if ($isData) {\n        out += 'validate.schema' + ($schemaPath);\n      } else {\n        out += '' + ($schema);\n      }\n      out += '         , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n    }\n    out += ' } ';\n  } else {\n    out += ' {} ';\n  }\n  var __err = out;\n  out = $$outStack.pop();\n  if (!it.compositeRule && $breakOnError) {\n    /* istanbul ignore if */\n    if (it.async) {\n      out += ' throw new ValidationError([' + (__err) + ']); ';\n    } else {\n      out += ' validate.errors = [' + (__err) + ']; return false; ';\n    }\n  } else {\n    out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n  }\n  out += '} ';\n  if ($breakOnError) {\n    out += ' else { ';\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_not(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $errs = 'errs__' + $lvl;\n  var $it = it.util.copy(it);\n  $it.level++;\n  var $nextValid = 'valid' + $it.level;\n  if ((it.opts.strictKeywords ? typeof $schema == 'object' && Object.keys($schema).length > 0 : it.util.schemaHasRules($schema, it.RULES.all))) {\n    $it.schema = $schema;\n    $it.schemaPath = $schemaPath;\n    $it.errSchemaPath = $errSchemaPath;\n    out += ' var ' + ($errs) + ' = errors;  ';\n    var $wasComposite = it.compositeRule;\n    it.compositeRule = $it.compositeRule = true;\n    $it.createErrors = false;\n    var $allErrorsOption;\n    if ($it.opts.allErrors) {\n      $allErrorsOption = $it.opts.allErrors;\n      $it.opts.allErrors = false;\n    }\n    out += ' ' + (it.validate($it)) + ' ';\n    $it.createErrors = true;\n    if ($allErrorsOption) $it.opts.allErrors = $allErrorsOption;\n    it.compositeRule = $it.compositeRule = $wasComposite;\n    out += ' if (' + ($nextValid) + ') {   ';\n    var $$outStack = $$outStack || [];\n    $$outStack.push(out);\n    out = ''; /* istanbul ignore else */\n    if (it.createErrors !== false) {\n      out += ' { keyword: \\'' + ('not') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: {} ';\n      if (it.opts.messages !== false) {\n        out += ' , message: \\'should NOT be valid\\' ';\n      }\n      if (it.opts.verbose) {\n        out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n      }\n      out += ' } ';\n    } else {\n      out += ' {} ';\n    }\n    var __err = out;\n    out = $$outStack.pop();\n    if (!it.compositeRule && $breakOnError) {\n      /* istanbul ignore if */\n      if (it.async) {\n        out += ' throw new ValidationError([' + (__err) + ']); ';\n      } else {\n        out += ' validate.errors = [' + (__err) + ']; return false; ';\n      }\n    } else {\n      out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n    }\n    out += ' } else {  errors = ' + ($errs) + '; if (vErrors !== null) { if (' + ($errs) + ') vErrors.length = ' + ($errs) + '; else vErrors = null; } ';\n    if (it.opts.allErrors) {\n      out += ' } ';\n    }\n  } else {\n    out += '  var err =   '; /* istanbul ignore else */\n    if (it.createErrors !== false) {\n      out += ' { keyword: \\'' + ('not') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: {} ';\n      if (it.opts.messages !== false) {\n        out += ' , message: \\'should NOT be valid\\' ';\n      }\n      if (it.opts.verbose) {\n        out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n      }\n      out += ' } ';\n    } else {\n      out += ' {} ';\n    }\n    out += ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n    if ($breakOnError) {\n      out += ' if (false) { ';\n    }\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_oneOf(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $valid = 'valid' + $lvl;\n  var $errs = 'errs__' + $lvl;\n  var $it = it.util.copy(it);\n  var $closingBraces = '';\n  $it.level++;\n  var $nextValid = 'valid' + $it.level;\n  var $currentBaseId = $it.baseId,\n    $prevValid = 'prevValid' + $lvl,\n    $passingSchemas = 'passingSchemas' + $lvl;\n  out += 'var ' + ($errs) + ' = errors , ' + ($prevValid) + ' = false , ' + ($valid) + ' = false , ' + ($passingSchemas) + ' = null; ';\n  var $wasComposite = it.compositeRule;\n  it.compositeRule = $it.compositeRule = true;\n  var arr1 = $schema;\n  if (arr1) {\n    var $sch, $i = -1,\n      l1 = arr1.length - 1;\n    while ($i < l1) {\n      $sch = arr1[$i += 1];\n      if ((it.opts.strictKeywords ? typeof $sch == 'object' && Object.keys($sch).length > 0 : it.util.schemaHasRules($sch, it.RULES.all))) {\n        $it.schema = $sch;\n        $it.schemaPath = $schemaPath + '[' + $i + ']';\n        $it.errSchemaPath = $errSchemaPath + '/' + $i;\n        out += '  ' + (it.validate($it)) + ' ';\n        $it.baseId = $currentBaseId;\n      } else {\n        out += ' var ' + ($nextValid) + ' = true; ';\n      }\n      if ($i) {\n        out += ' if (' + ($nextValid) + ' && ' + ($prevValid) + ') { ' + ($valid) + ' = false; ' + ($passingSchemas) + ' = [' + ($passingSchemas) + ', ' + ($i) + ']; } else { ';\n        $closingBraces += '}';\n      }\n      out += ' if (' + ($nextValid) + ') { ' + ($valid) + ' = ' + ($prevValid) + ' = true; ' + ($passingSchemas) + ' = ' + ($i) + '; }';\n    }\n  }\n  it.compositeRule = $it.compositeRule = $wasComposite;\n  out += '' + ($closingBraces) + 'if (!' + ($valid) + ') {   var err =   '; /* istanbul ignore else */\n  if (it.createErrors !== false) {\n    out += ' { keyword: \\'' + ('oneOf') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { passingSchemas: ' + ($passingSchemas) + ' } ';\n    if (it.opts.messages !== false) {\n      out += ' , message: \\'should match exactly one schema in oneOf\\' ';\n    }\n    if (it.opts.verbose) {\n      out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n    }\n    out += ' } ';\n  } else {\n    out += ' {} ';\n  }\n  out += ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n  if (!it.compositeRule && $breakOnError) {\n    /* istanbul ignore if */\n    if (it.async) {\n      out += ' throw new ValidationError(vErrors); ';\n    } else {\n      out += ' validate.errors = vErrors; return false; ';\n    }\n  }\n  out += '} else {  errors = ' + ($errs) + '; if (vErrors !== null) { if (' + ($errs) + ') vErrors.length = ' + ($errs) + '; else vErrors = null; }';\n  if (it.opts.allErrors) {\n    out += ' } ';\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_pattern(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $isData = it.opts.$data && $schema && $schema.$data,\n    $schemaValue;\n  if ($isData) {\n    out += ' var schema' + ($lvl) + ' = ' + (it.util.getData($schema.$data, $dataLvl, it.dataPathArr)) + '; ';\n    $schemaValue = 'schema' + $lvl;\n  } else {\n    $schemaValue = $schema;\n  }\n  var $regexp = $isData ? '(new RegExp(' + $schemaValue + '))' : it.usePattern($schema);\n  out += 'if ( ';\n  if ($isData) {\n    out += ' (' + ($schemaValue) + ' !== undefined && typeof ' + ($schemaValue) + ' != \\'string\\') || ';\n  }\n  out += ' !' + ($regexp) + '.test(' + ($data) + ') ) {   ';\n  var $$outStack = $$outStack || [];\n  $$outStack.push(out);\n  out = ''; /* istanbul ignore else */\n  if (it.createErrors !== false) {\n    out += ' { keyword: \\'' + ('pattern') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { pattern:  ';\n    if ($isData) {\n      out += '' + ($schemaValue);\n    } else {\n      out += '' + (it.util.toQuotedString($schema));\n    }\n    out += '  } ';\n    if (it.opts.messages !== false) {\n      out += ' , message: \\'should match pattern \"';\n      if ($isData) {\n        out += '\\' + ' + ($schemaValue) + ' + \\'';\n      } else {\n        out += '' + (it.util.escapeQuotes($schema));\n      }\n      out += '\"\\' ';\n    }\n    if (it.opts.verbose) {\n      out += ' , schema:  ';\n      if ($isData) {\n        out += 'validate.schema' + ($schemaPath);\n      } else {\n        out += '' + (it.util.toQuotedString($schema));\n      }\n      out += '         , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n    }\n    out += ' } ';\n  } else {\n    out += ' {} ';\n  }\n  var __err = out;\n  out = $$outStack.pop();\n  if (!it.compositeRule && $breakOnError) {\n    /* istanbul ignore if */\n    if (it.async) {\n      out += ' throw new ValidationError([' + (__err) + ']); ';\n    } else {\n      out += ' validate.errors = [' + (__err) + ']; return false; ';\n    }\n  } else {\n    out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n  }\n  out += '} ';\n  if ($breakOnError) {\n    out += ' else { ';\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_properties(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $errs = 'errs__' + $lvl;\n  var $it = it.util.copy(it);\n  var $closingBraces = '';\n  $it.level++;\n  var $nextValid = 'valid' + $it.level;\n  var $key = 'key' + $lvl,\n    $idx = 'idx' + $lvl,\n    $dataNxt = $it.dataLevel = it.dataLevel + 1,\n    $nextData = 'data' + $dataNxt,\n    $dataProperties = 'dataProperties' + $lvl;\n  var $schemaKeys = Object.keys($schema || {}),\n    $pProperties = it.schema.patternProperties || {},\n    $pPropertyKeys = Object.keys($pProperties),\n    $aProperties = it.schema.additionalProperties,\n    $someProperties = $schemaKeys.length || $pPropertyKeys.length,\n    $noAdditional = $aProperties === false,\n    $additionalIsSchema = typeof $aProperties == 'object' && Object.keys($aProperties).length,\n    $removeAdditional = it.opts.removeAdditional,\n    $checkAdditional = $noAdditional || $additionalIsSchema || $removeAdditional,\n    $ownProperties = it.opts.ownProperties,\n    $currentBaseId = it.baseId;\n  var $required = it.schema.required;\n  if ($required && !(it.opts.$data && $required.$data) && $required.length < it.opts.loopRequired) var $requiredHash = it.util.toHash($required);\n  out += 'var ' + ($errs) + ' = errors;var ' + ($nextValid) + ' = true;';\n  if ($ownProperties) {\n    out += ' var ' + ($dataProperties) + ' = undefined;';\n  }\n  if ($checkAdditional) {\n    if ($ownProperties) {\n      out += ' ' + ($dataProperties) + ' = ' + ($dataProperties) + ' || Object.keys(' + ($data) + '); for (var ' + ($idx) + '=0; ' + ($idx) + '<' + ($dataProperties) + '.length; ' + ($idx) + '++) { var ' + ($key) + ' = ' + ($dataProperties) + '[' + ($idx) + ']; ';\n    } else {\n      out += ' for (var ' + ($key) + ' in ' + ($data) + ') { ';\n    }\n    if ($someProperties) {\n      out += ' var isAdditional' + ($lvl) + ' = !(false ';\n      if ($schemaKeys.length) {\n        if ($schemaKeys.length > 8) {\n          out += ' || validate.schema' + ($schemaPath) + '.hasOwnProperty(' + ($key) + ') ';\n        } else {\n          var arr1 = $schemaKeys;\n          if (arr1) {\n            var $propertyKey, i1 = -1,\n              l1 = arr1.length - 1;\n            while (i1 < l1) {\n              $propertyKey = arr1[i1 += 1];\n              out += ' || ' + ($key) + ' == ' + (it.util.toQuotedString($propertyKey)) + ' ';\n            }\n          }\n        }\n      }\n      if ($pPropertyKeys.length) {\n        var arr2 = $pPropertyKeys;\n        if (arr2) {\n          var $pProperty, $i = -1,\n            l2 = arr2.length - 1;\n          while ($i < l2) {\n            $pProperty = arr2[$i += 1];\n            out += ' || ' + (it.usePattern($pProperty)) + '.test(' + ($key) + ') ';\n          }\n        }\n      }\n      out += ' ); if (isAdditional' + ($lvl) + ') { ';\n    }\n    if ($removeAdditional == 'all') {\n      out += ' delete ' + ($data) + '[' + ($key) + ']; ';\n    } else {\n      var $currentErrorPath = it.errorPath;\n      var $additionalProperty = '\\' + ' + $key + ' + \\'';\n      if (it.opts._errorDataPathProperty) {\n        it.errorPath = it.util.getPathExpr(it.errorPath, $key, it.opts.jsonPointers);\n      }\n      if ($noAdditional) {\n        if ($removeAdditional) {\n          out += ' delete ' + ($data) + '[' + ($key) + ']; ';\n        } else {\n          out += ' ' + ($nextValid) + ' = false; ';\n          var $currErrSchemaPath = $errSchemaPath;\n          $errSchemaPath = it.errSchemaPath + '/additionalProperties';\n          var $$outStack = $$outStack || [];\n          $$outStack.push(out);\n          out = ''; /* istanbul ignore else */\n          if (it.createErrors !== false) {\n            out += ' { keyword: \\'' + ('additionalProperties') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { additionalProperty: \\'' + ($additionalProperty) + '\\' } ';\n            if (it.opts.messages !== false) {\n              out += ' , message: \\'';\n              if (it.opts._errorDataPathProperty) {\n                out += 'is an invalid additional property';\n              } else {\n                out += 'should NOT have additional properties';\n              }\n              out += '\\' ';\n            }\n            if (it.opts.verbose) {\n              out += ' , schema: false , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n            }\n            out += ' } ';\n          } else {\n            out += ' {} ';\n          }\n          var __err = out;\n          out = $$outStack.pop();\n          if (!it.compositeRule && $breakOnError) {\n            /* istanbul ignore if */\n            if (it.async) {\n              out += ' throw new ValidationError([' + (__err) + ']); ';\n            } else {\n              out += ' validate.errors = [' + (__err) + ']; return false; ';\n            }\n          } else {\n            out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n          }\n          $errSchemaPath = $currErrSchemaPath;\n          if ($breakOnError) {\n            out += ' break; ';\n          }\n        }\n      } else if ($additionalIsSchema) {\n        if ($removeAdditional == 'failing') {\n          out += ' var ' + ($errs) + ' = errors;  ';\n          var $wasComposite = it.compositeRule;\n          it.compositeRule = $it.compositeRule = true;\n          $it.schema = $aProperties;\n          $it.schemaPath = it.schemaPath + '.additionalProperties';\n          $it.errSchemaPath = it.errSchemaPath + '/additionalProperties';\n          $it.errorPath = it.opts._errorDataPathProperty ? it.errorPath : it.util.getPathExpr(it.errorPath, $key, it.opts.jsonPointers);\n          var $passData = $data + '[' + $key + ']';\n          $it.dataPathArr[$dataNxt] = $key;\n          var $code = it.validate($it);\n          $it.baseId = $currentBaseId;\n          if (it.util.varOccurences($code, $nextData) < 2) {\n            out += ' ' + (it.util.varReplace($code, $nextData, $passData)) + ' ';\n          } else {\n            out += ' var ' + ($nextData) + ' = ' + ($passData) + '; ' + ($code) + ' ';\n          }\n          out += ' if (!' + ($nextValid) + ') { errors = ' + ($errs) + '; if (validate.errors !== null) { if (errors) validate.errors.length = errors; else validate.errors = null; } delete ' + ($data) + '[' + ($key) + ']; }  ';\n          it.compositeRule = $it.compositeRule = $wasComposite;\n        } else {\n          $it.schema = $aProperties;\n          $it.schemaPath = it.schemaPath + '.additionalProperties';\n          $it.errSchemaPath = it.errSchemaPath + '/additionalProperties';\n          $it.errorPath = it.opts._errorDataPathProperty ? it.errorPath : it.util.getPathExpr(it.errorPath, $key, it.opts.jsonPointers);\n          var $passData = $data + '[' + $key + ']';\n          $it.dataPathArr[$dataNxt] = $key;\n          var $code = it.validate($it);\n          $it.baseId = $currentBaseId;\n          if (it.util.varOccurences($code, $nextData) < 2) {\n            out += ' ' + (it.util.varReplace($code, $nextData, $passData)) + ' ';\n          } else {\n            out += ' var ' + ($nextData) + ' = ' + ($passData) + '; ' + ($code) + ' ';\n          }\n          if ($breakOnError) {\n            out += ' if (!' + ($nextValid) + ') break; ';\n          }\n        }\n      }\n      it.errorPath = $currentErrorPath;\n    }\n    if ($someProperties) {\n      out += ' } ';\n    }\n    out += ' }  ';\n    if ($breakOnError) {\n      out += ' if (' + ($nextValid) + ') { ';\n      $closingBraces += '}';\n    }\n  }\n  var $useDefaults = it.opts.useDefaults && !it.compositeRule;\n  if ($schemaKeys.length) {\n    var arr3 = $schemaKeys;\n    if (arr3) {\n      var $propertyKey, i3 = -1,\n        l3 = arr3.length - 1;\n      while (i3 < l3) {\n        $propertyKey = arr3[i3 += 1];\n        var $sch = $schema[$propertyKey];\n        if ((it.opts.strictKeywords ? typeof $sch == 'object' && Object.keys($sch).length > 0 : it.util.schemaHasRules($sch, it.RULES.all))) {\n          var $prop = it.util.getProperty($propertyKey),\n            $passData = $data + $prop,\n            $hasDefault = $useDefaults && $sch.default !== undefined;\n          $it.schema = $sch;\n          $it.schemaPath = $schemaPath + $prop;\n          $it.errSchemaPath = $errSchemaPath + '/' + it.util.escapeFragment($propertyKey);\n          $it.errorPath = it.util.getPath(it.errorPath, $propertyKey, it.opts.jsonPointers);\n          $it.dataPathArr[$dataNxt] = it.util.toQuotedString($propertyKey);\n          var $code = it.validate($it);\n          $it.baseId = $currentBaseId;\n          if (it.util.varOccurences($code, $nextData) < 2) {\n            $code = it.util.varReplace($code, $nextData, $passData);\n            var $useData = $passData;\n          } else {\n            var $useData = $nextData;\n            out += ' var ' + ($nextData) + ' = ' + ($passData) + '; ';\n          }\n          if ($hasDefault) {\n            out += ' ' + ($code) + ' ';\n          } else {\n            if ($requiredHash && $requiredHash[$propertyKey]) {\n              out += ' if ( ' + ($useData) + ' === undefined ';\n              if ($ownProperties) {\n                out += ' || ! Object.prototype.hasOwnProperty.call(' + ($data) + ', \\'' + (it.util.escapeQuotes($propertyKey)) + '\\') ';\n              }\n              out += ') { ' + ($nextValid) + ' = false; ';\n              var $currentErrorPath = it.errorPath,\n                $currErrSchemaPath = $errSchemaPath,\n                $missingProperty = it.util.escapeQuotes($propertyKey);\n              if (it.opts._errorDataPathProperty) {\n                it.errorPath = it.util.getPath($currentErrorPath, $propertyKey, it.opts.jsonPointers);\n              }\n              $errSchemaPath = it.errSchemaPath + '/required';\n              var $$outStack = $$outStack || [];\n              $$outStack.push(out);\n              out = ''; /* istanbul ignore else */\n              if (it.createErrors !== false) {\n                out += ' { keyword: \\'' + ('required') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { missingProperty: \\'' + ($missingProperty) + '\\' } ';\n                if (it.opts.messages !== false) {\n                  out += ' , message: \\'';\n                  if (it.opts._errorDataPathProperty) {\n                    out += 'is a required property';\n                  } else {\n                    out += 'should have required property \\\\\\'' + ($missingProperty) + '\\\\\\'';\n                  }\n                  out += '\\' ';\n                }\n                if (it.opts.verbose) {\n                  out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n                }\n                out += ' } ';\n              } else {\n                out += ' {} ';\n              }\n              var __err = out;\n              out = $$outStack.pop();\n              if (!it.compositeRule && $breakOnError) {\n                /* istanbul ignore if */\n                if (it.async) {\n                  out += ' throw new ValidationError([' + (__err) + ']); ';\n                } else {\n                  out += ' validate.errors = [' + (__err) + ']; return false; ';\n                }\n              } else {\n                out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n              }\n              $errSchemaPath = $currErrSchemaPath;\n              it.errorPath = $currentErrorPath;\n              out += ' } else { ';\n            } else {\n              if ($breakOnError) {\n                out += ' if ( ' + ($useData) + ' === undefined ';\n                if ($ownProperties) {\n                  out += ' || ! Object.prototype.hasOwnProperty.call(' + ($data) + ', \\'' + (it.util.escapeQuotes($propertyKey)) + '\\') ';\n                }\n                out += ') { ' + ($nextValid) + ' = true; } else { ';\n              } else {\n                out += ' if (' + ($useData) + ' !== undefined ';\n                if ($ownProperties) {\n                  out += ' &&   Object.prototype.hasOwnProperty.call(' + ($data) + ', \\'' + (it.util.escapeQuotes($propertyKey)) + '\\') ';\n                }\n                out += ' ) { ';\n              }\n            }\n            out += ' ' + ($code) + ' } ';\n          }\n        }\n        if ($breakOnError) {\n          out += ' if (' + ($nextValid) + ') { ';\n          $closingBraces += '}';\n        }\n      }\n    }\n  }\n  if ($pPropertyKeys.length) {\n    var arr4 = $pPropertyKeys;\n    if (arr4) {\n      var $pProperty, i4 = -1,\n        l4 = arr4.length - 1;\n      while (i4 < l4) {\n        $pProperty = arr4[i4 += 1];\n        var $sch = $pProperties[$pProperty];\n        if ((it.opts.strictKeywords ? typeof $sch == 'object' && Object.keys($sch).length > 0 : it.util.schemaHasRules($sch, it.RULES.all))) {\n          $it.schema = $sch;\n          $it.schemaPath = it.schemaPath + '.patternProperties' + it.util.getProperty($pProperty);\n          $it.errSchemaPath = it.errSchemaPath + '/patternProperties/' + it.util.escapeFragment($pProperty);\n          if ($ownProperties) {\n            out += ' ' + ($dataProperties) + ' = ' + ($dataProperties) + ' || Object.keys(' + ($data) + '); for (var ' + ($idx) + '=0; ' + ($idx) + '<' + ($dataProperties) + '.length; ' + ($idx) + '++) { var ' + ($key) + ' = ' + ($dataProperties) + '[' + ($idx) + ']; ';\n          } else {\n            out += ' for (var ' + ($key) + ' in ' + ($data) + ') { ';\n          }\n          out += ' if (' + (it.usePattern($pProperty)) + '.test(' + ($key) + ')) { ';\n          $it.errorPath = it.util.getPathExpr(it.errorPath, $key, it.opts.jsonPointers);\n          var $passData = $data + '[' + $key + ']';\n          $it.dataPathArr[$dataNxt] = $key;\n          var $code = it.validate($it);\n          $it.baseId = $currentBaseId;\n          if (it.util.varOccurences($code, $nextData) < 2) {\n            out += ' ' + (it.util.varReplace($code, $nextData, $passData)) + ' ';\n          } else {\n            out += ' var ' + ($nextData) + ' = ' + ($passData) + '; ' + ($code) + ' ';\n          }\n          if ($breakOnError) {\n            out += ' if (!' + ($nextValid) + ') break; ';\n          }\n          out += ' } ';\n          if ($breakOnError) {\n            out += ' else ' + ($nextValid) + ' = true; ';\n          }\n          out += ' }  ';\n          if ($breakOnError) {\n            out += ' if (' + ($nextValid) + ') { ';\n            $closingBraces += '}';\n          }\n        }\n      }\n    }\n  }\n  if ($breakOnError) {\n    out += ' ' + ($closingBraces) + ' if (' + ($errs) + ' == errors) {';\n  }\n  out = it.util.cleanUpCode(out);\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_propertyNames(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $errs = 'errs__' + $lvl;\n  var $it = it.util.copy(it);\n  var $closingBraces = '';\n  $it.level++;\n  var $nextValid = 'valid' + $it.level;\n  out += 'var ' + ($errs) + ' = errors;';\n  if ((it.opts.strictKeywords ? typeof $schema == 'object' && Object.keys($schema).length > 0 : it.util.schemaHasRules($schema, it.RULES.all))) {\n    $it.schema = $schema;\n    $it.schemaPath = $schemaPath;\n    $it.errSchemaPath = $errSchemaPath;\n    var $key = 'key' + $lvl,\n      $idx = 'idx' + $lvl,\n      $i = 'i' + $lvl,\n      $invalidName = '\\' + ' + $key + ' + \\'',\n      $dataNxt = $it.dataLevel = it.dataLevel + 1,\n      $nextData = 'data' + $dataNxt,\n      $dataProperties = 'dataProperties' + $lvl,\n      $ownProperties = it.opts.ownProperties,\n      $currentBaseId = it.baseId;\n    if ($ownProperties) {\n      out += ' var ' + ($dataProperties) + ' = undefined; ';\n    }\n    if ($ownProperties) {\n      out += ' ' + ($dataProperties) + ' = ' + ($dataProperties) + ' || Object.keys(' + ($data) + '); for (var ' + ($idx) + '=0; ' + ($idx) + '<' + ($dataProperties) + '.length; ' + ($idx) + '++) { var ' + ($key) + ' = ' + ($dataProperties) + '[' + ($idx) + ']; ';\n    } else {\n      out += ' for (var ' + ($key) + ' in ' + ($data) + ') { ';\n    }\n    out += ' var startErrs' + ($lvl) + ' = errors; ';\n    var $passData = $key;\n    var $wasComposite = it.compositeRule;\n    it.compositeRule = $it.compositeRule = true;\n    var $code = it.validate($it);\n    $it.baseId = $currentBaseId;\n    if (it.util.varOccurences($code, $nextData) < 2) {\n      out += ' ' + (it.util.varReplace($code, $nextData, $passData)) + ' ';\n    } else {\n      out += ' var ' + ($nextData) + ' = ' + ($passData) + '; ' + ($code) + ' ';\n    }\n    it.compositeRule = $it.compositeRule = $wasComposite;\n    out += ' if (!' + ($nextValid) + ') { for (var ' + ($i) + '=startErrs' + ($lvl) + '; ' + ($i) + '<errors; ' + ($i) + '++) { vErrors[' + ($i) + '].propertyName = ' + ($key) + '; }   var err =   '; /* istanbul ignore else */\n    if (it.createErrors !== false) {\n      out += ' { keyword: \\'' + ('propertyNames') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { propertyName: \\'' + ($invalidName) + '\\' } ';\n      if (it.opts.messages !== false) {\n        out += ' , message: \\'property name \\\\\\'' + ($invalidName) + '\\\\\\' is invalid\\' ';\n      }\n      if (it.opts.verbose) {\n        out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n      }\n      out += ' } ';\n    } else {\n      out += ' {} ';\n    }\n    out += ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n    if (!it.compositeRule && $breakOnError) {\n      /* istanbul ignore if */\n      if (it.async) {\n        out += ' throw new ValidationError(vErrors); ';\n      } else {\n        out += ' validate.errors = vErrors; return false; ';\n      }\n    }\n    if ($breakOnError) {\n      out += ' break; ';\n    }\n    out += ' } }';\n  }\n  if ($breakOnError) {\n    out += ' ' + ($closingBraces) + ' if (' + ($errs) + ' == errors) {';\n  }\n  out = it.util.cleanUpCode(out);\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_required(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $valid = 'valid' + $lvl;\n  var $isData = it.opts.$data && $schema && $schema.$data,\n    $schemaValue;\n  if ($isData) {\n    out += ' var schema' + ($lvl) + ' = ' + (it.util.getData($schema.$data, $dataLvl, it.dataPathArr)) + '; ';\n    $schemaValue = 'schema' + $lvl;\n  } else {\n    $schemaValue = $schema;\n  }\n  var $vSchema = 'schema' + $lvl;\n  if (!$isData) {\n    if ($schema.length < it.opts.loopRequired && it.schema.properties && Object.keys(it.schema.properties).length) {\n      var $required = [];\n      var arr1 = $schema;\n      if (arr1) {\n        var $property, i1 = -1,\n          l1 = arr1.length - 1;\n        while (i1 < l1) {\n          $property = arr1[i1 += 1];\n          var $propertySch = it.schema.properties[$property];\n          if (!($propertySch && (it.opts.strictKeywords ? typeof $propertySch == 'object' && Object.keys($propertySch).length > 0 : it.util.schemaHasRules($propertySch, it.RULES.all)))) {\n            $required[$required.length] = $property;\n          }\n        }\n      }\n    } else {\n      var $required = $schema;\n    }\n  }\n  if ($isData || $required.length) {\n    var $currentErrorPath = it.errorPath,\n      $loopRequired = $isData || $required.length >= it.opts.loopRequired,\n      $ownProperties = it.opts.ownProperties;\n    if ($breakOnError) {\n      out += ' var missing' + ($lvl) + '; ';\n      if ($loopRequired) {\n        if (!$isData) {\n          out += ' var ' + ($vSchema) + ' = validate.schema' + ($schemaPath) + '; ';\n        }\n        var $i = 'i' + $lvl,\n          $propertyPath = 'schema' + $lvl + '[' + $i + ']',\n          $missingProperty = '\\' + ' + $propertyPath + ' + \\'';\n        if (it.opts._errorDataPathProperty) {\n          it.errorPath = it.util.getPathExpr($currentErrorPath, $propertyPath, it.opts.jsonPointers);\n        }\n        out += ' var ' + ($valid) + ' = true; ';\n        if ($isData) {\n          out += ' if (schema' + ($lvl) + ' === undefined) ' + ($valid) + ' = true; else if (!Array.isArray(schema' + ($lvl) + ')) ' + ($valid) + ' = false; else {';\n        }\n        out += ' for (var ' + ($i) + ' = 0; ' + ($i) + ' < ' + ($vSchema) + '.length; ' + ($i) + '++) { ' + ($valid) + ' = ' + ($data) + '[' + ($vSchema) + '[' + ($i) + ']] !== undefined ';\n        if ($ownProperties) {\n          out += ' &&   Object.prototype.hasOwnProperty.call(' + ($data) + ', ' + ($vSchema) + '[' + ($i) + ']) ';\n        }\n        out += '; if (!' + ($valid) + ') break; } ';\n        if ($isData) {\n          out += '  }  ';\n        }\n        out += '  if (!' + ($valid) + ') {   ';\n        var $$outStack = $$outStack || [];\n        $$outStack.push(out);\n        out = ''; /* istanbul ignore else */\n        if (it.createErrors !== false) {\n          out += ' { keyword: \\'' + ('required') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { missingProperty: \\'' + ($missingProperty) + '\\' } ';\n          if (it.opts.messages !== false) {\n            out += ' , message: \\'';\n            if (it.opts._errorDataPathProperty) {\n              out += 'is a required property';\n            } else {\n              out += 'should have required property \\\\\\'' + ($missingProperty) + '\\\\\\'';\n            }\n            out += '\\' ';\n          }\n          if (it.opts.verbose) {\n            out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n          }\n          out += ' } ';\n        } else {\n          out += ' {} ';\n        }\n        var __err = out;\n        out = $$outStack.pop();\n        if (!it.compositeRule && $breakOnError) {\n          /* istanbul ignore if */\n          if (it.async) {\n            out += ' throw new ValidationError([' + (__err) + ']); ';\n          } else {\n            out += ' validate.errors = [' + (__err) + ']; return false; ';\n          }\n        } else {\n          out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n        }\n        out += ' } else { ';\n      } else {\n        out += ' if ( ';\n        var arr2 = $required;\n        if (arr2) {\n          var $propertyKey, $i = -1,\n            l2 = arr2.length - 1;\n          while ($i < l2) {\n            $propertyKey = arr2[$i += 1];\n            if ($i) {\n              out += ' || ';\n            }\n            var $prop = it.util.getProperty($propertyKey),\n              $useData = $data + $prop;\n            out += ' ( ( ' + ($useData) + ' === undefined ';\n            if ($ownProperties) {\n              out += ' || ! Object.prototype.hasOwnProperty.call(' + ($data) + ', \\'' + (it.util.escapeQuotes($propertyKey)) + '\\') ';\n            }\n            out += ') && (missing' + ($lvl) + ' = ' + (it.util.toQuotedString(it.opts.jsonPointers ? $propertyKey : $prop)) + ') ) ';\n          }\n        }\n        out += ') {  ';\n        var $propertyPath = 'missing' + $lvl,\n          $missingProperty = '\\' + ' + $propertyPath + ' + \\'';\n        if (it.opts._errorDataPathProperty) {\n          it.errorPath = it.opts.jsonPointers ? it.util.getPathExpr($currentErrorPath, $propertyPath, true) : $currentErrorPath + ' + ' + $propertyPath;\n        }\n        var $$outStack = $$outStack || [];\n        $$outStack.push(out);\n        out = ''; /* istanbul ignore else */\n        if (it.createErrors !== false) {\n          out += ' { keyword: \\'' + ('required') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { missingProperty: \\'' + ($missingProperty) + '\\' } ';\n          if (it.opts.messages !== false) {\n            out += ' , message: \\'';\n            if (it.opts._errorDataPathProperty) {\n              out += 'is a required property';\n            } else {\n              out += 'should have required property \\\\\\'' + ($missingProperty) + '\\\\\\'';\n            }\n            out += '\\' ';\n          }\n          if (it.opts.verbose) {\n            out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n          }\n          out += ' } ';\n        } else {\n          out += ' {} ';\n        }\n        var __err = out;\n        out = $$outStack.pop();\n        if (!it.compositeRule && $breakOnError) {\n          /* istanbul ignore if */\n          if (it.async) {\n            out += ' throw new ValidationError([' + (__err) + ']); ';\n          } else {\n            out += ' validate.errors = [' + (__err) + ']; return false; ';\n          }\n        } else {\n          out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n        }\n        out += ' } else { ';\n      }\n    } else {\n      if ($loopRequired) {\n        if (!$isData) {\n          out += ' var ' + ($vSchema) + ' = validate.schema' + ($schemaPath) + '; ';\n        }\n        var $i = 'i' + $lvl,\n          $propertyPath = 'schema' + $lvl + '[' + $i + ']',\n          $missingProperty = '\\' + ' + $propertyPath + ' + \\'';\n        if (it.opts._errorDataPathProperty) {\n          it.errorPath = it.util.getPathExpr($currentErrorPath, $propertyPath, it.opts.jsonPointers);\n        }\n        if ($isData) {\n          out += ' if (' + ($vSchema) + ' && !Array.isArray(' + ($vSchema) + ')) {  var err =   '; /* istanbul ignore else */\n          if (it.createErrors !== false) {\n            out += ' { keyword: \\'' + ('required') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { missingProperty: \\'' + ($missingProperty) + '\\' } ';\n            if (it.opts.messages !== false) {\n              out += ' , message: \\'';\n              if (it.opts._errorDataPathProperty) {\n                out += 'is a required property';\n              } else {\n                out += 'should have required property \\\\\\'' + ($missingProperty) + '\\\\\\'';\n              }\n              out += '\\' ';\n            }\n            if (it.opts.verbose) {\n              out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n            }\n            out += ' } ';\n          } else {\n            out += ' {} ';\n          }\n          out += ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } else if (' + ($vSchema) + ' !== undefined) { ';\n        }\n        out += ' for (var ' + ($i) + ' = 0; ' + ($i) + ' < ' + ($vSchema) + '.length; ' + ($i) + '++) { if (' + ($data) + '[' + ($vSchema) + '[' + ($i) + ']] === undefined ';\n        if ($ownProperties) {\n          out += ' || ! Object.prototype.hasOwnProperty.call(' + ($data) + ', ' + ($vSchema) + '[' + ($i) + ']) ';\n        }\n        out += ') {  var err =   '; /* istanbul ignore else */\n        if (it.createErrors !== false) {\n          out += ' { keyword: \\'' + ('required') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { missingProperty: \\'' + ($missingProperty) + '\\' } ';\n          if (it.opts.messages !== false) {\n            out += ' , message: \\'';\n            if (it.opts._errorDataPathProperty) {\n              out += 'is a required property';\n            } else {\n              out += 'should have required property \\\\\\'' + ($missingProperty) + '\\\\\\'';\n            }\n            out += '\\' ';\n          }\n          if (it.opts.verbose) {\n            out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n          }\n          out += ' } ';\n        } else {\n          out += ' {} ';\n        }\n        out += ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } } ';\n        if ($isData) {\n          out += '  }  ';\n        }\n      } else {\n        var arr3 = $required;\n        if (arr3) {\n          var $propertyKey, i3 = -1,\n            l3 = arr3.length - 1;\n          while (i3 < l3) {\n            $propertyKey = arr3[i3 += 1];\n            var $prop = it.util.getProperty($propertyKey),\n              $missingProperty = it.util.escapeQuotes($propertyKey),\n              $useData = $data + $prop;\n            if (it.opts._errorDataPathProperty) {\n              it.errorPath = it.util.getPath($currentErrorPath, $propertyKey, it.opts.jsonPointers);\n            }\n            out += ' if ( ' + ($useData) + ' === undefined ';\n            if ($ownProperties) {\n              out += ' || ! Object.prototype.hasOwnProperty.call(' + ($data) + ', \\'' + (it.util.escapeQuotes($propertyKey)) + '\\') ';\n            }\n            out += ') {  var err =   '; /* istanbul ignore else */\n            if (it.createErrors !== false) {\n              out += ' { keyword: \\'' + ('required') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { missingProperty: \\'' + ($missingProperty) + '\\' } ';\n              if (it.opts.messages !== false) {\n                out += ' , message: \\'';\n                if (it.opts._errorDataPathProperty) {\n                  out += 'is a required property';\n                } else {\n                  out += 'should have required property \\\\\\'' + ($missingProperty) + '\\\\\\'';\n                }\n                out += '\\' ';\n              }\n              if (it.opts.verbose) {\n                out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n              }\n              out += ' } ';\n            } else {\n              out += ' {} ';\n            }\n            out += ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } ';\n          }\n        }\n      }\n    }\n    it.errorPath = $currentErrorPath;\n  } else if ($breakOnError) {\n    out += ' if (true) {';\n  }\n  return out;\n}\n","'use strict';\nmodule.exports = function generate_uniqueItems(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $data = 'data' + ($dataLvl || '');\n  var $valid = 'valid' + $lvl;\n  var $isData = it.opts.$data && $schema && $schema.$data,\n    $schemaValue;\n  if ($isData) {\n    out += ' var schema' + ($lvl) + ' = ' + (it.util.getData($schema.$data, $dataLvl, it.dataPathArr)) + '; ';\n    $schemaValue = 'schema' + $lvl;\n  } else {\n    $schemaValue = $schema;\n  }\n  if (($schema || $isData) && it.opts.uniqueItems !== false) {\n    if ($isData) {\n      out += ' var ' + ($valid) + '; if (' + ($schemaValue) + ' === false || ' + ($schemaValue) + ' === undefined) ' + ($valid) + ' = true; else if (typeof ' + ($schemaValue) + ' != \\'boolean\\') ' + ($valid) + ' = false; else { ';\n    }\n    out += ' var i = ' + ($data) + '.length , ' + ($valid) + ' = true , j; if (i > 1) { ';\n    var $itemType = it.schema.items && it.schema.items.type,\n      $typeIsArray = Array.isArray($itemType);\n    if (!$itemType || $itemType == 'object' || $itemType == 'array' || ($typeIsArray && ($itemType.indexOf('object') >= 0 || $itemType.indexOf('array') >= 0))) {\n      out += ' outer: for (;i--;) { for (j = i; j--;) { if (equal(' + ($data) + '[i], ' + ($data) + '[j])) { ' + ($valid) + ' = false; break outer; } } } ';\n    } else {\n      out += ' var itemIndices = {}, item; for (;i--;) { var item = ' + ($data) + '[i]; ';\n      var $method = 'checkDataType' + ($typeIsArray ? 's' : '');\n      out += ' if (' + (it.util[$method]($itemType, 'item', true)) + ') continue; ';\n      if ($typeIsArray) {\n        out += ' if (typeof item == \\'string\\') item = \\'\"\\' + item; ';\n      }\n      out += ' if (typeof itemIndices[item] == \\'number\\') { ' + ($valid) + ' = false; j = itemIndices[item]; break; } itemIndices[item] = i; } ';\n    }\n    out += ' } ';\n    if ($isData) {\n      out += '  }  ';\n    }\n    out += ' if (!' + ($valid) + ') {   ';\n    var $$outStack = $$outStack || [];\n    $$outStack.push(out);\n    out = ''; /* istanbul ignore else */\n    if (it.createErrors !== false) {\n      out += ' { keyword: \\'' + ('uniqueItems') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { i: i, j: j } ';\n      if (it.opts.messages !== false) {\n        out += ' , message: \\'should NOT have duplicate items (items ## \\' + j + \\' and \\' + i + \\' are identical)\\' ';\n      }\n      if (it.opts.verbose) {\n        out += ' , schema:  ';\n        if ($isData) {\n          out += 'validate.schema' + ($schemaPath);\n        } else {\n          out += '' + ($schema);\n        }\n        out += '         , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n      }\n      out += ' } ';\n    } else {\n      out += ' {} ';\n    }\n    var __err = out;\n    out = $$outStack.pop();\n    if (!it.compositeRule && $breakOnError) {\n      /* istanbul ignore if */\n      if (it.async) {\n        out += ' throw new ValidationError([' + (__err) + ']); ';\n      } else {\n        out += ' validate.errors = [' + (__err) + ']; return false; ';\n      }\n    } else {\n      out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n    }\n    out += ' } ';\n    if ($breakOnError) {\n      out += ' else { ';\n    }\n  } else {\n    if ($breakOnError) {\n      out += ' if (true) { ';\n    }\n  }\n  return out;\n}\n","'use strict';\n\nvar ruleModules = require('../dotjs')\n  , toHash = require('./util').toHash;\n\nmodule.exports = function rules() {\n  var RULES = [\n    { type: 'number',\n      rules: [ { 'maximum': ['exclusiveMaximum'] },\n               { 'minimum': ['exclusiveMinimum'] }, 'multipleOf', 'format'] },\n    { type: 'string',\n      rules: [ 'maxLength', 'minLength', 'pattern', 'format' ] },\n    { type: 'array',\n      rules: [ 'maxItems', 'minItems', 'items', 'contains', 'uniqueItems' ] },\n    { type: 'object',\n      rules: [ 'maxProperties', 'minProperties', 'required', 'dependencies', 'propertyNames',\n               { 'properties': ['additionalProperties', 'patternProperties'] } ] },\n    { rules: [ '$ref', 'const', 'enum', 'not', 'anyOf', 'oneOf', 'allOf', 'if' ] }\n  ];\n\n  var ALL = [ 'type', '$comment' ];\n  var KEYWORDS = [\n    '$schema', '$id', 'id', '$data', '$async', 'title',\n    'description', 'default', 'definitions',\n    'examples', 'readOnly', 'writeOnly',\n    'contentMediaType', 'contentEncoding',\n    'additionalItems', 'then', 'else'\n  ];\n  var TYPES = [ 'number', 'integer', 'string', 'array', 'object', 'boolean', 'null' ];\n  RULES.all = toHash(ALL);\n  RULES.types = toHash(TYPES);\n\n  RULES.forEach(function (group) {\n    group.rules = group.rules.map(function (keyword) {\n      var implKeywords;\n      if (typeof keyword == 'object') {\n        var key = Object.keys(keyword)[0];\n        implKeywords = keyword[key];\n        keyword = key;\n        implKeywords.forEach(function (k) {\n          ALL.push(k);\n          RULES.all[k] = true;\n        });\n      }\n      ALL.push(keyword);\n      var rule = RULES.all[keyword] = {\n        keyword: keyword,\n        code: ruleModules[keyword],\n        implements: implKeywords\n      };\n      return rule;\n    });\n\n    RULES.all.$comment = {\n      keyword: '$comment',\n      code: ruleModules.$comment\n    };\n\n    if (group.type) RULES.types[group.type] = group;\n  });\n\n  RULES.keywords = toHash(ALL.concat(KEYWORDS));\n  RULES.custom = {};\n\n  return RULES;\n};\n","'use strict';\n\nvar KEYWORDS = [\n  'multipleOf',\n  'maximum',\n  'exclusiveMaximum',\n  'minimum',\n  'exclusiveMinimum',\n  'maxLength',\n  'minLength',\n  'pattern',\n  'additionalItems',\n  'maxItems',\n  'minItems',\n  'uniqueItems',\n  'maxProperties',\n  'minProperties',\n  'required',\n  'additionalProperties',\n  'enum',\n  'format',\n  'const'\n];\n\nmodule.exports = function (metaSchema, keywordsJsonPointers) {\n  for (var i=0; i<keywordsJsonPointers.length; i++) {\n    metaSchema = JSON.parse(JSON.stringify(metaSchema));\n    var segments = keywordsJsonPointers[i].split('/');\n    var keywords = metaSchema;\n    var j;\n    for (j=1; j<segments.length; j++)\n      keywords = keywords[segments[j]];\n\n    for (j=0; j<KEYWORDS.length; j++) {\n      var key = KEYWORDS[j];\n      var schema = keywords[key];\n      if (schema) {\n        keywords[key] = {\n          anyOf: [\n            schema,\n            { $ref: 'https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/data.json#' }\n          ]\n        };\n      }\n    }\n  }\n\n  return metaSchema;\n};\n","'use strict';\n\nvar MissingRefError = require('./error_classes').MissingRef;\n\nmodule.exports = compileAsync;\n\n\n/**\n * Creates validating function for passed schema with asynchronous loading of missing schemas.\n * `loadSchema` option should be a function that accepts schema uri and returns promise that resolves with the schema.\n * @this  Ajv\n * @param {Object}   schema schema object\n * @param {Boolean}  meta optional true to compile meta-schema; this parameter can be skipped\n * @param {Function} callback an optional node-style callback, it is called with 2 parameters: error (or null) and validating function.\n * @return {Promise} promise that resolves with a validating function.\n */\nfunction compileAsync(schema, meta, callback) {\n  /* eslint no-shadow: 0 */\n  /* global Promise */\n  /* jshint validthis: true */\n  var self = this;\n  if (typeof this._opts.loadSchema != 'function')\n    throw new Error('options.loadSchema should be a function');\n\n  if (typeof meta == 'function') {\n    callback = meta;\n    meta = undefined;\n  }\n\n  var p = loadMetaSchemaOf(schema).then(function () {\n    var schemaObj = self._addSchema(schema, undefined, meta);\n    return schemaObj.validate || _compileAsync(schemaObj);\n  });\n\n  if (callback) {\n    p.then(\n      function(v) { callback(null, v); },\n      callback\n    );\n  }\n\n  return p;\n\n\n  function loadMetaSchemaOf(sch) {\n    var $schema = sch.$schema;\n    return $schema && !self.getSchema($schema)\n            ? compileAsync.call(self, { $ref: $schema }, true)\n            : Promise.resolve();\n  }\n\n\n  function _compileAsync(schemaObj) {\n    try { return self._compile(schemaObj); }\n    catch(e) {\n      if (e instanceof MissingRefError) return loadMissingSchema(e);\n      throw e;\n    }\n\n\n    function loadMissingSchema(e) {\n      var ref = e.missingSchema;\n      if (added(ref)) throw new Error('Schema ' + ref + ' is loaded but ' + e.missingRef + ' cannot be resolved');\n\n      var schemaPromise = self._loadingSchemas[ref];\n      if (!schemaPromise) {\n        schemaPromise = self._loadingSchemas[ref] = self._opts.loadSchema(ref);\n        schemaPromise.then(removePromise, removePromise);\n      }\n\n      return schemaPromise.then(function (sch) {\n        if (!added(ref)) {\n          return loadMetaSchemaOf(sch).then(function () {\n            if (!added(ref)) self.addSchema(sch, ref, undefined, meta);\n          });\n        }\n      }).then(function() {\n        return _compileAsync(schemaObj);\n      });\n\n      function removePromise() {\n        delete self._loadingSchemas[ref];\n      }\n\n      function added(ref) {\n        return self._refs[ref] || self._schemas[ref];\n      }\n    }\n  }\n}\n","'use strict';\nmodule.exports = function generate_custom(it, $keyword, $ruleType) {\n  var out = ' ';\n  var $lvl = it.level;\n  var $dataLvl = it.dataLevel;\n  var $schema = it.schema[$keyword];\n  var $schemaPath = it.schemaPath + it.util.getProperty($keyword);\n  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;\n  var $breakOnError = !it.opts.allErrors;\n  var $errorKeyword;\n  var $data = 'data' + ($dataLvl || '');\n  var $valid = 'valid' + $lvl;\n  var $errs = 'errs__' + $lvl;\n  var $isData = it.opts.$data && $schema && $schema.$data,\n    $schemaValue;\n  if ($isData) {\n    out += ' var schema' + ($lvl) + ' = ' + (it.util.getData($schema.$data, $dataLvl, it.dataPathArr)) + '; ';\n    $schemaValue = 'schema' + $lvl;\n  } else {\n    $schemaValue = $schema;\n  }\n  var $rule = this,\n    $definition = 'definition' + $lvl,\n    $rDef = $rule.definition,\n    $closingBraces = '';\n  var $compile, $inline, $macro, $ruleValidate, $validateCode;\n  if ($isData && $rDef.$data) {\n    $validateCode = 'keywordValidate' + $lvl;\n    var $validateSchema = $rDef.validateSchema;\n    out += ' var ' + ($definition) + ' = RULES.custom[\\'' + ($keyword) + '\\'].definition; var ' + ($validateCode) + ' = ' + ($definition) + '.validate;';\n  } else {\n    $ruleValidate = it.useCustomRule($rule, $schema, it.schema, it);\n    if (!$ruleValidate) return;\n    $schemaValue = 'validate.schema' + $schemaPath;\n    $validateCode = $ruleValidate.code;\n    $compile = $rDef.compile;\n    $inline = $rDef.inline;\n    $macro = $rDef.macro;\n  }\n  var $ruleErrs = $validateCode + '.errors',\n    $i = 'i' + $lvl,\n    $ruleErr = 'ruleErr' + $lvl,\n    $asyncKeyword = $rDef.async;\n  if ($asyncKeyword && !it.async) throw new Error('async keyword in sync schema');\n  if (!($inline || $macro)) {\n    out += '' + ($ruleErrs) + ' = null;';\n  }\n  out += 'var ' + ($errs) + ' = errors;var ' + ($valid) + ';';\n  if ($isData && $rDef.$data) {\n    $closingBraces += '}';\n    out += ' if (' + ($schemaValue) + ' === undefined) { ' + ($valid) + ' = true; } else { ';\n    if ($validateSchema) {\n      $closingBraces += '}';\n      out += ' ' + ($valid) + ' = ' + ($definition) + '.validateSchema(' + ($schemaValue) + '); if (' + ($valid) + ') { ';\n    }\n  }\n  if ($inline) {\n    if ($rDef.statements) {\n      out += ' ' + ($ruleValidate.validate) + ' ';\n    } else {\n      out += ' ' + ($valid) + ' = ' + ($ruleValidate.validate) + '; ';\n    }\n  } else if ($macro) {\n    var $it = it.util.copy(it);\n    var $closingBraces = '';\n    $it.level++;\n    var $nextValid = 'valid' + $it.level;\n    $it.schema = $ruleValidate.validate;\n    $it.schemaPath = '';\n    var $wasComposite = it.compositeRule;\n    it.compositeRule = $it.compositeRule = true;\n    var $code = it.validate($it).replace(/validate\\.schema/g, $validateCode);\n    it.compositeRule = $it.compositeRule = $wasComposite;\n    out += ' ' + ($code);\n  } else {\n    var $$outStack = $$outStack || [];\n    $$outStack.push(out);\n    out = '';\n    out += '  ' + ($validateCode) + '.call( ';\n    if (it.opts.passContext) {\n      out += 'this';\n    } else {\n      out += 'self';\n    }\n    if ($compile || $rDef.schema === false) {\n      out += ' , ' + ($data) + ' ';\n    } else {\n      out += ' , ' + ($schemaValue) + ' , ' + ($data) + ' , validate.schema' + (it.schemaPath) + ' ';\n    }\n    out += ' , (dataPath || \\'\\')';\n    if (it.errorPath != '\"\"') {\n      out += ' + ' + (it.errorPath);\n    }\n    var $parentData = $dataLvl ? 'data' + (($dataLvl - 1) || '') : 'parentData',\n      $parentDataProperty = $dataLvl ? it.dataPathArr[$dataLvl] : 'parentDataProperty';\n    out += ' , ' + ($parentData) + ' , ' + ($parentDataProperty) + ' , rootData )  ';\n    var def_callRuleValidate = out;\n    out = $$outStack.pop();\n    if ($rDef.errors === false) {\n      out += ' ' + ($valid) + ' = ';\n      if ($asyncKeyword) {\n        out += 'await ';\n      }\n      out += '' + (def_callRuleValidate) + '; ';\n    } else {\n      if ($asyncKeyword) {\n        $ruleErrs = 'customErrors' + $lvl;\n        out += ' var ' + ($ruleErrs) + ' = null; try { ' + ($valid) + ' = await ' + (def_callRuleValidate) + '; } catch (e) { ' + ($valid) + ' = false; if (e instanceof ValidationError) ' + ($ruleErrs) + ' = e.errors; else throw e; } ';\n      } else {\n        out += ' ' + ($ruleErrs) + ' = null; ' + ($valid) + ' = ' + (def_callRuleValidate) + '; ';\n      }\n    }\n  }\n  if ($rDef.modifying) {\n    out += ' if (' + ($parentData) + ') ' + ($data) + ' = ' + ($parentData) + '[' + ($parentDataProperty) + '];';\n  }\n  out += '' + ($closingBraces);\n  if ($rDef.valid) {\n    if ($breakOnError) {\n      out += ' if (true) { ';\n    }\n  } else {\n    out += ' if ( ';\n    if ($rDef.valid === undefined) {\n      out += ' !';\n      if ($macro) {\n        out += '' + ($nextValid);\n      } else {\n        out += '' + ($valid);\n      }\n    } else {\n      out += ' ' + (!$rDef.valid) + ' ';\n    }\n    out += ') { ';\n    $errorKeyword = $rule.keyword;\n    var $$outStack = $$outStack || [];\n    $$outStack.push(out);\n    out = '';\n    var $$outStack = $$outStack || [];\n    $$outStack.push(out);\n    out = ''; /* istanbul ignore else */\n    if (it.createErrors !== false) {\n      out += ' { keyword: \\'' + ($errorKeyword || 'custom') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { keyword: \\'' + ($rule.keyword) + '\\' } ';\n      if (it.opts.messages !== false) {\n        out += ' , message: \\'should pass \"' + ($rule.keyword) + '\" keyword validation\\' ';\n      }\n      if (it.opts.verbose) {\n        out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n      }\n      out += ' } ';\n    } else {\n      out += ' {} ';\n    }\n    var __err = out;\n    out = $$outStack.pop();\n    if (!it.compositeRule && $breakOnError) {\n      /* istanbul ignore if */\n      if (it.async) {\n        out += ' throw new ValidationError([' + (__err) + ']); ';\n      } else {\n        out += ' validate.errors = [' + (__err) + ']; return false; ';\n      }\n    } else {\n      out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n    }\n    var def_customError = out;\n    out = $$outStack.pop();\n    if ($inline) {\n      if ($rDef.errors) {\n        if ($rDef.errors != 'full') {\n          out += '  for (var ' + ($i) + '=' + ($errs) + '; ' + ($i) + '<errors; ' + ($i) + '++) { var ' + ($ruleErr) + ' = vErrors[' + ($i) + ']; if (' + ($ruleErr) + '.dataPath === undefined) ' + ($ruleErr) + '.dataPath = (dataPath || \\'\\') + ' + (it.errorPath) + '; if (' + ($ruleErr) + '.schemaPath === undefined) { ' + ($ruleErr) + '.schemaPath = \"' + ($errSchemaPath) + '\"; } ';\n          if (it.opts.verbose) {\n            out += ' ' + ($ruleErr) + '.schema = ' + ($schemaValue) + '; ' + ($ruleErr) + '.data = ' + ($data) + '; ';\n          }\n          out += ' } ';\n        }\n      } else {\n        if ($rDef.errors === false) {\n          out += ' ' + (def_customError) + ' ';\n        } else {\n          out += ' if (' + ($errs) + ' == errors) { ' + (def_customError) + ' } else {  for (var ' + ($i) + '=' + ($errs) + '; ' + ($i) + '<errors; ' + ($i) + '++) { var ' + ($ruleErr) + ' = vErrors[' + ($i) + ']; if (' + ($ruleErr) + '.dataPath === undefined) ' + ($ruleErr) + '.dataPath = (dataPath || \\'\\') + ' + (it.errorPath) + '; if (' + ($ruleErr) + '.schemaPath === undefined) { ' + ($ruleErr) + '.schemaPath = \"' + ($errSchemaPath) + '\"; } ';\n          if (it.opts.verbose) {\n            out += ' ' + ($ruleErr) + '.schema = ' + ($schemaValue) + '; ' + ($ruleErr) + '.data = ' + ($data) + '; ';\n          }\n          out += ' } } ';\n        }\n      }\n    } else if ($macro) {\n      out += '   var err =   '; /* istanbul ignore else */\n      if (it.createErrors !== false) {\n        out += ' { keyword: \\'' + ($errorKeyword || 'custom') + '\\' , dataPath: (dataPath || \\'\\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: { keyword: \\'' + ($rule.keyword) + '\\' } ';\n        if (it.opts.messages !== false) {\n          out += ' , message: \\'should pass \"' + ($rule.keyword) + '\" keyword validation\\' ';\n        }\n        if (it.opts.verbose) {\n          out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';\n        }\n        out += ' } ';\n      } else {\n        out += ' {} ';\n      }\n      out += ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';\n      if (!it.compositeRule && $breakOnError) {\n        /* istanbul ignore if */\n        if (it.async) {\n          out += ' throw new ValidationError(vErrors); ';\n        } else {\n          out += ' validate.errors = vErrors; return false; ';\n        }\n      }\n    } else {\n      if ($rDef.errors === false) {\n        out += ' ' + (def_customError) + ' ';\n      } else {\n        out += ' if (Array.isArray(' + ($ruleErrs) + ')) { if (vErrors === null) vErrors = ' + ($ruleErrs) + '; else vErrors = vErrors.concat(' + ($ruleErrs) + '); errors = vErrors.length;  for (var ' + ($i) + '=' + ($errs) + '; ' + ($i) + '<errors; ' + ($i) + '++) { var ' + ($ruleErr) + ' = vErrors[' + ($i) + ']; if (' + ($ruleErr) + '.dataPath === undefined) ' + ($ruleErr) + '.dataPath = (dataPath || \\'\\') + ' + (it.errorPath) + ';  ' + ($ruleErr) + '.schemaPath = \"' + ($errSchemaPath) + '\";  ';\n        if (it.opts.verbose) {\n          out += ' ' + ($ruleErr) + '.schema = ' + ($schemaValue) + '; ' + ($ruleErr) + '.data = ' + ($data) + '; ';\n        }\n        out += ' } } else { ' + (def_customError) + ' } ';\n      }\n    }\n    out += ' } ';\n    if ($breakOnError) {\n      out += ' else { ';\n    }\n  }\n  return out;\n}\n","'use strict';\n\nvar metaSchema = require('./refs/json-schema-draft-07.json');\n\nmodule.exports = {\n  $id: 'https://github.com/epoberezkin/ajv/blob/master/lib/definition_schema.js',\n  definitions: {\n    simpleTypes: metaSchema.definitions.simpleTypes\n  },\n  type: 'object',\n  dependencies: {\n    schema: ['validate'],\n    $data: ['validate'],\n    statements: ['inline'],\n    valid: {not: {required: ['macro']}}\n  },\n  properties: {\n    type: metaSchema.properties.type,\n    schema: {type: 'boolean'},\n    statements: {type: 'boolean'},\n    dependencies: {\n      type: 'array',\n      items: {type: 'string'}\n    },\n    metaSchema: {type: 'object'},\n    modifying: {type: 'boolean'},\n    valid: {type: 'boolean'},\n    $data: {type: 'boolean'},\n    async: {type: 'boolean'},\n    errors: {\n      anyOf: [\n        {type: 'boolean'},\n        {const: 'full'}\n      ]\n    }\n  }\n};\n","'use strict';\n\nvar IDENTIFIER = /^[a-z_$][a-z0-9_$-]*$/i;\nvar customRuleCode = require('./dotjs/custom');\nvar definitionSchema = require('./definition_schema');\n\nmodule.exports = {\n  add: addKeyword,\n  get: getKeyword,\n  remove: removeKeyword,\n  validate: validateKeyword\n};\n\n\n/**\n * Define custom keyword\n * @this  Ajv\n * @param {String} keyword custom keyword, should be unique (including different from all standard, custom and macro keywords).\n * @param {Object} definition keyword definition object with properties `type` (type(s) which the keyword applies to), `validate` or `compile`.\n * @return {Ajv} this for method chaining\n */\nfunction addKeyword(keyword, definition) {\n  /* jshint validthis: true */\n  /* eslint no-shadow: 0 */\n  var RULES = this.RULES;\n  if (RULES.keywords[keyword])\n    throw new Error('Keyword ' + keyword + ' is already defined');\n\n  if (!IDENTIFIER.test(keyword))\n    throw new Error('Keyword ' + keyword + ' is not a valid identifier');\n\n  if (definition) {\n    this.validateKeyword(definition, true);\n\n    var dataType = definition.type;\n    if (Array.isArray(dataType)) {\n      for (var i=0; i<dataType.length; i++)\n        _addRule(keyword, dataType[i], definition);\n    } else {\n      _addRule(keyword, dataType, definition);\n    }\n\n    var metaSchema = definition.metaSchema;\n    if (metaSchema) {\n      if (definition.$data && this._opts.$data) {\n        metaSchema = {\n          anyOf: [\n            metaSchema,\n            { '$ref': 'https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/data.json#' }\n          ]\n        };\n      }\n      definition.validateSchema = this.compile(metaSchema, true);\n    }\n  }\n\n  RULES.keywords[keyword] = RULES.all[keyword] = true;\n\n\n  function _addRule(keyword, dataType, definition) {\n    var ruleGroup;\n    for (var i=0; i<RULES.length; i++) {\n      var rg = RULES[i];\n      if (rg.type == dataType) {\n        ruleGroup = rg;\n        break;\n      }\n    }\n\n    if (!ruleGroup) {\n      ruleGroup = { type: dataType, rules: [] };\n      RULES.push(ruleGroup);\n    }\n\n    var rule = {\n      keyword: keyword,\n      definition: definition,\n      custom: true,\n      code: customRuleCode,\n      implements: definition.implements\n    };\n    ruleGroup.rules.push(rule);\n    RULES.custom[keyword] = rule;\n  }\n\n  return this;\n}\n\n\n/**\n * Get keyword\n * @this  Ajv\n * @param {String} keyword pre-defined or custom keyword.\n * @return {Object|Boolean} custom keyword definition, `true` if it is a predefined keyword, `false` otherwise.\n */\nfunction getKeyword(keyword) {\n  /* jshint validthis: true */\n  var rule = this.RULES.custom[keyword];\n  return rule ? rule.definition : this.RULES.keywords[keyword] || false;\n}\n\n\n/**\n * Remove keyword\n * @this  Ajv\n * @param {String} keyword pre-defined or custom keyword.\n * @return {Ajv} this for method chaining\n */\nfunction removeKeyword(keyword) {\n  /* jshint validthis: true */\n  var RULES = this.RULES;\n  delete RULES.keywords[keyword];\n  delete RULES.all[keyword];\n  delete RULES.custom[keyword];\n  for (var i=0; i<RULES.length; i++) {\n    var rules = RULES[i].rules;\n    for (var j=0; j<rules.length; j++) {\n      if (rules[j].keyword == keyword) {\n        rules.splice(j, 1);\n        break;\n      }\n    }\n  }\n  return this;\n}\n\n\n/**\n * Validate keyword definition\n * @this  Ajv\n * @param {Object} definition keyword definition object.\n * @param {Boolean} throwError true to throw exception if definition is invalid\n * @return {boolean} validation result\n */\nfunction validateKeyword(definition, throwError) {\n  validateKeyword.errors = null;\n  var v = this._validateKeyword = this._validateKeyword\n                                  || this.compile(definitionSchema, true);\n\n  if (v(definition)) return true;\n  validateKeyword.errors = v.errors;\n  if (throwError)\n    throw new Error('custom keyword definition is invalid: '  + this.errorsText(v.errors));\n  else\n    return false;\n}\n","'use strict';\n\nvar compileSchema = require('./compile')\n  , resolve = require('./compile/resolve')\n  , Cache = require('./cache')\n  , SchemaObject = require('./compile/schema_obj')\n  , stableStringify = require('fast-json-stable-stringify')\n  , formats = require('./compile/formats')\n  , rules = require('./compile/rules')\n  , $dataMetaSchema = require('./data')\n  , util = require('./compile/util');\n\nmodule.exports = Ajv;\n\nAjv.prototype.validate = validate;\nAjv.prototype.compile = compile;\nAjv.prototype.addSchema = addSchema;\nAjv.prototype.addMetaSchema = addMetaSchema;\nAjv.prototype.validateSchema = validateSchema;\nAjv.prototype.getSchema = getSchema;\nAjv.prototype.removeSchema = removeSchema;\nAjv.prototype.addFormat = addFormat;\nAjv.prototype.errorsText = errorsText;\n\nAjv.prototype._addSchema = _addSchema;\nAjv.prototype._compile = _compile;\n\nAjv.prototype.compileAsync = require('./compile/async');\nvar customKeyword = require('./keyword');\nAjv.prototype.addKeyword = customKeyword.add;\nAjv.prototype.getKeyword = customKeyword.get;\nAjv.prototype.removeKeyword = customKeyword.remove;\nAjv.prototype.validateKeyword = customKeyword.validate;\n\nvar errorClasses = require('./compile/error_classes');\nAjv.ValidationError = errorClasses.Validation;\nAjv.MissingRefError = errorClasses.MissingRef;\nAjv.$dataMetaSchema = $dataMetaSchema;\n\nvar META_SCHEMA_ID = 'http://json-schema.org/draft-07/schema';\n\nvar META_IGNORE_OPTIONS = [ 'removeAdditional', 'useDefaults', 'coerceTypes', 'strictDefaults' ];\nvar META_SUPPORT_DATA = ['/properties'];\n\n/**\n * Creates validator instance.\n * Usage: `Ajv(opts)`\n * @param {Object} opts optional options\n * @return {Object} ajv instance\n */\nfunction Ajv(opts) {\n  if (!(this instanceof Ajv)) return new Ajv(opts);\n  opts = this._opts = util.copy(opts) || {};\n  setLogger(this);\n  this._schemas = {};\n  this._refs = {};\n  this._fragments = {};\n  this._formats = formats(opts.format);\n\n  this._cache = opts.cache || new Cache;\n  this._loadingSchemas = {};\n  this._compilations = [];\n  this.RULES = rules();\n  this._getId = chooseGetId(opts);\n\n  opts.loopRequired = opts.loopRequired || Infinity;\n  if (opts.errorDataPath == 'property') opts._errorDataPathProperty = true;\n  if (opts.serialize === undefined) opts.serialize = stableStringify;\n  this._metaOpts = getMetaSchemaOptions(this);\n\n  if (opts.formats) addInitialFormats(this);\n  if (opts.keywords) addInitialKeywords(this);\n  addDefaultMetaSchema(this);\n  if (typeof opts.meta == 'object') this.addMetaSchema(opts.meta);\n  if (opts.nullable) this.addKeyword('nullable', {metaSchema: {type: 'boolean'}});\n  addInitialSchemas(this);\n}\n\n\n\n/**\n * Validate data using schema\n * Schema will be compiled and cached (using serialized JSON as key. [fast-json-stable-stringify](https://github.com/epoberezkin/fast-json-stable-stringify) is used to serialize.\n * @this   Ajv\n * @param  {String|Object} schemaKeyRef key, ref or schema object\n * @param  {Any} data to be validated\n * @return {Boolean} validation result. Errors from the last validation will be available in `ajv.errors` (and also in compiled schema: `schema.errors`).\n */\nfunction validate(schemaKeyRef, data) {\n  var v;\n  if (typeof schemaKeyRef == 'string') {\n    v = this.getSchema(schemaKeyRef);\n    if (!v) throw new Error('no schema with key or ref \"' + schemaKeyRef + '\"');\n  } else {\n    var schemaObj = this._addSchema(schemaKeyRef);\n    v = schemaObj.validate || this._compile(schemaObj);\n  }\n\n  var valid = v(data);\n  if (v.$async !== true) this.errors = v.errors;\n  return valid;\n}\n\n\n/**\n * Create validating function for passed schema.\n * @this   Ajv\n * @param  {Object} schema schema object\n * @param  {Boolean} _meta true if schema is a meta-schema. Used internally to compile meta schemas of custom keywords.\n * @return {Function} validating function\n */\nfunction compile(schema, _meta) {\n  var schemaObj = this._addSchema(schema, undefined, _meta);\n  return schemaObj.validate || this._compile(schemaObj);\n}\n\n\n/**\n * Adds schema to the instance.\n * @this   Ajv\n * @param {Object|Array} schema schema or array of schemas. If array is passed, `key` and other parameters will be ignored.\n * @param {String} key Optional schema key. Can be passed to `validate` method instead of schema object or id/ref. One schema per instance can have empty `id` and `key`.\n * @param {Boolean} _skipValidation true to skip schema validation. Used internally, option validateSchema should be used instead.\n * @param {Boolean} _meta true if schema is a meta-schema. Used internally, addMetaSchema should be used instead.\n * @return {Ajv} this for method chaining\n */\nfunction addSchema(schema, key, _skipValidation, _meta) {\n  if (Array.isArray(schema)){\n    for (var i=0; i<schema.length; i++) this.addSchema(schema[i], undefined, _skipValidation, _meta);\n    return this;\n  }\n  var id = this._getId(schema);\n  if (id !== undefined && typeof id != 'string')\n    throw new Error('schema id must be string');\n  key = resolve.normalizeId(key || id);\n  checkUnique(this, key);\n  this._schemas[key] = this._addSchema(schema, _skipValidation, _meta, true);\n  return this;\n}\n\n\n/**\n * Add schema that will be used to validate other schemas\n * options in META_IGNORE_OPTIONS are alway set to false\n * @this   Ajv\n * @param {Object} schema schema object\n * @param {String} key optional schema key\n * @param {Boolean} skipValidation true to skip schema validation, can be used to override validateSchema option for meta-schema\n * @return {Ajv} this for method chaining\n */\nfunction addMetaSchema(schema, key, skipValidation) {\n  this.addSchema(schema, key, skipValidation, true);\n  return this;\n}\n\n\n/**\n * Validate schema\n * @this   Ajv\n * @param {Object} schema schema to validate\n * @param {Boolean} throwOrLogError pass true to throw (or log) an error if invalid\n * @return {Boolean} true if schema is valid\n */\nfunction validateSchema(schema, throwOrLogError) {\n  var $schema = schema.$schema;\n  if ($schema !== undefined && typeof $schema != 'string')\n    throw new Error('$schema must be a string');\n  $schema = $schema || this._opts.defaultMeta || defaultMeta(this);\n  if (!$schema) {\n    this.logger.warn('meta-schema not available');\n    this.errors = null;\n    return true;\n  }\n  var valid = this.validate($schema, schema);\n  if (!valid && throwOrLogError) {\n    var message = 'schema is invalid: ' + this.errorsText();\n    if (this._opts.validateSchema == 'log') this.logger.error(message);\n    else throw new Error(message);\n  }\n  return valid;\n}\n\n\nfunction defaultMeta(self) {\n  var meta = self._opts.meta;\n  self._opts.defaultMeta = typeof meta == 'object'\n                            ? self._getId(meta) || meta\n                            : self.getSchema(META_SCHEMA_ID)\n                              ? META_SCHEMA_ID\n                              : undefined;\n  return self._opts.defaultMeta;\n}\n\n\n/**\n * Get compiled schema from the instance by `key` or `ref`.\n * @this   Ajv\n * @param  {String} keyRef `key` that was passed to `addSchema` or full schema reference (`schema.id` or resolved id).\n * @return {Function} schema validating function (with property `schema`).\n */\nfunction getSchema(keyRef) {\n  var schemaObj = _getSchemaObj(this, keyRef);\n  switch (typeof schemaObj) {\n    case 'object': return schemaObj.validate || this._compile(schemaObj);\n    case 'string': return this.getSchema(schemaObj);\n    case 'undefined': return _getSchemaFragment(this, keyRef);\n  }\n}\n\n\nfunction _getSchemaFragment(self, ref) {\n  var res = resolve.schema.call(self, { schema: {} }, ref);\n  if (res) {\n    var schema = res.schema\n      , root = res.root\n      , baseId = res.baseId;\n    var v = compileSchema.call(self, schema, root, undefined, baseId);\n    self._fragments[ref] = new SchemaObject({\n      ref: ref,\n      fragment: true,\n      schema: schema,\n      root: root,\n      baseId: baseId,\n      validate: v\n    });\n    return v;\n  }\n}\n\n\nfunction _getSchemaObj(self, keyRef) {\n  keyRef = resolve.normalizeId(keyRef);\n  return self._schemas[keyRef] || self._refs[keyRef] || self._fragments[keyRef];\n}\n\n\n/**\n * Remove cached schema(s).\n * If no parameter is passed all schemas but meta-schemas are removed.\n * If RegExp is passed all schemas with key/id matching pattern but meta-schemas are removed.\n * Even if schema is referenced by other schemas it still can be removed as other schemas have local references.\n * @this   Ajv\n * @param  {String|Object|RegExp} schemaKeyRef key, ref, pattern to match key/ref or schema object\n * @return {Ajv} this for method chaining\n */\nfunction removeSchema(schemaKeyRef) {\n  if (schemaKeyRef instanceof RegExp) {\n    _removeAllSchemas(this, this._schemas, schemaKeyRef);\n    _removeAllSchemas(this, this._refs, schemaKeyRef);\n    return this;\n  }\n  switch (typeof schemaKeyRef) {\n    case 'undefined':\n      _removeAllSchemas(this, this._schemas);\n      _removeAllSchemas(this, this._refs);\n      this._cache.clear();\n      return this;\n    case 'string':\n      var schemaObj = _getSchemaObj(this, schemaKeyRef);\n      if (schemaObj) this._cache.del(schemaObj.cacheKey);\n      delete this._schemas[schemaKeyRef];\n      delete this._refs[schemaKeyRef];\n      return this;\n    case 'object':\n      var serialize = this._opts.serialize;\n      var cacheKey = serialize ? serialize(schemaKeyRef) : schemaKeyRef;\n      this._cache.del(cacheKey);\n      var id = this._getId(schemaKeyRef);\n      if (id) {\n        id = resolve.normalizeId(id);\n        delete this._schemas[id];\n        delete this._refs[id];\n      }\n  }\n  return this;\n}\n\n\nfunction _removeAllSchemas(self, schemas, regex) {\n  for (var keyRef in schemas) {\n    var schemaObj = schemas[keyRef];\n    if (!schemaObj.meta && (!regex || regex.test(keyRef))) {\n      self._cache.del(schemaObj.cacheKey);\n      delete schemas[keyRef];\n    }\n  }\n}\n\n\n/* @this   Ajv */\nfunction _addSchema(schema, skipValidation, meta, shouldAddSchema) {\n  if (typeof schema != 'object' && typeof schema != 'boolean')\n    throw new Error('schema should be object or boolean');\n  var serialize = this._opts.serialize;\n  var cacheKey = serialize ? serialize(schema) : schema;\n  var cached = this._cache.get(cacheKey);\n  if (cached) return cached;\n\n  shouldAddSchema = shouldAddSchema || this._opts.addUsedSchema !== false;\n\n  var id = resolve.normalizeId(this._getId(schema));\n  if (id && shouldAddSchema) checkUnique(this, id);\n\n  var willValidate = this._opts.validateSchema !== false && !skipValidation;\n  var recursiveMeta;\n  if (willValidate && !(recursiveMeta = id && id == resolve.normalizeId(schema.$schema)))\n    this.validateSchema(schema, true);\n\n  var localRefs = resolve.ids.call(this, schema);\n\n  var schemaObj = new SchemaObject({\n    id: id,\n    schema: schema,\n    localRefs: localRefs,\n    cacheKey: cacheKey,\n    meta: meta\n  });\n\n  if (id[0] != '#' && shouldAddSchema) this._refs[id] = schemaObj;\n  this._cache.put(cacheKey, schemaObj);\n\n  if (willValidate && recursiveMeta) this.validateSchema(schema, true);\n\n  return schemaObj;\n}\n\n\n/* @this   Ajv */\nfunction _compile(schemaObj, root) {\n  if (schemaObj.compiling) {\n    schemaObj.validate = callValidate;\n    callValidate.schema = schemaObj.schema;\n    callValidate.errors = null;\n    callValidate.root = root ? root : callValidate;\n    if (schemaObj.schema.$async === true)\n      callValidate.$async = true;\n    return callValidate;\n  }\n  schemaObj.compiling = true;\n\n  var currentOpts;\n  if (schemaObj.meta) {\n    currentOpts = this._opts;\n    this._opts = this._metaOpts;\n  }\n\n  var v;\n  try { v = compileSchema.call(this, schemaObj.schema, root, schemaObj.localRefs); }\n  catch(e) {\n    delete schemaObj.validate;\n    throw e;\n  }\n  finally {\n    schemaObj.compiling = false;\n    if (schemaObj.meta) this._opts = currentOpts;\n  }\n\n  schemaObj.validate = v;\n  schemaObj.refs = v.refs;\n  schemaObj.refVal = v.refVal;\n  schemaObj.root = v.root;\n  return v;\n\n\n  /* @this   {*} - custom context, see passContext option */\n  function callValidate() {\n    /* jshint validthis: true */\n    var _validate = schemaObj.validate;\n    var result = _validate.apply(this, arguments);\n    callValidate.errors = _validate.errors;\n    return result;\n  }\n}\n\n\nfunction chooseGetId(opts) {\n  switch (opts.schemaId) {\n    case 'auto': return _get$IdOrId;\n    case 'id': return _getId;\n    default: return _get$Id;\n  }\n}\n\n/* @this   Ajv */\nfunction _getId(schema) {\n  if (schema.$id) this.logger.warn('schema $id ignored', schema.$id);\n  return schema.id;\n}\n\n/* @this   Ajv */\nfunction _get$Id(schema) {\n  if (schema.id) this.logger.warn('schema id ignored', schema.id);\n  return schema.$id;\n}\n\n\nfunction _get$IdOrId(schema) {\n  if (schema.$id && schema.id && schema.$id != schema.id)\n    throw new Error('schema $id is different from id');\n  return schema.$id || schema.id;\n}\n\n\n/**\n * Convert array of error message objects to string\n * @this   Ajv\n * @param  {Array<Object>} errors optional array of validation errors, if not passed errors from the instance are used.\n * @param  {Object} options optional options with properties `separator` and `dataVar`.\n * @return {String} human readable string with all errors descriptions\n */\nfunction errorsText(errors, options) {\n  errors = errors || this.errors;\n  if (!errors) return 'No errors';\n  options = options || {};\n  var separator = options.separator === undefined ? ', ' : options.separator;\n  var dataVar = options.dataVar === undefined ? 'data' : options.dataVar;\n\n  var text = '';\n  for (var i=0; i<errors.length; i++) {\n    var e = errors[i];\n    if (e) text += dataVar + e.dataPath + ' ' + e.message + separator;\n  }\n  return text.slice(0, -separator.length);\n}\n\n\n/**\n * Add custom format\n * @this   Ajv\n * @param {String} name format name\n * @param {String|RegExp|Function} format string is converted to RegExp; function should return boolean (true when valid)\n * @return {Ajv} this for method chaining\n */\nfunction addFormat(name, format) {\n  if (typeof format == 'string') format = new RegExp(format);\n  this._formats[name] = format;\n  return this;\n}\n\n\nfunction addDefaultMetaSchema(self) {\n  var $dataSchema;\n  if (self._opts.$data) {\n    $dataSchema = require('./refs/data.json');\n    self.addMetaSchema($dataSchema, $dataSchema.$id, true);\n  }\n  if (self._opts.meta === false) return;\n  var metaSchema = require('./refs/json-schema-draft-07.json');\n  if (self._opts.$data) metaSchema = $dataMetaSchema(metaSchema, META_SUPPORT_DATA);\n  self.addMetaSchema(metaSchema, META_SCHEMA_ID, true);\n  self._refs['http://json-schema.org/schema'] = META_SCHEMA_ID;\n}\n\n\nfunction addInitialSchemas(self) {\n  var optsSchemas = self._opts.schemas;\n  if (!optsSchemas) return;\n  if (Array.isArray(optsSchemas)) self.addSchema(optsSchemas);\n  else for (var key in optsSchemas) self.addSchema(optsSchemas[key], key);\n}\n\n\nfunction addInitialFormats(self) {\n  for (var name in self._opts.formats) {\n    var format = self._opts.formats[name];\n    self.addFormat(name, format);\n  }\n}\n\n\nfunction addInitialKeywords(self) {\n  for (var name in self._opts.keywords) {\n    var keyword = self._opts.keywords[name];\n    self.addKeyword(name, keyword);\n  }\n}\n\n\nfunction checkUnique(self, id) {\n  if (self._schemas[id] || self._refs[id])\n    throw new Error('schema with key or id \"' + id + '\" already exists');\n}\n\n\nfunction getMetaSchemaOptions(self) {\n  var metaOpts = util.copy(self._opts);\n  for (var i=0; i<META_IGNORE_OPTIONS.length; i++)\n    delete metaOpts[META_IGNORE_OPTIONS[i]];\n  return metaOpts;\n}\n\n\nfunction setLogger(self) {\n  var logger = self._opts.logger;\n  if (logger === false) {\n    self.logger = {log: noop, warn: noop, error: noop};\n  } else {\n    if (logger === undefined) logger = console;\n    if (!(typeof logger == 'object' && logger.log && logger.warn && logger.error))\n      throw new Error('logger must implement log, warn and error methods');\n    self.logger = logger;\n  }\n}\n\n\nfunction noop() {}\n","export var RawCode = 'RawCode';\nexport var Literal = 'Literal';\nexport var Property = 'Property';\nexport var Identifier = 'Identifier';\n\nexport var ArrayExpression = 'ArrayExpression';\nexport var BinaryExpression = 'BinaryExpression';\nexport var CallExpression = 'CallExpression';\nexport var ConditionalExpression = 'ConditionalExpression';\nexport var LogicalExpression = 'LogicalExpression';\nexport var MemberExpression = 'MemberExpression';\nexport var ObjectExpression = 'ObjectExpression';\nexport var UnaryExpression = 'UnaryExpression';\n\nexport default function ASTNode(type) {\n  this.type = type;\n}\n\nASTNode.prototype.visit = function(visitor) {\n  var node = this, c, i, n;\n\n  if (visitor(node)) return 1;\n\n  for (c=children(node), i=0, n=c.length; i<n; ++i) {\n    if (c[i].visit(visitor)) return 1;\n  }\n};\n\nfunction children(node) {\n  switch (node.type) {\n    case ArrayExpression:\n      return node.elements;\n    case BinaryExpression:\n    case LogicalExpression:\n      return [node.left, node.right];\n    case CallExpression:\n      var args = node.arguments.slice();\n      args.unshift(node.callee);\n      return args;\n    case ConditionalExpression:\n      return [node.test, node.consequent, node.alternate];\n    case MemberExpression:\n      return [node.object, node.property];\n    case ObjectExpression:\n      return node.properties;\n    case Property:\n      return [node.key, node.value];\n    case UnaryExpression:\n      return [node.argument];\n    case Identifier:\n    case Literal:\n    case RawCode:\n    default:\n      return [];\n  }\n}\n","/*\n  The following expression parser is based on Esprima (http://esprima.org/).\n  Original header comment and license for Esprima is included here:\n\n  Copyright (C) 2013 Ariya Hidayat <ariya.hidayat@gmail.com>\n  Copyright (C) 2013 Thaddee Tyl <thaddee.tyl@gmail.com>\n  Copyright (C) 2013 Mathias Bynens <mathias@qiwi.be>\n  Copyright (C) 2012 Ariya Hidayat <ariya.hidayat@gmail.com>\n  Copyright (C) 2012 Mathias Bynens <mathias@qiwi.be>\n  Copyright (C) 2012 Joost-Wim Boekesteijn <joost-wim@boekesteijn.nl>\n  Copyright (C) 2012 Kris Kowal <kris.kowal@cixar.com>\n  Copyright (C) 2012 Yusuke Suzuki <utatane.tea@gmail.com>\n  Copyright (C) 2012 Arpad Borsos <arpad.borsos@googlemail.com>\n  Copyright (C) 2011 Ariya Hidayat <ariya.hidayat@gmail.com>\n\n  Redistribution and use in source and binary forms, with or without\n  modification, are permitted provided that the following conditions are met:\n\n    * Redistributions of source code must retain the above copyright\n      notice, this list of conditions and the following disclaimer.\n    * Redistributions in binary form must reproduce the above copyright\n      notice, this list of conditions and the following disclaimer in the\n      documentation and/or other materials provided with the distribution.\n\n  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n  ARE DISCLAIMED. IN NO EVENT SHALL <COPYRIGHT HOLDER> BE LIABLE FOR ANY\n  DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n  (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\n  THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\nimport ASTNode from './ast';\n\nvar TokenName,\n    source,\n    index,\n    length,\n    lookahead;\n\nvar TokenBooleanLiteral = 1,\n    TokenEOF = 2,\n    TokenIdentifier = 3,\n    TokenKeyword = 4,\n    TokenNullLiteral = 5,\n    TokenNumericLiteral = 6,\n    TokenPunctuator = 7,\n    TokenStringLiteral = 8,\n    TokenRegularExpression = 9;\n\nTokenName = {};\nTokenName[TokenBooleanLiteral] = 'Boolean';\nTokenName[TokenEOF] = '<end>';\nTokenName[TokenIdentifier] = 'Identifier';\nTokenName[TokenKeyword] = 'Keyword';\nTokenName[TokenNullLiteral] = 'Null';\nTokenName[TokenNumericLiteral] = 'Numeric';\nTokenName[TokenPunctuator] = 'Punctuator';\nTokenName[TokenStringLiteral] = 'String';\nTokenName[TokenRegularExpression] = 'RegularExpression';\n\nvar SyntaxArrayExpression = 'ArrayExpression',\n    SyntaxBinaryExpression = 'BinaryExpression',\n    SyntaxCallExpression = 'CallExpression',\n    SyntaxConditionalExpression = 'ConditionalExpression',\n    SyntaxIdentifier = 'Identifier',\n    SyntaxLiteral = 'Literal',\n    SyntaxLogicalExpression = 'LogicalExpression',\n    SyntaxMemberExpression = 'MemberExpression',\n    SyntaxObjectExpression = 'ObjectExpression',\n    SyntaxProperty = 'Property',\n    SyntaxUnaryExpression = 'UnaryExpression';\n\n// Error messages should be identical to V8.\nvar MessageUnexpectedToken = 'Unexpected token %0',\n    MessageUnexpectedNumber = 'Unexpected number',\n    MessageUnexpectedString = 'Unexpected string',\n    MessageUnexpectedIdentifier = 'Unexpected identifier',\n    MessageUnexpectedReserved = 'Unexpected reserved word',\n    MessageUnexpectedEOS = 'Unexpected end of input',\n    MessageInvalidRegExp = 'Invalid regular expression',\n    MessageUnterminatedRegExp = 'Invalid regular expression: missing /',\n    MessageStrictOctalLiteral = 'Octal literals are not allowed in strict mode.',\n    MessageStrictDuplicateProperty = 'Duplicate data property in object literal not allowed in strict mode';\n\nvar ILLEGAL = 'ILLEGAL',\n    DISABLED = 'Disabled.';\n\n// See also tools/generate-unicode-regex.py.\nvar RegexNonAsciiIdentifierStart = new RegExp(\"[\\\\xAA\\\\xB5\\\\xBA\\\\xC0-\\\\xD6\\\\xD8-\\\\xF6\\\\xF8-\\\\u02C1\\\\u02C6-\\\\u02D1\\\\u02E0-\\\\u02E4\\\\u02EC\\\\u02EE\\\\u0370-\\\\u0374\\\\u0376\\\\u0377\\\\u037A-\\\\u037D\\\\u037F\\\\u0386\\\\u0388-\\\\u038A\\\\u038C\\\\u038E-\\\\u03A1\\\\u03A3-\\\\u03F5\\\\u03F7-\\\\u0481\\\\u048A-\\\\u052F\\\\u0531-\\\\u0556\\\\u0559\\\\u0561-\\\\u0587\\\\u05D0-\\\\u05EA\\\\u05F0-\\\\u05F2\\\\u0620-\\\\u064A\\\\u066E\\\\u066F\\\\u0671-\\\\u06D3\\\\u06D5\\\\u06E5\\\\u06E6\\\\u06EE\\\\u06EF\\\\u06FA-\\\\u06FC\\\\u06FF\\\\u0710\\\\u0712-\\\\u072F\\\\u074D-\\\\u07A5\\\\u07B1\\\\u07CA-\\\\u07EA\\\\u07F4\\\\u07F5\\\\u07FA\\\\u0800-\\\\u0815\\\\u081A\\\\u0824\\\\u0828\\\\u0840-\\\\u0858\\\\u08A0-\\\\u08B2\\\\u0904-\\\\u0939\\\\u093D\\\\u0950\\\\u0958-\\\\u0961\\\\u0971-\\\\u0980\\\\u0985-\\\\u098C\\\\u098F\\\\u0990\\\\u0993-\\\\u09A8\\\\u09AA-\\\\u09B0\\\\u09B2\\\\u09B6-\\\\u09B9\\\\u09BD\\\\u09CE\\\\u09DC\\\\u09DD\\\\u09DF-\\\\u09E1\\\\u09F0\\\\u09F1\\\\u0A05-\\\\u0A0A\\\\u0A0F\\\\u0A10\\\\u0A13-\\\\u0A28\\\\u0A2A-\\\\u0A30\\\\u0A32\\\\u0A33\\\\u0A35\\\\u0A36\\\\u0A38\\\\u0A39\\\\u0A59-\\\\u0A5C\\\\u0A5E\\\\u0A72-\\\\u0A74\\\\u0A85-\\\\u0A8D\\\\u0A8F-\\\\u0A91\\\\u0A93-\\\\u0AA8\\\\u0AAA-\\\\u0AB0\\\\u0AB2\\\\u0AB3\\\\u0AB5-\\\\u0AB9\\\\u0ABD\\\\u0AD0\\\\u0AE0\\\\u0AE1\\\\u0B05-\\\\u0B0C\\\\u0B0F\\\\u0B10\\\\u0B13-\\\\u0B28\\\\u0B2A-\\\\u0B30\\\\u0B32\\\\u0B33\\\\u0B35-\\\\u0B39\\\\u0B3D\\\\u0B5C\\\\u0B5D\\\\u0B5F-\\\\u0B61\\\\u0B71\\\\u0B83\\\\u0B85-\\\\u0B8A\\\\u0B8E-\\\\u0B90\\\\u0B92-\\\\u0B95\\\\u0B99\\\\u0B9A\\\\u0B9C\\\\u0B9E\\\\u0B9F\\\\u0BA3\\\\u0BA4\\\\u0BA8-\\\\u0BAA\\\\u0BAE-\\\\u0BB9\\\\u0BD0\\\\u0C05-\\\\u0C0C\\\\u0C0E-\\\\u0C10\\\\u0C12-\\\\u0C28\\\\u0C2A-\\\\u0C39\\\\u0C3D\\\\u0C58\\\\u0C59\\\\u0C60\\\\u0C61\\\\u0C85-\\\\u0C8C\\\\u0C8E-\\\\u0C90\\\\u0C92-\\\\u0CA8\\\\u0CAA-\\\\u0CB3\\\\u0CB5-\\\\u0CB9\\\\u0CBD\\\\u0CDE\\\\u0CE0\\\\u0CE1\\\\u0CF1\\\\u0CF2\\\\u0D05-\\\\u0D0C\\\\u0D0E-\\\\u0D10\\\\u0D12-\\\\u0D3A\\\\u0D3D\\\\u0D4E\\\\u0D60\\\\u0D61\\\\u0D7A-\\\\u0D7F\\\\u0D85-\\\\u0D96\\\\u0D9A-\\\\u0DB1\\\\u0DB3-\\\\u0DBB\\\\u0DBD\\\\u0DC0-\\\\u0DC6\\\\u0E01-\\\\u0E30\\\\u0E32\\\\u0E33\\\\u0E40-\\\\u0E46\\\\u0E81\\\\u0E82\\\\u0E84\\\\u0E87\\\\u0E88\\\\u0E8A\\\\u0E8D\\\\u0E94-\\\\u0E97\\\\u0E99-\\\\u0E9F\\\\u0EA1-\\\\u0EA3\\\\u0EA5\\\\u0EA7\\\\u0EAA\\\\u0EAB\\\\u0EAD-\\\\u0EB0\\\\u0EB2\\\\u0EB3\\\\u0EBD\\\\u0EC0-\\\\u0EC4\\\\u0EC6\\\\u0EDC-\\\\u0EDF\\\\u0F00\\\\u0F40-\\\\u0F47\\\\u0F49-\\\\u0F6C\\\\u0F88-\\\\u0F8C\\\\u1000-\\\\u102A\\\\u103F\\\\u1050-\\\\u1055\\\\u105A-\\\\u105D\\\\u1061\\\\u1065\\\\u1066\\\\u106E-\\\\u1070\\\\u1075-\\\\u1081\\\\u108E\\\\u10A0-\\\\u10C5\\\\u10C7\\\\u10CD\\\\u10D0-\\\\u10FA\\\\u10FC-\\\\u1248\\\\u124A-\\\\u124D\\\\u1250-\\\\u1256\\\\u1258\\\\u125A-\\\\u125D\\\\u1260-\\\\u1288\\\\u128A-\\\\u128D\\\\u1290-\\\\u12B0\\\\u12B2-\\\\u12B5\\\\u12B8-\\\\u12BE\\\\u12C0\\\\u12C2-\\\\u12C5\\\\u12C8-\\\\u12D6\\\\u12D8-\\\\u1310\\\\u1312-\\\\u1315\\\\u1318-\\\\u135A\\\\u1380-\\\\u138F\\\\u13A0-\\\\u13F4\\\\u1401-\\\\u166C\\\\u166F-\\\\u167F\\\\u1681-\\\\u169A\\\\u16A0-\\\\u16EA\\\\u16EE-\\\\u16F8\\\\u1700-\\\\u170C\\\\u170E-\\\\u1711\\\\u1720-\\\\u1731\\\\u1740-\\\\u1751\\\\u1760-\\\\u176C\\\\u176E-\\\\u1770\\\\u1780-\\\\u17B3\\\\u17D7\\\\u17DC\\\\u1820-\\\\u1877\\\\u1880-\\\\u18A8\\\\u18AA\\\\u18B0-\\\\u18F5\\\\u1900-\\\\u191E\\\\u1950-\\\\u196D\\\\u1970-\\\\u1974\\\\u1980-\\\\u19AB\\\\u19C1-\\\\u19C7\\\\u1A00-\\\\u1A16\\\\u1A20-\\\\u1A54\\\\u1AA7\\\\u1B05-\\\\u1B33\\\\u1B45-\\\\u1B4B\\\\u1B83-\\\\u1BA0\\\\u1BAE\\\\u1BAF\\\\u1BBA-\\\\u1BE5\\\\u1C00-\\\\u1C23\\\\u1C4D-\\\\u1C4F\\\\u1C5A-\\\\u1C7D\\\\u1CE9-\\\\u1CEC\\\\u1CEE-\\\\u1CF1\\\\u1CF5\\\\u1CF6\\\\u1D00-\\\\u1DBF\\\\u1E00-\\\\u1F15\\\\u1F18-\\\\u1F1D\\\\u1F20-\\\\u1F45\\\\u1F48-\\\\u1F4D\\\\u1F50-\\\\u1F57\\\\u1F59\\\\u1F5B\\\\u1F5D\\\\u1F5F-\\\\u1F7D\\\\u1F80-\\\\u1FB4\\\\u1FB6-\\\\u1FBC\\\\u1FBE\\\\u1FC2-\\\\u1FC4\\\\u1FC6-\\\\u1FCC\\\\u1FD0-\\\\u1FD3\\\\u1FD6-\\\\u1FDB\\\\u1FE0-\\\\u1FEC\\\\u1FF2-\\\\u1FF4\\\\u1FF6-\\\\u1FFC\\\\u2071\\\\u207F\\\\u2090-\\\\u209C\\\\u2102\\\\u2107\\\\u210A-\\\\u2113\\\\u2115\\\\u2119-\\\\u211D\\\\u2124\\\\u2126\\\\u2128\\\\u212A-\\\\u212D\\\\u212F-\\\\u2139\\\\u213C-\\\\u213F\\\\u2145-\\\\u2149\\\\u214E\\\\u2160-\\\\u2188\\\\u2C00-\\\\u2C2E\\\\u2C30-\\\\u2C5E\\\\u2C60-\\\\u2CE4\\\\u2CEB-\\\\u2CEE\\\\u2CF2\\\\u2CF3\\\\u2D00-\\\\u2D25\\\\u2D27\\\\u2D2D\\\\u2D30-\\\\u2D67\\\\u2D6F\\\\u2D80-\\\\u2D96\\\\u2DA0-\\\\u2DA6\\\\u2DA8-\\\\u2DAE\\\\u2DB0-\\\\u2DB6\\\\u2DB8-\\\\u2DBE\\\\u2DC0-\\\\u2DC6\\\\u2DC8-\\\\u2DCE\\\\u2DD0-\\\\u2DD6\\\\u2DD8-\\\\u2DDE\\\\u2E2F\\\\u3005-\\\\u3007\\\\u3021-\\\\u3029\\\\u3031-\\\\u3035\\\\u3038-\\\\u303C\\\\u3041-\\\\u3096\\\\u309D-\\\\u309F\\\\u30A1-\\\\u30FA\\\\u30FC-\\\\u30FF\\\\u3105-\\\\u312D\\\\u3131-\\\\u318E\\\\u31A0-\\\\u31BA\\\\u31F0-\\\\u31FF\\\\u3400-\\\\u4DB5\\\\u4E00-\\\\u9FCC\\\\uA000-\\\\uA48C\\\\uA4D0-\\\\uA4FD\\\\uA500-\\\\uA60C\\\\uA610-\\\\uA61F\\\\uA62A\\\\uA62B\\\\uA640-\\\\uA66E\\\\uA67F-\\\\uA69D\\\\uA6A0-\\\\uA6EF\\\\uA717-\\\\uA71F\\\\uA722-\\\\uA788\\\\uA78B-\\\\uA78E\\\\uA790-\\\\uA7AD\\\\uA7B0\\\\uA7B1\\\\uA7F7-\\\\uA801\\\\uA803-\\\\uA805\\\\uA807-\\\\uA80A\\\\uA80C-\\\\uA822\\\\uA840-\\\\uA873\\\\uA882-\\\\uA8B3\\\\uA8F2-\\\\uA8F7\\\\uA8FB\\\\uA90A-\\\\uA925\\\\uA930-\\\\uA946\\\\uA960-\\\\uA97C\\\\uA984-\\\\uA9B2\\\\uA9CF\\\\uA9E0-\\\\uA9E4\\\\uA9E6-\\\\uA9EF\\\\uA9FA-\\\\uA9FE\\\\uAA00-\\\\uAA28\\\\uAA40-\\\\uAA42\\\\uAA44-\\\\uAA4B\\\\uAA60-\\\\uAA76\\\\uAA7A\\\\uAA7E-\\\\uAAAF\\\\uAAB1\\\\uAAB5\\\\uAAB6\\\\uAAB9-\\\\uAABD\\\\uAAC0\\\\uAAC2\\\\uAADB-\\\\uAADD\\\\uAAE0-\\\\uAAEA\\\\uAAF2-\\\\uAAF4\\\\uAB01-\\\\uAB06\\\\uAB09-\\\\uAB0E\\\\uAB11-\\\\uAB16\\\\uAB20-\\\\uAB26\\\\uAB28-\\\\uAB2E\\\\uAB30-\\\\uAB5A\\\\uAB5C-\\\\uAB5F\\\\uAB64\\\\uAB65\\\\uABC0-\\\\uABE2\\\\uAC00-\\\\uD7A3\\\\uD7B0-\\\\uD7C6\\\\uD7CB-\\\\uD7FB\\\\uF900-\\\\uFA6D\\\\uFA70-\\\\uFAD9\\\\uFB00-\\\\uFB06\\\\uFB13-\\\\uFB17\\\\uFB1D\\\\uFB1F-\\\\uFB28\\\\uFB2A-\\\\uFB36\\\\uFB38-\\\\uFB3C\\\\uFB3E\\\\uFB40\\\\uFB41\\\\uFB43\\\\uFB44\\\\uFB46-\\\\uFBB1\\\\uFBD3-\\\\uFD3D\\\\uFD50-\\\\uFD8F\\\\uFD92-\\\\uFDC7\\\\uFDF0-\\\\uFDFB\\\\uFE70-\\\\uFE74\\\\uFE76-\\\\uFEFC\\\\uFF21-\\\\uFF3A\\\\uFF41-\\\\uFF5A\\\\uFF66-\\\\uFFBE\\\\uFFC2-\\\\uFFC7\\\\uFFCA-\\\\uFFCF\\\\uFFD2-\\\\uFFD7\\\\uFFDA-\\\\uFFDC]\"),\n    // eslint-disable-next-line no-misleading-character-class\n    RegexNonAsciiIdentifierPart = new RegExp(\"[\\\\xAA\\\\xB5\\\\xBA\\\\xC0-\\\\xD6\\\\xD8-\\\\xF6\\\\xF8-\\\\u02C1\\\\u02C6-\\\\u02D1\\\\u02E0-\\\\u02E4\\\\u02EC\\\\u02EE\\\\u0300-\\\\u0374\\\\u0376\\\\u0377\\\\u037A-\\\\u037D\\\\u037F\\\\u0386\\\\u0388-\\\\u038A\\\\u038C\\\\u038E-\\\\u03A1\\\\u03A3-\\\\u03F5\\\\u03F7-\\\\u0481\\\\u0483-\\\\u0487\\\\u048A-\\\\u052F\\\\u0531-\\\\u0556\\\\u0559\\\\u0561-\\\\u0587\\\\u0591-\\\\u05BD\\\\u05BF\\\\u05C1\\\\u05C2\\\\u05C4\\\\u05C5\\\\u05C7\\\\u05D0-\\\\u05EA\\\\u05F0-\\\\u05F2\\\\u0610-\\\\u061A\\\\u0620-\\\\u0669\\\\u066E-\\\\u06D3\\\\u06D5-\\\\u06DC\\\\u06DF-\\\\u06E8\\\\u06EA-\\\\u06FC\\\\u06FF\\\\u0710-\\\\u074A\\\\u074D-\\\\u07B1\\\\u07C0-\\\\u07F5\\\\u07FA\\\\u0800-\\\\u082D\\\\u0840-\\\\u085B\\\\u08A0-\\\\u08B2\\\\u08E4-\\\\u0963\\\\u0966-\\\\u096F\\\\u0971-\\\\u0983\\\\u0985-\\\\u098C\\\\u098F\\\\u0990\\\\u0993-\\\\u09A8\\\\u09AA-\\\\u09B0\\\\u09B2\\\\u09B6-\\\\u09B9\\\\u09BC-\\\\u09C4\\\\u09C7\\\\u09C8\\\\u09CB-\\\\u09CE\\\\u09D7\\\\u09DC\\\\u09DD\\\\u09DF-\\\\u09E3\\\\u09E6-\\\\u09F1\\\\u0A01-\\\\u0A03\\\\u0A05-\\\\u0A0A\\\\u0A0F\\\\u0A10\\\\u0A13-\\\\u0A28\\\\u0A2A-\\\\u0A30\\\\u0A32\\\\u0A33\\\\u0A35\\\\u0A36\\\\u0A38\\\\u0A39\\\\u0A3C\\\\u0A3E-\\\\u0A42\\\\u0A47\\\\u0A48\\\\u0A4B-\\\\u0A4D\\\\u0A51\\\\u0A59-\\\\u0A5C\\\\u0A5E\\\\u0A66-\\\\u0A75\\\\u0A81-\\\\u0A83\\\\u0A85-\\\\u0A8D\\\\u0A8F-\\\\u0A91\\\\u0A93-\\\\u0AA8\\\\u0AAA-\\\\u0AB0\\\\u0AB2\\\\u0AB3\\\\u0AB5-\\\\u0AB9\\\\u0ABC-\\\\u0AC5\\\\u0AC7-\\\\u0AC9\\\\u0ACB-\\\\u0ACD\\\\u0AD0\\\\u0AE0-\\\\u0AE3\\\\u0AE6-\\\\u0AEF\\\\u0B01-\\\\u0B03\\\\u0B05-\\\\u0B0C\\\\u0B0F\\\\u0B10\\\\u0B13-\\\\u0B28\\\\u0B2A-\\\\u0B30\\\\u0B32\\\\u0B33\\\\u0B35-\\\\u0B39\\\\u0B3C-\\\\u0B44\\\\u0B47\\\\u0B48\\\\u0B4B-\\\\u0B4D\\\\u0B56\\\\u0B57\\\\u0B5C\\\\u0B5D\\\\u0B5F-\\\\u0B63\\\\u0B66-\\\\u0B6F\\\\u0B71\\\\u0B82\\\\u0B83\\\\u0B85-\\\\u0B8A\\\\u0B8E-\\\\u0B90\\\\u0B92-\\\\u0B95\\\\u0B99\\\\u0B9A\\\\u0B9C\\\\u0B9E\\\\u0B9F\\\\u0BA3\\\\u0BA4\\\\u0BA8-\\\\u0BAA\\\\u0BAE-\\\\u0BB9\\\\u0BBE-\\\\u0BC2\\\\u0BC6-\\\\u0BC8\\\\u0BCA-\\\\u0BCD\\\\u0BD0\\\\u0BD7\\\\u0BE6-\\\\u0BEF\\\\u0C00-\\\\u0C03\\\\u0C05-\\\\u0C0C\\\\u0C0E-\\\\u0C10\\\\u0C12-\\\\u0C28\\\\u0C2A-\\\\u0C39\\\\u0C3D-\\\\u0C44\\\\u0C46-\\\\u0C48\\\\u0C4A-\\\\u0C4D\\\\u0C55\\\\u0C56\\\\u0C58\\\\u0C59\\\\u0C60-\\\\u0C63\\\\u0C66-\\\\u0C6F\\\\u0C81-\\\\u0C83\\\\u0C85-\\\\u0C8C\\\\u0C8E-\\\\u0C90\\\\u0C92-\\\\u0CA8\\\\u0CAA-\\\\u0CB3\\\\u0CB5-\\\\u0CB9\\\\u0CBC-\\\\u0CC4\\\\u0CC6-\\\\u0CC8\\\\u0CCA-\\\\u0CCD\\\\u0CD5\\\\u0CD6\\\\u0CDE\\\\u0CE0-\\\\u0CE3\\\\u0CE6-\\\\u0CEF\\\\u0CF1\\\\u0CF2\\\\u0D01-\\\\u0D03\\\\u0D05-\\\\u0D0C\\\\u0D0E-\\\\u0D10\\\\u0D12-\\\\u0D3A\\\\u0D3D-\\\\u0D44\\\\u0D46-\\\\u0D48\\\\u0D4A-\\\\u0D4E\\\\u0D57\\\\u0D60-\\\\u0D63\\\\u0D66-\\\\u0D6F\\\\u0D7A-\\\\u0D7F\\\\u0D82\\\\u0D83\\\\u0D85-\\\\u0D96\\\\u0D9A-\\\\u0DB1\\\\u0DB3-\\\\u0DBB\\\\u0DBD\\\\u0DC0-\\\\u0DC6\\\\u0DCA\\\\u0DCF-\\\\u0DD4\\\\u0DD6\\\\u0DD8-\\\\u0DDF\\\\u0DE6-\\\\u0DEF\\\\u0DF2\\\\u0DF3\\\\u0E01-\\\\u0E3A\\\\u0E40-\\\\u0E4E\\\\u0E50-\\\\u0E59\\\\u0E81\\\\u0E82\\\\u0E84\\\\u0E87\\\\u0E88\\\\u0E8A\\\\u0E8D\\\\u0E94-\\\\u0E97\\\\u0E99-\\\\u0E9F\\\\u0EA1-\\\\u0EA3\\\\u0EA5\\\\u0EA7\\\\u0EAA\\\\u0EAB\\\\u0EAD-\\\\u0EB9\\\\u0EBB-\\\\u0EBD\\\\u0EC0-\\\\u0EC4\\\\u0EC6\\\\u0EC8-\\\\u0ECD\\\\u0ED0-\\\\u0ED9\\\\u0EDC-\\\\u0EDF\\\\u0F00\\\\u0F18\\\\u0F19\\\\u0F20-\\\\u0F29\\\\u0F35\\\\u0F37\\\\u0F39\\\\u0F3E-\\\\u0F47\\\\u0F49-\\\\u0F6C\\\\u0F71-\\\\u0F84\\\\u0F86-\\\\u0F97\\\\u0F99-\\\\u0FBC\\\\u0FC6\\\\u1000-\\\\u1049\\\\u1050-\\\\u109D\\\\u10A0-\\\\u10C5\\\\u10C7\\\\u10CD\\\\u10D0-\\\\u10FA\\\\u10FC-\\\\u1248\\\\u124A-\\\\u124D\\\\u1250-\\\\u1256\\\\u1258\\\\u125A-\\\\u125D\\\\u1260-\\\\u1288\\\\u128A-\\\\u128D\\\\u1290-\\\\u12B0\\\\u12B2-\\\\u12B5\\\\u12B8-\\\\u12BE\\\\u12C0\\\\u12C2-\\\\u12C5\\\\u12C8-\\\\u12D6\\\\u12D8-\\\\u1310\\\\u1312-\\\\u1315\\\\u1318-\\\\u135A\\\\u135D-\\\\u135F\\\\u1380-\\\\u138F\\\\u13A0-\\\\u13F4\\\\u1401-\\\\u166C\\\\u166F-\\\\u167F\\\\u1681-\\\\u169A\\\\u16A0-\\\\u16EA\\\\u16EE-\\\\u16F8\\\\u1700-\\\\u170C\\\\u170E-\\\\u1714\\\\u1720-\\\\u1734\\\\u1740-\\\\u1753\\\\u1760-\\\\u176C\\\\u176E-\\\\u1770\\\\u1772\\\\u1773\\\\u1780-\\\\u17D3\\\\u17D7\\\\u17DC\\\\u17DD\\\\u17E0-\\\\u17E9\\\\u180B-\\\\u180D\\\\u1810-\\\\u1819\\\\u1820-\\\\u1877\\\\u1880-\\\\u18AA\\\\u18B0-\\\\u18F5\\\\u1900-\\\\u191E\\\\u1920-\\\\u192B\\\\u1930-\\\\u193B\\\\u1946-\\\\u196D\\\\u1970-\\\\u1974\\\\u1980-\\\\u19AB\\\\u19B0-\\\\u19C9\\\\u19D0-\\\\u19D9\\\\u1A00-\\\\u1A1B\\\\u1A20-\\\\u1A5E\\\\u1A60-\\\\u1A7C\\\\u1A7F-\\\\u1A89\\\\u1A90-\\\\u1A99\\\\u1AA7\\\\u1AB0-\\\\u1ABD\\\\u1B00-\\\\u1B4B\\\\u1B50-\\\\u1B59\\\\u1B6B-\\\\u1B73\\\\u1B80-\\\\u1BF3\\\\u1C00-\\\\u1C37\\\\u1C40-\\\\u1C49\\\\u1C4D-\\\\u1C7D\\\\u1CD0-\\\\u1CD2\\\\u1CD4-\\\\u1CF6\\\\u1CF8\\\\u1CF9\\\\u1D00-\\\\u1DF5\\\\u1DFC-\\\\u1F15\\\\u1F18-\\\\u1F1D\\\\u1F20-\\\\u1F45\\\\u1F48-\\\\u1F4D\\\\u1F50-\\\\u1F57\\\\u1F59\\\\u1F5B\\\\u1F5D\\\\u1F5F-\\\\u1F7D\\\\u1F80-\\\\u1FB4\\\\u1FB6-\\\\u1FBC\\\\u1FBE\\\\u1FC2-\\\\u1FC4\\\\u1FC6-\\\\u1FCC\\\\u1FD0-\\\\u1FD3\\\\u1FD6-\\\\u1FDB\\\\u1FE0-\\\\u1FEC\\\\u1FF2-\\\\u1FF4\\\\u1FF6-\\\\u1FFC\\\\u200C\\\\u200D\\\\u203F\\\\u2040\\\\u2054\\\\u2071\\\\u207F\\\\u2090-\\\\u209C\\\\u20D0-\\\\u20DC\\\\u20E1\\\\u20E5-\\\\u20F0\\\\u2102\\\\u2107\\\\u210A-\\\\u2113\\\\u2115\\\\u2119-\\\\u211D\\\\u2124\\\\u2126\\\\u2128\\\\u212A-\\\\u212D\\\\u212F-\\\\u2139\\\\u213C-\\\\u213F\\\\u2145-\\\\u2149\\\\u214E\\\\u2160-\\\\u2188\\\\u2C00-\\\\u2C2E\\\\u2C30-\\\\u2C5E\\\\u2C60-\\\\u2CE4\\\\u2CEB-\\\\u2CF3\\\\u2D00-\\\\u2D25\\\\u2D27\\\\u2D2D\\\\u2D30-\\\\u2D67\\\\u2D6F\\\\u2D7F-\\\\u2D96\\\\u2DA0-\\\\u2DA6\\\\u2DA8-\\\\u2DAE\\\\u2DB0-\\\\u2DB6\\\\u2DB8-\\\\u2DBE\\\\u2DC0-\\\\u2DC6\\\\u2DC8-\\\\u2DCE\\\\u2DD0-\\\\u2DD6\\\\u2DD8-\\\\u2DDE\\\\u2DE0-\\\\u2DFF\\\\u2E2F\\\\u3005-\\\\u3007\\\\u3021-\\\\u302F\\\\u3031-\\\\u3035\\\\u3038-\\\\u303C\\\\u3041-\\\\u3096\\\\u3099\\\\u309A\\\\u309D-\\\\u309F\\\\u30A1-\\\\u30FA\\\\u30FC-\\\\u30FF\\\\u3105-\\\\u312D\\\\u3131-\\\\u318E\\\\u31A0-\\\\u31BA\\\\u31F0-\\\\u31FF\\\\u3400-\\\\u4DB5\\\\u4E00-\\\\u9FCC\\\\uA000-\\\\uA48C\\\\uA4D0-\\\\uA4FD\\\\uA500-\\\\uA60C\\\\uA610-\\\\uA62B\\\\uA640-\\\\uA66F\\\\uA674-\\\\uA67D\\\\uA67F-\\\\uA69D\\\\uA69F-\\\\uA6F1\\\\uA717-\\\\uA71F\\\\uA722-\\\\uA788\\\\uA78B-\\\\uA78E\\\\uA790-\\\\uA7AD\\\\uA7B0\\\\uA7B1\\\\uA7F7-\\\\uA827\\\\uA840-\\\\uA873\\\\uA880-\\\\uA8C4\\\\uA8D0-\\\\uA8D9\\\\uA8E0-\\\\uA8F7\\\\uA8FB\\\\uA900-\\\\uA92D\\\\uA930-\\\\uA953\\\\uA960-\\\\uA97C\\\\uA980-\\\\uA9C0\\\\uA9CF-\\\\uA9D9\\\\uA9E0-\\\\uA9FE\\\\uAA00-\\\\uAA36\\\\uAA40-\\\\uAA4D\\\\uAA50-\\\\uAA59\\\\uAA60-\\\\uAA76\\\\uAA7A-\\\\uAAC2\\\\uAADB-\\\\uAADD\\\\uAAE0-\\\\uAAEF\\\\uAAF2-\\\\uAAF6\\\\uAB01-\\\\uAB06\\\\uAB09-\\\\uAB0E\\\\uAB11-\\\\uAB16\\\\uAB20-\\\\uAB26\\\\uAB28-\\\\uAB2E\\\\uAB30-\\\\uAB5A\\\\uAB5C-\\\\uAB5F\\\\uAB64\\\\uAB65\\\\uABC0-\\\\uABEA\\\\uABEC\\\\uABED\\\\uABF0-\\\\uABF9\\\\uAC00-\\\\uD7A3\\\\uD7B0-\\\\uD7C6\\\\uD7CB-\\\\uD7FB\\\\uF900-\\\\uFA6D\\\\uFA70-\\\\uFAD9\\\\uFB00-\\\\uFB06\\\\uFB13-\\\\uFB17\\\\uFB1D-\\\\uFB28\\\\uFB2A-\\\\uFB36\\\\uFB38-\\\\uFB3C\\\\uFB3E\\\\uFB40\\\\uFB41\\\\uFB43\\\\uFB44\\\\uFB46-\\\\uFBB1\\\\uFBD3-\\\\uFD3D\\\\uFD50-\\\\uFD8F\\\\uFD92-\\\\uFDC7\\\\uFDF0-\\\\uFDFB\\\\uFE00-\\\\uFE0F\\\\uFE20-\\\\uFE2D\\\\uFE33\\\\uFE34\\\\uFE4D-\\\\uFE4F\\\\uFE70-\\\\uFE74\\\\uFE76-\\\\uFEFC\\\\uFF10-\\\\uFF19\\\\uFF21-\\\\uFF3A\\\\uFF3F\\\\uFF41-\\\\uFF5A\\\\uFF66-\\\\uFFBE\\\\uFFC2-\\\\uFFC7\\\\uFFCA-\\\\uFFCF\\\\uFFD2-\\\\uFFD7\\\\uFFDA-\\\\uFFDC]\");\n\n// Ensure the condition is true, otherwise throw an error.\n// This is only to have a better contract semantic, i.e. another safety net\n// to catch a logic error. The condition shall be fulfilled in normal case.\n// Do NOT use this to enforce a certain condition on any user input.\n\nfunction assert(condition, message) {\n  /* istanbul ignore next */\n  if (!condition) {\n    throw new Error('ASSERT: ' + message);\n  }\n}\n\nfunction isDecimalDigit(ch) {\n  return (ch >= 0x30 && ch <= 0x39); // 0..9\n}\n\nfunction isHexDigit(ch) {\n  return '0123456789abcdefABCDEF'.indexOf(ch) >= 0;\n}\n\nfunction isOctalDigit(ch) {\n  return '01234567'.indexOf(ch) >= 0;\n}\n\n// 7.2 White Space\n\nfunction isWhiteSpace(ch) {\n  return (ch === 0x20) || (ch === 0x09) || (ch === 0x0B) || (ch === 0x0C) || (ch === 0xA0) ||\n    (ch >= 0x1680 && [0x1680, 0x180E, 0x2000, 0x2001, 0x2002, 0x2003, 0x2004, 0x2005, 0x2006, 0x2007, 0x2008, 0x2009, 0x200A, 0x202F, 0x205F, 0x3000, 0xFEFF].indexOf(ch) >= 0);\n}\n\n// 7.3 Line Terminators\n\nfunction isLineTerminator(ch) {\n  return (ch === 0x0A) || (ch === 0x0D) || (ch === 0x2028) || (ch === 0x2029);\n}\n\n// 7.6 Identifier Names and Identifiers\n\nfunction isIdentifierStart(ch) {\n  return (ch === 0x24) || (ch === 0x5F) || // $ (dollar) and _ (underscore)\n    (ch >= 0x41 && ch <= 0x5A) || // A..Z\n    (ch >= 0x61 && ch <= 0x7A) || // a..z\n    (ch === 0x5C) || // \\ (backslash)\n    ((ch >= 0x80) && RegexNonAsciiIdentifierStart.test(String.fromCharCode(ch)));\n}\n\nfunction isIdentifierPart(ch) {\n  return (ch === 0x24) || (ch === 0x5F) || // $ (dollar) and _ (underscore)\n    (ch >= 0x41 && ch <= 0x5A) || // A..Z\n    (ch >= 0x61 && ch <= 0x7A) || // a..z\n    (ch >= 0x30 && ch <= 0x39) || // 0..9\n    (ch === 0x5C) || // \\ (backslash)\n    ((ch >= 0x80) && RegexNonAsciiIdentifierPart.test(String.fromCharCode(ch)));\n}\n\n// 7.6.1.1 Keywords\n\nvar keywords = {\n  'if':1, 'in':1, 'do':1,\n  'var':1, 'for':1, 'new':1, 'try':1, 'let':1,\n  'this':1, 'else':1, 'case':1, 'void':1, 'with':1, 'enum':1,\n  'while':1, 'break':1, 'catch':1, 'throw':1, 'const':1, 'yield':1, 'class':1, 'super':1,\n  'return':1, 'typeof':1, 'delete':1, 'switch':1, 'export':1, 'import':1, 'public':1, 'static':1,\n  'default':1, 'finally':1, 'extends':1, 'package':1, 'private':1,\n  'function':1, 'continue':1, 'debugger':1,\n  'interface':1, 'protected':1,\n  'instanceof':1, 'implements':1\n};\n\nfunction skipComment() {\n  var ch;\n\n  while (index < length) {\n    ch = source.charCodeAt(index);\n\n    if (isWhiteSpace(ch) || isLineTerminator(ch)) {\n      ++index;\n    } else {\n      break;\n    }\n  }\n}\n\nfunction scanHexEscape(prefix) {\n  var i, len, ch, code = 0;\n\n  len = (prefix === 'u') ? 4 : 2;\n  for (i = 0; i < len; ++i) {\n    if (index < length && isHexDigit(source[index])) {\n      ch = source[index++];\n      code = code * 16 + '0123456789abcdef'.indexOf(ch.toLowerCase());\n    } else {\n      throwError({}, MessageUnexpectedToken, ILLEGAL);\n    }\n  }\n  return String.fromCharCode(code);\n}\n\nfunction scanUnicodeCodePointEscape() {\n  var ch, code, cu1, cu2;\n\n  ch = source[index];\n  code = 0;\n\n  // At least, one hex digit is required.\n  if (ch === '}') {\n    throwError({}, MessageUnexpectedToken, ILLEGAL);\n  }\n\n  while (index < length) {\n    ch = source[index++];\n    if (!isHexDigit(ch)) {\n      break;\n    }\n    code = code * 16 + '0123456789abcdef'.indexOf(ch.toLowerCase());\n  }\n\n  if (code > 0x10FFFF || ch !== '}') {\n    throwError({}, MessageUnexpectedToken, ILLEGAL);\n  }\n\n  // UTF-16 Encoding\n  if (code <= 0xFFFF) {\n    return String.fromCharCode(code);\n  }\n  cu1 = ((code - 0x10000) >> 10) + 0xD800;\n  cu2 = ((code - 0x10000) & 1023) + 0xDC00;\n  return String.fromCharCode(cu1, cu2);\n}\n\nfunction getEscapedIdentifier() {\n  var ch, id;\n\n  ch = source.charCodeAt(index++);\n  id = String.fromCharCode(ch);\n\n  // '\\u' (U+005C, U+0075) denotes an escaped character.\n  if (ch === 0x5C) {\n    if (source.charCodeAt(index) !== 0x75) {\n      throwError({}, MessageUnexpectedToken, ILLEGAL);\n    }\n    ++index;\n    ch = scanHexEscape('u');\n    if (!ch || ch === '\\\\' || !isIdentifierStart(ch.charCodeAt(0))) {\n      throwError({}, MessageUnexpectedToken, ILLEGAL);\n    }\n    id = ch;\n  }\n\n  while (index < length) {\n    ch = source.charCodeAt(index);\n    if (!isIdentifierPart(ch)) {\n      break;\n    }\n    ++index;\n    id += String.fromCharCode(ch);\n\n    // '\\u' (U+005C, U+0075) denotes an escaped character.\n    if (ch === 0x5C) {\n      id = id.substr(0, id.length - 1);\n      if (source.charCodeAt(index) !== 0x75) {\n        throwError({}, MessageUnexpectedToken, ILLEGAL);\n      }\n      ++index;\n      ch = scanHexEscape('u');\n      if (!ch || ch === '\\\\' || !isIdentifierPart(ch.charCodeAt(0))) {\n        throwError({}, MessageUnexpectedToken, ILLEGAL);\n      }\n      id += ch;\n    }\n  }\n\n  return id;\n}\n\nfunction getIdentifier() {\n  var start, ch;\n\n  start = index++;\n  while (index < length) {\n    ch = source.charCodeAt(index);\n    if (ch === 0x5C) {\n      // Blackslash (U+005C) marks Unicode escape sequence.\n      index = start;\n      return getEscapedIdentifier();\n    }\n    if (isIdentifierPart(ch)) {\n      ++index;\n    } else {\n      break;\n    }\n  }\n\n  return source.slice(start, index);\n}\n\nfunction scanIdentifier() {\n  var start, id, type;\n\n  start = index;\n\n  // Backslash (U+005C) starts an escaped character.\n  id = (source.charCodeAt(index) === 0x5C) ? getEscapedIdentifier() : getIdentifier();\n\n  // There is no keyword or literal with only one character.\n  // Thus, it must be an identifier.\n  if (id.length === 1) {\n    type = TokenIdentifier;\n  } else if (keywords.hasOwnProperty(id)) { // eslint-disable-line no-prototype-builtins\n    type = TokenKeyword;\n  } else if (id === 'null') {\n    type = TokenNullLiteral;\n  } else if (id === 'true' || id === 'false') {\n    type = TokenBooleanLiteral;\n  } else {\n    type = TokenIdentifier;\n  }\n\n  return {\n    type: type,\n    value: id,\n    start: start,\n    end: index\n  };\n}\n\n// 7.7 Punctuators\n\nfunction scanPunctuator() {\n  var start = index,\n    code = source.charCodeAt(index),\n    code2,\n    ch1 = source[index],\n    ch2,\n    ch3,\n    ch4;\n\n  switch (code) {\n\n    // Check for most common single-character punctuators.\n    case 0x2E: // . dot\n    case 0x28: // ( open bracket\n    case 0x29: // ) close bracket\n    case 0x3B: // ; semicolon\n    case 0x2C: // , comma\n    case 0x7B: // { open curly brace\n    case 0x7D: // } close curly brace\n    case 0x5B: // [\n    case 0x5D: // ]\n    case 0x3A: // :\n    case 0x3F: // ?\n    case 0x7E: // ~\n      ++index;\n      return {\n        type: TokenPunctuator,\n        value: String.fromCharCode(code),\n        start: start,\n        end: index\n      };\n\n    default:\n      code2 = source.charCodeAt(index + 1);\n\n      // '=' (U+003D) marks an assignment or comparison operator.\n      if (code2 === 0x3D) {\n        switch (code) {\n          case 0x2B: // +\n          case 0x2D: // -\n          case 0x2F: // /\n          case 0x3C: // <\n          case 0x3E: // >\n          case 0x5E: // ^\n          case 0x7C: // |\n          case 0x25: // %\n          case 0x26: // &\n          case 0x2A: // *\n            index += 2;\n            return {\n              type: TokenPunctuator,\n              value: String.fromCharCode(code) + String.fromCharCode(code2),\n              start: start,\n              end: index\n            };\n\n          case 0x21: // !\n          case 0x3D: // =\n            index += 2;\n\n            // !== and ===\n            if (source.charCodeAt(index) === 0x3D) {\n              ++index;\n            }\n            return {\n              type: TokenPunctuator,\n              value: source.slice(start, index),\n              start: start,\n              end: index\n            };\n        }\n      }\n  }\n\n  // 4-character punctuator: >>>=\n\n  ch4 = source.substr(index, 4);\n\n  if (ch4 === '>>>=') {\n    index += 4;\n    return {\n      type: TokenPunctuator,\n      value: ch4,\n      start: start,\n      end: index\n    };\n  }\n\n  // 3-character punctuators: === !== >>> <<= >>=\n\n  ch3 = ch4.substr(0, 3);\n\n  if (ch3 === '>>>' || ch3 === '<<=' || ch3 === '>>=') {\n    index += 3;\n    return {\n      type: TokenPunctuator,\n      value: ch3,\n      start: start,\n      end: index\n    };\n  }\n\n  // Other 2-character punctuators: ++ -- << >> && ||\n  ch2 = ch3.substr(0, 2);\n\n  if ((ch1 === ch2[1] && ('+-<>&|'.indexOf(ch1) >= 0)) || ch2 === '=>') {\n    index += 2;\n    return {\n      type: TokenPunctuator,\n      value: ch2,\n      start: start,\n      end: index\n    };\n  }\n\n  // 1-character punctuators: < > = ! + - * % & | ^ /\n\n  if ('<>=!+-*%&|^/'.indexOf(ch1) >= 0) {\n    ++index;\n    return {\n      type: TokenPunctuator,\n      value: ch1,\n      start: start,\n      end: index\n    };\n  }\n\n  throwError({}, MessageUnexpectedToken, ILLEGAL);\n}\n\n// 7.8.3 Numeric Literals\n\nfunction scanHexLiteral(start) {\n  var number = '';\n\n  while (index < length) {\n    if (!isHexDigit(source[index])) {\n      break;\n    }\n    number += source[index++];\n  }\n\n  if (number.length === 0) {\n    throwError({}, MessageUnexpectedToken, ILLEGAL);\n  }\n\n  if (isIdentifierStart(source.charCodeAt(index))) {\n    throwError({}, MessageUnexpectedToken, ILLEGAL);\n  }\n\n  return {\n    type: TokenNumericLiteral,\n    value: parseInt('0x' + number, 16),\n    start: start,\n    end: index\n  };\n}\n\nfunction scanOctalLiteral(start) {\n  var number = '0' + source[index++];\n  while (index < length) {\n    if (!isOctalDigit(source[index])) {\n      break;\n    }\n    number += source[index++];\n  }\n\n  if (isIdentifierStart(source.charCodeAt(index)) || isDecimalDigit(source.charCodeAt(index))) {\n    throwError({}, MessageUnexpectedToken, ILLEGAL);\n  }\n\n  return {\n    type: TokenNumericLiteral,\n    value: parseInt(number, 8),\n    octal: true,\n    start: start,\n    end: index\n  };\n}\n\nfunction scanNumericLiteral() {\n  var number, start, ch;\n\n  ch = source[index];\n  assert(isDecimalDigit(ch.charCodeAt(0)) || (ch === '.'),\n    'Numeric literal must start with a decimal digit or a decimal point');\n\n  start = index;\n  number = '';\n  if (ch !== '.') {\n    number = source[index++];\n    ch = source[index];\n\n    // Hex number starts with '0x'.\n    // Octal number starts with '0'.\n    if (number === '0') {\n      if (ch === 'x' || ch === 'X') {\n        ++index;\n        return scanHexLiteral(start);\n      }\n      if (isOctalDigit(ch)) {\n        return scanOctalLiteral(start);\n      }\n\n      // decimal number starts with '0' such as '09' is illegal.\n      if (ch && isDecimalDigit(ch.charCodeAt(0))) {\n        throwError({}, MessageUnexpectedToken, ILLEGAL);\n      }\n    }\n\n    while (isDecimalDigit(source.charCodeAt(index))) {\n      number += source[index++];\n    }\n    ch = source[index];\n  }\n\n  if (ch === '.') {\n    number += source[index++];\n    while (isDecimalDigit(source.charCodeAt(index))) {\n      number += source[index++];\n    }\n    ch = source[index];\n  }\n\n  if (ch === 'e' || ch === 'E') {\n    number += source[index++];\n\n    ch = source[index];\n    if (ch === '+' || ch === '-') {\n      number += source[index++];\n    }\n    if (isDecimalDigit(source.charCodeAt(index))) {\n      while (isDecimalDigit(source.charCodeAt(index))) {\n        number += source[index++];\n      }\n    } else {\n      throwError({}, MessageUnexpectedToken, ILLEGAL);\n    }\n  }\n\n  if (isIdentifierStart(source.charCodeAt(index))) {\n    throwError({}, MessageUnexpectedToken, ILLEGAL);\n  }\n\n  return {\n    type: TokenNumericLiteral,\n    value: parseFloat(number),\n    start: start,\n    end: index\n  };\n}\n\n// 7.8.4 String Literals\n\nfunction scanStringLiteral() {\n  var str = '',\n    quote, start, ch, code, octal = false;\n\n  quote = source[index];\n  assert((quote === '\\'' || quote === '\"'),\n    'String literal must starts with a quote');\n\n  start = index;\n  ++index;\n\n  while (index < length) {\n    ch = source[index++];\n\n    if (ch === quote) {\n      quote = '';\n      break;\n    } else if (ch === '\\\\') {\n      ch = source[index++];\n      if (!ch || !isLineTerminator(ch.charCodeAt(0))) {\n        switch (ch) {\n          case 'u':\n          case 'x':\n            if (source[index] === '{') {\n              ++index;\n              str += scanUnicodeCodePointEscape();\n            } else {\n              str += scanHexEscape(ch);\n            }\n            break;\n          case 'n':\n            str += '\\n';\n            break;\n          case 'r':\n            str += '\\r';\n            break;\n          case 't':\n            str += '\\t';\n            break;\n          case 'b':\n            str += '\\b';\n            break;\n          case 'f':\n            str += '\\f';\n            break;\n          case 'v':\n            str += '\\x0B';\n            break;\n\n          default:\n            if (isOctalDigit(ch)) {\n              code = '01234567'.indexOf(ch);\n\n              // \\0 is not octal escape sequence\n              if (code !== 0) {\n                octal = true;\n              }\n\n              if (index < length && isOctalDigit(source[index])) {\n                octal = true;\n                code = code * 8 + '01234567'.indexOf(source[index++]);\n\n                // 3 digits are only allowed when string starts\n                // with 0, 1, 2, 3\n                if ('0123'.indexOf(ch) >= 0 &&\n                  index < length &&\n                  isOctalDigit(source[index])) {\n                  code = code * 8 + '01234567'.indexOf(source[index++]);\n                }\n              }\n              str += String.fromCharCode(code);\n            } else {\n              str += ch;\n            }\n            break;\n        }\n      } else {\n        if (ch === '\\r' && source[index] === '\\n') {\n          ++index;\n        }\n      }\n    } else if (isLineTerminator(ch.charCodeAt(0))) {\n      break;\n    } else {\n      str += ch;\n    }\n  }\n\n  if (quote !== '') {\n    throwError({}, MessageUnexpectedToken, ILLEGAL);\n  }\n\n  return {\n    type: TokenStringLiteral,\n    value: str,\n    octal: octal,\n    start: start,\n    end: index\n  };\n}\n\nfunction testRegExp(pattern, flags) {\n  var tmp = pattern;\n\n  if (flags.indexOf('u') >= 0) {\n    // Replace each astral symbol and every Unicode code point\n    // escape sequence with a single ASCII symbol to avoid throwing on\n    // regular expressions that are only valid in combination with the\n    // `/u` flag.\n    // Note: replacing with the ASCII symbol `x` might cause false\n    // negatives in unlikely scenarios. For example, `[\\u{61}-b]` is a\n    // perfectly valid pattern that is equivalent to `[a-b]`, but it\n    // would be replaced by `[x-b]` which throws an error.\n    tmp = tmp\n      .replace(/\\\\u\\{([0-9a-fA-F]+)\\}/g, function($0, $1) {\n        if (parseInt($1, 16) <= 0x10FFFF) {\n          return 'x';\n        }\n        throwError({}, MessageInvalidRegExp);\n      })\n      .replace(/[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g, 'x');\n  }\n\n  // First, detect invalid regular expressions.\n  try {\n    new RegExp(tmp);\n  } catch (e) {\n    throwError({}, MessageInvalidRegExp);\n  }\n\n  // Return a regular expression object for this pattern-flag pair, or\n  // `null` in case the current environment doesn't support the flags it\n  // uses.\n  try {\n    return new RegExp(pattern, flags);\n  } catch (exception) {\n    return null;\n  }\n}\n\nfunction scanRegExpBody() {\n  var ch, str, classMarker, terminated, body;\n\n  ch = source[index];\n  assert(ch === '/', 'Regular expression literal must start with a slash');\n  str = source[index++];\n\n  classMarker = false;\n  terminated = false;\n  while (index < length) {\n    ch = source[index++];\n    str += ch;\n    if (ch === '\\\\') {\n      ch = source[index++];\n      // ECMA-262 7.8.5\n      if (isLineTerminator(ch.charCodeAt(0))) {\n        throwError({}, MessageUnterminatedRegExp);\n      }\n      str += ch;\n    } else if (isLineTerminator(ch.charCodeAt(0))) {\n      throwError({}, MessageUnterminatedRegExp);\n    } else if (classMarker) {\n      if (ch === ']') {\n        classMarker = false;\n      }\n    } else {\n      if (ch === '/') {\n        terminated = true;\n        break;\n      } else if (ch === '[') {\n        classMarker = true;\n      }\n    }\n  }\n\n  if (!terminated) {\n    throwError({}, MessageUnterminatedRegExp);\n  }\n\n  // Exclude leading and trailing slash.\n  body = str.substr(1, str.length - 2);\n  return {\n    value: body,\n    literal: str\n  };\n}\n\nfunction scanRegExpFlags() {\n  var ch, str, flags;\n\n  str = '';\n  flags = '';\n  while (index < length) {\n    ch = source[index];\n    if (!isIdentifierPart(ch.charCodeAt(0))) {\n      break;\n    }\n\n    ++index;\n    if (ch === '\\\\' && index < length) {\n      throwError({}, MessageUnexpectedToken, ILLEGAL);\n    } else {\n      flags += ch;\n      str += ch;\n    }\n  }\n\n  if (flags.search(/[^gimuy]/g) >= 0) {\n    throwError({}, MessageInvalidRegExp, flags);\n  }\n\n  return {\n    value: flags,\n    literal: str\n  };\n}\n\nfunction scanRegExp() {\n  var start, body, flags, value;\n\n  lookahead = null;\n  skipComment();\n  start = index;\n\n  body = scanRegExpBody();\n  flags = scanRegExpFlags();\n  value = testRegExp(body.value, flags.value);\n\n  return {\n    literal: body.literal + flags.literal,\n    value: value,\n    regex: {\n      pattern: body.value,\n      flags: flags.value\n    },\n    start: start,\n    end: index\n  };\n}\n\nfunction isIdentifierName(token) {\n  return token.type === TokenIdentifier ||\n    token.type === TokenKeyword ||\n    token.type === TokenBooleanLiteral ||\n    token.type === TokenNullLiteral;\n}\n\nfunction advance() {\n  var ch;\n\n  skipComment();\n\n  if (index >= length) {\n    return {\n      type: TokenEOF,\n      start: index,\n      end: index\n    };\n  }\n\n  ch = source.charCodeAt(index);\n\n  if (isIdentifierStart(ch)) {\n    return scanIdentifier();\n  }\n\n  // Very common: ( and ) and ;\n  if (ch === 0x28 || ch === 0x29 || ch === 0x3B) {\n    return scanPunctuator();\n  }\n\n  // String literal starts with single quote (U+0027) or double quote (U+0022).\n  if (ch === 0x27 || ch === 0x22) {\n    return scanStringLiteral();\n  }\n\n\n  // Dot (.) U+002E can also start a floating-point number, hence the need\n  // to check the next character.\n  if (ch === 0x2E) {\n    if (isDecimalDigit(source.charCodeAt(index + 1))) {\n      return scanNumericLiteral();\n    }\n    return scanPunctuator();\n  }\n\n  if (isDecimalDigit(ch)) {\n    return scanNumericLiteral();\n  }\n\n  return scanPunctuator();\n}\n\nfunction lex() {\n  var token;\n\n  token = lookahead;\n  index = token.end;\n\n  lookahead = advance();\n\n  index = token.end;\n\n  return token;\n}\n\nfunction peek() {\n  var pos;\n\n  pos = index;\n\n  lookahead = advance();\n  index = pos;\n}\n\nfunction finishArrayExpression(elements) {\n  var node = new ASTNode(SyntaxArrayExpression);\n  node.elements = elements;\n  return node;\n}\n\nfunction finishBinaryExpression(operator, left, right) {\n  var node = new ASTNode((operator === '||' || operator === '&&') ? SyntaxLogicalExpression : SyntaxBinaryExpression);\n  node.operator = operator;\n  node.left = left;\n  node.right = right;\n  return node;\n}\n\nfunction finishCallExpression(callee, args) {\n  var node = new ASTNode(SyntaxCallExpression);\n  node.callee = callee;\n  node.arguments = args;\n  return node;\n}\n\nfunction finishConditionalExpression(test, consequent, alternate) {\n  var node = new ASTNode(SyntaxConditionalExpression);\n  node.test = test;\n  node.consequent = consequent;\n  node.alternate = alternate;\n  return node;\n}\n\nfunction finishIdentifier(name) {\n  var node = new ASTNode(SyntaxIdentifier);\n  node.name = name;\n  return node;\n}\n\nfunction finishLiteral(token) {\n  var node = new ASTNode(SyntaxLiteral);\n  node.value = token.value;\n  node.raw = source.slice(token.start, token.end);\n  if (token.regex) {\n    if (node.raw === '//') {\n      node.raw = '/(?:)/';\n    }\n    node.regex = token.regex;\n  }\n  return node;\n}\n\nfunction finishMemberExpression(accessor, object, property) {\n  var node = new ASTNode(SyntaxMemberExpression);\n  node.computed = accessor === '[';\n  node.object = object;\n  node.property = property;\n  if (!node.computed) property.member = true;\n  return node;\n}\n\nfunction finishObjectExpression(properties) {\n  var node = new ASTNode(SyntaxObjectExpression);\n  node.properties = properties;\n  return node;\n}\n\nfunction finishProperty(kind, key, value) {\n  var node = new ASTNode(SyntaxProperty);\n  node.key = key;\n  node.value = value;\n  node.kind = kind;\n  return node;\n}\n\nfunction finishUnaryExpression(operator, argument) {\n  var node = new ASTNode(SyntaxUnaryExpression);\n  node.operator = operator;\n  node.argument = argument;\n  node.prefix = true;\n  return node;\n}\n\n// Throw an exception\n\nfunction throwError(token, messageFormat) {\n  var error,\n    args = Array.prototype.slice.call(arguments, 2),\n    msg = messageFormat.replace(\n      /%(\\d)/g,\n      function(whole, index) {\n        assert(index < args.length, 'Message reference must be in range');\n        return args[index];\n      }\n    );\n\n\n  error = new Error(msg);\n  error.index = index;\n  error.description = msg;\n  throw error;\n}\n\n// Throw an exception because of the token.\n\nfunction throwUnexpected(token) {\n  if (token.type === TokenEOF) {\n    throwError(token, MessageUnexpectedEOS);\n  }\n\n  if (token.type === TokenNumericLiteral) {\n    throwError(token, MessageUnexpectedNumber);\n  }\n\n  if (token.type === TokenStringLiteral) {\n    throwError(token, MessageUnexpectedString);\n  }\n\n  if (token.type === TokenIdentifier) {\n    throwError(token, MessageUnexpectedIdentifier);\n  }\n\n  if (token.type === TokenKeyword) {\n    throwError(token, MessageUnexpectedReserved);\n  }\n\n  // BooleanLiteral, NullLiteral, or Punctuator.\n  throwError(token, MessageUnexpectedToken, token.value);\n}\n\n// Expect the next token to match the specified punctuator.\n// If not, an exception will be thrown.\n\nfunction expect(value) {\n  var token = lex();\n  if (token.type !== TokenPunctuator || token.value !== value) {\n    throwUnexpected(token);\n  }\n}\n\n// Return true if the next token matches the specified punctuator.\n\nfunction match(value) {\n  return lookahead.type === TokenPunctuator && lookahead.value === value;\n}\n\n// Return true if the next token matches the specified keyword\n\nfunction matchKeyword(keyword) {\n  return lookahead.type === TokenKeyword && lookahead.value === keyword;\n}\n\n// 11.1.4 Array Initialiser\n\nfunction parseArrayInitialiser() {\n  var elements = [];\n\n  index = lookahead.start;\n  expect('[');\n\n  while (!match(']')) {\n    if (match(',')) {\n      lex();\n      elements.push(null);\n    } else {\n      elements.push(parseConditionalExpression());\n\n      if (!match(']')) {\n        expect(',');\n      }\n    }\n  }\n\n  lex();\n\n  return finishArrayExpression(elements);\n}\n\n// 11.1.5 Object Initialiser\n\nfunction parseObjectPropertyKey() {\n  var token;\n\n  index = lookahead.start;\n  token = lex();\n\n  // Note: This function is called only from parseObjectProperty(), where\n  // EOF and Punctuator tokens are already filtered out.\n\n  if (token.type === TokenStringLiteral || token.type === TokenNumericLiteral) {\n    if (token.octal) {\n      throwError(token, MessageStrictOctalLiteral);\n    }\n    return finishLiteral(token);\n  }\n\n  return finishIdentifier(token.value);\n}\n\nfunction parseObjectProperty() {\n  var token, key, id, value;\n\n  index = lookahead.start;\n  token = lookahead;\n\n  if (token.type === TokenIdentifier) {\n    id = parseObjectPropertyKey();\n    expect(':');\n    value = parseConditionalExpression();\n    return finishProperty('init', id, value);\n  }\n  if (token.type === TokenEOF || token.type === TokenPunctuator) {\n    throwUnexpected(token);\n  } else {\n    key = parseObjectPropertyKey();\n    expect(':');\n    value = parseConditionalExpression();\n    return finishProperty('init', key, value);\n  }\n}\n\nfunction parseObjectInitialiser() {\n  var properties = [],\n    property, name, key, map = {},\n    toString = String;\n\n  index = lookahead.start;\n  expect('{');\n\n  while (!match('}')) {\n    property = parseObjectProperty();\n\n    if (property.key.type === SyntaxIdentifier) {\n      name = property.key.name;\n    } else {\n      name = toString(property.key.value);\n    }\n\n    key = '$' + name;\n    if (Object.prototype.hasOwnProperty.call(map, key)) {\n      throwError({}, MessageStrictDuplicateProperty);\n    } else {\n      map[key] = true;\n    }\n\n    properties.push(property);\n\n    if (!match('}')) {\n      expect(',');\n    }\n  }\n\n  expect('}');\n\n  return finishObjectExpression(properties);\n}\n\n// 11.1.6 The Grouping Operator\n\nfunction parseGroupExpression() {\n  var expr;\n\n  expect('(');\n\n  expr = parseExpression();\n\n  expect(')');\n\n  return expr;\n}\n\n\n// 11.1 Primary Expressions\n\nvar legalKeywords = {\n  \"if\": 1,\n  \"this\": 1\n};\n\nfunction parsePrimaryExpression() {\n  var type, token, expr;\n\n  if (match('(')) {\n    return parseGroupExpression();\n  }\n\n  if (match('[')) {\n    return parseArrayInitialiser();\n  }\n\n  if (match('{')) {\n    return parseObjectInitialiser();\n  }\n\n  type = lookahead.type;\n  index = lookahead.start;\n\n\n  if (type === TokenIdentifier || legalKeywords[lookahead.value]) {\n    expr = finishIdentifier(lex().value);\n  } else if (type === TokenStringLiteral || type === TokenNumericLiteral) {\n    if (lookahead.octal) {\n      throwError(lookahead, MessageStrictOctalLiteral);\n    }\n    expr = finishLiteral(lex());\n  } else if (type === TokenKeyword) {\n    throw new Error(DISABLED);\n  } else if (type === TokenBooleanLiteral) {\n    token = lex();\n    token.value = (token.value === 'true');\n    expr = finishLiteral(token);\n  } else if (type === TokenNullLiteral) {\n    token = lex();\n    token.value = null;\n    expr = finishLiteral(token);\n  } else if (match('/') || match('/=')) {\n    expr = finishLiteral(scanRegExp());\n    peek();\n  } else {\n    throwUnexpected(lex());\n  }\n\n  return expr;\n}\n\n// 11.2 Left-Hand-Side Expressions\n\nfunction parseArguments() {\n  var args = [];\n\n  expect('(');\n\n  if (!match(')')) {\n    while (index < length) {\n      args.push(parseConditionalExpression());\n      if (match(')')) {\n        break;\n      }\n      expect(',');\n    }\n  }\n\n  expect(')');\n\n  return args;\n}\n\nfunction parseNonComputedProperty() {\n  var token;\n  index = lookahead.start;\n  token = lex();\n\n  if (!isIdentifierName(token)) {\n    throwUnexpected(token);\n  }\n\n  return finishIdentifier(token.value);\n}\n\nfunction parseNonComputedMember() {\n  expect('.');\n\n  return parseNonComputedProperty();\n}\n\nfunction parseComputedMember() {\n  var expr;\n\n  expect('[');\n\n  expr = parseExpression();\n\n  expect(']');\n\n  return expr;\n}\n\nfunction parseLeftHandSideExpressionAllowCall() {\n  var expr, args, property;\n\n  expr = parsePrimaryExpression();\n\n  for (;;) {\n    if (match('.')) {\n      property = parseNonComputedMember();\n      expr = finishMemberExpression('.', expr, property);\n    } else if (match('(')) {\n      args = parseArguments();\n      expr = finishCallExpression(expr, args);\n    } else if (match('[')) {\n      property = parseComputedMember();\n      expr = finishMemberExpression('[', expr, property);\n    } else {\n      break;\n    }\n  }\n\n  return expr;\n}\n\n// 11.3 Postfix Expressions\n\nfunction parsePostfixExpression() {\n  var expr = parseLeftHandSideExpressionAllowCall();\n\n  if (lookahead.type === TokenPunctuator) {\n    if ((match('++') || match('--'))) {\n      throw new Error(DISABLED);\n    }\n  }\n\n  return expr;\n}\n\n// 11.4 Unary Operators\n\nfunction parseUnaryExpression() {\n  var token, expr;\n\n  if (lookahead.type !== TokenPunctuator && lookahead.type !== TokenKeyword) {\n    expr = parsePostfixExpression();\n  } else if (match('++') || match('--')) {\n    throw new Error(DISABLED);\n  } else if (match('+') || match('-') || match('~') || match('!')) {\n    token = lex();\n    expr = parseUnaryExpression();\n    expr = finishUnaryExpression(token.value, expr);\n  } else if (matchKeyword('delete') || matchKeyword('void') || matchKeyword('typeof')) {\n    throw new Error(DISABLED);\n  } else {\n    expr = parsePostfixExpression();\n  }\n\n  return expr;\n}\n\nfunction binaryPrecedence(token) {\n  var prec = 0;\n\n  if (token.type !== TokenPunctuator && token.type !== TokenKeyword) {\n    return 0;\n  }\n\n  switch (token.value) {\n    case '||':\n      prec = 1;\n      break;\n\n    case '&&':\n      prec = 2;\n      break;\n\n    case '|':\n      prec = 3;\n      break;\n\n    case '^':\n      prec = 4;\n      break;\n\n    case '&':\n      prec = 5;\n      break;\n\n    case '==':\n    case '!=':\n    case '===':\n    case '!==':\n      prec = 6;\n      break;\n\n    case '<':\n    case '>':\n    case '<=':\n    case '>=':\n    case 'instanceof':\n    case 'in':\n      prec = 7;\n      break;\n\n    case '<<':\n    case '>>':\n    case '>>>':\n      prec = 8;\n      break;\n\n    case '+':\n    case '-':\n      prec = 9;\n      break;\n\n    case '*':\n    case '/':\n    case '%':\n      prec = 11;\n      break;\n\n    default:\n      break;\n  }\n\n  return prec;\n}\n\n// 11.5 Multiplicative Operators\n// 11.6 Additive Operators\n// 11.7 Bitwise Shift Operators\n// 11.8 Relational Operators\n// 11.9 Equality Operators\n// 11.10 Binary Bitwise Operators\n// 11.11 Binary Logical Operators\n\nfunction parseBinaryExpression() {\n  var marker, markers, expr, token, prec, stack, right, operator, left, i;\n\n  marker = lookahead;\n  left = parseUnaryExpression();\n\n  token = lookahead;\n  prec = binaryPrecedence(token);\n  if (prec === 0) {\n    return left;\n  }\n  token.prec = prec;\n  lex();\n\n  markers = [marker, lookahead];\n  right = parseUnaryExpression();\n\n  stack = [left, token, right];\n\n  while ((prec = binaryPrecedence(lookahead)) > 0) {\n\n    // Reduce: make a binary expression from the three topmost entries.\n    while ((stack.length > 2) && (prec <= stack[stack.length - 2].prec)) {\n      right = stack.pop();\n      operator = stack.pop().value;\n      left = stack.pop();\n      markers.pop();\n      expr = finishBinaryExpression(operator, left, right);\n      stack.push(expr);\n    }\n\n    // Shift.\n    token = lex();\n    token.prec = prec;\n    stack.push(token);\n    markers.push(lookahead);\n    expr = parseUnaryExpression();\n    stack.push(expr);\n  }\n\n  // Final reduce to clean-up the stack.\n  i = stack.length - 1;\n  expr = stack[i];\n  markers.pop();\n  while (i > 1) {\n    markers.pop()\n    expr = finishBinaryExpression(stack[i - 1].value, stack[i - 2], expr);\n    i -= 2;\n  }\n\n  return expr;\n}\n\n// 11.12 Conditional Operator\n\nfunction parseConditionalExpression() {\n  var expr, consequent, alternate;\n\n  expr = parseBinaryExpression();\n\n  if (match('?')) {\n    lex();\n    consequent = parseConditionalExpression();\n    expect(':');\n    alternate = parseConditionalExpression();\n\n    expr = finishConditionalExpression(expr, consequent, alternate);\n  }\n\n  return expr;\n}\n\n// 11.14 Comma Operator\n\nfunction parseExpression() {\n  var expr = parseConditionalExpression();\n\n  if (match(',')) {\n    throw new Error(DISABLED); // no sequence expressions\n  }\n\n  return expr;\n}\n\nexport default function(code) {\n  source = code;\n  index = 0;\n  length = source.length;\n  lookahead = null;\n\n  peek();\n\n  var expr = parseExpression();\n\n  if (lookahead.type !== TokenEOF) {\n    throw new Error(\"Unexpect token after expression.\");\n  }\n  return expr;\n}\n","export default {\n  NaN:       'NaN',\n  E:         'Math.E',\n  LN2:       'Math.LN2',\n  LN10:      'Math.LN10',\n  LOG2E:     'Math.LOG2E',\n  LOG10E:    'Math.LOG10E',\n  PI:        'Math.PI',\n  SQRT1_2:   'Math.SQRT1_2',\n  SQRT2:     'Math.SQRT2',\n  MIN_VALUE: 'Number.MIN_VALUE',\n  MAX_VALUE: 'Number.MAX_VALUE'\n};\n","export default function(fn, fields, name) {\n  fn.fields = fields || [];\n  fn.fname = name;\n  return fn;\n}\n\nexport function accessorName(fn) {\n  return fn == null ? null : fn.fname;\n}\n\nexport function accessorFields(fn) {\n  return fn == null ? null : fn.fields;\n}\n","export default function(message) {\n  throw Error(message);\n}\n","export default Array.isArray;\n","export default function(_) {\n  return typeof _ === 'string';\n}\n","import isArray from './isArray';\nimport isObject from './isObject';\nimport isString from './isString';\n\nexport default function $(x) {\n  return isArray(x) ? '[' + x.map($) + ']'\n    : isObject(x) || isString(x) ?\n      // Output valid JSON and JS source strings.\n      // See http://timelessrepo.com/json-isnt-a-javascript-subset\n      JSON.stringify(x).replace('\\u2028','\\\\u2028').replace('\\u2029', '\\\\u2029')\n    : x;\n}\n","export default function(_) {\n  return _ === Object(_);\n}\n","import accessor from './accessor';\nimport field from './field';\n\nvar empty = [];\n\nexport var id = field('id');\n\nexport var identity = accessor(function(_) { return _; }, empty, 'identity');\n\nexport var zero = accessor(function() { return 0; }, empty, 'zero');\n\nexport var one = accessor(function() { return 1; }, empty, 'one');\n\nexport var truthy = accessor(function() { return true; }, empty, 'true');\n\nexport var falsy = accessor(function() { return false; }, empty, 'false');\n","import accessor from './accessor';\nimport splitAccessPath from './splitAccessPath';\nimport stringValue from './stringValue';\n\nexport default function(field, name) {\n  var path = splitAccessPath(field),\n      code = 'return _[' + path.map(stringValue).join('][') + '];';\n\n  return accessor(\n    Function('_', code),\n    [(field = path.length===1 ? path[0] : field)],\n    name || field\n  );\n}\n","import error from './error';\n\nexport default function(p) {\n  var path = [],\n      q = null,\n      b = 0,\n      n = p.length,\n      s = '',\n      i, j, c;\n\n  p = p + '';\n\n  function push() {\n    path.push(s + p.substring(i, j));\n    s = '';\n    i = j + 1;\n  }\n\n  for (i=j=0; j<n; ++j) {\n    c = p[j];\n    if (c === '\\\\') {\n      s += p.substring(i, j);\n      i = ++j;\n    } else if (c === q) {\n      push();\n      q = null;\n      b = -1;\n    } else if (q) {\n      continue;\n    } else if (i === b && c === '\"') {\n      i = j + 1;\n      q = c;\n    } else if (i === b && c === \"'\") {\n      i = j + 1;\n      q = c;\n    } else if (c === '.' && !b) {\n      if (j > i) {\n        push();\n      } else {\n        i = j + 1;\n      }\n    } else if (c === '[') {\n      if (j > i) push();\n      b = i = j + 1;\n    } else if (c === ']') {\n      if (!b) error('Access path missing open bracket: ' + p);\n      if (b > 0) push();\n      b = 0;\n      i = j + 1;\n    }\n  }\n\n  if (b) error('Access path missing closing bracket: ' + p);\n  if (q) error('Access path missing closing quote: ' + p);\n\n  if (j > i) {\n    j++;\n    push();\n  }\n\n  return path;\n}\n","export default function(_) {\n  return typeof _ === 'function';\n}\n","const hop = Object.prototype.hasOwnProperty;\n\nexport default function(object, property) {\n  return hop.call(object, property);\n}\n","export default function(_) {\n  for (var s={}, i=0, n=_.length; i<n; ++i) s[_[i]] = true;\n  return s;\n}\n","import {error} from 'vega-util';\n\nexport default function(codegen) {\n\n  function fncall(name, args, cast, type) {\n    var obj = codegen(args[0]);\n    if (cast) {\n      obj = cast + '(' + obj + ')';\n      if (cast.lastIndexOf('new ', 0) === 0) obj = '(' + obj + ')';\n    }\n    return obj + '.' + name + (type < 0 ? '' : type === 0 ?\n      '()' :\n      '(' + args.slice(1).map(codegen).join(',') + ')');\n  }\n\n  function fn(name, cast, type) {\n    return function(args) {\n      return fncall(name, args, cast, type);\n    };\n  }\n\n  var DATE = 'new Date',\n      STRING = 'String',\n      REGEXP = 'RegExp';\n\n  return {\n    // MATH functions\n    isNaN:    'Number.isNaN',\n    isFinite: 'Number.isFinite',\n    abs:      'Math.abs',\n    acos:     'Math.acos',\n    asin:     'Math.asin',\n    atan:     'Math.atan',\n    atan2:    'Math.atan2',\n    ceil:     'Math.ceil',\n    cos:      'Math.cos',\n    exp:      'Math.exp',\n    floor:    'Math.floor',\n    log:      'Math.log',\n    max:      'Math.max',\n    min:      'Math.min',\n    pow:      'Math.pow',\n    random:   'Math.random',\n    round:    'Math.round',\n    sin:      'Math.sin',\n    sqrt:     'Math.sqrt',\n    tan:      'Math.tan',\n\n    clamp: function(args) {\n      if (args.length < 3) error('Missing arguments to clamp function.');\n      if (args.length > 3) error('Too many arguments to clamp function.');\n      var a = args.map(codegen);\n      return 'Math.max('+a[1]+', Math.min('+a[2]+','+a[0]+'))';\n    },\n\n    // DATE functions\n    now:             'Date.now',\n    utc:             'Date.UTC',\n    datetime:        DATE,\n    date:            fn('getDate', DATE, 0),\n    day:             fn('getDay', DATE, 0),\n    year:            fn('getFullYear', DATE, 0),\n    month:           fn('getMonth', DATE, 0),\n    hours:           fn('getHours', DATE, 0),\n    minutes:         fn('getMinutes', DATE, 0),\n    seconds:         fn('getSeconds', DATE, 0),\n    milliseconds:    fn('getMilliseconds', DATE, 0),\n    time:            fn('getTime', DATE, 0),\n    timezoneoffset:  fn('getTimezoneOffset', DATE, 0),\n    utcdate:         fn('getUTCDate', DATE, 0),\n    utcday:          fn('getUTCDay', DATE, 0),\n    utcyear:         fn('getUTCFullYear', DATE, 0),\n    utcmonth:        fn('getUTCMonth', DATE, 0),\n    utchours:        fn('getUTCHours', DATE, 0),\n    utcminutes:      fn('getUTCMinutes', DATE, 0),\n    utcseconds:      fn('getUTCSeconds', DATE, 0),\n    utcmilliseconds: fn('getUTCMilliseconds', DATE, 0),\n\n    // sequence functions\n    length:      fn('length', null, -1),\n    join:        fn('join', null),\n    indexof:     fn('indexOf', null),\n    lastindexof: fn('lastIndexOf', null),\n    slice:       fn('slice', null),\n\n    reverse: function(args) {\n      return '('+codegen(args[0])+').slice().reverse()';\n    },\n\n    // STRING functions\n    parseFloat:  'parseFloat',\n    parseInt:    'parseInt',\n    upper:       fn('toUpperCase', STRING, 0),\n    lower:       fn('toLowerCase', STRING, 0),\n    substring:   fn('substring', STRING),\n    split:       fn('split', STRING),\n    replace:     fn('replace', STRING),\n    trim:        fn('trim', STRING, 0),\n\n    // REGEXP functions\n    regexp:  REGEXP,\n    test:    fn('test', REGEXP),\n\n    // Control Flow functions\n    if: function(args) {\n        if (args.length < 3) error('Missing arguments to if function.');\n        if (args.length > 3) error('Too many arguments to if function.');\n        var a = args.map(codegen);\n        return '('+a[0]+'?'+a[1]+':'+a[2]+')';\n      }\n  };\n}\n","import Constants from './constants';\nimport Functions from './functions';\nimport {error, hasOwnProperty, isFunction, isString, toSet} from 'vega-util';\n\nfunction stripQuotes(s) {\n  var n = s && s.length - 1;\n  return n && (\n      (s[0]==='\"' && s[n]==='\"') ||\n      (s[0]==='\\'' && s[n]==='\\'')\n    ) ? s.slice(1, -1) : s;\n}\n\nexport default function(opt) {\n  opt = opt || {};\n\n  var whitelist = opt.whitelist ? toSet(opt.whitelist) : {},\n      blacklist = opt.blacklist ? toSet(opt.blacklist) : {},\n      constants = opt.constants || Constants,\n      functions = (opt.functions || Functions)(visit),\n      globalvar = opt.globalvar,\n      fieldvar = opt.fieldvar,\n      globals = {},\n      fields = {},\n      memberDepth = 0;\n\n  var outputGlobal = isFunction(globalvar)\n    ? globalvar\n    : function (id) { return globalvar + '[\"' + id + '\"]'; };\n\n  function visit(ast) {\n    if (isString(ast)) return ast;\n    var generator = Generators[ast.type];\n    if (generator == null) error('Unsupported type: ' + ast.type);\n    return generator(ast);\n  }\n\n  var Generators = {\n    Literal: function(n) {\n        return n.raw;\n      },\n\n    Identifier: function(n) {\n      var id = n.name;\n      if (memberDepth > 0) {\n        return id;\n      } else if (hasOwnProperty(blacklist, id)) {\n        return error('Illegal identifier: ' + id);\n      } else if (hasOwnProperty(constants, id)) {\n        return constants[id];\n      } else if (hasOwnProperty(whitelist, id)) {\n        return id;\n      } else {\n        globals[id] = 1;\n        return outputGlobal(id);\n      }\n    },\n\n    MemberExpression: function(n) {\n        var d = !n.computed;\n        var o = visit(n.object);\n        if (d) memberDepth += 1;\n        var p = visit(n.property);\n        if (o === fieldvar) {\n          // strip quotes to sanitize field name (#1653)\n          fields[stripQuotes(p)] = 1;\n        }\n        if (d) memberDepth -= 1;\n        return o + (d ? '.'+p : '['+p+']');\n      },\n\n    CallExpression: function(n) {\n        if (n.callee.type !== 'Identifier') {\n          error('Illegal callee type: ' + n.callee.type);\n        }\n        var callee = n.callee.name;\n        var args = n.arguments;\n        var fn = hasOwnProperty(functions, callee) && functions[callee];\n        if (!fn) error('Unrecognized function: ' + callee);\n        return isFunction(fn)\n          ? fn(args)\n          : fn + '(' + args.map(visit).join(',') + ')';\n      },\n\n    ArrayExpression: function(n) {\n        return '[' + n.elements.map(visit).join(',') + ']';\n      },\n\n    BinaryExpression: function(n) {\n        return '(' + visit(n.left) + n.operator + visit(n.right) + ')';\n      },\n\n    UnaryExpression: function(n) {\n        return '(' + n.operator + visit(n.argument) + ')';\n      },\n\n    ConditionalExpression: function(n) {\n        return '(' + visit(n.test) +\n          '?' + visit(n.consequent) +\n          ':' + visit(n.alternate) +\n          ')';\n      },\n\n    LogicalExpression: function(n) {\n        return '(' + visit(n.left) + n.operator + visit(n.right) + ')';\n      },\n\n    ObjectExpression: function(n) {\n        return '{' + n.properties.map(visit).join(',') + '}';\n      },\n\n    Property: function(n) {\n        memberDepth += 1;\n        var k = visit(n.key);\n        memberDepth -= 1;\n        return k + ':' + visit(n.value);\n      }\n  };\n\n  function codegen(ast) {\n    var result = {\n      code:    visit(ast),\n      globals: Object.keys(globals),\n      fields:  Object.keys(fields)\n    };\n    globals = {};\n    fields = {};\n    return result;\n  }\n\n  codegen.functions = functions;\n  codegen.constants = constants;\n\n  return codegen;\n}\n","const textDefault = {\n  fill: \"#000\",\n  font: \"sans-serif\",\n  fontSize: 11,\n  opacity: 1,\n  baseline: \"alphabetic\"\n};\n// the browsers' default\nexport const BR_PROP_DEFAULT = {\n  none: {},\n  rect: { opacity: 1 },\n  gradient: { opacity: 1 },\n  group: { opacity: 1 },\n  tick: { opacity: 1 },\n  grid: { opacity: 1 },\n  domain: { opacity: 1 },\n  symbol: { opacity: 1, stroke: \"transparent\" },\n  line: { opacity: 1, fill: \"none\" },\n  // area: { opacity: 1, strokeWidth: \"1px\", stroke: \"none\" },\n  area: { opacity: 1, strokeWidth: \"0px\" },\n  trail: { opacity: 1, strokeWidth: \"0px\" },\n  rule: { opacity: 1 },\n  text: textDefault,\n  title: textDefault\n};\n","export const DEFAULT_EASE = {\n  mark: \"cubic\",\n  line: \"cubic\",\n  axis: \"cubic\",\n  legend: \"cubic\",\n  view: \"cubic\"\n};","// From https://github.com/vega/vega/blob/master/packages/vega-parser/src/config.js\n/**\n * Standard configuration defaults for Vega specification parsing.\n * Users can provide their own (sub-)set of these default values\n * by passing in a config object to the top-level parse method.\n */\nconst defaultFont = \"sans-serif\",\n  defaultSymbolSize = 30,\n  defaultStrokeWidth = 2,\n  defaultColor = \"#4c78a8\",\n  black = \"#000\",\n  gray = \"#888\",\n  lightGray = \"#ddd\";\nexport const vegaConfig = {\n  // default visualization description\n  description: \"Vega visualization\",\n\n  // default padding around visualization\n  padding: 0,\n\n  // default for automatic sizing; options: 'none', 'pad', 'fit'\n  // or provide an object (e.g., {'type': 'pad', 'resize': true})\n  autosize: \"pad\",\n\n  // default view background color\n  // covers the entire view component\n  background: null,\n\n  // default event handling configuration\n  // preventDefault for view-sourced event types except 'wheel'\n  events: {\n    defaults: {allow: [\"wheel\"]}\n  },\n\n  // defaults for top-level group marks\n  // accepts mark properties (fill, stroke, etc)\n  // covers the data rectangle within group width/height\n  group: null,\n\n  // defaults for basic mark types\n  // each subset accepts mark properties (fill, stroke, etc)\n  mark: null,\n  arc: { fill: defaultColor },\n  area: { fill: defaultColor },\n  image: null,\n  line: {\n    stroke: defaultColor,\n    strokeWidth: defaultStrokeWidth\n  },\n  path: { stroke: defaultColor },\n  rect: { fill: defaultColor },\n  rule: { stroke: black },\n  shape: { stroke: defaultColor },\n  symbol: {\n    fill: defaultColor,\n    size: 64\n  },\n  text: {\n    fill: black,\n    font: defaultFont,\n    fontSize: 11\n  },\n  trail: {\n    fill: defaultColor,\n    size: defaultStrokeWidth\n  },\n\n  // style definitions\n  style: {\n    // axis & legend labels\n    \"guide-label\": {\n      fill: black,\n      font: defaultFont,\n      fontSize: 10\n    },\n    // axis & legend titles\n    \"guide-title\": {\n      fill: black,\n      font: defaultFont,\n      fontSize: 11,\n      fontWeight: \"bold\"\n    },\n    // headers, including chart title\n    \"group-title\": {\n      fill: black,\n      font: defaultFont,\n      fontSize: 13,\n      fontWeight: \"bold\"\n    },\n    // chart subtitle\n    \"group-subtitle\": {\n      fill: black,\n      font: defaultFont,\n      fontSize: 12\n    },\n    // defaults for styled point marks in Vega-Lite\n    point: {\n      size: defaultSymbolSize,\n      strokeWidth: defaultStrokeWidth,\n      shape: \"circle\"\n    },\n    circle: {\n      size: defaultSymbolSize,\n      strokeWidth: defaultStrokeWidth\n    },\n    square: {\n      size: defaultSymbolSize,\n      strokeWidth: defaultStrokeWidth,\n      shape: \"square\"\n    },\n    // defaults for styled group marks in Vega-Lite\n    cell: {\n      fill: \"transparent\",\n      stroke: lightGray\n    }\n  },\n\n  // defaults for title\n  title: {\n    orient: \"top\",\n    anchor: \"middle\",\n    offset: 4,\n    subtitlePadding: 3\n  },\n\n  // defaults for axes\n  axis: {\n    minExtent: 0,\n    maxExtent: 200,\n    bandPosition: 0.5,\n    domain: true,\n    domainWidth: 1,\n    domainColor: gray,\n    grid: false,\n    gridWidth: 1,\n    gridColor: lightGray,\n    labels: true,\n    labelAngle: 0,\n    labelLimit: 180,\n    labelOffset: 0,\n    labelPadding: 2,\n    ticks: true,\n    tickColor: gray,\n    tickOffset: 0,\n    tickRound: true,\n    tickSize: 5,\n    tickWidth: 1,\n    titlePadding: 4\n  },\n\n  // correction for centering bias\n  axisBand: {\n    tickOffset: -0.5\n  },\n\n  // defaults for cartographic projection\n  projection: {\n    type: \"mercator\"\n  },\n\n  // defaults for legends\n  legend: {\n    orient: \"right\",\n    padding: 0,\n    gridAlign: \"each\",\n    columnPadding: 10,\n    rowPadding: 2,\n    symbolDirection: \"vertical\",\n    gradientDirection: \"vertical\",\n    gradientLength: 200,\n    gradientThickness: 16,\n    gradientStrokeColor: lightGray,\n    gradientStrokeWidth: 0,\n    gradientLabelOffset: 2,\n    labelAlign: \"left\",\n    labelBaseline: \"middle\",\n    labelLimit: 160,\n    labelOffset: 4,\n    labelOverlap: true,\n    symbolLimit: 30,\n    symbolType: \"circle\",\n    symbolSize: 100,\n    symbolOffset: 0,\n    symbolStrokeWidth: 1.5,\n    symbolBaseFillColor: \"transparent\",\n    symbolBaseStrokeColor: gray,\n    titleLimit: 180,\n    titleOrient: \"top\",\n    titlePadding: 5,\n    layout: {\n      offset: 18,\n      direction: \"horizontal\",\n      left:   { direction: \"vertical\" },\n      right:  { direction: \"vertical\" }\n    }\n  },\n\n  // defaults for scale ranges\n  range: {\n    category: {\n      scheme: \"tableau10\"\n    },\n    ordinal: {\n      scheme: \"blues\"\n    },\n    heatmap: {\n      scheme: \"yellowgreenblue\"\n    },\n    ramp: {\n      scheme: \"blues\"\n    },\n    diverging: {\n      scheme: \"blueorange\",\n      extent: [1, 0]\n    },\n    symbol: [\n      \"circle\",\n      \"square\",\n      \"triangle-up\",\n      \"cross\",\n      \"diamond\",\n      \"triangle-right\",\n      \"triangle-down\",\n      \"triangle-left\"\n    ]\n  }\n};\n\n","export function encodify(obj) {\n  return Object.keys(obj).reduce((encode, key) => {\n    encode[key] = { value: obj[key] };\n    return encode;\n  }, {});\n}\n","import { vegaConfig } from \"./vegaConfig\";\nimport { encodify } from \"./util\";\nexport const DEFAULT_STYLE = Object.keys(vegaConfig.style).reduce(\n  (styles, key) => {\n    styles[key] = encodify(vegaConfig.style[key]);\n    return styles;\n  },\n  {}\n);\n","import { vegaConfig as vgConfig } from \"../vegaConfig\";\n\nconst EMPTY_ENCODE = {\n  enter: { opacity: { value: 0 } },\n  exit: { opacity: { value: 0 } },\n  update: { }\n};\n\n\nfunction axisCompPos(spec) {\n  if (!spec) {\n    return {};\n  }\n  const scName = spec.scale;\n  if (spec.orient === \"left\" || spec.orient === \"right\") {\n    return { y: { scale: scName, field: \"value\", band: 0.5 } };\n  }\n  return { x: { scale: scName, field: \"value\", band: 0.5 } };\n}\nfunction legendBandPos(spec) {\n  let grLength = spec ? spec.gradientLength : undefined;\n  let grThickness = spec ? spec.gradientThickness : undefined;\n  grLength = grLength || vgConfig.legend.gradientLength;\n  grThickness = grThickness || vgConfig.legend.gradientThickness;\n\n  if (spec && spec.direction === \"horizontal\") {\n    return {\n      x: { signal: \"(1-datum.perc)\", mult: grLength },\n      x2: { signal: \"(1-datum.perc2)\", mult: grLength },\n      y: { value: 0 },\n      height: { value: grThickness }\n    };\n  }\n  return {\n    y: { signal: \"(1-datum.perc)\", mult: grLength },\n    y2: { signal: \"(1-datum.perc2)\", mult: grLength },\n    x: { value: 0 },\n    width: { value: grThickness }\n  };\n}\n\nfunction legendLablePos(spec) {\n  let grLength = spec ? spec.gradientLength : undefined;\n  grLength = isNaN(grLength) ? vgConfig.legend.gradientLength : grLength;\n  let grThickness = spec ? spec.gradientThickness : undefined;\n  grThickness = isNaN(grThickness) ? vgConfig.legend.gradientThickness : grThickness;\n  let grLabelOffset = spec ? spec.gradientLabelOffset : undefined;\n  grLabelOffset = isNaN(grLabelOffset) ? vgConfig.legend.gradientLabelOffset : grLabelOffset;\n\n  if (spec.type === \"symbol\") {\n    return {\n      x: { value: 0 },\n      y: { value: 0 },\n      dx: { value: 16 },\n      dy: { value: 6 }\n    };\n  }\n  if (spec.direction === \"vertical\") {\n    return {\n      x: { value: 0, },\n      y: { signal: `(1-datum.perc) * clamp(height, 64, ${grLength})` },\n      dx: { value: grThickness + grLabelOffset }\n    };\n  }\n  return {\n    x: { signal: `(datum.perc) * clamp(width, 64, ${grLength})` },\n    y: { value: 0, },\n    dy: { value: grThickness + grLabelOffset }\n  };\n}\n\n\nfunction titlePos(orient) {\n  if (orient === \"top\") {\n    return {x: { signal: \"width\", mult: 0.5}, y: {value: -22}};\n  } if (orient === \"bottom\") {\n    return {x: { signal: \"width\", mult: 0.5}, y: {value: 22}};\n  } if (orient === \"right\") {\n    return {y: { signal: \"height\", mult: 0.5}, x: {value: 22}};\n  }\n  return {y: { signal: \"height\", mult: 0.5}, x: {value: -22}};\n\n}\nfunction titleAngle(orient) {\n  if (orient === \"left\") {\n    return 270;\n  }\n  if (orient === \"right\") {\n    return 90;\n  }\n  return 0;\n}\nfunction baseline(orient) {\n  if (orient === \"top\") {\n    return \"bottom\";\n  }\n  if (orient === \"bottom\") {\n    return \"top\";\n  }\n  return \"middle\";\n}\nfunction tickLength(attr, orient) {\n  if (attr === \"x2\") {\n    if (orient === \"right\") {\n      return vgConfig.axis.tickSize;\n    }\n    if (orient === \"left\") {\n      return -vgConfig.axis.tickSize;\n    }\n  } else if (attr === \"y2\") {\n    if (orient === \"bottom\") {\n      return vgConfig.axis.tickSize;\n    }\n    if (orient === \"top\") {\n      return -vgConfig.axis.tickSize;\n    }\n  }\n  return 0;\n}\n\nfunction axisLabelAlign(spec) {\n  if (spec && spec.labelAlign) {\n    return spec.labelAlign;\n  }\n\n  if (spec && spec.orient === \"right\") {\n    return \"left\";\n  }\n  if (spec && spec.orient === \"left\") {\n    return \"right\";\n  }\n  return \"center\";\n}\n\nfunction legendLabelAlign(spec) {\n  if (spec && spec.labelAlign) {\n    return spec.labelAlign;\n  }\n\n  if (spec && spec.orient === \"right\") {\n    return \"left\";\n  }\n  if (spec && spec.orient === \"left\") {\n    return \"right\";\n  }\n  return \"center\";\n}\n\nfunction lableAngle(orient, scaleType) {\n  if (orient === \"top\" || orient === \"bottom\") {\n    if ([\"band\", \"point\"].indexOf(scaleType) >= 0) {\n      return 270;\n    }\n  }\n  return 0;\n}\nfunction axisTextDpos(attr, orient) {\n  if (attr === \"dx\") {\n    if (orient === \"right\") {\n      return 7;\n    }\n    if (orient === \"left\") {\n      return -7;\n    }\n  } else if (attr === \"dy\") {\n    if (orient === \"bottom\") {\n      return 7;\n    }\n    if (orient === \"top\") {\n      return -7;\n    }\n  }\n  return 0;\n}\n\nfunction gridLength(orient, gridScale){\n  if (orient === \"bottom\" || orient === \"top\") {\n    if (!gridScale){\n      return {\n        y2: {signal: \"height\", mult: -1},\n        y: {value: 0},\n        x2: {value: 0}\n      };\n    }\n    return {\n      // y2: {signal: \"height\"},\n      // y: {signal: \"height\", mult: -1},\n      y2: {signal: \"height\", mult: -1},\n      y: {value: 0},\n      x2: {value: 0}\n    };\n\n  }\n\n  if (orient === \"right\" || orient === \"left\") {\n    if (!gridScale){\n      return {\n        x2: {signal: \"width\"},\n        x: {value: 0},\n        y2: {value: 0}\n      };\n    }\n    return {\n      x2: {signal: \"width\"},\n      x: {value: 0},\n      y2: {value: 0}\n    };\n\n  }\n\n}\n\nfunction domainLength(orient) {\n  if (orient === \"bottom\" || orient === \"top\") {\n    return {\n      y2: { value: 0 },\n      x2: { signal: \"width\" },\n      y: { value: 0 },\n      x: { value: 0 }\n    };\n  }\n  if (orient === \"right\" || orient === \"left\") {\n    return {\n      y2: { signal: \"height\", mult: 1 },\n      x2: { value: 0 },\n      y: { value: 0 },\n      x: { value: 0 }\n    };\n  }\n  return {\n    y2: { value: 0 },\n    x2: { value: 0 }\n  };\n}\n\nexport {\n\n  legendBandPos,\n  legendLablePos,\n  legendLabelAlign,\n\n  titlePos,\n  titleAngle,\n  baseline,\n\n  axisCompPos,\n  lableAngle,\n  tickLength,\n  axisLabelAlign,\n  axisTextDpos,\n  gridLength,\n  domainLength,\n\n  EMPTY_ENCODE\n};","import { vegaConfig as vgConfig } from \"../vegaConfig\";\nimport * as vg from \"./vegaDefault\";\nimport { copy } from \"../../util/util\";\nconst LEGEND_SYMBOL_CHANNEL = [\n  \"fill\",\n  \"opacity\",\n  \"shape\",\n  \"size\",\n  \"stroke\",\n  \"strokeDash\",\n  \"strokeWidth\"\n];\n\nexport const DEFAULT_ENCODE_LEGEND = {\n\n  title: () => {\n    const defaultTitleEncode = {\n      fontSize: { value: vgConfig.style[\"guide-title\"].fontSize },\n      fontWeight: { value: \"bold\" }\n    };\n\n    return {\n      update: defaultTitleEncode,\n      enter: {...defaultTitleEncode, opacity: {value: 0}},\n      exit: {...defaultTitleEncode, opacity: {value: 0}},\n    };\n  },\n  labels: spec => {\n    if (!spec) {\n      return copy(vg.EMPTY_ENCODE);\n    }\n\n    let defaultEncode = {\n      ...vg.legendLablePos(spec),\n      text: { field: \"label\" },\n      fontSize: { value: vgConfig.style[\"guide-label\"].fontSize },\n      align: { value: vg.legendLabelAlign(spec) },\n      baseline: {\n        value: spec.baseline || vg.baseline(spec.orient)\n      },\n      angle: {\n        value: spec.labelAngle || vg.lableAngle(spec.orient, spec.scaleType)\n      }\n    };\n\n\n    return {\n      enter: {...defaultEncode, opacity: { value: 0 } },\n      exit: {...defaultEncode, opacity: { value: 0 } },\n      update: defaultEncode\n    };\n  },\n  symbols: spec => {\n    const defaultEncode = {\n      y: { value: 6 },\n      x: { value: 6 },\n      shape: { value: vgConfig.legend.symbolType },\n      size: { value: vgConfig.legend.symbolSize },\n      strokeWidth: { value: vgConfig.legend.symbolStrokeWidth }\n    };\n\n    if (spec) {\n      if (!spec.fill) {\n        defaultEncode.stroke = {\n          value: vgConfig.legend.symbolBaseStrokeColor\n        };\n        defaultEncode.fill = {\n          value: vgConfig.legend.symbolBaseFillColor\n        };\n      }\n\n      LEGEND_SYMBOL_CHANNEL.forEach(channel => {\n        if (channel === \"shape\") {\n          defaultEncode[channel] = { value: spec.symbolType };\n        }\n        if (spec[channel]) {\n          defaultEncode[channel] = { scale: spec[channel], field: \"value\" };\n        }\n      });\n    }\n\n    return {\n      update: defaultEncode,\n      enter: Object.assign({}, defaultEncode, { opacity: { value: 0 } }),\n      exit: Object.assign({}, defaultEncode, { opacity: { value: 0 } })\n    };\n  },\n  gradient: spec => {\n    if (!spec) {\n      return copy(vg.EMPTY_ENCODE);\n    }\n\n    let grLength = spec.gradientLength ||\n      {\n        signal: `clamp(${spec.direction === \"vertical\" ? \"height\" : \"width\"}, 64, ${vgConfig.legend.gradientLength})`\n      },\n      grThickness = spec.gradientThickness || vgConfig.legend.gradientThickness;\n    if (typeof grLength === \"number\") {\n      grLength= {\n        signal: `clamp(${spec.direction === \"vertical\" ? \"height\" : \"width\"}, 64, ${grLength})`\n      };\n    }\n    const defaultEncode = {\n      x: { value: 0 },\n      y: { value: 0 },\n      width:\n        spec.direction === \"vertical\"\n          ? { value: grThickness }\n          : grLength,\n      height:\n        spec.direction === \"vertical\"\n          ? grLength\n          : { value: grThickness }\n    };\n\n    return {\n      update: defaultEncode,\n      enter: Object.assign({}, defaultEncode, { opacity: { value: 0 } }),\n      exit: Object.assign({}, defaultEncode, { opacity: { value: 0 } })\n    };\n  },\n  entries: () => {\n    return copy(vg.EMPTY_ENCODE);\n  },\n  legend: () => {\n    return copy(vg.EMPTY_ENCODE);\n  },\n  pairs: spec => {\n    let defaultEncode = { y: { signal: \"datum.index * 13\" } };\n    if (spec && spec.direction === \"horizontal\") {\n      defaultEncode = { x: { signal: \"datum.index * 50\" } };\n    }\n\n    return {\n      update: defaultEncode,\n      enter: Object.assign({}, defaultEncode, { opacity: { value: 0 } }),\n      exit: Object.assign({}, defaultEncode, { opacity: { value: 0 } })\n    };\n  },\n  bands: spec => {\n    let defaultEncode = {\n      ...vg.legendBandPos(spec),\n      fill: {\n        value: vgConfig.legend.symbolBaseFillColor\n      }\n    };\n    if (spec && (spec.fill || spec.stroke)) {\n      defaultEncode.fill = { scale: spec.fill || spec.stroke, field: \"value\" };\n    }\n\n    return {\n      update: defaultEncode,\n      enter: {\n        ...defaultEncode,\n        opacity: { value: 0 }\n      },\n      exit: {\n        ...defaultEncode,\n        opacity: { value: 0 }\n      }\n    };\n  }\n};","import { DEFAULT_ENCODE_LEGEND } from \"./legend\";\nimport { DEFAULT_ENCODE_MARK } from \"./mark\";\nimport { DEFAULT_ENCODE_AXIS } from \"./axis\";\n\n// DEFAULT enter means initials of the enter\nexport const DEFAULT_ENCODE = {\n  mark: DEFAULT_ENCODE_MARK,\n  axis: DEFAULT_ENCODE_AXIS,\n  legend: DEFAULT_ENCODE_LEGEND\n};\n","import { encodify } from \"../util\";\nimport { vegaConfig as vgConfig } from \"../vegaConfig\";\nexport const DEFAULT_ENCODE_MARK = {\n  enter: { opacity: { value: 0 } },\n  exit: { opacity: { value: 0 } },\n  line: {\n    update: {\n      ...encodify(vgConfig.line),\n      fill: { value: \"none\" }\n    }\n  },\n  area: {update: encodify(vgConfig.area)},\n  trail: {update: encodify(vgConfig.trail)},\n  symbol: { update: encodify(vgConfig.symbol)  },\n  rect: {    update: encodify(vgConfig.rect) },\n  rule: {    update: encodify(vgConfig.rule)  },\n  text: {    update: encodify(vgConfig.text)  }\n};","import { vegaConfig as vgConfig } from \"../vegaConfig\";\nimport * as vg from \"./vegaDefault\";\nimport { isNumber, copy } from \"../../util/util\";\n\n\nexport const DEFAULT_ENCODE_AXIS = {\n  axis: () => {\n    return copy(vg.EMPTY_ENCODE);\n  },\n  labels: spec => {\n    const orient = spec ? spec.orient : undefined;\n    const scaleType = spec ? spec.scaleType : undefined;\n\n    const defaultEncode = {\n      ...vg.axisCompPos(spec),\n      text: { field: \"label\" },\n      fontSize: { value: vgConfig.style[\"guide-label\"].fontSize },\n      dx: { value: vg.axisTextDpos(\"dx\", orient) },\n      dy: { value: vg.axisTextDpos(\"dy\", orient) },\n      align: { value: vg.axisLabelAlign(spec) },\n      baseline: {\n        value: spec && spec.baseline ? spec.baseline : vg.baseline(orient)\n      },\n      angle: {\n        value:\n          spec && isNumber(spec.labelAngle)\n            ? spec.labelAngle\n            : vg.lableAngle(orient, scaleType)\n      }\n    };\n\n    return {\n      enter: { ...defaultEncode, opacity: { value: 0 } },\n      exit: { ...defaultEncode, opacity: { value: 0 } },\n      update: defaultEncode\n    };\n  },\n  ticks: spec => {\n    const orient = spec ? spec.orient : undefined;\n    const defaultEncode = Object.assign({}, vg.axisCompPos(spec), {\n      x2: { value: vg.tickLength(\"x2\", orient) },\n      y2: { value: vg.tickLength(\"y2\", orient) },\n      strokeWidth: { value: vgConfig.axis.tickWidth },\n      stroke: { value: vgConfig.axis.tickColor }\n    });\n    return {\n      enter: { ...defaultEncode, opacity: { value: 0 } },\n      exit: { ...defaultEncode, opacity: { value: 0 } },\n      update: defaultEncode\n    };\n  },\n  grid: spec => {\n    const orient = spec ? spec.orient : undefined;\n    const gridScale = spec ? spec.gridScale : undefined;\n    const defaultEncode = Object.assign(\n      {},\n      vg.axisCompPos(spec),\n      vg.gridLength(orient, gridScale),\n      {\n        strokeWidth: { value: vgConfig.axis.gridWidth },\n        stroke: { value: vgConfig.axis.gridColor }\n      }\n    );\n\n    return {\n      enter: { ...defaultEncode, opacity: { value: 0 } },\n      exit: { ...defaultEncode, opacity: { value: 0 } },\n      update: defaultEncode\n    };\n  },\n  title: spec => {\n    const orient = spec ? spec.orient : undefined;\n    const defaultEncode = Object.assign(\n      {\n        baseline: { value: vg.baseline(orient) },\n        align: { value: \"center\" },\n        angle: { value: vg.titleAngle(orient) },\n        fontSize: { value: vgConfig.style[\"guide-title\"].fontSize },\n        fontWeight: { value: \"bold\" }\n      },\n      vg.titlePos(orient)\n    );\n    return {\n      enter: { ...defaultEncode, opacity: { value: 0 } },\n      exit: { ...defaultEncode, opacity: { value: 0 } },\n      update: defaultEncode\n    };\n  },\n  domain: spec => {\n    const defaultEncode = {\n      ...(spec ? vg.domainLength(spec.orient) : {}),\n      strokeWidth: { value: vgConfig.axis.domainWidth },\n      stroke: { value: vgConfig.axis.domainColor }\n    };\n\n    return {\n      enter: { ...defaultEncode, opacity: { value: 0 } },\n      exit: { ...defaultEncode, opacity: { value: 0 } },\n      update: defaultEncode\n    };\n  }\n};\n","/* eslint-disable prefer-destructuring */\n/* eslint-disable no-restricted-globals */\n/* eslint-disable no-use-before-define */\n/* eslint-disable camelcase */\nimport * as vega from \"vega\";\nimport * as d3 from \"d3\";\nimport { DEFAULT_EASE } from \"../default\";\n\nfunction getEaseFn(easeFnName) {\n  const name = easeFnName || DEFAULT_EASE.mark;\n  return d3[`ease${name.slice(0, 1).toUpperCase() + name.slice(1)}`];\n}\n\n\nfunction findAfterSibling(scene, name) {\n  let result;\n  for (let i = 0; i < scene.items.length; i++) {\n    const s = scene.items[i];\n    if (s.name === name) {\n      return scene.items[i + 1];\n    }\n    if (s.items) {\n      result = findAfterSibling(s, name);\n    }\n  }\n  return result;\n}\n\nfunction getJoinInfo(d, i, step, prop) {\n  return d.__gemini__[step.stepId]\n    ? d.__gemini__[step.stepId][prop]\n    : undefined;\n}\n\nfunction findComp(scene, name, role) {\n  let result = [];\n  scene.items.forEach(item => {\n    if (item.items) {\n      result = result.concat(findComp(item, name, role));\n    }\n\n    if (item.role === role && item.name === name) {\n      result.push(item);\n    }\n  });\n  return result; // return the first item.\n}\nfunction svgRender(vegaScene) {\n  const svg = new vega.SVGRenderer()\n    .initialize(document.createElement(\"div\"), 1, 1)\n    .render(vegaScene)\n    .svg();\n  const p = new DOMParser();\n  const dom = p.parseFromString(svg, \"image/svg+xml\");\n  return dom.documentElement;\n}\n\nfunction gradientRender(d3RootSelection, d) {\n  const s = vega.sceneFromJSON(vega.sceneToJSON(d.mark));\n  s.items[0].fill = d.fill;\n  const dom = svgRender(s);\n  const gradientDom = dom.getElementsByTagName(\"defs\")[0].firstElementChild;\n  let d3DefsSelection = d3RootSelection.select(\"defs\");\n  if (d3DefsSelection.empty()) {\n    d3DefsSelection = d3RootSelection.append(\"defs\");\n  }\n  d3DefsSelection.node().appendChild(gradientDom);\n  return `${window.location.origin + window.location.pathname}#${\n    gradientDom.id\n  }`;\n}\n\n\nfunction propMap(prop) {\n  let propName = prop;\n  let tweaks;\n  if (typeof prop === \"object\") {\n    propName = prop.name;\n    tweaks = prop.tweaks;\n  }\n  let result = [];\n  switch (propName) {\n  case \"text\":\n    result = result.concat([\n      { type: \"text\", val: \"text\" },\n      { type: \"attr\", val: \"transform\" },\n      { type: \"style\", val: \"opacity\" },\n      { type: \"style\", val: \"font\" },\n      { type: \"style\", val: \"fontSize\" },\n      { type: \"style\", val: \"fill\" }\n    ]);\n    break;\n  case \"title\":\n    result = result.concat([\n      { type: \"text\", val: \"text\" },\n      { type: \"attr\", val: \"transform\" },\n      { type: \"style\", val: \"opacity\" },\n      { type: \"style\", val: \"font\" },\n      { type: \"style\", val: \"fontSize\" },\n      { type: \"style\", val: \"fontWeight\" },\n      { type: \"style\", val: \"fill\" }\n    ]);\n    break;\n  case \"tick\":\n    result = result.concat([\n      { type: \"attr\", val: \"transform\" },\n      { type: \"attr\", val: \"x2\" },\n      { type: \"attr\", val: \"y2\" },\n      { type: \"style\", val: \"strokeWidth\" },\n      { type: \"style\", val: \"stroke\" },\n      { type: \"style\", val: \"opacity\" }\n    ]);\n    break;\n  case \"grid\":\n    result = result.concat([\n      { type: \"attr\", val: \"transform\" },\n      { type: \"attr\", val: \"x2\" },\n      { type: \"attr\", val: \"y2\" },\n      { type: \"style\", val: \"strokeWidth\" },\n      { type: \"style\", val: \"stroke\" },\n      { type: \"style\", val: \"opacity\" }\n    ]);\n    break;\n  case \"domain\":\n    result = result.concat([\n      { type: \"attr\", val: \"transform\" },\n      { type: \"attr\", val: \"x2\" },\n      { type: \"attr\", val: \"y2\" },\n      { type: \"style\", val: \"strokeWidth\" },\n      { type: \"style\", val: \"stroke\" },\n      { type: \"style\", val: \"opacity\" }\n    ]);\n    break;\n  case \"rect\":\n    result = result.concat([\n      { type: \"attrTween\", val: \"d\" },\n      { type: \"attr\", val: \"transform\" },\n      { type: \"style\", val: \"opacity\" },\n      { type: \"style\", val: \"fill\" },\n      { type: \"style\", val: \"strokeWidth\" },\n      { type: \"style\", val: \"stroke\" }\n    ]);\n    break;\n  case \"gradient\":\n    result = result.concat([\n      { type: \"attr\", val: \"d\" },\n      { type: \"style\", val: \"opacity\" },\n      { type: \"style\", val: \"fill\", defs: gradientRender },\n      { type: \"style\", val: \"strokeWidth\" },\n      { type: \"style\", val: \"stroke\" }\n    ]);\n    break;\n  case \"rule\":\n    result = result.concat([\n      { type: \"attr\", val: \"transform\" },\n      { type: \"attr\", val: \"x2\" },\n      { type: \"attr\", val: \"y2\" },\n      { type: \"style\", val: \"strokeWidth\" },\n      { type: \"style\", val: \"stroke\" },\n      { type: \"style\", val: \"opacity\" }\n    ]);\n    break;\n  case \"symbol\":\n    result = result.concat([\n      { type: \"attrTween\", val: \"d\" },\n      { type: \"attr\", val: \"size\" },\n      { type: \"attr\", val: \"transform\" },\n      { type: \"style\", val: \"strokeWidth\" },\n      { type: \"style\", val: \"stroke\" },\n      { type: \"style\", val: \"opacity\" },\n      { type: \"style\", val: \"fill\" }\n    ]);\n    break;\n  case \"group\":\n    result = result.concat([\n      { type: \"attr\", val: \"transform\" },\n      { type: \"style\", val: \"opacity\" }\n    ]);\n    break;\n  case \"background\":\n    result = result.concat([{ type: \"attr\", val: \"d\" }]);\n    break;\n  case \"line\":\n    result = result.concat([\n      { type: \"attrTween\", val: \"d\" },\n      { type: \"style\", val: \"strokeWidth\" },\n      { type: \"style\", val: \"stroke\" },\n      { type: \"style\", val: \"opacity\" },\n      { type: \"style\", val: \"fill\" }\n    ]);\n    break;\n  case \"trail\":\n  case \"area\":\n    result = result.concat([\n      { type: \"attrTween\", val: \"d\" },\n      { type: \"style\", val: \"strokeWidth\" },\n      { type: \"style\", val: \"stroke\" },\n      { type: \"style\", val: \"opacity\" },\n      { type: \"style\", val: \"fill\" }\n    ]);\n    break;\n  case \"legend-pair\":\n    result = result.concat([{ type: \"attr\", val: \"transform\" }]);\n    break;\n  default:\n    break;\n  }\n  if (prop.excludes) {\n    prop.excludes.forEach(exclude => {\n      result = result.filter(\n        r => !(r.type === exclude.type && r.val === exclude.val)\n      );\n    });\n  }\n  if (result.length > 0) {\n    result.forEach(p => {\n      p.elmType = propName;\n      if (tweaks) {\n        tweaks\n          .filter(twk => twk.type === p.type && twk.val === p.val)\n          .forEach(twk => {\n            p = Object.assign(p, twk);\n          });\n      }\n    });\n    return result;\n  }\n  if (propName === \"align\") {\n    return [{ type: \"attr\", val: \"text-anchor\", elmType: \"none\" }];\n  }\n  return [{ type: \"style\", val: propName, elmType: \"none\" }];\n}\n\nfunction computeScale(scales, scNames, getScales) {\n  const computed = Object.assign({}, scales);\n\n  scNames.forEach(scName => {\n    computed.initial[scName] = getScales.initial(scName);\n    computed.final[scName] = getScales.final(scName);\n  });\n  return computed;\n}\n\nfunction isLinearMarktype(mtype) {\n  return [\"area\", \"line\", \"trail\"].indexOf(mtype) >= 0;\n}\n\nexport {\n  propMap,\n  getEaseFn,\n  findAfterSibling,\n  getJoinInfo,\n  findComp,\n  svgRender,\n  computeScale,\n  isLinearMarktype\n};\n","function computeHasFacet(compSpec) {\n  if (\n    compSpec &&\n    compSpec.parent &&\n    compSpec.parent.from &&\n    compSpec.parent.from.facet &&\n    compSpec.parent.from.facet.data &&\n    compSpec.parent.from.facet.name === compSpec.from.data\n  ) {\n    return true;\n  }\n  return false;\n}\n\nfunction getFacet(compSpec) {\n  return computeHasFacet(compSpec) ? compSpec.parent.from.facet : undefined;\n}\n\nfunction isGroupingMarktype(marktype) {\n  return marktype === \"line\" || marktype === \"area\" || marktype === \"trail\";\n}\n\nfunction findMark(marks, markName) {\n  let result;\n  for (let i = 0; i < marks.length; i++) {\n    const m = marks[i];\n    if (m.name === markName) {\n      return m;\n    }\n    if (m.marks) {\n      result = findMark(m.marks, markName);\n      if (result) {\n        break;\n      }\n    }\n  }\n  return result;\n}\n\nfunction findData(spec, dataName) {\n  for (let i = 0; i < spec.data.length; i++) {\n    if (spec.data[i].name === dataName) {\n      return spec.data[i];\n    }\n  }\n}\nfunction findFilter(spec, name) {\n  for (let i = 0; i < spec.data.length; i++) {\n    const d = spec.data[i];\n    if (d.transform) {\n      const filter = d.transform.find(filter => filter.name === name);\n      if (filter) {\n        return filter;\n      }\n    }\n  }\n}\n\nexport {\n  computeHasFacet,\n  getFacet,\n  isGroupingMarktype,\n  findMark,\n  findData,\n  findFilter\n};\n","import { parse, codegen as vgCodegen } from \"vega-expression\";\nimport * as d3 from \"d3\";\nimport * as vega from \"vega\";\nimport {copy, flatten} from \"./util/util.js\";\nimport { getEaseFn } from \"./actuator/util\";\nimport { findFilter } from \"./changeFetcher/state/util\";\n\n\nclass Enumerator {\n  constructor(enumDef, spec, rawInfo) {\n    this.views = getStops(enumDef, spec, rawInfo);\n    this.stopN = this.views.length;\n    this.enumDef = enumDef;\n    this.currSpec = spec;\n    this.easeFn = getEaseFn(enumDef.ease);\n    this.delay = enumDef.delay || 0;\n    this.staggering = enumDef.staggering;\n    this.rawInfo = rawInfo;\n  }\n\n  _getScales(stop_n) {\n    return scName => {\n      const view = this.views[stop_n];\n      return view._runtime.scales[scName]\n        ? view._runtime.scales[scName].value\n        : undefined;\n    };\n  }\n\n  getData(stop_n) {\n    if (this.extractData && this.getId) {\n      return this.extractData(this.views[stop_n]);\n    }\n    throw Error(\"Cannot return data without joining data.\");\n  }\n\n  getDatum(id, stop_n) {\n    if (this.extractData && this.getId) {\n      const found = this.extractData(this.views[stop_n]).find(\n        (d, i) => this.getId(d, i) === id\n      );\n      return found && found.datum ? found.datum : found;\n    }\n    throw Error(\"Cannot return data without joining data.\");\n  }\n\n  joinData(extractData, identifyData) {\n    this.extractData = extractData;\n    this.getId = identifyData;\n    let currDataKeys = this.extractData(this.views[0]).map(this.getId);\n\n    this.joinDataInfo = this.views.slice(1).map(view => {\n      const join = {\n        update: [],\n        enter: [],\n        exit: []\n      };\n      const newDataKeys = extractData(view).map(this.getId);\n      currDataKeys.forEach(cKey => {\n        const foundIndex = newDataKeys.indexOf(cKey);\n        if (foundIndex >= 0) {\n          join.update.push(cKey);\n        } else {\n          join.exit.push(cKey);\n        }\n      });\n      join.enter = newDataKeys.filter(nKey => currDataKeys.indexOf(nKey) < 0);\n\n      currDataKeys = newDataKeys;\n\n      return [\"update\", \"enter\", \"exit\"].reduce((accMap, set) => {\n        return Object.assign(\n          accMap,\n          join[set].reduce((acc, key) => {\n            acc[key] = set;\n            return acc;\n          }, {})\n        );\n      }, {});\n    });\n    this.allKeys = flatten(this.joinDataInfo.map(Object.keys)).unique();\n    this.set = (id, stop_n) => this.joinDataInfo[stop_n][id];\n  }\n\n  getPropVal(prop, encodes, stop_n, id) {\n    const d = this.extractData(this.views[stop_n]).find(\n      (x, i) => this.getId(x, i) === id\n    );\n    const dSet = this.set(id, stop_n);\n    if (!dSet) {\n      return [\"x2\", \"y2\"].indexOf(prop.val) >= 0 ? 0 : \"\";\n    }\n    const getScales = {\n      initial: this._getScales(stop_n),\n      final: this._getScales(stop_n + 1)\n    };\n    return encodes[dSet].initial(prop, getScales, d);\n  }\n\n  interpolateAlongEnumMaker(prop, encodes, elem) {\n    return id => {\n      return t => {\n        const stop_n = Math.min(Math.floor(t * (this.stopN - 1)), this.stopN - 2);\n        let d_i = this.extractData(this.views[stop_n]).find(\n          (x, i) => this.getId(x, i) === id\n        );\n        let d_f = this.extractData(this.views[stop_n + 1]).find(\n          (x, i) => this.getId(x, i) === id\n        );\n\n        const dSet = this.set(id, stop_n);\n        switch (dSet) {\n        case \"enter\":\n          d_i = d_f;\n          break;\n        case \"exit\":\n          d_f = d_i;\n          break;\n        case \"update\":\n          break;\n        default:\n          return [\"x2\", \"y2\"].indexOf(prop.val) >= 0 ? 0 : \"\";\n        }\n        const getScales = {\n          initial: this._getScales(stop_n),\n          final: this._getScales(stop_n + 1)\n        };\n        if (prop.type === \"attrTween\") {\n          return encodes[dSet].custom.bind(elem)(prop, getScales, d_i, d_f)(\n            t * (this.stopN - 1) - stop_n\n          );\n        }\n        const valI = encodes[dSet].initial.bind(elem)(prop, getScales, d_i);\n        const valF = encodes[dSet].final.bind(elem)(prop, getScales, d_f);\n\n        return d3.interpolate(valI, valF)(t * (this.stopN - 1) - stop_n);\n        // apply one of corresponding interpolation\n      };\n    };\n  }\n}\n\nfunction computeFilteringValues(enumDef, rawInfo) {\n  const filteringValues = enumDef.values || [];\n  if (filteringValues.length === 0 && enumDef.stepSize) {\n    // find initial value\n    const iFilter = findFilter(rawInfo.sVis.spec, enumDef.filter);\n    const iVal = parse(iFilter.expr).right.value;\n\n    // find end value\n    const fFilter = findFilter(rawInfo.eVis.spec, enumDef.filter);\n    const fVal = parse(fFilter.expr).right.value;\n\n    for (let v = iVal; v < fVal; v += enumDef.stepSize) {\n      filteringValues.push(v);\n    }\n\n    filteringValues.push(fVal);\n  }\n  return filteringValues;\n}\n\n\nfunction computeNewSpec(workingSpec, filter, fVal) {\n  const codegen = vgCodegen({\n    whitelist: [\"datum\", \"event\", \"signals\"],\n    globalvar: \"global\"\n  });\n\n  const parsedASTNode = parse(filter.expr);\n\n  parsedASTNode.right.value = fVal;\n  parsedASTNode.right.raw = fVal.toString();\n  const newFilterExpr = codegen(parsedASTNode).code;\n  filter.expr = newFilterExpr;\n\n  return copy(workingSpec);\n}\nfunction getStops(enumDef, spec, rawInfo) {\n  const workingSpec = copy(spec);\n\n  const enumVals = computeFilteringValues(enumDef, rawInfo);\n  const filter = findFilter(workingSpec, enumDef.filter);\n\n  const views = enumVals.map(v => {\n    return new vega.View(vega.parse(computeNewSpec(workingSpec, filter, v)), {\n      renderer: \"none\"\n    }).run();\n  });\n\n  return views;\n}\n\n\nexport { Enumerator, computeFilteringValues, computeNewSpec };\n","import { copy } from \"../util/util\";\nimport {computeFilteringValues} from \"../enumerator\";\nexport default function enumerateSteps(block, rawInfo, enumDefs) {\n  if (block.sync) {\n    block.sync = block.sync.map(blk => enumerateSteps(blk, rawInfo, enumDefs));\n  } else if (block.concat) {\n    block.concat = block.concat.map(blk =>\n      enumerateSteps(blk, rawInfo, enumDefs)\n    );\n\n    if (block.enumerator) {\n      const foundEnumDef = enumDefs.find(\n        enumDef => enumDef.name === block.enumerator\n      );\n\n      if (foundEnumDef) {\n        const filteringValues = computeFilteringValues(foundEnumDef, rawInfo);\n        return filteringValues.slice(1).reduce(\n          (acc, fVal, i) => {\n            const enumedConcatBlock = copy(block);\n            enumedConcatBlock.concat.forEach(blk => {\n              fetchEnumVal(blk, foundEnumDef, fVal);\n            });\n            enumedConcatBlock.enumerated = copy(foundEnumDef);\n            enumedConcatBlock.enumerated.val = fVal;\n            enumedConcatBlock.enumerated.N = filteringValues.length;\n            enumedConcatBlock.enumerated.last =\n              i === filteringValues.length - 2;\n\n            acc.concat.push(enumedConcatBlock);\n            return acc;\n          },\n          { concat: [] }\n        );\n      }\n    }\n  }\n  return block;\n}\n\nfunction fetchEnumVal(block, enumDef, val) {\n  if (block.sync || block.concat) {\n    (block.sync || block.concat).forEach(blk => {\n      fetchEnumVal(blk, enumDef, val);\n    });\n  } else if (Array.isArray(block.enumVals)) {\n    block.enumerated.push({def: enumDef, val: val});\n  } else {\n    block.enumerated = [{def: enumDef, val: val}];\n  }\n}","import { isNumber, copy, permutate} from \"../util/util\";\nimport {default as collectResolves} from \"./resolveCollector\";\nimport {Schedule} from \"../schedule\";\nimport {default as checkConflict} from \"./conflictChecker\";\nimport {specChecker} from \"./specChecker\";\nimport {default as enumerateSteps} from \"./stepEnumerator\";\nexport function parse(spec, rawInfo){\n  // const speckCheckResult = true; //specChecker(spec); TODO: when specChecker is included, it blocked loading the source map.\n  const speckCheckResult = specChecker(spec);\n  if (!speckCheckResult) {\n    // Todo: give more specific reasons through speckCheckResult.\n    return console.error(\"The spec is invalid.\");\n  }\n\n  // Enumerator argument the concatBlock with enumerator\n  let newSpec = copy(spec);\n  newSpec.timeline = enumerateSteps(newSpec.timeline, rawInfo, newSpec.enumerators);\n\n\n  // 1. reform the timline such that all blocks have duration.\n  let parsedTimelineBlock = readBlock(newSpec.timeline, newSpec.totalDuration);\n  let parsedSteps = assignTiming(parsedTimelineBlock, { sTime: 0 }, true);\n\n  // 2. attach staggering definitions\n  parsedSteps.forEach(step => {\n    if ([\"axis\", \"mark\", \"legend\"].indexOf(step.compType) >= 0) {\n      step.timing = attachStaggering(step.timing, newSpec.staggerings);\n    }\n  });\n  // 3. enumerator definitions\n  if (newSpec.enumerators) {\n    newSpec.enumerators = newSpec.enumerators.map(enumerator => {\n      return attachStaggering(enumerator, newSpec.staggerings);\n    });\n\n    parsedSteps.forEach((step, i) => {\n      if ([\"axis\", \"mark\", \"legend\"].indexOf(step.compType) >= 0) {\n        step = attachEnumerators(step, newSpec.enumerators);\n      }\n    });\n  }\n\n\n  const schedule = new Schedule(parsedSteps);\n  const resolves = collectResolves(parsedTimelineBlock, parsedSteps);\n\n  const { conflictsPerAlterId } = checkConflict(schedule, resolves);\n\n\n  return { schedule, resolves, conflictsPerAlterId };\n}\n\n\nexport function readBlock(block, totalDuration, multiplier = 1) {\n  if (block.sync) {\n    return readSyncBlock(block, totalDuration, multiplier);\n  }\n  if (block.concat) {\n    return readConcatBlock(block, totalDuration, multiplier);\n  }\n  const delay =\n    (block.delay\n      ? isNumber(block.timing.delay.ratio)\n        ? block.timing.delay.ratio * totalDuration\n        : block.timing.delay\n      : 0) * multiplier;\n\n  const duration =\n    (isNumber(block.timing.duration.ratio)\n      ? block.timing.duration.ratio * totalDuration\n      : block.timing.duration) * multiplier;\n  const compType =\n    typeof block.component === \"object\"\n      ? Object.keys(block.component)[0]\n      : block.component;\n  const compName =\n    typeof block.component === \"object\" ? block.component[compType] : undefined;\n\n  return {\n    duration,\n    delay,\n    timing: Object.assign({}, block.timing, { duration, delay }),\n    change: block.change,\n    enumerated: block.enumerated,\n    enumerator: block.enumerator, // step enumerator\n    compType,\n    compName\n  };\n}\nexport function readConcatBlock(concatBlock, totalDuration, multiplier = 1) {\n  const concatenated = concatBlock.concat;\n  let duration = 0;\n  let alternateConcats = {};\n\n  const newMult = concatBlock.enumerated ? 1 / concatBlock.enumerated.N : 1;\n\n  const reformedBlocks = concatenated.map(block => {\n    const newBlock = readBlock(block, totalDuration, multiplier * newMult);\n    duration = duration + newBlock.timing.duration + newBlock.timing.delay;\n    return newBlock;\n  });\n\n  if (concatBlock.autoScaleOrder) {\n    // permutate the concat's order\n    concatBlock.resolve = {\n      autoScaleOrder: concatBlock.autoScaleOrder,\n      alterName:\n        concatBlock.autoScaleOrder.join(\"-\") +\n        (concatBlock.enumerated ? `_${concatBlock.enumerated.val}` : \"\")\n    };\n    let alternates = permutateOnlyContainNames(\n      concatenated,\n      concatBlock.resolve.autoScaleOrder\n    );\n\n    alternates.splice(0, 1);\n    alternates = alternates.map(concatenated_i => {\n      return concatenated_i.map(block => readBlock(block, totalDuration, multiplier * newMult));\n    });\n    alternateConcats = {\n      alterName: concatBlock.resolve.alterName,\n      alternates\n    };\n  }\n  return Object.assign(\n    {\n      delay: 0,\n      duration,\n      timing: { delay: 0, duration },\n      concat: reformedBlocks,\n      resolve: concatBlock.resolve,\n      enumerated: concatBlock.enumerated\n    },\n    alternateConcats\n  );\n}\n\nexport function permutateOnlyContainNames(blocks, names) {\n  const filtered = [];\n  const indices = [];\n  blocks.forEach((blk, i) => {\n    if (containNames(blk)) {\n      filtered.push(blk);\n      indices.push(i);\n    }\n  });\n\n  return permutate(filtered).map(permutatedOne => {\n    return indices.reduce((acc, index, i) => {\n      acc.splice(index, 1, permutatedOne[i]);\n      return acc;\n    }, copy(blocks));\n  });\n\n  function containNames(block) {\n    if (block.sync || block.concat) {\n      return (block.sync || block.concat).reduce((acc, blk) => {\n        acc = acc || containNames(blk, names);\n        return acc;\n      }, false);\n    }\n    const compType = Object.keys(block.component)[0];\n    return names.indexOf(block.component[compType]) >= 0;\n  }\n}\n\nexport function readSyncBlock(syncBlock, totalDuration, multiplier = 1) {\n  const anchor = syncBlock.anchor || \"start\";\n  let duration = 0;\n  const newBlocks = syncBlock.sync.map(block => {\n    const newBlock = readBlock(block, totalDuration, multiplier);\n    duration =\n      duration > newBlock.timing.duration + newBlock.timing.delay\n        ? duration\n        : newBlock.timing.duration + newBlock.timing.delay;\n    return newBlock;\n  });\n\n  return {\n    delay: 0,\n    duration,\n    timing: { delay: 0, duration },\n    anchor,\n    sync: newBlocks\n  };\n}\n\nexport function attachStaggering(item, staggerings) {\n  if (!staggerings || staggerings.length <= 0 || !item) {\n    return item;\n  }\n\n  const found = staggerings.find(stgDef => item.staggering === stgDef.name);\n  return Object.assign(item, { staggering: found });\n}\n\nexport function attachEnumerators(item, enumerators) {\n  if (!enumerators || enumerators.length <= 0 || !item) {\n    return item;\n  }\n\n  const found = enumerators.find(\n    enumeratorDef => item.enumerator === enumeratorDef.name\n  );\n  return Object.assign(item, { enumerator: found });\n}\n\nexport function assignTiming(block, timePointer) {\n  let steps = [];\n  const anchor = isNumber(timePointer.sTime) ? \"s\" : \"e\";\n  let timestamp = anchor === \"s\" ? timePointer.sTime : timePointer.eTime;\n  if (block.sync && block.anchor === \"start\") {\n    block.sync.forEach(blk => {\n      steps = steps.concat(\n        assignTiming(blk, {\n          sTime: anchor === \"s\" ? timestamp : timestamp - block.duration\n        })\n      );\n    });\n  } else if (block.sync && block.anchor === \"end\") {\n    block.sync.forEach(blk => {\n      steps = steps.concat(\n        assignTiming(blk, {\n          eTime: anchor === \"e\" ? timestamp : timestamp + block.duration\n        })\n      );\n    });\n  } else if (block.concat) {\n    if (anchor === \"e\") {\n      timestamp -= block.duration;\n    }\n\n    if (block.alternates) {\n      block.alternates.forEach((alternate, i) => {\n        let alterTimeStamp = timestamp;\n        alternate.forEach(blk => {\n          const alter = assignTiming(copy(blk), {\n            sTime: alterTimeStamp\n          }).map(step => {\n            step.alterId = `${step.alterId || \"\"}${block.alterName}:${i}`;\n            return step;\n          });\n\n          steps = steps.concat(alter);\n          alterTimeStamp += blk.duration + blk.delay;\n        });\n      });\n    }\n\n    block.concat.forEach(blk => {\n      const mainSteps = assignTiming(blk, { sTime: timestamp }).map(step => {\n        step.alterId = step.alterId || `${block.alterName || \"\"}:main`;\n        return copy(step);\n      });\n      steps = steps.concat(mainSteps);\n      timestamp += blk.duration + blk.delay;\n    });\n  } else {\n    if (anchor === \"s\") {\n      block.sTime = timestamp;\n      block.eTime = timestamp + block.duration + block.delay;\n    } else {\n      block.eTime = timestamp;\n      block.sTime = timestamp - block.duration - block.delay;\n    }\n    steps = steps.concat([block]);\n  }\n  return steps;\n}","import Ajv from \"ajv\";\n/* global globalThis */\n/* eslint no-restricted-globals: 1 */\nfunction schema() {\n  return {\n    type: \"object\",\n    properties: {\n      timeline: { $ref: \"#/defs/block\" },\n      totalDuration: { type: \"number\", minimum: 0 },\n      staggerings: { type: \"array\", items: { $ref: \"#/defs/staggering\" } },\n      enumerators: { type: \"array\", items: { $ref: \"#/defs/enumerator\" } },\n      meta: { type: \"object\" }\n    },\n    additionalProperties: false,\n    defs: {\n      enumerator: {\n        type: \"object\",\n        properties: {\n          name: { type: \"string\" },\n          filter: { type: \"string\" },\n          stepSize: { type: \"number\" },\n          values: { type: \"array\" }\n        },\n        additionalProperties: false,\n        oneOf: [\n          { required: [\"name\", \"filter\", \"stepSize\"] },\n          { required: [\"name\", \"filter\", \"values\"] }\n        ]\n      },\n      staggering: {\n        type: \"object\",\n        properties: {\n          name: { type: \"string\" },\n          by: {\n            oneOf: [\n              { type: \"string\" },\n              {\n                type: \"object\",\n                properties: {\n                  initial: { type: \"string\" },\n                  final: { type: \"string\" }\n                },\n                additionalProperties: false\n              }\n            ]\n          },\n          overlap: { type: \"number\" },\n          order: { type: \"string\", enum: [\"ascending\", \"descending\"] },\n          staggering: { $ref: \"#/defs/subStaggering\" }\n        },\n        additionalProperties: false,\n        oneOf: [{ required: [\"name\", \"overlap\", \"by\"] }]\n      },\n      subStaggering: {\n        type: \"object\",\n        properties: {\n          name: { type: \"string\" },\n          by: { oneOf: [{ type: \"string\" }, { type: \"object\" }] },\n          overlap: { type: \"number\" },\n          order: { type: \"string\", enum: [\"ascending\", \"descending\"] },\n          staggering: { $ref: \"#/defs/subStaggering\" }\n        },\n        additionalProperties: false,\n        oneOf: [{ required: [\"overlap\", \"by\"] }]\n      },\n      block: {\n        anyOf: [\n          { $ref: \"#/defs/sync\" },\n          { $ref: \"#/defs/concat\" },\n          { $ref: \"#/defs/markStep\" },\n          { $ref: \"#/defs/axisStep\" },\n          { $ref: \"#/defs/legendStep\" },\n          { $ref: \"#/defs/pauseStep\" },\n          { $ref: \"#/defs/viewStep\" }\n        ]\n      },\n      concat: {\n        type: \"object\",\n        properties: {\n          concat: { type: \"array\", items: { $ref: \"#/defs/block\" } },\n          autoScaleOrder: { type: \"array\", items: { type: \"string\" } },\n          enumerator: { type: \"string\" }\n        },\n        required: [\"concat\"],\n        additionalProperties: false\n      },\n      sync: {\n        type: \"object\",\n        properties: {\n          sync: { type: \"array\", items: { $ref: \"#/defs/block\" } },\n          anchor: { type: \"string\", enum: [\"start\", \"end\"] }\n        },\n        required: [\"sync\"],\n        additionalProperties: false\n      },\n      markStep: {\n        type: \"object\",\n        properties: {\n          component: {\n            type: \"object\",\n            properties: { mark: { type: \"string\" } },\n            additionalProperties: false,\n            required: [\"mark\"]\n          },\n          change: {\n            type: \"object\",\n            properties: {\n              data: {\n                oneOf: [\n                  {\n                    type: \"object\",\n                    properties: {\n                      keys: { type: \"array\", items: { type: \"string\" } },\n                      enter: { type: \"boolean\" },\n                      exit: { type: \"boolean\" },\n                      update: { type: \"boolean\" }\n                    },\n                    additionalProperties: false\n                  },\n                  { type: \"array\", items: { type: \"string\" } },\n                  { type: \"boolean\" }\n                ]\n              },\n              scale: {\n                oneOf: [\n                  {\n                    type: \"object\",\n                    additionalProperties: {\n                      type: \"object\",\n                      properties: { data: { type: \"boolean\" } },\n                      additionalProperties: false\n                    }\n                  },\n                  { type: \"boolean\" },\n                  { type: \"array\", items: { type: \"string\" } }\n                ]\n              },\n              signal: {\n                oneOf: [\n                  { type: \"array\", items: { type: \"string\" } },\n                  { type: \"boolean\" }\n                ]\n              },\n              marktype: { type: \"boolean\" },\n              encode: { $ref: \"#/defs/encode\" }\n            },\n            additionalProperties: false\n          },\n          timing: { $ref: \"#/defs/timing\" },\n          enumerator: { type: \"string\" }\n        },\n        required: [\"timing\", \"component\"],\n        additionalProperties: false\n      },\n      axisStep: {\n        type: \"object\",\n        properties: {\n          component: {\n            type: \"object\",\n            properties: { axis: { type: \"string\" } },\n            additionalProperties: false,\n            required: [\"axis\"]\n          },\n          change: {\n            type: \"object\",\n            properties: {\n              scale: {\n                oneOf: [\n                  {\n                    type: \"object\",\n                    properties: {\n                      domainDimension: { type: \"string\", enum: [\"same\", \"diff\"] },\n                      data: { type: \"boolean\" }\n                    },\n                    additionalProperties: false\n                  },\n                  { type: \"boolean\" }\n                ]\n              },\n              signal: {\n                oneOf: [\n                  { type: \"array\", items: { type: \"string\" } },\n                  { type: \"boolean\" }\n                ]\n              },\n              marktype: { type: \"boolean\" },\n              encode: {\n                oneOf: [\n                  {\n                    type: \"object\",\n                    properties: {\n                      axis: { $ref: \"#/defs/encode\" },\n                      title: { $ref: \"#/defs/encode\" },\n                      ticks: { $ref: \"#/defs/encode\" },\n                      labels: { $ref: \"#/defs/encode\" },\n                      grid: { $ref: \"#/defs/encode\" },\n                      domain: { $ref: \"#/defs/encode\" }\n                    },\n                    additionalProperties: false\n                  },\n                  { type: \"boolean\" }\n                ]\n              }\n            },\n            additionalProperties: false\n          },\n          timing: { $ref: \"#/defs/timing\" },\n          enumerator: { type: \"string\" }\n        },\n        required: [\"timing\", \"component\"],\n        additionalProperties: false\n      },\n      legendStep: {\n        type: \"object\",\n        properties: {\n          component: {\n            type: \"object\",\n            properties: { legend: { type: \"string\" } },\n            additionalProperties: false,\n            required: [\"legend\"]\n          },\n          change: {\n            type: \"object\",\n            properties: {\n              scale: {\n                oneOf: [\n                  {\n                    type: \"object\",\n                    properties: {\n                      domainDimension: { type: \"string\", enum: [\"same\", \"diff\"] }\n                    },\n                    additionalProperties: {\n                      type: \"object\",\n                      properties: { data: { type: \"boolean\" } },\n                      additionalProperties: false\n                    }\n                  },\n                  { type: \"boolean\" },\n                  { type: \"array\", items: { type: \"string\" } }\n                ]\n              },\n              signal: {\n                oneOf: [\n                  { type: \"array\", items: { type: \"string\" } },\n                  { type: \"boolean\" }\n                ]\n              },\n              encode: {\n                oneOf: [\n                  {\n                    type: \"object\",\n                    properties: {\n                      symbols: { $ref: \"#/defs/encode\" },\n                      title: { $ref: \"#/defs/encode\" },\n                      labels: { $ref: \"#/defs/encode\" },\n                      entries: { $ref: \"#/defs/encode\" },\n                      gradient: { $ref: \"#/defs/encode\" },\n                      legend: { $ref: \"#/defs/encode\" }\n                    },\n                    additionalProperties: false\n                  },\n                  { type: \"boolean\" }\n                ]\n              }\n            },\n            additionalProperties: false\n          },\n          timing: { $ref: \"#/defs/timing\" },\n          enumerator: { type: \"string\" }\n        },\n        required: [\"timing\", \"component\"],\n        additionalProperties: false\n      },\n      pauseStep: {\n        type: \"object\",\n        properties: {\n          component: { const: \"pause\" },\n          timing: { $ref: \"#/defs/timing\" }\n        },\n        required: [\"timing\", \"component\"],\n        additionalProperties: false\n      },\n      viewStep: {\n        type: \"object\",\n        properties: {\n          component: { const: \"view\" },\n          change: {\n            type: \"object\",\n            properties: {\n              signal: {\n                oneOf: [\n                  { type: \"array\", items: { type: \"string\" } },\n                  { type: \"boolean\" }\n                ]\n              },\n              additionalProperties: false\n            }\n          },\n          timing: { $ref: \"#/defs/timing\" }\n        },\n        required: [\"timing\", \"component\"],\n        additionalProperties: false\n      },\n      timing: {\n        type: \"object\",\n        properties: {\n          duration: {\n            oneOf: [\n              { type: \"number\", minimum: 0 },\n              {\n                type: \"object\",\n                properties: { ratio: { type: \"number\", minimum: 0 } }\n              }\n            ]\n          },\n          delay: {\n            oneOf: [\n              { type: \"number\" },\n              { type: \"object\", properties: { ratio: { type: \"number\" } } }\n            ]\n          },\n          staggering: { type: \"string\" }\n        }\n      },\n      encode: {\n        oneOf: [\n          {\n            type: \"object\",\n            properties: {\n              update: { oneOf: [{ type: \"object\" }, { type: \"boolean\" }] },\n              enter: { oneOf: [{ type: \"object\" }, { type: \"boolean\" }] },\n              exit: { oneOf: [{ type: \"object\" }, { type: \"boolean\" }] }\n            },\n            additionalProperties: false\n          },\n          { type: \"boolean\" }\n        ]\n      }\n    }\n  };\n}\n\nfunction specChecker(spec) {\n  const ajv = new Ajv();\n  const validate = ajv.compile(schema());\n\n  const valid = validate(spec);\n  if (!valid) {\n    throw new Error(\"Invalid Spec\", validate.errors);\n  }\n  return true;\n}\n\nexport {\n  // schema,\n  specChecker\n};","import * as d3 from \"d3\";\nimport { computeHasFacet, isGroupingMarktype } from \"../changeFetcher/state/util\";\n// Join and return nextData\nfunction facetData(data, facetDef) {\n  if (!facetDef) {\n    return [\n      {\n        datum: {},\n        mark: { role: \"group\", marktype: \"group\" },\n        items: [{ items: data }]\n      }\n    ];\n  }\n\n  let {groupby} = facetDef;\n  if (typeof groupby === \"string\") {\n    groupby = [groupby];\n  }\n  return d3\n    .nest()\n    .key(d => groupby.map(f => d.datum[f]).join(\"@@_@@\"))\n    .entries(data)\n    .map(group => {\n      let datum = groupby.reduce((datum, f) => {\n        datum[f] = group.values[0].datum[f];\n        return datum;\n      }, { count: group.values.length });\n      return {\n        datum: datum,\n        mark: {role: \"group\", marktype: \"group\"},\n        items: [{items: group.values }]\n      };\n    });\n}\nfunction unpackData(data) {\n  if (data[0].mark.marktype !== \"group\") {\n    return data;\n  }\n\n  return data.reduce((unpacked, group) => {\n    return unpacked.concat(group.items[0].items);\n  }, []);\n}\n\nfunction getMarkData(view, compSpec, compName, marktype, facet) {\n  let dataName = computeHasFacet(compSpec) ? compSpec.parent.name : compName;\n  let data = view._runtime.data[dataName] ? (view._runtime.data[dataName].values.value) || [] : [];\n  if (data.length === 0) {\n    return data;\n  }\n  let isGroupingMtype = isGroupingMarktype(marktype || compSpec.type),\n    hasFacet = computeHasFacet(compSpec);\n\n  if ( isGroupingMtype && !hasFacet ) {\n    return facetData(data, facet || (compSpec.parent.from ? compSpec.parent.from.facet : undefined));\n  } if (!isGroupingMtype && hasFacet) {\n    data = unpackData(data);\n  }\n  return data;\n}\n\nfunction getEmptyLegendData(compSpec) {\n  if (compSpec.type === \"symbol\") {\n    return {\n      labels: [],\n      symbols: [],\n      pairs: [],\n      title: []\n    };\n  } if (compSpec.type === \"gradient\") {\n    return {\n      labels: [],\n      gradient: [],\n      bands: [],\n      title: []\n    };\n  }\n}\nfunction getLegendData(view, compName, compSpec) {\n  const titleDatum = view._runtime.data[compName].values.value[0].items.find(\n    item => item.role === \"legend-title\"\n  ).items[0];\n  let returnData = { title: [titleDatum] };\n  if (compSpec.type === \"symbol\") {\n    returnData = Object.assign(returnData, {\n      labels: [],\n      symbols: [],\n      pairs: []\n    });\n    const fPairs = view._runtime.data[compName].values.value[0].items.find(\n      item => item.role === \"legend-entry\"\n    ).items[0].items[0].items;\n    fPairs.forEach(pair => {\n      returnData.pairs.push(pair);\n      returnData.labels.push(\n        pair.items.find(item => item.role === \"legend-label\").items[0]\n      );\n      returnData.symbols.push(\n        pair.items.find(item => item.role === \"legend-symbol\").items[0]\n      );\n    });\n  } else if (compSpec.type === \"gradient\") {\n    returnData = Object.assign(returnData, {\n      labels: [],\n      gradient: [],\n      bands: []\n    });\n    const entryG = view._runtime.data[compName].values.value[0].items.find(\n      item => item.role === \"legend-entry\"\n    ).items[0];\n    let labelG; let bandG; let gradientG;\n    if ((labelG = entryG.items.find(item => item.role === \"legend-label\"))) {\n      returnData.labels = returnData.labels.concat(labelG.items);\n    }\n    if ((bandG = entryG.items.find(item => item.role === \"legend-band\"))) {\n      returnData.bands = returnData.bands.concat(bandG.items);\n    }\n    if (\n      (gradientG = entryG.items.find(item => item.role === \"legend-gradient\"))\n    ) {\n      returnData.gradient.push(gradientG.items[0]);\n    }\n  }\n  return returnData;\n}\n\nfunction getEmptyAxisData() {\n  return {\n    tick: [],\n    label: [],\n    grid: []\n  };\n}\nfunction getAxisData(view, compName) {\n  return [\"tick\", \"label\", \"grid\"].reduce((acc, subComp) => {\n    let data = view._runtime.data[compName].values.value[0].items\n      .find(item => item.role === `axis-${subComp}`);\n\n    data = data && data.items ? data.items : [];\n    acc[subComp] = data;\n    return acc;\n  }, {});\n}\n\nexport {\n  facetData,\n  unpackData,\n  getMarkData,\n  getEmptyLegendData,\n  getLegendData,\n  getEmptyAxisData,\n  getAxisData\n};\n","import { computeHasFacet, isGroupingMarktype, getFacet } from \"./util\";\nimport { stringifyDatumValue } from \"../../util/util\";\nimport {\n  facetData,\n  unpackData,\n  getAxisData,\n  getEmptyAxisData,\n  getEmptyLegendData,\n  getLegendData,\n  getMarkData\n} from \"../../util/vgDataHelper\";\n\nfunction computeIdMaker(key) {\n  if (Array.isArray(key)) {\n    return (d) => {\n      return key\n        .map(field => {\n          return d.datum[field];\n        })\n        .join(\"-\");\n    };\n  }\n  return (d, i) => stringifyDatumValue(i);\n}\n\nfunction initialData(step, rawInfo) {\n  const sView = rawInfo.sVis.view;\n  const { change } = step;\n  const isAdd = !change.initial && !!change.final;\n  if (change.compType === \"axis\") {\n    if (isAdd) {\n      return getEmptyAxisData();\n    }\n    return getAxisData(sView, change.compName);\n  }\n  if (change.compType === \"legend\") {\n    if (isAdd) {\n      return getEmptyLegendData(change.final);\n    }\n    return getLegendData(sView, change.compName, change.initial);\n  }\n  if (change.compType === \"mark\") {\n    if (isAdd) {\n      return [];\n    }\n    const mtype = step.marktypes ? step.marktypes.initial : change.initial.type;\n    return getMarkData(sView, change.initial, change.compName, mtype);\n  }\n  if (change.compType === \"view\") {\n    return sView._runtime.data.root.values.value[0];\n  }\n}\n\nfunction joinData(step, rawInfo, initialData) {\n  const iData = initialData;\n  const eView = rawInfo.eVis.view;\n  const {change} = step;\n  const isAdd = !change.initial && !!change.final;\n  const isRemove = !!change.initial && !change.final;\n  const {hasFacet} = step;\n  let preFetchCurrData = false;\n  let computeId = {};\n\n  if (change.compType === \"axis\") {\n    const result = {\n      nextData: {},\n      currData: {},\n      computeDatumId: {}\n    };\n\n    result.nextData.axis = isRemove\n      ? iData.axis\n      : [eView._runtime.data[change.compName].values.value[0].datum];\n    result.currData.axis = iData.axis;\n    result.computeDatumId.axis = (d, i) => i;\n\n    if (\n      change.scale === false ||\n      (change.scale && change.scale.data === false)\n    ) {\n      const computeId = d => stringifyDatumValue(d.datum.value);\n      return [\"tick\", \"label\", \"grid\"].reduce((acc, subComp) => {\n        const nextData = iData[subComp].map((d, i) => {\n          setJoinInfo(d, step, { animSet: \"update\", joinKey: computeId(d, i) });\n          return d;\n        });\n        acc.nextData[subComp] = nextData;\n        acc.currData[subComp] = nextData;\n        acc.computeDatumId[subComp] = computeId;\n        return acc;\n      }, result);\n    }\n\n    let fData = getEmptyAxisData();\n    if (!isRemove) {\n      fData = getAxisData(eView, change.compName);\n    }\n\n    return [\"tick\", \"label\", \"grid\"].reduce((acc, subComp) => {\n      let subCompEncName = subComp === \"tick\" ? \"ticks\" : subComp;\n      subCompEncName = subCompEncName === \"label\" ? \"labels\" : subCompEncName;\n      let computeId = d => stringifyDatumValue(d.datum.value);\n\n      if (change.encode && change.encode[subCompEncName] === false) {\n        acc.nextData[subComp] = iData[subComp];\n        acc.currData[subComp] = iData[subComp];\n        acc.computeDatumId[subComp] = computeId;\n        return acc;\n      }\n\n      const iDataSubComp = iData[subComp] || [];\n      let fDataSubComp = fData[subComp] || [];\n      if (!step.sameDomainDimension) {\n        const ci = appendPostfix(computeId, \"_exit\");\n        let cf = appendPostfix(computeId, \"_enter\");\n        computeId = { initial: ci, final: cf };\n\n        iDataSubComp.forEach((iDatum, i) => {\n          setJoinInfo(iDatum, step, {\n            animSet: \"exit\",\n            joinKey: computeId.initial(iDatum, i)\n          });\n        });\n\n        fDataSubComp.forEach((fDatum, i) => {\n          setJoinInfo(fDatum, step, {\n            animSet: \"enter\",\n            joinKey: computeId.final(fDatum, i)\n          });\n        });\n      } else {\n        joinThem(iDataSubComp, fDataSubComp, computeId, step);\n      }\n\n      // let isAnimSet = getIsAnimSet(subCompEncName, change.encode);\n      // let iDataAnimSets = (isAnimSet.exit ? [] : [\"exit\"]).concat(isAnimSet.update ? [] : [\"update\"]),\n      //   fDataAnimSets = (isAnimSet.enter ? [\"enter\"] : []).concat(isAnimSet.update ? [\"update\"] : [])\n      const iDataAnimSets = []; let fDataAnimSets = [\"enter\", \"update\"];\n      const nextData = iDataSubComp\n        .filter(d => iDataAnimSets.indexOf(getJoinInfo(d, step, \"animSet\")) >= 0)\n        .concat(fDataSubComp.filter(d => fDataAnimSets.indexOf(getJoinInfo(d, step, \"animSet\")) >= 0));\n\n      // let nextData = [];\n\n      // nextData = nextData.concat(isAnimSet.update ? joinedData.update.final : joinedData.update.initial)\n      // nextData = isAnimSet.enter ? nextData.concat(joinedData.enter) : nextData;\n      // nextData = !isAnimSet.exit ? nextData.concat(joinedData.exit) : nextData;\n\n      acc.nextData[subComp] = nextData;\n      acc.currData[subComp] = iDataSubComp;\n      acc.computeDatumId[subComp] = computeId;\n      return acc;\n    }, result);\n\n  }\n  if (change.compType === \"legend\") {\n    const getComputeId = subComp => {\n      if (subComp === \"pairs\") {\n        return d => {\n          const {datum} = d.items.find(item => item.role === \"legend-label\").items[0];\n          return stringifyDatumValue(datum.value);\n        };\n      } else if (subComp === \"title\") {\n        return d => d.text;\n      } else if (subComp === \"gradient\") {\n        return d => JSON.stringify(d.fill.stops);\n      }\n      return d => stringifyDatumValue(d.datum.value);\n    };\n\n    const result = Object.keys(iData).reduce(\n      (acc, subComp) => {\n        computeId = getComputeId(subComp);\n        const nextData = iData[subComp].map((d, i) => {\n          setJoinInfo(d, step, { animSet: \"update\", joinKey: computeId(d, i) });\n          return d;\n        });\n        acc.nextData[subComp] = nextData;\n        acc.currData[subComp] = nextData;\n        acc.computeDatumId[subComp] = computeId;\n        return acc;\n      },\n      {\n        nextData: {},\n        currData: {},\n        computeDatumId: {}\n      }\n    );\n\n    if (\n      change.scale === false ||\n      (change.scale && change.scale.data === false)\n    ) {\n      return result;\n    }\n\n    if (isRemove) {\n      result.nextData = getEmptyLegendData(change.initial);\n      return result;\n    }\n    const fData = getLegendData(eView, change.compName, change.final);\n    const keys = Object.keys(fData)\n      .concat(Object.keys(iData))\n      .unique();\n    return keys.reduce((acc, subComp) => {\n      const subCompEncName = subComp;\n      if (change.encode && change.encode[subCompEncName] === false) {\n        return acc;\n      }\n      computeId = getComputeId(subComp);\n      const iDataSubComp = iData[subComp] || [];\n      let fDataSubComp = fData[subComp]|| [];\n      if (\n        (subComp === \"labels\" &&\n          step.legendTypes.initial !== step.legendTypes.final) ||\n        !step.sameDomainDimension\n      ) {\n        const ci = appendPostfix(computeId, \"_exit\");\n        let cf = appendPostfix(computeId, \"_enter\");\n        computeId = { initial: ci, final: cf };\n\n        iDataSubComp.forEach((iDatum, i) => {\n          setJoinInfo(iDatum, step, {\n            animSet: \"exit\",\n            joinKey: computeId.initial(iDatum, i)\n          });\n        });\n\n        fDataSubComp.forEach((fDatum, i) => {\n          setJoinInfo(fDatum, step, {\n            animSet: \"enter\",\n            joinKey: computeId.final(fDatum, i)\n          });\n        });\n      } else {\n        joinThem(iDataSubComp, fDataSubComp, computeId, step);\n      }\n\n      // let isAnimSet = getIsAnimSet(subCompEncName, change.encode);\n\n      // let iDataAnimSets = (isAnimSet.exit ? [] : [\"exit\"]).concat(isAnimSet.update ? [] : [\"update\"]),\n      //   fDataAnimSets = (isAnimSet.enter ? [\"enter\"] : []).concat(isAnimSet.update ? [\"update\"] : [])\n      const iDataAnimSets = []; let fDataAnimSets = [\"enter\", \"update\"];\n      const nextData = iDataSubComp\n        .filter(d => iDataAnimSets.indexOf(getJoinInfo(d, step, \"animSet\")) >= 0)\n        .concat(fDataSubComp.filter(d => fDataAnimSets.indexOf(getJoinInfo(d, step, \"animSet\")) >= 0));\n\n      acc.nextData[subComp] = nextData || [];\n      acc.currData[subComp] = iDataSubComp;\n      acc.computeDatumId[subComp] = computeId;\n      return acc;\n    }, result);\n  }\n  if (change.compType === \"mark\") {\n    const {marktypes} = step;\n\n    let doUpdate = !isRemove && !isAdd && change.data !== false,\n      doEnter = !isRemove && (isAdd || change.data !== false),\n      doExit = !isAdd && (isRemove || change.data !== false);\n    let joinFields = null;\n    if (change.data) {\n      doUpdate = change.data.update === false ? false : doUpdate;\n      doEnter = change.data.enter === false ? false : doEnter;\n      doExit = change.data.exit === false ? false : doExit;\n      joinFields = Array.isArray(change.data) ? change.data : change.data.keys;\n    }\n\n\n    const aggregate = step.aggregates;\n    const isGroupingMarktypes = {\n      initial: isGroupingMarktype(marktypes.initial || marktypes.final),\n      final: isGroupingMarktype(marktypes.final || marktypes.initial)\n    };\n\n    const facets = {\n      initial: hasFacet.initial\n        ? getFacet(change.initial) || getFacet(change.final)\n        : undefined,\n      final: hasFacet.final\n        ? getFacet(change.final) || getFacet(change.initial)\n        : undefined\n    };\n    if (change.marktype === false) {\n      isGroupingMarktypes.final = isGroupingMarktypes.initial;\n    }\n\n    if (change.data || isAdd || isRemove) {\n      step.change.aggregate = aggregate;\n\n      let fData = [];\n      if (!isRemove) {\n        const mtype = marktypes.final || marktypes.initial;\n        const facet =\n          change.marktype === false\n            ? change.initial.parent.from\n              ? change.initial.parent.from.facet\n              : undefined\n            : change.final.parent.from\n              ? change.final.parent.from.facet\n              : undefined;\n\n        fData = getMarkData(eView, change.final, change.compName, mtype, facet);\n      }\n      //   // Data should be from change.final!\n      //   let dName = computeHasFacet(change.final) ? change.final.parent.name : dataName;\n      //   let _fData = eView._runtime.data[dName] ? (eView._runtime.data[dName].values.value) : [];\n\n      //   // when the final data should be facetted but are not facetted yet:\n      //   if (isGroupingMarktypes.final && !computeHasFacet(change.final)){\n      //     if (change.marktype === false) {\n      //       fData = facetData(_fData, change.initial.parent.from ? change.initial.parent.from.facet : undefined);\n      //     } else {\n      //       fData = facetData(_fData, change.final.parent.from ? change.final.parent.from.facet : undefined);\n      //     }\n      //   } else if (!isGroupingMarktypes.final && computeHasFacet(change.final)) {\n      //     fData = unpackData(_fData);\n      //   } else {\n      //     fData = _fData;\n      //   }\n      // }\n\n      [\"initial\", \"final\"].forEach(which => {\n        if (change[which] && facets[which]) {\n          computeId[which] = computeIdMaker(facets[which].groupby);\n        } else if (aggregate[which]) {\n          computeId[which] = computeIdMaker(aggregate[which].groupby);\n        } else {\n          computeId[which] = computeIdMaker(joinFields);\n        }\n      });\n\n\n      if (isGroupingMarktypes.initial && isGroupingMarktypes.final) {\n        if (\n          change.final &&\n          change.initial &&\n          facets.final &&\n          facets.initial &&\n          facets.initial.groupby.sort().toString() ===\n            facets.final.groupby.sort().toString()\n        ) {\n          computeId = computeId.initial;\n          joinThem(iData, fData, computeId, step);\n        } else if (\n          change.final &&\n          change.initial &&\n          !facets.final &&\n          !facets.initial\n        ) {\n          computeId = computeId.initial;\n          joinThem(iData, fData, computeId, step);\n        } else {\n          const ci = appendPostfix(computeId.initial, \"_exit\");\n          let cf = appendPostfix(computeId.final, \"_enter\");\n\n          computeId = { initial: ci, final: cf };\n          iData.forEach((iDatum, i) => {\n            setJoinInfo(iDatum, step, {\n              animSet: \"exit\",\n              joinKey: computeId.initial(iDatum, i)\n            });\n          });\n          fData.forEach((fDatum, i) => {\n            setJoinInfo(fDatum, step, {\n              animSet: \"enter\",\n              joinKey: computeId.final(fDatum, i)\n            });\n          });\n        }\n      } else if (!isGroupingMarktypes.initial && !isGroupingMarktypes.final) {\n        if (\n          aggregate.initial &&\n          aggregate.final &&\n          aggregate.initial.groupby.sort().toString() ===\n            aggregate.final.groupby.sort().toString()\n        ) {\n          computeId = computeId.initial;\n          joinThem(iData, fData, computeId, step);\n        } else if (!aggregate.initial && !aggregate.final) {\n          computeId = computeId.initial;\n          joinThem(iData, fData, computeId, step);\n        } else {\n          let ci = appendPostfix(computeId.initial, \"_exit\");\n          let cf = appendPostfix(computeId.final, \"_enter\");\n          computeId = { initial: ci, final: cf };\n\n          iData.forEach((iDatum, i) => {\n            setJoinInfo(iDatum, step, {\n              animSet: \"exit\",\n              joinKey: computeId.initial(iDatum, i)\n            });\n          });\n\n          fData.forEach((fDatum, i) => {\n            setJoinInfo(fDatum, step, {\n              animSet: \"enter\",\n              joinKey: computeId.final(fDatum, i)\n            });\n          });\n\n          if (!aggregate.initial && aggregate.final) {\n            attachAggData(fData, iData, computeId.final, aggregate.final);\n            preFetchCurrData = true;\n          } else if (aggregate.initial && !aggregate.final) {\n            attachAggData(iData, fData, computeId.initial, aggregate.initial);\n            preFetchCurrData = true;\n          }\n        }\n      } else {\n        // When the marktype changes between area/line to the others.\n        let groupedData; let unpackedData;\n        if (isGroupingMarktypes.initial) {\n          computeId.initial = computeIdMaker(\n            facets.initial ? change.initial.parent.from.facet.groupby : null\n          );\n          computeId.final = computeIdMaker(joinFields || null);\n          unpackedData = unpackData(iData);\n          joinThem(unpackedData, fData, computeId.final, step);\n\n          groupedData = facetData(\n            fData,\n            change.initial.parent.from\n              ? change.initial.parent.from.facet\n              : undefined\n          );\n          joinThem(iData, groupedData, computeId.initial, step);\n        } else {\n          computeId.initial = computeIdMaker(joinFields || null);\n          computeId.final = computeIdMaker(\n            facets.final ? change.final.parent.from.facet.groupby : null\n          );\n\n          unpackedData = unpackData(fData);\n          joinThem(iData, unpackedData, computeId.initial, step);\n\n          groupedData = facetData(\n            iData,\n            change.final.parent.from\n              ? change.final.parent.from.facet\n              : undefined\n          );\n          joinThem(groupedData, fData, computeId.final, step);\n        }\n\n        return {\n          nextData: fData,\n          currData: iData,\n          computeDatumId: computeId,\n          groupedData,\n          unpackedData\n        };\n      }\n\n      const iDataAnimSets = (doExit ? [] : [\"exit\"]).concat(\n        doUpdate ? [] : [\"update\"]\n      );\n      let fDataAnimSets = (doEnter ? [\"enter\"] : []).concat(\n        doUpdate ? [\"update\"] : []\n      );\n      let nextData = iData.filter(\n        d => iDataAnimSets.indexOf(getJoinInfo(d, step, \"animSet\")) >= 0\n      );\n      if (!doExit) {\n        // we included the exit data as we do not make them exit.\n        nextData.forEach((datum) => {\n          setJoinInfo(datum, step, { animSet: \"update\" });\n        });\n      }\n\n      nextData = nextData.concat(\n        fData.filter(\n          d => fDataAnimSets.indexOf(getJoinInfo(d, step, \"animSet\")) >= 0\n        )\n      );\n\n      return {\n        nextData,\n        currData: iData,\n        computeDatumId: computeId,\n        preFetchCurrData\n      };\n    }\n    // When there is no data change\n    computeId = computeIdMaker(null);\n    const sameData = iData.map((d, i) => {\n      setJoinInfo(d, step, { animSet: \"update\", joinKey: computeId(d,i) });\n      return d;\n    });\n\n    if (isGroupingMarktypes.initial !== isGroupingMarktypes.final) {\n      // When the marktype changes between area/line to the others.\n      let groupedData; let unpackedData;\n      if (isGroupingMarktypes.initial) {\n        unpackedData = unpackData(iData);\n        unpackedData.map((d, i) => {\n          setJoinInfo(d, step, { animSet: \"update\", joinKey: computeId(d,i) });\n          return d;\n        });\n        return {\n          nextData: unpackedData, currData: iData,\n          computeDatumId: computeId,\n          groupedData: iData,\n          unpackedData: unpackedData\n        };\n      }\n      groupedData = facetData(iData, change.final.parent.from ? change.final.parent.from.facet : undefined);\n      groupedData.map((d, i) => {\n        setJoinInfo(d, step, { animSet: \"update\", joinKey: computeId(d,i) });\n        return d;\n      });\n      return {\n        nextData: groupedData, currData: iData,\n        computeDatumId: computeId,\n        groupedData,\n        unpackedData: iData\n      };\n    }\n\n    return {\n      nextData: sameData,\n      currData: sameData,\n      computeDatumId: computeId\n    };\n  }\n  if (change.compType === \"view\") {\n    return { nextData: eView._runtime.data.root.values.value[0] };\n  }\n  return iData;\n}\nfunction joinThem(iData, fData, computeId, step) {\n  const updateData = { initial: [], final: [] };\n  const enterData = [];\n  const exitData = [];\n\n  const takenChecker = new Array(fData.length);\n  takenChecker.fill(false);\n  iData.forEach((iDatum, i) => {\n    const id = computeId(iDatum, i);\n    const foundIndex = fData.findIndex(\n      (fDatum, j) => computeId(fDatum, j) === id\n    );\n    const found = foundIndex >= 0 ? fData[foundIndex] : null;\n\n    if (found) {\n      const info = { animSet: \"update\", joinKey: id };\n      setJoinInfo(found, step, info);\n      setJoinInfo(iDatum, step, info);\n      const extendedIDatum = { ...found.datum, ...iDatum.datum };\n      const extendedFDatum = { ...iDatum.datum, ...found.datum };\n      iDatum.datum = extendedIDatum;\n      found.datum = extendedFDatum;\n      updateData.final.push(found);\n      updateData.initial.push(iDatum);\n\n      takenChecker[foundIndex] = true;\n    } else {\n      setJoinInfo(iDatum, step, { animSet: \"exit\", joinKey: id });\n      exitData.push(iDatum);\n    }\n  });\n  takenChecker.forEach((taken, i) => {\n    if (!taken) {\n      setJoinInfo(fData[i], step, {\n        animSet: \"enter\",\n        joinKey: computeId(fData[i], i)\n      });\n      enterData.push(fData[i]);\n    }\n  });\n\n  return {\n    enter: enterData,\n    update: updateData,\n    exit: exitData\n  };\n}\nfunction attachAggData(aggData, rawData, aggId, agg) {\n  rawData.forEach((rawDatum, i) => {\n    aggData.forEach((aggDatum, j) => {\n      if (aggId(rawDatum, i) === aggId(aggDatum, j)) {\n        agg.fields.forEach((f, f_i) => {\n          rawDatum.datum[agg.as[f_i]] = aggDatum.datum[agg.as[f_i]];\n        });\n      }\n    });\n  });\n}\n\nfunction getJoinInfo(d, step, prop) {\n  return d.__gemini__[step.stepId]\n    ? d.__gemini__[step.stepId][prop]\n    : undefined;\n}\n\nfunction appendPostfix(computeId, postFix) {\n  return (d, i) => {\n    return computeId(d, i) + postFix;\n  };\n}\n\nfunction getAggregate(change, rawInfo) {\n  const aggregate = {};\n  if (!change.initial || !change.final) {\n    return aggregate;\n  }\n  const sSpec = rawInfo.sVis.spec;\n  const eSpec = rawInfo.eVis.spec;\n\n  const dataName = compSpec => {\n    return computeHasFacet(compSpec)\n      ? compSpec.parent.from.facet.data\n      : compSpec.from.data;\n  };\n\n  const dataSource_f = eSpec.data.find(\n    dset => dset.name === dataName(change.final)\n  );\n  if (dataSource_f.transform) {\n    aggregate.final = dataSource_f.transform.find(\n      trsfm => trsfm.type === \"aggregate\"\n    );\n  }\n  const dataSource_i = sSpec.data.find(\n    dset => dset.name === dataName(change.initial)\n  );\n  if (dataSource_i.transform) {\n    aggregate.initial = dataSource_i.transform.find(\n      trsfm => trsfm.type === \"aggregate\"\n    );\n  }\n  return aggregate;\n}\n\nfunction setJoinInfo(datum, step, info) {\n  datum.__gemini__ = datum.__gemini__ || {};\n  datum.__gemini__[step.stepId] = datum.__gemini__[step.stepId] || {};\n  Object.assign(datum.__gemini__[step.stepId], info);\n}\n\nexport { joinData, initialData, getAggregate };\n","import { copy } from \"../../../util/util\";\nimport * as vega from \"vega\";\nfunction dataPreservedScale(sSpec, eSpec, scName) {\n  const tempSpec = copy(eSpec);\n  const scaleSpec = tempSpec.scales.find(sc => sc.name === scName);\n  if (scaleSpec.domain.data) {\n    const index = tempSpec.data.findIndex(\n      d => d.name === scaleSpec.domain.data\n    );\n    if (index >= 0) {\n      tempSpec.data.splice(\n        index,\n        1,\n        sSpec.data.find(d => d.name === scaleSpec.domain.data)\n      );\n    }\n  }\n  const tempView = new vega.View(vega.parse(tempSpec), {\n    renderer: \"none\"\n  }).run();\n  return tempView._runtime.scales[scName].value;\n}\n\nfunction computeKeptEncode(manualEncode, referenceEncode, set) {\n  return Object.keys(manualEncode && manualEncode[set] ? manualEncode[set] : {})\n    .filter(attr => manualEncode[set][attr] === false)\n    .reduce((keptEncode, attr) => {\n      keptEncode[attr] = referenceEncode[set][attr];\n      return keptEncode;\n    }, {});\n}\n\n\nfunction replacePositionAttrs(targetMarktype, targetEncode, referenceEncode) {\n  const encode = Object.assign({}, targetEncode);\n  const POSITION_ATTRS = [\"x\", \"x2\", \"xc\", \"width\", \"y\", \"y2\", \"yc\", \"height\"];\n  const replaceRules = {\n    rect: [\n      {replaceBy: [\"x\", \"x2\"], },\n      {replaceBy: [\"x\", \"width\"], },\n      {replaceBy: [\"xc\", \"width\"], remove: [\"x\"] },\n      {replaceBy: [\"y\", \"y2\"], },\n      {replaceBy: [\"y\", \"height\"], },\n      {replaceBy: [\"yc\", \"height\"], remove: [\"y\"] }\n    ],\n    area: [\n      {replaceBy: [\"x\", \"x2\", \"y\"], remove: \"*\" },\n      {replaceBy: [\"x\", \"width\", \"y\"], remove: \"*\" },\n      {replaceBy: [\"xc\", \"width\", \"y\"], remove: \"*\" },\n      {replaceBy: [\"y\", \"y2\", \"x\"], remove: \"*\" },\n      {replaceBy: [\"y\", \"height\", \"x\"], remove: \"*\" },\n      {replaceBy: [\"yc\", \"height\", \"x\"], remove: \"*\" },\n      {replaceBy: [\"x\", \"x2\", \"yc\"], remove: \"*\" },\n      {replaceBy: [\"x\", \"width\", \"yc\"], remove: \"*\" },\n      {replaceBy: [\"xc\", \"width\", \"yc\"], remove: \"*\" },\n      {replaceBy: [\"y\", \"y2\", \"xc\"], remove: \"*\" },\n      {replaceBy: [\"y\", \"height\", \"xc\"], remove: \"*\" },\n      {replaceBy: [\"yc\", \"height\", \"xc\"], remove: \"*\" }\n    ],\n    default: [\n      {replaceBy: [\"x\"] },\n      {replaceBy: [\"xc\"], remove: [\"x\"] },\n      {replaceBy: [\"y\"] },\n      {replaceBy: [\"yc\"], remove: [\"y\"] }\n    ]\n  };\n  let rules = replaceRules[targetMarktype] || replaceRules.default;\n\n  rules.forEach(rule => {\n    const hasAll = rule.replaceBy.reduce((hasAll, attr) => {\n      return hasAll && referenceEncode[attr];\n    }, true);\n    if (hasAll) {\n      rule.replaceBy.forEach(attr => {\n        encode[attr] = referenceEncode[attr];\n      });\n      let removedAttrs = rule.remove || [];\n      if (rule.remove === \"*\") {\n        removedAttrs = POSITION_ATTRS.filter(attr => rule.replaceBy.indexOf(attr) < 0);\n      }\n      removedAttrs.forEach(attr => {\n        delete encode[attr];\n      });\n    }\n  });\n\n\n  return encode;\n}\n\nexport { dataPreservedScale, computeKeptEncode, replacePositionAttrs };","import { dataPreservedScale, computeKeptEncode, replacePositionAttrs } from \"./util\";\nimport { copy2, copy, get } from \"../../../util/util\";\nimport { DEFAULT_ENCODE, DEFAULT_STYLE } from \"../../../default\";\nimport { computeHasFacet } from \"../util\";\nimport { getAggregate } from \"../dataJoin\";\n\n\nexport function compute(rawInfo, step, lastState) {\n  const eView = rawInfo.eVis.view;\n  const { change } = step;\n  const isAdd = !change.initial && !!change.final;\n  const isRemove = !!change.initial && !change.final;\n\n  const manualEncode = change.encode;\n  let doEnter = !isRemove && (isAdd || change.data !== false);\n  let doExit = !isAdd && (isRemove || change.data !== false);\n\n  if (change.data) {\n    doEnter = change.data.enter === false ? false : doEnter;\n    doExit = change.data.exit === false ? false : doExit;\n  }\n\n  if (\n    !isAdd &&\n    !isRemove &&\n    change.initial.from.data !== change.final.from.data\n  ) {\n    if (!computeHasFacet(change.final) && !computeHasFacet(change.initial)) {\n      console.error(\n        `Data source of this mark (${change.compName}) has changed unexpectedly!`\n      );\n    }\n  }\n\n  const aggregates = {\n    initial: lastState.aggregate,\n    final: lastState.aggregate\n  };\n\n  if (change.data) {\n    // aggregates.done = true;\n    aggregates.final = getAggregate(change, rawInfo).final;\n  }\n\n  const marktypes = {\n    initial: lastState.marktype, // change.initial ? change.initial.type : undefined,\n    final: change.final ? change.final.type : undefined\n  };\n\n  if (\n    marktypes.initial &&\n    marktypes.final &&\n    marktypes.initial !== marktypes.final\n  ) {\n    console.log(\"mark transform change!\");\n    if (change.marktype === false) {\n      marktypes.final = marktypes.initial;\n    }\n  }\n\n  const hasFacet = {\n    initial: lastState.hasFacet,\n    final: lastState.hasFacet\n  };\n  if ((change.data || isAdd || isRemove) && change.marktype !== false) {\n    hasFacet.final = computeHasFacet(change.final);\n  }\n\n  const scales = {\n    initial: lastState.scale,\n    final: copy2(lastState.scale)\n  };\n  const encodes = {\n    initial: Object.assign({ update: {} }, copy(lastState.encode)),\n    final: Object.assign({ update: {} }, copy(lastState.encode))\n  };\n  const signals = {\n    initial: lastState.signal\n  };\n  const signalsFinal = [\"width\", \"height\", \"padding\"].reduce((acc, sgName) => {\n    if (Array.isArray(change.signal)) {\n      if (change.signal.indexOf(sgName) >= 0) {\n        acc[sgName] = eView.signal(sgName);\n      }\n      return acc;\n    }\n    if (change.signal === false) {\n      return acc;\n    }\n    acc[sgName] = eView.signal(sgName);\n    return acc;\n  }, {});\n  signals.final = Object.assign({}, signals.initial, signalsFinal);\n\n  if (change.scale !== false) {\n    let finalScaleNames = [];\n    if (change.scale === true || isAdd) {\n      finalScaleNames = Object.keys(eView._runtime.scales);\n    } else if (Array.isArray(change.scale)) {\n      finalScaleNames = change.scale;\n    } else if (typeof change.scale === \"object\") {\n      finalScaleNames = Object.keys(change.scale);\n    }\n    finalScaleNames.forEach(scName => {\n      if (change.scale[scName] && change.scale[scName].data === false) {\n        scales.final[scName] = dataPreservedScale(\n          rawInfo.sVis.spec,\n          rawInfo.eVis.spec,\n          scName\n        );\n      } else {\n        scales.final[scName] = eView._runtime.scales[scName]\n          ? eView._runtime.scales[scName].value\n          : undefined;\n      }\n\n      const channel = Object.keys(encodes.final.update).find(\n        key => key.scale === scName\n      );\n      encodes.final.update[channel] = change.final\n        ? copy(change.final.encode.update[channel])\n        : undefined;\n    });\n  }\n\n  if (manualEncode === false) {\n    throw Error(\"Interpolating data requires to interpolate encode.\");\n  }\n\n  const styleEncodes = {\n    initial: copy(lastState.styleEncode),\n    final: copy(lastState.styleEncode)\n  };\n  if (change.marktype) {\n    styleEncodes.final = change.final && change.final.style\n      ? DEFAULT_STYLE[change.final.style] || {}\n      : {};\n  }\n\n  const manualEncodeEnterWithoutInitial = manualEncode\n    ? copy(manualEncode.enter || {})\n    : {};\n  delete manualEncodeEnterWithoutInitial.initial;\n\n  encodes.initial.enter = Object.assign(\n    {},\n    lastState.encode.update,\n    DEFAULT_ENCODE.mark.enter,\n    manualEncode && manualEncode.enter ? manualEncode.enter.initial : {}\n  );\n\n  if (get(change, \"encode\", \"enter\") === false) {\n    encodes.final.enter = encodes.initial.enter;\n  } else {\n    encodes.final.enter = Object.assign(\n      {},\n      DEFAULT_ENCODE.mark[marktypes.final || marktypes.initial].update,\n      styleEncodes.final,\n      copy(get(change, \"final\", \"encode\", \"update\") || {}),\n      manualEncode ? manualEncodeEnterWithoutInitial : {},\n      computeKeptEncode(manualEncode, encodes.initial, \"enter\")\n    );\n  }\n\n  encodes.initial.exit = Object.assign({}, lastState.encode.update);\n  if (change.encode && change.encode.exit === false) {\n    encodes.final.exit = encodes.initial.exit;\n  } else {\n    encodes.final.exit = Object.assign(\n      {},\n      DEFAULT_ENCODE.mark[marktypes.initial || marktypes.final].update,\n      styleEncodes.final,\n      doExit\n        ? copy(\n          get(change, \"final\", \"encode\", \"update\") ||\n              get(change, \"initial\", \"encode\", \"update\")\n        )\n        : copy(\n          get(change, \"initial\", \"encode\", \"update\") ||\n              get(change, \"final\", \"encode\", \"update\")\n        ),\n      DEFAULT_ENCODE.mark.exit,\n      manualEncode ? manualEncode.exit : {},\n      computeKeptEncode(manualEncode, encodes.initial, \"exit\")\n    );\n  }\n\n  if (change.encode && change.encode.update === false) {\n    encodes.final.update = encodes.initial.update;\n  } else {\n    encodes.final.update = Object.assign(\n      {},\n      DEFAULT_ENCODE.mark[marktypes.final || marktypes.initial].update,\n      styleEncodes.final,\n      copy(get(change, \"final\", \"encode\", \"update\") || {}),\n      manualEncode ? manualEncode.update : {},\n      computeKeptEncode(manualEncode, encodes.initial, \"update\")\n    );\n  }\n\n  // When marktype changes\n  // |S_exit  | -> |          | exit!                 (initial.exit  -> final.exit)\n  // |S_update| -> |          | update via fading out (initial.update -> initial.intermediate)\n  // |        | -> | E_update | & fading in           (final.intermediate -> final.update)\n  // |        | -> | E_enter  | enter!                (initial.enter  -> final.enter)\n  if (marktypes.final !== marktypes.initial) {\n    encodes.initial.intermediate = Object.assign(\n      {},\n      replacePositionAttrs(marktypes.initial, encodes.initial.update, encodes.final.update),\n      { opacity: { value: 0 } }\n    );\n\n    encodes.final.intermediate = Object.assign(\n      {},\n      replacePositionAttrs(marktypes.final, encodes.final.update, encodes.initial.update),\n      { opacity: { value: 0 } }\n    );\n\n    if (doEnter) {\n      encodes.initial.enter = Object.assign(\n        {},\n        replacePositionAttrs(marktypes.final, encodes.final.enter, encodes.initial.enter),\n        { opacity: { value: 0 } },\n        manualEncode && manualEncode.enter ? manualEncode.enter.initial : {}\n      );\n    }\n    if (doExit) {\n      encodes.final.exit = Object.assign(\n        {},\n        replacePositionAttrs(marktypes.initial, encodes.initial.exit, encodes.final.exit),\n        { opacity: { value: 0 } },\n        manualEncode ? manualEncode.exit : {},\n        computeKeptEncode(manualEncode, encodes.initial, \"exit\"),\n      );\n    }\n  }\n  if (!aggregates.initial && aggregates.final && change.data ) {\n    // when aggregate\n    encodes.final.exit = Object.assign(\n      !change.marktype ? encodes.final.update : replacePositionAttrs(marktypes.initial, encodes.final.exit, encodes.final.update),\n      { opacity: { value: 0 } },\n      manualEncode ? manualEncode.exit : {},\n      computeKeptEncode(manualEncode, encodes.initial, \"exit\"),\n    );\n\n    encodes.final.update = copy(encodes.final.enter);\n  } else if (aggregates.initial && !aggregates.final && change.data ) {\n    // when disaggregate\n\n    encodes.initial.enter = Object.assign(\n      {},\n      !change.marktype ? encodes.initial.update : replacePositionAttrs(marktypes.final, encodes.initial.enter, encodes.initial.update),\n      { opacity: { value: 0 } },\n      manualEncode && manualEncode.enter ? manualEncode.enter.initial : {}\n    );\n\n    encodes.final.update = copy(encodes.final.enter);\n  }\n\n  return {\n    encodes,\n    scales,\n    signals,\n    marktypes,\n    hasFacet,\n    aggregates,\n    styleEncodes\n  };\n}","import { dataPreservedScale, computeKeptEncode } from \"./util\";\nimport { copy2, copy, get, deepEqual } from \"../../../util/util\";\nimport { DEFAULT_ENCODE } from \"../../../default\";\nimport { findComp } from \"../../../actuator/util\";\n\nexport function compute(rawInfo, step, lastState) {\n  const { change } = step;\n  const compState = lastState;\n  const eView = rawInfo.eVis.view;\n  const isRemove = !change.final;\n  const isAdd = !change.initial;\n  let doTicks;\n  let doLabels;\n  let doAxisG;\n  let doTitle;\n  let doDomain;\n  let doGrid;\n  doTicks = doLabels = doAxisG = doTitle = doDomain = doGrid = true;\n\n  if (change.encode === false) {\n    doTicks = doLabels = doAxisG = doTitle = doDomain = doGrid = false;\n  } else if (change.encode) {\n    doTicks = !(change.encode.ticks === false);\n    doLabels = !(change.encode.labels === false);\n    doAxisG = !(change.encode.axis === false);\n    doTitle = !(change.encode.title === false);\n    doGrid = !(change.encode.grid === false);\n    doDomain = !(change.encode.domain === false);\n  }\n\n  const scNames = {\n    initial: change.initial ? change.initial.scale : undefined,\n    final: change.final ? change.final.scale : undefined\n  };\n\n  // collect the scale objects to scale the initial/final values\n  const scales = {\n    initial: compState.scale,\n    final: copy2(compState.scale)\n  };\n\n  if (!(change.scale === false)) {\n    if (!scNames.final) {\n      scales.final = {};\n    } else if (change.scale && change.scale.data === false) {\n      scales.final[scNames.final] = dataPreservedScale(\n        rawInfo.sVis.spec,\n        rawInfo.eVis.spec,\n        scNames.final\n      );\n    } else {\n      scales.final[scNames.final] = eView._runtime.scales[scNames.final]\n        ? eView._runtime.scales[scNames.final].value\n        : undefined;\n    }\n  }\n\n  let sameDomainDimension = get(change, \"scale\", \"domainDimension\");\n  if (typeof sameDomainDimension === \"string\") {\n    sameDomainDimension =\n      sameDomainDimension === \"same\"\n        ? true\n        : sameDomainDimension === \"diff\"\n          ? false\n          : undefined;\n  }\n  if (isRemove || isAdd) {\n    sameDomainDimension = false;\n  } else if (sameDomainDimension === undefined) {\n    if (change.scale === false) {\n      sameDomainDimension = true;\n    } else {\n      const scaleDefs = {\n        initial: rawInfo.sVis.spec.scales.find(\n          scaleDef => scaleDef.name === scNames.initial\n        ),\n        final: rawInfo.eVis.spec.scales.find(\n          scaleDef => scaleDef.name === scNames.final\n        )\n      };\n      sameDomainDimension = deepEqual(\n        scaleDefs.initial.domain,\n        scaleDefs.final.domain\n      );\n    }\n  }\n\n  const signals = {\n    initial: compState.signal\n  };\n  const signalsFinal = [\"width\", \"height\", \"padding\"].reduce((acc, sgName) => {\n    if (Array.isArray(change.signal)) {\n      if (change.signal.indexOf(sgName) >= 0) {\n        acc[sgName] = eView.signal(sgName);\n      }\n      return acc;\n    }\n    if (change.signal === false) {\n      return acc;\n    }\n    acc[sgName] = eView.signal(sgName);\n    return acc;\n  }, {});\n  signals.final = Object.assign({}, signals.initial, signalsFinal);\n\n  const allEncodes = {};\n\n  const subComps = {\n    ticks: doTicks,\n    labels: doLabels,\n    title: doTitle,\n    axis: doAxisG,\n    grid: doGrid,\n    domain: doDomain\n  };\n  const axisGDatumFinal = change.final\n    ? findComp(eView.scenegraph().root, change.compName, \"axis\")[0].items[0]\n    : undefined;\n  const axisGEncodeBaseFinal = axisGDatumFinal\n    ? {\n      x: { value: axisGDatumFinal.x },\n      y: { value: axisGDatumFinal.y }\n    }\n    : {};\n\n  Object.keys(subComps).forEach(subComp => {\n    const manualEncode =\n      change.encode && change.encode[subComp] ? change.encode[subComp] : {};\n    allEncodes[subComp] = getAxisSubCompEncodes(subComp, manualEncode);\n  });\n\n  function getAxisSubCompEncodes(subComponent, manualEncode) {\n    const encodes = {\n      initial: copy(compState.encode[subComponent] || {}),\n      final: copy(compState.encode[subComponent] || {})\n    };\n\n    if (subComps[subComponent] !== true) {\n      return encodes;\n    }\n\n    const subCompEncode = {\n      initial:\n        change.initial &&\n        change.initial.encode &&\n        change.initial.encode[subComponent]\n          ? change.initial.encode[subComponent].update\n          : undefined,\n      final:\n        change.final && change.final.encode && change.final.encode[subComponent]\n          ? change.final.encode[subComponent].update\n          : undefined\n    };\n\n    encodes.initial.enter = Object.assign(\n      {},\n      // defaultAxisEncode.initial,\n      DEFAULT_ENCODE.axis[subComponent](sameDomainDimension ? change.initial : change.final)\n        .update,\n      sameDomainDimension ? subCompEncode.initial : subCompEncode.final || {},\n      DEFAULT_ENCODE.mark.enter,\n      compState.encode.enter,\n      manualEncode && manualEncode.enter ? manualEncode.enter.initial : {}\n    );\n    if (manualEncode && manualEncode.enter === false) {\n      encodes.final.enter = encodes.initial.enter;\n    } else {\n      encodes.final.enter = Object.assign(\n        {},\n        // defaultAxisEncode.final,\n        DEFAULT_ENCODE.axis[subComponent](change.final).update,\n        subCompEncode.final ? subCompEncode.final : {},\n        manualEncode ? manualEncode.enter : {},\n        computeKeptEncode(manualEncode, encodes.initial, \"enter\")\n      );\n    }\n\n    encodes.initial.exit = Object.assign(\n      {},\n      // defaultAxisEncode.initial,\n      DEFAULT_ENCODE.axis[subComponent](change.initial).update,\n      subCompEncode.initial ? subCompEncode.initial : {},\n      compState.encode.exit || compState.encode.update\n    );\n    if (manualEncode && manualEncode.exit === false) {\n      encodes.final.exit = encodes.initial.exit;\n    } else {\n      encodes.final.exit = Object.assign(\n        {},\n        // defaultAxisEncode.final,\n        DEFAULT_ENCODE.axis[subComponent](\n          sameDomainDimension ? change.final : change.initial\n        ).update,\n        sameDomainDimension ? subCompEncode.final : subCompEncode.initial || {},\n        DEFAULT_ENCODE.mark.exit,\n        manualEncode ? manualEncode.exit : {},\n        computeKeptEncode(manualEncode, encodes.initial, \"exit\")\n      );\n    }\n\n    encodes.initial.update = Object.assign(\n      {},\n      // defaultAxisEncode.initial,\n      DEFAULT_ENCODE.axis[subComponent](change.initial).update,\n      subCompEncode.initial || {},\n      encodes.initial.update\n    );\n\n    if (manualEncode && manualEncode.update === false) {\n      encodes.final.update = encodes.initial.update;\n    } else {\n      encodes.final.update = Object.assign(\n        {},\n        // defaultAxisEncode.final,\n        subComponent === \"axis\" ? axisGEncodeBaseFinal : {},\n        DEFAULT_ENCODE.axis[subComponent](change.final).update,\n        subCompEncode.final || {},\n        manualEncode ? manualEncode.update : {},\n        computeKeptEncode(manualEncode, encodes.initial, \"update\")\n      );\n    }\n    return encodes;\n  }\n\n  return {\n    encodes: allEncodes,\n    scales,\n    signals,\n    sameDomainDimension\n  };\n}","import { dataPreservedScale, computeKeptEncode } from \"./util\";\nimport { copy2, get, deepEqual } from \"../../../util/util\";\nimport { DEFAULT_ENCODE } from \"../../../default\";\n\n\nexport function compute(rawInfo, step, lastState) {\n  const LEGEND_CHANNELS = [\n    \"fill\",\n    \"opacity\",\n    \"shape\",\n    \"size\",\n    \"stroke\",\n    \"strokeDash\",\n    \"strokeWidth\"\n  ];\n  const { change } = step;\n  const eView = rawInfo.eVis.view;\n\n  let doTitle;\n  let doSymbols;\n  let doLabels;\n  let doEntries;\n  let doGradient;\n  let doLegendG;\n  doTitle = doSymbols = doLabels = doEntries = doGradient = doLegendG = true;\n  const isRemove = !lastState.isRemove && !change.final;\n  const isAdd = !lastState.isAdd && !change.initial;\n  if (change.encode === false) {\n    doTitle = doSymbols = doLabels = doEntries = doGradient = doLegendG = false;\n  } else if (change.encode) {\n    doTitle = !(change.encode.title === false);\n    doSymbols = !(change.encode.symbols === false);\n    doLabels = !(change.encode.labels === false);\n    doEntries = !(change.encode.entries === false);\n    doGradient = !(change.encode.gradient === false);\n    doLegendG = !(change.encode.legend === false);\n  }\n\n  const legendTypes = {\n    initial: lastState.legendType,\n    final:\n      change.scale === false\n        ? lastState.legendType\n        : change.final\n          ? change.final.type\n          : undefined\n  };\n\n  const scNames = {\n    initial: [],\n    final: []\n  };\n  LEGEND_CHANNELS.forEach(channel => {\n    if (change.initial && change.initial[channel]) {\n      scNames.initial.push(change.initial[channel]);\n    }\n    if (change.final && change.final[channel]) {\n      scNames.final.push(change.final[channel]);\n    }\n  });\n\n  // collect the scale objects to scale the initial/final values\n  const scales = {\n    initial: lastState.scale,\n    final: copy2(lastState.scale)\n  };\n\n  if (change.scale !== false) {\n    let finalScaleNames = [];\n    if (Array.isArray(change.scale)) {\n      finalScaleNames = change.scale;\n    } else if (change.scale === true || isAdd) {\n      finalScaleNames = scNames.final;\n    } else if (typeof change.scale === \"object\") {\n      finalScaleNames = scNames.final.filter(\n        scName => change.scale[scName] !== false\n      );\n    }\n    finalScaleNames.forEach(scName => {\n      if (change.scale[scName] && change.scale[scName].data === false) {\n        scales.final[scName] = dataPreservedScale(\n          rawInfo.sVis.spec,\n          rawInfo.eVis.spec,\n          scName\n        );\n      } else {\n        scales.final[scName] = eView._runtime.scales[scName]\n          ? eView._runtime.scales[scName].value\n          : undefined;\n      }\n    });\n  }\n\n  let sameDomainDimension = get(change, \"scale\", \"domainDimension\");\n  if (typeof sameDomainDimension === \"string\") {\n    sameDomainDimension =\n      sameDomainDimension === \"same\"\n        ? true\n        : sameDomainDimension === \"diff\"\n          ? false\n          : undefined;\n  }\n  if (sameDomainDimension === undefined) {\n    if (change.scale === false) {\n      sameDomainDimension = true;\n    } else if (isRemove || isAdd) {\n      sameDomainDimension = false;\n    } else {\n      // Fact: Each legend can be associated with multiple scales but their domains are equal.\n      const scaleDefs = {\n        initial: rawInfo.sVis.spec.scales.find(\n          scaleDef => scaleDef.name === scNames.initial[0]\n        ),\n        final: rawInfo.eVis.spec.scales.find(\n          scaleDef => scaleDef.name === scNames.final[0]\n        )\n      };\n      sameDomainDimension = deepEqual(\n        scaleDefs.initial.domain,\n        scaleDefs.final.domain\n      );\n    }\n  }\n\n  const signals = {\n    initial: lastState.signal\n  };\n  const signalsFinal = [\"width\", \"height\", \"padding\"].reduce((acc, sgName) => {\n    if (Array.isArray(change.signal)) {\n      if (change.signal.indexOf(sgName) >= 0) {\n        acc[sgName] = eView.signal(sgName);\n      }\n      return acc;\n    }\n    if (change.signal === false) {\n      return acc;\n    }\n    acc[sgName] = eView.signal(sgName);\n    return acc;\n  }, {});\n  signals.final = Object.assign({}, signals.initial, signalsFinal);\n\n  const allEncodes = {};\n\n  const subComps = {\n    gradient: doGradient,\n    bands: doGradient,\n    pairs: doSymbols || doLabels,\n    labels: doLabels,\n    title: doTitle,\n    legend: doLegendG,\n    entries: doEntries,\n    symbols: doSymbols\n  };\n  Object.keys(subComps).forEach(subComp => {\n    if (subComps[subComp]) {\n      const manualEncode =\n        change.encode && change.encode[subComp] ? change.encode[subComp] : {};\n      allEncodes[subComp] = getLegendSubCompEncodes(\n        subComp,\n        manualEncode\n      );\n    }\n  });\n\n  function getLegendSubCompEncodes(subComponent, manualEncode) {\n    const defaultSubcompEncode = {\n      initial: DEFAULT_ENCODE.legend[subComponent](change.initial).update,\n      final: DEFAULT_ENCODE.legend[subComponent](change.final).update\n    };\n    const comps = change;\n    const compEncode = {};\n    [\"initial\", \"final\"].forEach(which => {\n      if (\n        comps[which] &&\n        comps[which].encode &&\n        comps[which].encode[subComponent]\n      ) {\n        compEncode[which] = comps[which].encode[subComponent].update;\n      }\n    });\n\n    const encodes = {\n      initial: copy2(\n        lastState.encode && lastState.encode[subComponent]\n          ? lastState.encode[subComponent]\n          : { update: defaultSubcompEncode.initial }\n      ),\n      final: copy2(\n        lastState.encode && lastState.encode[subComponent]\n          ? lastState.encode[subComponent]\n          : { update: defaultSubcompEncode.final }\n      )\n    };\n\n    encodes.initial.enter = Object.assign(\n      {},\n      sameDomainDimension\n        ? defaultSubcompEncode.initial\n        : defaultSubcompEncode.final,\n      sameDomainDimension ? compEncode.initial : compEncode.final,\n      DEFAULT_ENCODE.mark.enter,\n      lastState.encode.enter,\n      manualEncode && manualEncode.enter ? manualEncode.enter.initial : {}\n    );\n    if (manualEncode && manualEncode.enter === false) {\n      encodes.final.enter = encodes.initial.enter;\n    } else {\n      encodes.final.enter = Object.assign(\n        {},\n        defaultSubcompEncode.final,\n        compEncode.final,\n        manualEncode ? manualEncode.enter : {},\n        computeKeptEncode(manualEncode, encodes.initial, \"enter\")\n      );\n    }\n\n    encodes.initial.exit = Object.assign(\n      {},\n      defaultSubcompEncode.initial,\n      compEncode.initial,\n      lastState.encode.exit || lastState.encode.update\n    );\n\n    if (manualEncode && manualEncode.exit === false) {\n      encodes.final.exit = encodes.initial.exit;\n    } else {\n      encodes.final.exit = Object.assign(\n        {},\n        sameDomainDimension\n          ? defaultSubcompEncode.final\n          : defaultSubcompEncode.initial,\n        sameDomainDimension ? compEncode.final : compEncode.initial,\n        DEFAULT_ENCODE.mark.exit,\n        manualEncode ? manualEncode.exit : {},\n        computeKeptEncode(manualEncode, encodes.initial, \"exit\")\n      );\n    }\n\n    encodes.initial.update = Object.assign(\n      {},\n      defaultSubcompEncode.initial,\n      compEncode.initial,\n      encodes.initial.update\n    );\n\n    if (manualEncode && manualEncode.update === false) {\n      encodes.final.update = encodes.initial.update;\n    } else {\n      encodes.final.update = Object.assign(\n        {},\n        defaultSubcompEncode.final,\n        compEncode.final,\n        manualEncode ? manualEncode.update : {},\n        computeKeptEncode(manualEncode, encodes.initial, \"update\")\n      );\n    }\n\n    return encodes;\n  }\n\n  return {\n    encodes: allEncodes,\n    scales,\n    signals,\n    legendTypes,\n    sameDomainDimension,\n    isAdd,\n    isRemove\n  };\n}","import { copy } from \"../../../util/util\";\n\nexport function compute(rawInfo, step, lastState) {\n  const { change } = step;\n  const signals = {\n    initial: lastState.signal\n  };\n  const encodes = {\n    initial: copy(lastState.encode),\n    final: copy(lastState.encode)\n  };\n\n  const signalsFinal = {};\n  const finalSignalNames = Array.isArray(change.signal)\n    ? change.signal\n    : [\"width\", \"height\", \"padding\"];\n\n  finalSignalNames.forEach(sgName => {\n    signalsFinal[sgName] = rawInfo.eVis.view.signal(sgName);\n  });\n\n  signals.final = { ...signals.initial, ...signalsFinal };\n\n  if (step.change.signal !== false) {\n    if (finalSignalNames.indexOf(\"height\") >= 0) {\n      encodes.final.svg.y = { value: change.final.y + change.final.padding };\n      encodes.final.svg.height = {\n        value: change.final.viewHeight + change.final.padding * 2\n      };\n      encodes.final.root.height = { value: signals.final.height };\n    }\n    if (finalSignalNames.indexOf(\"width\") >= 0) {\n      encodes.final.svg.x = { value: change.final.x + change.final.padding };\n      encodes.final.svg.width = {\n        value: change.final.viewWidth + change.final.padding * 2\n      };\n      encodes.final.root.width = { value: signals.final.width };\n    }\n  }\n\n  // Todo Encodes for view comp\n  const fRootDatum = rawInfo.eVis.view._runtime.data.root.values.value[0];\n  encodes.final.root.fill = { value: fRootDatum.fill };\n  encodes.final.root.stroke = { value: fRootDatum.stroke };\n\n  return {\n    signals,\n    encodes\n  };\n\n}","function getLegendType(legendCompSpec, view) {\n  if (legendCompSpec.fill) {\n    const scale = view._runtime.scales[legendCompSpec.fill].value;\n    if (\n      [\n        \"sequential-linear\",\n        \"linear\",\n        \"log\",\n        \"pow\",\n        \"sqrt\",\n        \"symlog\",\n        \"bin-ordinal\"\n      ].indexOf(scale.type) >= 0\n    ) {\n      if (scale.type === \"bin-ordinal\") {\n        return { type: \"gradient\", isBand: true };\n      }\n      return { type: \"gradient\" };\n    }\n  }\n\n  if (legendCompSpec.stroke) {\n    const scale = view._runtime.scales[legendCompSpec.stroke].value;\n    if (\n      [\n        \"sequential-linear\",\n        \"linear\",\n        \"log\",\n        \"pow\",\n        \"sqrt\",\n        \"symlog\",\n        \"bin-ordinal\"\n      ].indexOf(scale.type) >= 0\n    ) {\n      if (scale.type === \"bin-ordinal\") {\n        return { type: \"gradient\", isBand: true };\n      }\n      return { type: \"gradient\" };\n    }\n  }\n  return { type: \"symbol\" };\n}\n\nexport { getLegendType };\n","import { copy } from \"../util/util\";\nimport { getLegendType } from \"../util/vgSpecHelper\";\n\nfunction getComponents(vgSpec) {\n  // By traveling vgSpec, collect the marks, axes, legends, and scales with their bound data and encoding.\n  const components = [];\n  function collectComp(mark, currComp, isRoot = false) {\n    if (isRoot) {\n      mark.name = \"root\";\n    }\n    let newComp = currComp;\n    if (mark.axes) {\n      newComp = newComp.concat(\n        mark.axes.map(d => {\n          return {\n            ...copy(d),\n            compType: \"axis\"\n          };\n        })\n      );\n    }\n\n    if (mark.legends) {\n      newComp = newComp.concat(\n        mark.legends.map(d => { return { ...copy(d),  compType: \"legend\" }; })\n      );\n    }\n\n    if (mark.scales) {\n      newComp = newComp.concat(\n        mark.scales.map(d => { return { ...copy(d),  compType: \"scale\" }; })\n      );\n    }\n\n    if (!isRoot) {\n      const newMark = { ...copy(mark),  compType: \"mark\" };\n      delete newMark.marks;\n      newComp.push(newMark);\n    }\n\n    if (mark.marks) {\n      newComp = mark.marks.reduce((acc, curr) => {\n        const subComps = collectComp(\n          { ...curr, parent: (mark || \"root\") },\n          []\n        );\n        return acc.concat(subComps);\n      }, newComp);\n    }\n    return newComp;\n  }\n\n  return collectComp(vgSpec, components, true);\n}\nfunction getChanges(sComponents, eComponents) {\n  const IDENTIFIERS = {\n    axis: comp =>\n      comp.encode && comp.encode.axis ? comp.encode.axis.name : comp.scale,\n    legend: comp =>\n      comp.encode && comp.encode.legend ? comp.encode.legend.name : comp.scale,\n    mark: comp => comp.name,\n    scale: comp => comp.name\n  };\n  const merged = [];\n  sComponents.forEach(sComp => {\n    const id = IDENTIFIERS[sComp.compType];\n    const matchedId = eComponents.findIndex(\n      eComp => sComp.compType === eComp.compType && id(sComp) === id(eComp)\n    );\n    if (matchedId >= 0) {\n      merged.push({\n        compType: sComp.compType,\n        compName: id(sComp),\n        parent: sComp.parent,\n        initial: sComp,\n        final: eComponents.splice(matchedId, 1)[0]\n      });\n    } else {\n      merged.push({\n        compType: sComp.compType,\n        compName: id(sComp),\n        parent: sComp.parent,\n        initial: sComp,\n        final: null\n      });\n    }\n  });\n\n  return merged.concat(\n    eComponents.map(eComp => {\n      const id = IDENTIFIERS[eComp.compType];\n      return {\n        compType: eComp.compType,\n        compName: id(eComp),\n        parent: eComp.parent,\n        initial: null,\n        final: eComp\n      };\n    })\n  );\n}\n\nfunction getViewChange(rawInfo) {\n  return {\n    compType: \"view\",\n    compName: \"global\",\n\n    initial: {\n      viewWidth: rawInfo.sVis.view._viewWidth,\n      viewHeight: rawInfo.sVis.view._viewHeight,\n      width: rawInfo.sVis.view.width(),\n      height: rawInfo.sVis.view.height(),\n      x: rawInfo.sVis.view._origin[0],\n      y: rawInfo.sVis.view._origin[1],\n      padding: rawInfo.sVis.spec.padding\n    },\n    final: {\n      viewWidth: rawInfo.eVis.view._viewWidth,\n      viewHeight: rawInfo.eVis.view._viewHeight,\n      width: rawInfo.eVis.view.width(),\n      height: rawInfo.eVis.view.height(),\n      x: rawInfo.eVis.view._origin[0],\n      y: rawInfo.eVis.view._origin[1],\n      padding: rawInfo.eVis.spec.padding\n    }\n  };\n}\n\n\nfunction getDefaultChange(step, rawInfo) {\n  const change = copy(step.change || {});\n  if (step.compType === \"mark\") {\n    change.data = change.data === undefined ? true : change.data;\n    if (\n      change.data.update === false &&\n      change.data.enter === false &&\n      change.data.exit === false\n    ) {\n      change.data = false;\n    }\n    change.marktype = change.marktype === undefined ? true : change.marktype;\n    change.scale = change.scale === undefined ? true : change.scale;\n    change.signal = change.signal === undefined ? true : change.signal;\n    change.encode = change.encode === undefined ? true : change.encode;\n  } else if (step.compType === \"axis\" || step.compType === \"legend\") {\n    change.signal = change.signal === undefined ? true : change.signal;\n    change.scale = change.scale === undefined ? {} : change.scale;\n\n    if (step.compType === \"legend\") {\n      change.scale = change.scale === undefined ? true : change.scale;\n      change.signal = change.signal === undefined ? true : change.signal;\n      // specify the type of the legend\n      if (change.initial) {\n        change.initial = Object.assign(\n          change.initial,\n          getLegendType(change.initial, rawInfo.sVis.view)\n        );\n\n        change.initial.direction = change.initial.direction || \"vertical\";\n        change.initial.orient = change.initial.orient || \"right\";\n      }\n      if (change.final) {\n        change.final = Object.assign(\n          change.final,\n          getLegendType(change.final, rawInfo.eVis.view)\n        );\n        change.final.direction = change.final.direction || \"vertical\";\n        change.final.orient = change.final.orient || \"right\";\n      }\n    }\n  } else if (step.compType === \"view\") {\n    change.signal = change.signal === undefined ? true : change.signal;\n  }\n  return change;\n}\n\n\nfunction attachChanges(rawInfo, schedule) {\n  const changes = getChanges(\n    getComponents(rawInfo.sVis.spec),\n    getComponents(rawInfo.eVis.spec)\n  );\n\n  // attach the view change\n  changes.push(getViewChange(rawInfo));\n\n  schedule.forEach(track => {\n    track.steps = track.steps.map(step => {\n      if (step.compType === \"pause\") {\n        return step;\n      }\n\n      const found = changes.find(change => {\n        return (\n          change.compType === step.compType &&\n          (change.compName === step.compName || step.compType === \"view\")\n        );\n      });\n      if (!found) {\n        console.error(`cannot found the changes of ${step.compName}.`);\n      }\n\n      step.change = {\n        ...step.change,\n        ...found\n      };\n      step.change = {\n        ...step.change,\n        ...getDefaultChange(step, rawInfo)\n      };\n\n      return step;\n    });\n  });\n\n  return schedule;\n}\n\nexport { getComponents, getChanges, getViewChange, getDefaultChange, attachChanges };\n","import * as vega from \"vega\";\nimport { joinData, initialData, getAggregate } from \"./dataJoin\";\nimport { findComp } from \"../../actuator/util\";\nimport { DEFAULT_ENCODE, DEFAULT_STYLE } from \"../../default\";\nimport * as computeStates from \"./compute\";\nimport { computeNewSpec, Enumerator } from \"../../enumerator\";\nimport { copy, get } from \"../../util/util\";\nimport {\n  getComponents,\n  getViewChange,\n} from \"../change\";\nimport {\n  computeHasFacet,\n  isGroupingMarktype,\n  findMark,\n  findFilter,\n  findData\n} from \"./util\";\n\n\n//Todo make schedule class and put this as its method\nfunction getMoments(schedule) {\n  const moments = [];\n  schedule.forEach(track => {\n    track.steps.forEach(step => {\n      let m = moments.find(m => m.time === step.sTime);\n      if (!m) {\n        moments.push({\n          time: step.sTime,\n          starting: [step],\n          ending: []\n        });\n      } else {\n        m.starting.push(step);\n      }\n      m = moments.find(m => m.time === step.eTime);\n      if (!m) {\n        moments.push({\n          time: step.eTime,\n          starting: [],\n          ending: [step]\n        });\n      } else {\n        m.ending.push(step);\n      }\n    });\n  });\n  return moments.sort((a, b) => a.time - b.time);\n}\n\n\nexport function attachStates(schedule, rawInfo) {\n  const state = initializeState(schedule, rawInfo);\n  const moments = getMoments(schedule);\n  schedule.moments = moments;\n\n  moments.forEach(moment => {\n    moment.ending.forEach(step => {\n      const lastState = state[step.trackName];\n      if (step.compType === \"pause\") {\n        return;\n      }\n\n      lastState.data = lastState.data || initialData(step, rawInfo);\n\n      // When the steps are enumerated by \"enumerator\"\n      let eView;\n      if (step.enumerated) {\n        step.enumerated.forEach(enumed => {\n          const filter = findFilter(state.spec, enumed.def.filter);\n          state.spec = computeNewSpec(state.spec, filter, enumed.val);\n        });\n        eView = new vega.View(vega.parse(state.spec), {\n          renderer: \"none\"\n        }).run();\n      }\n      const newRawInfo = {\n        sVis: rawInfo.sVis,\n        eVis: Object.assign(\n          {},\n          rawInfo.eVis,\n          eView ? { view: eView } : undefined\n        )\n      };\n      if (step.compType === \"view\") {\n        Object.assign(step.change, getViewChange(newRawInfo));\n      }\n\n      Object.assign(\n        step,\n        computeStates[step.compType](newRawInfo, step, lastState)\n      );\n      Object.assign(step, joinData(step, newRawInfo, lastState.data));\n      lastState.data = step.nextData;\n\n      if (step.encodes) {\n        lastState.encode =\n          copy(step.encodes.final) ||\n          Object.keys(step.encodes).reduce((acc, key) => {\n            acc[key] = step.encodes[key].final;\n            return acc;\n          }, {});\n      }\n      lastState.styleEncode = step.styleEncodes ? step.styleEncodes.final : undefined;\n      lastState.signal = step.signals ? step.signals.final : undefined;\n      lastState.scale = step.scales ? step.scales.final : undefined;\n      lastState.marktype = step.marktypes ? step.marktypes.final : undefined;\n      lastState.hasFacet = step.hasFacet ? step.hasFacet.final : undefined;\n      lastState.aggregate = step.aggregates ? step.aggregates.final : undefined;\n      lastState.isAdd = step.isAdd;\n      lastState.isRemove = step.isRemove;\n      lastState.sameDomainDimension = step.sameDomainDimension;\n\n      state.spec = updateSpec(state, step, newRawInfo.eVis.spec);\n\n      // Catch if scale < data for encodes using scales\n\n      if (step.compType === \"mark\") {\n        let valid = schedule.find(track => track.name === step.trackName)\n          .scaleOrderValid;\n        valid = valid === undefined ? true : valid;\n\n        Object.keys(lastState.encode.update).map(prop => {\n          const foundScale =\n            lastState.scale[lastState.encode.update[prop].scale];\n\n          if (foundScale && lastState.encode.update[prop].field) {\n            const { field } = lastState.encode.update[prop];\n            let vals = lastState.data.map(d => d.datum[field]);\n\n            if (lastState.data[0].mark.marktype === \"group\") {\n              vals = lastState.data.reduce((vals, d) => {\n                return vals.concat(d.items[0].items.map(d2 => d2.datum[field]));\n              }, []);\n            }\n\n            const scaleDomain = foundScale.domain();\n            if (foundScale.type === \"band\" || foundScale.type === \"point\") {\n              valid =\n                valid &&\n                vals.reduce(\n                  (acc, v) => (acc = acc && scaleDomain.indexOf(v) >= 0),\n                  true\n                );\n            } else if (foundScale.type === \"linear\") {\n              const max = Math.max(...vals);\n              const min = Math.min(...vals);\n              valid = valid && scaleDomain[0] <= min && scaleDomain[1] >= max;\n            }\n          }\n        });\n        schedule.find(\n          track => track.name === step.trackName\n        ).scaleOrderValid = valid;\n      }\n    });\n    moment.starting.forEach(step => {\n      const lastState = state[step.trackName];\n      if (get(step, \"enumerator\")) {\n        if (step.compType === \"mark\") {\n          // fetch enumerator\n          step.enumeratorDef = step.enumerator;\n          const enumerator = (step.enumerator = new Enumerator(\n            step.enumerator,\n            state.spec,\n            rawInfo\n          ));\n          // let dataName = (step.change.final || step.change.final).from.data;\n          let dataName = step.compName;\n\n          let key =\n            (Array.isArray(step.change.data)\n              ? step.change.data\n              : step.change.data.keys) || null;\n          if (\n            computeHasFacet(step.change.initial) &&\n            computeHasFacet(step.change.final)\n          ) {\n            key = (step.change.final || step.change.final).parent.from.facet\n              .groupby;\n            dataName = (step.change.final || step.change.final).parent.name;\n          }\n          let extractData = view => view.data(dataName);\n          if (\n            !computeHasFacet(step.change.initial) &&\n            !computeHasFacet(step.change.final) &&\n            isGroupingMarktype(step.change.initial) &&\n            isGroupingMarktype(step.change.final)\n          ) {\n            extractData = view => {\n              const data = view._runtime.data[dataName].values.value;\n              return [\n                {\n                  datum: {},\n                  mark: { role: \"group\", marktype: \"group\" },\n                  items: [{ items: data }]\n                }\n              ];\n            };\n          }\n          enumerator.joinData(extractData, (d, i) => {\n            if (Array.isArray(key)) {\n              return key\n                .map(field => {\n                  return d.datum[field];\n                })\n                .join(\"-\");\n            }\n            return i.toString();\n          });\n\n          // Check if scale < data\n          for (let i = 1; i < enumerator.stopN - 1; i++) {\n            let scale = scName => lastState.scale[scName];\n            if (step.change.scale) {\n              scale = enumerator._getScales(i);\n            }\n            const data = enumerator.getData(i);\n            let valid = schedule.find(track => track.name === step.trackName)\n              .scaleOrderValid;\n            valid = valid === undefined ? true : valid;\n            Object.keys(lastState.encode.update).map(prop => {\n              const foundScale = scale(lastState.encode.update[prop].scale);\n\n              if (foundScale && lastState.encode.update[prop].field) {\n                const { field } = lastState.encode.update[prop];\n                const scaleDomain = foundScale.domain();\n                let vals = data.map(d => d[field]);\n\n                if (data[0].mark.marktype === \"group\") {\n                  vals = data.reduce((vals, d) => {\n                    return vals.concat(\n                      d.items[0].items.map(d2 => d2.datum[field])\n                    );\n                  }, []);\n                }\n\n                if (foundScale.type === \"band\" || foundScale.type === \"point\") {\n                  valid =\n                    valid &&\n                    vals.reduce(\n                      (acc, v) => (acc = acc && scaleDomain.indexOf(v) >= 0),\n                      true\n                    );\n                } else if (foundScale.type === \"linear\") {\n                  const max = Math.max(...vals);\n                  const min = Math.min(...vals);\n                  valid =\n                    valid && scaleDomain[0] <= min && scaleDomain[1] >= max;\n                }\n              }\n            });\n            schedule.find(\n              track => track.name === step.trackName\n            ).scaleOrderValid = valid;\n          }\n        } else if (step.compType === \"axis\") {\n          step.enumeratorDef = step.enumerator;\n          step.enumerator = [\"tick\", \"label\", \"grid\"].reduce((acc, subComp) => {\n            const enumerator = new Enumerator(\n              step.enumerator,\n              state.spec,\n              rawInfo\n            );\n            const scName = step.compName;\n            enumerator.joinData(\n              view => {\n                return view\n                  .data(scName)[0]\n                  .items.filter(item => item.role === `axis-${subComp}`)[0]\n                  .items;\n              },\n              d => d.datum.value.toString()\n            );\n            acc[subComp] = enumerator;\n            return acc;\n          }, {});\n        } else if (step.compType === \"legend\") {\n          step.enumeratorDef = step.enumerator;\n          let legendEnumDefs = [];\n          if (\n            step.change.initial.type === \"gradient\" &&\n            step.change.initial.type === \"gradient\"\n          ) {\n            const subComps = step.change.initial.isBand\n              ? [\"bands\", \"labels\"]\n              : [\"labels\"];\n            legendEnumDefs = subComps.map(subComp => {\n              return {\n                subComp,\n                extractData: view => {\n                  const entryG = view._runtime.data[\n                    step.compName\n                  ].values.value[0].items.find(\n                    item => item.role === \"legend-entry\"\n                  ).items[0];\n                  return entryG.items.find(\n                    item => item.role === `legend-${subComp.replace(/s$/g, \"\")}`\n                  ).items;\n                },\n                identifyDatum: d => d.datum.value.toString()\n              };\n            });\n          } else if (\n            step.change.initial.type === \"symbol\" &&\n            step.change.initial.type === \"symbol\"\n          ) {\n            legendEnumDefs.push({\n              subComp: \"pairs\",\n              extractData: view => {\n                return view._runtime.data[\n                  step.compName\n                ].values.value[0].items.find(\n                  item => item.role === \"legend-entry\"\n                ).items[0].items[0].items;\n              },\n              identifyDatum: d => {\n                const { datum } = d.items.find(\n                  item => item.role === \"legend-label\"\n                ).items[0];\n                return datum.value.toString();\n              }\n            });\n\n            legendEnumDefs.push({\n              subComp: \"labels\",\n              extractData: view => {\n                const pairs = view._runtime.data[\n                  step.compName\n                ].values.value[0].items.find(\n                  item => item.role === \"legend-entry\"\n                ).items[0].items[0].items;\n                return pairs.map(pair => {\n                  return pair.items.find(item => item.role === \"legend-label\")\n                    .items[0];\n                });\n              },\n              identifyDatum: d => d.datum.value.toString()\n            });\n\n            legendEnumDefs.push({\n              subComp: \"symbols\",\n              extractData: view => {\n                const pairs = view._runtime.data[\n                  step.compName\n                ].values.value[0].items.find(\n                  item => item.role === \"legend-entry\"\n                ).items[0].items[0].items;\n                return pairs.map(pair => {\n                  return pair.items.find(item => item.role === \"legend-symbol\")\n                    .items[0];\n                });\n              },\n              identifyDatum: d => d.datum.value.toString()\n            });\n          } else {\n            console.error(\n              \"Cannot enumerate the changes when the legend type changes.\"\n            );\n          }\n          step.enumerator = legendEnumDefs.reduce((acc, enumDef) => {\n            const enumerator = new Enumerator(\n              step.enumerator,\n              state.spec,\n              rawInfo\n            );\n            enumerator.joinData(enumDef.extractData, enumDef.identifyDatum);\n            acc[enumDef.subComp] = enumerator;\n            return acc;\n          }, {});\n        }\n      }\n    });\n  });\n\n  return schedule;\n}\n\nfunction initializeState(schedule, rawInfo) {\n  const sView = rawInfo.sVis.view;\n  const sSpec = rawInfo.sVis.spec;\n  const sComps = getComponents(sSpec);\n  const initialState = {\n    spec: copy(sSpec)\n  };\n  return schedule.reduce((initialState, track) => {\n    // Todo: some scales can be hidden in _runtime._subcontext\n    const compState = {\n      scale: {},\n      signal: {\n        width: sView.signal(\"width\"),\n        height: sView.signal(\"height\"),\n        padding: sView.signal(\"padding\")\n      }\n    };\n\n    if (track.compType === \"mark\") {\n      const sComp = sComps.find(c => c.name === track.compName);\n\n      if (sComp) {\n        compState.marktype = sComp.type;\n        compState.hasFacet = computeHasFacet(sComp);\n        compState.styleEncode = sComp.style ? DEFAULT_STYLE[sComp.style] : {};\n\n        compState.encode = copy(sComp.encode || {});\n        const baseEncode = Object.assign(\n          {},\n          DEFAULT_ENCODE.mark[compState.marktype].update,\n          sComp.style ? DEFAULT_STYLE[sComp.style] : {}\n        );\n        compState.encode.update = Object.assign(\n          baseEncode,\n          compState.encode.update\n        );\n        compState.encode.exit = copy(compState.encode.update);\n        compState.encode.enter = Object.assign(\n          {},\n          compState.encode.update,\n          DEFAULT_ENCODE.mark.enter\n        );\n\n        sComps\n          .filter(comp => comp.compType === \"scale\")\n          .forEach(scale => {\n            compState.scale[scale.name] = sView.scale(scale.name);\n          });\n      } else {\n        compState.encode = {};\n        compState.styleEncode = {};\n      }\n      compState.aggregate = getAggregate(\n        track.steps[0].change,\n        rawInfo\n      ).initial;\n      // compState.aggregate.done = false;\n    } else if (track.compType === \"axis\") {\n      // for axis comp\n      const sComp = sComps.find(\n        c => c.compType === \"axis\" && c.encode.axis.name === track.compName\n      );\n\n      if (track.steps[0].change.initial) {\n        compState.scale[sComp.scale] = sView.scale(sComp.scale);\n      }\n\n      compState.encode = sComp ? copy(sComp.encode || {}) : {};\n      const axisGDatumInitial = sComp\n        ? findComp(sView.scenegraph().root, track.compName, \"axis\")[0].items[0]\n        : undefined;\n      compState.encode.axis = axisGDatumInitial\n        ? {\n          update: {\n            x: { value: axisGDatumInitial.x },\n            y: { value: axisGDatumInitial.y }\n          }\n        }\n        : {};\n    } else if (track.compType === \"legend\") {\n      // for axis comp\n\n      const sComp = sComps.find(\n        c => c.compType === \"legend\" && c.encode.legend.name === track.compName\n      );\n      compState.legendType = undefined;\n      if (track.steps[0].change.initial) {\n        compState.legendType = track.steps[0].change.initial.type;\n        [\n          \"fill\",\n          \"opacity\",\n          \"shape\",\n          \"size\",\n          \"stroke\",\n          \"strokeDash\",\n          \"strokeWidth\"\n        ].forEach(channel => {\n          const scName = track.steps[0].change.initial[channel];\n          if (scName) {\n            compState.scale[scName] = sView.scale(scName);\n          }\n        });\n      }\n\n      compState.encode = sComp ? copy(sComp.encode || {}) : {};\n    } else if (track.compType === \"view\") {\n      const iRootDatum = sView._runtime.data.root.values.value[0];\n      const { initial } = track.steps[0].change;\n      compState.encode = {\n        svg: {\n          x: { value: initial.x + initial.padding },\n          y: { value: initial.y + initial.padding },\n          width: { value: initial.viewWidth + initial.padding * 2 },\n          height: { value: initial.viewHeight + initial.padding * 2 }\n        },\n        root: {\n          width: { value: initial.width },\n          height: { value: initial.height },\n          fill: { value: iRootDatum.fill },\n          stroke: { value: iRootDatum.stroke }\n        }\n      };\n    }\n    initialState[track.name] = compState;\n    return initialState;\n  }, initialState);\n}\n\nfunction updateSpec(lastState, lastStep, eSpec) {\n  const updatedSpec = copy(lastState.spec);\n  if (lastStep.compType === \"mark\") {\n    const lastMarkComp = lastStep.change.final;\n    // If the markComp is facetted, its parent mark should be updated.\n    const compName = computeHasFacet(lastMarkComp)\n      ? lastMarkComp.parent.name\n      : lastStep.compName;\n    if (!lastMarkComp && compName && lastStep.change.data) {\n      // Remove the mark\n      const old = updatedSpec.marks.findIndex(mark => mark.name === compName);\n      updatedSpec.marks.splice(old, 1);\n    } else {\n      const old = findMark(updatedSpec.marks, compName);\n      if (!old) {\n        updatedSpec.marks.push(findMark(eSpec.marks, compName));\n      } else {\n        const dataName = computeHasFacet(lastMarkComp)\n          ? lastMarkComp.parent.from.facet.data\n          : lastMarkComp.from.data;\n        if (lastStep.change.data) {\n          // update data source\n          const old = updatedSpec.data.findIndex(\n            data => data.name === dataName\n          );\n          if (old >= 0) {\n            updatedSpec.data.splice(old, 1, copy(findData(eSpec, dataName)));\n          } else {\n            const newI = eSpec.data.findIndex(data => data.name === dataName);\n            updatedSpec.data.splice(newI, 0, copy(findData(eSpec, dataName)));\n          }\n        }\n        old.encode.update = lastState[lastStep.trackName].encode.update;\n      }\n    }\n  } else if (lastStep.compType === \"axis\") {\n    // console.log(lastStep.compName);\n    const old = updatedSpec.axes.findIndex(\n      axis =>\n        axis.encode &&\n        axis.encode.axis &&\n        axis.encode.axis.name === lastStep.compName\n    );\n    if (old >= 0) {\n      updatedSpec.axes.splice(old, 1);\n    }\n    let newAxis;\n    if (\n      (newAxis = eSpec.axes.find(\n        axis =>\n          axis.encode &&\n          axis.encode.axis &&\n          axis.encode.axis.name === lastStep.compName\n      ))\n    ) {\n      updatedSpec.axes.push(newAxis);\n    }\n  } else if (lastStep.compType === \"legend\") {\n    const old = updatedSpec.legends\n      ? updatedSpec.legends.findIndex(\n        legend =>\n          legend.encode &&\n            legend.encode.legend &&\n            legend.encode.legend.name === lastStep.compName\n      )\n      : -1;\n    if (old >= 0) {\n      updatedSpec.legends.splice(old, 1);\n    }\n\n    const newLegend = eSpec.legends\n      ? eSpec.legends.find(\n        legend =>\n          legend.encode &&\n            legend.encode.legend &&\n            legend.encode.legend.name === lastStep.compName\n      )\n      : undefined;\n    if (newLegend) {\n      if (updatedSpec.legends) {\n        updatedSpec.legends.push(newLegend);\n      } else {\n        updatedSpec.legends = [newLegend];\n      }\n    }\n  }\n  return updatedSpec;\n}","// https://github.com/vega/vega/blob/master/packages/vega-scenegraph/src/util/text.js\nfunction textOffset(item) {\n  // perform our own font baseline calculation\n  // why? not all browsers support SVG 1.1 'alignment-baseline' :(\n  const { baseline } = item;\n  const h = fontSize(item);\n  switch (baseline) {\n  case \"top\":\n    return 0.79 * h;\n  case \"middle\":\n    return 0.3 * h;\n  case \"bottom\":\n    return -0.21 * h;\n  case \"line-top\":\n    return 0.29 * h + 0.5 * lineHeight(item);\n  case \"line-bottom\":\n    return 0.29 * h - 0.5 * lineHeight(item);\n  default:\n    return 0;\n  }\n}\n\nfunction fontSize(item) {\n  return item.fontSize != null ? +item.fontSize || 0 : 11;\n}\n\nfunction lineHeight(item) {\n  return item.lineHeight != null ? item.lineHeight : fontSize(item) + 2;\n}\n\nfunction getStyle(attr) {\n  switch (attr) {\n  case \"font\":\n    return \"font-family\";\n  case \"fontSize\":\n    return \"font-size\";\n  case \"fontStyle\":\n    return \"font-style\";\n  case \"fontVariant\":\n    return \"font-variant\";\n  case \"fontWeight\":\n    return \"font-weight\";\n  case \"strokeWidth\":\n    return \"stroke-width\";\n  }\n  return attr;\n}\n\nfunction setTextAnchor(d3Selection, fn) {\n  const textAnchor = {\n    left: \"start\",\n    center: \"middle\",\n    right: \"end\"\n  };\n  d3Selection.attr(\"text-anchor\", d => textAnchor[fn(d)]);\n}\n\nfunction transformItem(item) {\n  return `translate(${item.x || 0}, ${item.y || 0})${\n    item.angle ? ` rotate(${item.angle})` : \"\"\n  }`;\n}\n\nexport { textOffset, getStyle, setTextAnchor, transformItem };\n","import * as d3 from \"d3\";\n// Modify d3-interpolate-path (https://github.com/pbeshai/d3-interpolate-path) package by **.\n\n/**\n * List of params for each command type in a path `d` attribute\n */\nconst typeMap = {\n  M: [\"x\", \"y\"],\n  L: [\"x\", \"y\"],\n  H: [\"x\"],\n  V: [\"y\"],\n  C: [\"x1\", \"y1\", \"x2\", \"y2\", \"x\", \"y\"],\n  S: [\"x2\", \"y2\", \"x\", \"y\"],\n  Q: [\"x1\", \"y1\", \"x\", \"y\"],\n  T: [\"x\", \"y\"],\n  A: [\"rx\", \"ry\", \"xAxisRotation\", \"largeArcFlag\", \"sweepFlag\", \"x\", \"y\"]\n};\n\n/**\n * Convert to object representation of the command from a string\n *\n * @param {String} commandString Token string from the `d` attribute (e.g., L0,0)\n * @return {Object} An object representing this command.\n */\nfunction commandObject(commandString) {\n  // convert all spaces to commas\n  commandString = commandString.trim().replace(/ /g, \",\");\n\n  const type = commandString[0];\n  const args = commandString.substring(1).split(\",\");\n  return typeMap[type.toUpperCase()].reduce(\n    (obj, param, i) => {\n      // parse X as float since we need it to do distance checks for extending points\n      obj[param] = [\"x\", \"y\"].indexOf(param) >= 0 ? parseFloat(args[i]) : args[i];\n      return obj;\n    },\n    { type }\n  );\n}\n\n/**\n * Converts a command object to a string to be used in a `d` attribute\n * @param {Object} command A command object\n * @return {String} The string for the `d` attribute\n */\nfunction commandToString(command) {\n  const { type } = command;\n  const params = typeMap[type.toUpperCase()];\n  return `${type}${params.map(p => command[p]).join(\",\")}`;\n}\n\n/**\n * Converts command A to have the same type as command B.\n *\n * e.g., L0,5 -> C0,5,0,5,0,5\n *\n * Uses these rules:\n * x1 <- x\n * x2 <- x\n * y1 <- y\n * y2 <- y\n * rx <- 0\n * ry <- 0\n * xAxisRotation <- read from B\n * largeArcFlag <- read from B\n * sweepflag <- read from B\n *\n * @param {Object} aCommand Command object from path `d` attribute\n * @param {Object} bCommand Command object from path `d` attribute to match against\n * @return {Object} aCommand converted to type of bCommand\n */\nfunction convertToSameType(aCommand, bCommand) {\n  const conversionMap = {\n    x1: \"x\",\n    y1: \"y\",\n    x2: \"x\",\n    y2: \"y\"\n  };\n\n  const readFromBKeys = [\"xAxisRotation\", \"largeArcFlag\", \"sweepFlag\"];\n\n  // convert (but ignore M types)\n  if (aCommand.type !== bCommand.type && bCommand.type.toUpperCase() !== \"M\") {\n    const aConverted = {};\n    Object.keys(bCommand).forEach(bKey => {\n      const bValue = bCommand[bKey];\n      // first read from the A command\n      let aValue = aCommand[bKey];\n\n      // if it is one of these values, read from B no matter what\n      if (aValue === undefined) {\n        if (readFromBKeys.includes(bKey)) {\n          aValue = bValue;\n        } else {\n          // if it wasn't in the A command, see if an equivalent was\n          if (aValue === undefined && conversionMap[bKey]) {\n            aValue = aCommand[conversionMap[bKey]];\n          }\n\n          // if it doesn't have a converted value, use 0\n          if (aValue === undefined) {\n            aValue = 0;\n          }\n        }\n      }\n\n      aConverted[bKey] = aValue;\n    });\n\n    // update the type to match B\n    aConverted.type = bCommand.type;\n    aCommand = aConverted;\n  }\n\n  return aCommand;\n}\n\n/**\n * Extends an array of commands to the length of the second array\n * inserting points at the spot that is closest by X value. Ensures\n * all the points of commandsToExtend are in the extended array and that\n * only numPointsToExtend points are added.\n *\n * @param {Object[]} commandsToExtend The commands array to extend\n * @param {Object[]} referenceCommands The commands array to match\n * @return {Object[]} The extended commands1 array\n */\nfunction extend(commandsToExtend, referenceCommands, numPointsToExtend) {\n  // map each command in B to a command in A by counting how many times ideally\n  // a command in A was in the initial path (see https://github.com/pbeshai/d3-interpolate-path/issues/8)\n  let initialCommandIndex;\n  if (commandsToExtend.length > 1 && commandsToExtend[0].type === \"M\") {\n    initialCommandIndex = 1;\n  } else {\n    initialCommandIndex = 0;\n  }\n\n  const counts = referenceCommands.reduce((counts, refCommand, i) => {\n    // skip first M\n    if (i === 0 && refCommand.type === \"M\") {\n      counts[0] = 1;\n      return counts;\n    }\n\n    let minDistance = Math.abs(\n      commandsToExtend[initialCommandIndex].x - refCommand.x\n    );\n    let minCommand = initialCommandIndex;\n\n    // find the closest point by X position in A\n    for (let j = initialCommandIndex + 1; j < commandsToExtend.length; j++) {\n      const distance = Math.abs(commandsToExtend[j].x - refCommand.x);\n      if (distance < minDistance) {\n        minDistance = distance;\n        minCommand = j;\n        // since we assume sorted by X, once we find a value farther, we can return the min.\n      } else {\n        break;\n      }\n    }\n\n    counts[minCommand] = (counts[minCommand] || 0) + 1;\n    return counts;\n  }, {});\n\n  // now extend the array adding in at the appropriate place as needed\n  const extended = [];\n  let numExtended = 0;\n  for (let i = 0; i < commandsToExtend.length; i++) {\n    // add in the initial point for this A command\n    extended.push(commandsToExtend[i]);\n\n    for (let j = 1; j < counts[i] && numExtended < numPointsToExtend; j++) {\n      const commandToAdd = Object.assign({}, commandsToExtend[i]);\n      // don't allow multiple Ms\n      if (commandToAdd.type === \"M\") {\n        commandToAdd.type = \"L\";\n      } else {\n        // try to set control points to x and y\n        if (commandToAdd.x1 !== undefined) {\n          commandToAdd.x1 = commandToAdd.x;\n          commandToAdd.y1 = commandToAdd.y;\n        }\n\n        if (commandToAdd.x2 !== undefined) {\n          commandToAdd.x2 = commandToAdd.x;\n          commandToAdd.y2 = commandToAdd.y;\n        }\n      }\n      extended.push(commandToAdd);\n      numExtended += 1;\n    }\n  }\n\n  return extended;\n}\n\n/**\n * Extends an array of commands to the length of the second array\n * inserting points at the spot that is closest by X value. Ensures\n * all the points of commandsToExtend are in the extended array and that\n * only numPointsToExtend points are added.\n *\n * @param {Object[]} commandsToExtend The commands array to extend\n * @param {Object[]} referenceCommands The commands array to match\n * @return {Object[]} The extended commands1 array\n */\nfunction extend2(commandsToExtend, referenceCommands, numPointsToExtend, alongTo=\"x\") {\n  // map each command in B to a command in A by counting how many times ideally\n  // a command in A was in the initial path (see https://github.com/pbeshai/d3-interpolate-path/issues/8)\n  let initialCommandIndex;\n  if (commandsToExtend.length > 1 && commandsToExtend[0].type === \"M\") {\n    initialCommandIndex = 1;\n  } else {\n    initialCommandIndex = 0;\n  }\n  let [m, subM] = alongTo === \"x\" ? [\"x\", \"y\"] : [\"y\", \"x\"];\n\n\n  const counts = referenceCommands.reduce((counts, refCommand, i) => {\n    // skip first M\n    if (i === 0 && refCommand.type === \"M\") {\n      counts[0] = 1;\n      return counts;\n    }\n\n    let minDistance = Math.abs(\n      commandsToExtend[initialCommandIndex][m] - refCommand[m]\n    );\n    let subMinDistance = Math.abs(\n      commandsToExtend[initialCommandIndex][subM] - refCommand[subM]\n    );\n    let minCommand = initialCommandIndex;\n\n    // find the closest point by X position in A\n    for (let j = initialCommandIndex + 1; j < commandsToExtend.length; j++) {\n      const distance = Math.abs(commandsToExtend[j][m] - refCommand[m]);\n      const subDistance = Math.abs(commandsToExtend[j][subM] - refCommand[subM]);\n      if (distance < minDistance) {\n        minDistance = distance;\n        minCommand = j;\n        subMinDistance = subDistance;\n        // since we assume sorted by X, once we find a value farther, we can return the min.\n      } else if (distance === minDistance) {\n        if (subDistance < subMinDistance) {\n          minCommand = j;\n          subMinDistance = subDistance;\n        }\n      } else {\n        break;\n      }\n    }\n\n    counts[minCommand] = (counts[minCommand] || 0) + 1;\n    return counts;\n  }, {});\n\n  // now extend the array adding in at the appropriate place as needed\n  const extended = [];\n  let numExtended = 0;\n  for (let i = 0; i < commandsToExtend.length; i++) {\n    // add in the initial point for this A command\n    extended.push(commandsToExtend[i]);\n\n    for (let j = 1; j < counts[i] && numExtended < numPointsToExtend; j++) {\n      const commandToAdd = Object.assign({}, commandsToExtend[i]);\n      // don't allow multiple Ms\n      if (commandToAdd.type === \"M\") {\n        commandToAdd.type = \"L\";\n      } else {\n        // try to set control points to x and y\n        if (commandToAdd.x1 !== undefined) {\n          commandToAdd.x1 = commandToAdd.x;\n          commandToAdd.y1 = commandToAdd.y;\n        }\n\n        if (commandToAdd.x2 !== undefined) {\n          commandToAdd.x2 = commandToAdd.x;\n          commandToAdd.y2 = commandToAdd.y;\n        }\n      }\n      extended.push(commandToAdd);\n      numExtended += 1;\n    }\n  }\n\n  return extended;\n}\n\n/**\n * Interpolate from A to B by extending A and B during interpolation to have\n * the same number of points. This allows for a smooth transition when they\n * have a different number of points.\n *\n * Ignores the `Z` character in paths unless both A and B end with it.\n *\n * @param {String} a The `d` attribute for a path\n * @param {String} b The `d` attribute for a path\n */\nfunction interpolatePath(a, b, alongTo = \"x\") {\n  // remove Z, remove spaces after letters as seen in IE\n  const aNormalized =\n    a == null ? \"\" : a.replace(/[Z]/gi, \"\").replace(/([MLCSTQAHV])\\s*/gi, \"$1\");\n  const bNormalized =\n    b == null ? \"\" : b.replace(/[Z]/gi, \"\").replace(/([MLCSTQAHV])\\s*/gi, \"$1\");\n  const aPoints =\n    aNormalized === \"\" ? [] : aNormalized.split(/(?=[MLCSTQAHV])/gi);\n  const bPoints =\n    bNormalized === \"\" ? [] : bNormalized.split(/(?=[MLCSTQAHV])/gi);\n\n  // if both are empty, interpolation is always the empty string.\n  if (!aPoints.length && !bPoints.length) {\n    return function nullInterpolator() {\n      return \"\";\n    };\n  }\n\n  // if A is empty, treat it as if it used to contain just the first point\n  // of B. This makes it so the line extends out of from that first point.\n  if (!aPoints.length) {\n    aPoints.push(bPoints[0]);\n\n    // otherwise if B is empty, treat it as if it contains the first point\n    // of A. This makes it so the line retracts into the first point.\n  } else if (!bPoints.length) {\n    bPoints.push(aPoints[0]);\n  }\n\n  // convert to command objects so we can match types\n  let aCommands = aPoints.map(commandObject);\n  let bCommands = bPoints.map(commandObject);\n\n  // extend to match equal size\n  const numPointsToExtend = Math.abs(bPoints.length - aPoints.length);\n\n  if (numPointsToExtend !== 0) {\n    // B has more points than A, so add points to A before interpolating\n    if (bCommands.length > aCommands.length) {\n      aCommands = extend2(aCommands, bCommands, numPointsToExtend, alongTo);\n\n      // else if A has more points than B, add more points to B\n    } else if (bCommands.length < aCommands.length) {\n      bCommands = extend2(bCommands, aCommands, numPointsToExtend, alongTo);\n    }\n  }\n\n  // commands have same length now.\n  // convert A to the same type of B\n  aCommands = aCommands.map((aCommand, i) =>\n    convertToSameType(aCommand, bCommands[i])\n  );\n\n  let aProcessed = aCommands.map(commandToString).join(\"\");\n  let bProcessed = bCommands.map(commandToString).join(\"\");\n\n  // if both A and B end with Z add it back in\n  if (\n    (a == null || a[a.length - 1] === \"Z\") &&\n    (b == null || b[b.length - 1] === \"Z\")\n  ) {\n    aProcessed += \"Z\";\n    bProcessed += \"Z\";\n  }\n\n  const stringInterpolator = d3.interpolateString(aProcessed, bProcessed);\n\n  return function pathInterpolator(t) {\n    // at 1 return the final value without the extensions used during interpolation\n    if (t === 1) {\n      return b == null ? \"\" : b;\n    }\n\n    return stringInterpolator(t);\n  };\n}\n\n// a -> a + reverse(a) so that the line is closed.\nfunction lineToArea(a) {\n  const aNormalized =\n    a == null ? \"\" : a.replace(/[Z]/gi, \"\").replace(/([MLCSTQAHV])\\s*/gi, \"$1\");\n  const aPoints =\n    aNormalized === \"\" ? [] : aNormalized.split(/(?=[MLCSTQAHV])/gi);\n\n  if (aPoints.length <= 0) {\n    return \"\";\n  }\n\n  // convert to command objects so we can match types\n  const aCommands = aPoints.map(commandObject);\n  const reversed = aPoints.map(commandObject).reverse();\n  if (reversed[reversed.length - 1].type == \"M\") {\n    reversed[reversed.length - 1].type = reversed[reversed.length - 2].type;\n  }\n  return `${aCommands\n    .concat(reversed)\n    .map(commandToString)\n    .join(\"\")}Z`;\n}\n/**\n * Interpolate from A to B by extending A and B during interpolation to have\n * the same number of points. This allows for a smooth transition when they\n * have a different number of points.\n *\n * Ignores the `Z` character in paths unless both A and B end with it.\n *\n * @param {String} a The `d` attribute for a path\n * @param {String} b The `d` attribute for a path\n */\nfunction interpolatePath2(a, b, alongTo = \"x\") {\n  // remove Z, remove spaces after letters as seen in IE\n  const aNormalized =\n    a == null ? \"\" : a.replace(/[Z]/gi, \"\").replace(/([MLCSTQAHV])\\s*/gi, \"$1\");\n  const bNormalized =\n    b == null ? \"\" : b.replace(/[Z]/gi, \"\").replace(/([MLCSTQAHV])\\s*/gi, \"$1\");\n  const aPoints =\n    aNormalized === \"\" ? [] : aNormalized.split(/(?=[MLCSTQAHV])/gi);\n  const bPoints =\n    bNormalized === \"\" ? [] : bNormalized.split(/(?=[MLCSTQAHV])/gi);\n\n  // if both are empty, interpolation is always the empty string.\n  if (!aPoints.length && !bPoints.length) {\n    return function nullInterpolator() {\n      return \"\";\n    };\n  }\n\n  // if A is empty, treat it as if it used to contain just the first point\n  // of B. This makes it so the line extends out of from that first point.\n  if (!aPoints.length) {\n    aPoints.push(bPoints[0]);\n\n    // otherwise if B is empty, treat it as if it contains the first point\n    // of A. This makes it so the line retracts into the first point.\n  } else if (!bPoints.length) {\n    bPoints.push(aPoints[0]);\n  }\n\n  // convert to command objects so we can match types\n  const aCommands = aPoints.map(commandObject);\n  const bCommands = bPoints.map(commandObject);\n  let hasZ = false;\n  if (\n    (a == null || a[a.length - 1] === \"Z\") &&\n    (b == null || b[b.length - 1] === \"Z\")\n  ) {\n    hasZ = true;\n  }\n\n  // get tail\n  // get head\n  // concat tail + body + head\n  const aExtent = d3.extent(aCommands, c => c[alongTo]);\n  const bExtent = d3.extent(bCommands, c => c[alongTo]);\n  if (alongTo === \"x\") {\n    const aHeadI = aCommands.findIndex(c => c[alongTo] === aExtent[1]);\n    const bHeadI = bCommands.findIndex(c => c[alongTo] === bExtent[1]);\n\n    const aTop = aCommands.slice(0, aHeadI + 1);\n    const bTop = bCommands.slice(0, bHeadI + 1);\n    const aBottom = aCommands.slice(aHeadI + 1).reverse();\n    const bBottom = bCommands.slice(bHeadI + 1).reverse();\n    const hasBottom = aBottom.length > 0 && bBottom.length > 0;\n\n    return t => {\n      if (t === 1) {\n        return b === null ? \"\" : b;\n      }\n      return (\n        interpolateOutline(aTop, bTop, aExtent, bExtent)(t) +\n        (hasBottom\n          ? interpolateOutline(aBottom, bBottom, aExtent, bExtent, true, true)(t)\n          : \"\") +\n        (hasZ ? \"Z\" : \"\")\n      );\n    };\n  } else {\n    const aHeadI = aCommands.findIndex(c => c[alongTo] === aExtent[0]);\n    const bHeadI = bCommands.findIndex(c => c[alongTo] === bExtent[0]);\n\n    const aTop = aCommands.slice(0, aHeadI + 1).reverse();\n    const bTop = bCommands.slice(0, bHeadI + 1).reverse();\n    const aBottom = aCommands.slice(aHeadI + 1);\n    const bBottom = bCommands.slice(bHeadI + 1);\n    const hasBottom = aBottom.length > 0 && bBottom.length > 0;\n\n    return t => {\n      if (t === 1) {\n        return b === null ? \"\" : b;\n      }\n      return (\n        interpolateOutline(aTop, bTop, aExtent, bExtent, true)(t) +\n        (hasBottom\n          ? interpolateOutline(aBottom, bBottom, aExtent, bExtent, false, true)(t)\n          : \"\") +\n        (hasZ ? \"Z\" : \"\")\n      );\n    };\n  }\n\n  function interpolateOutline(\n    aCommands,\n    bCommands,\n    aExtent,\n    bExtent,\n    reverse,\n    isBottom = false\n  ) {\n    let head;\n    let tail;\n    let body;\n    if (aExtent[1] < bExtent[0] || aExtent[0] > bExtent[1]) {\n      // just interpolate\n      body = getBody(aCommands, bCommands, reverse);\n    } else {\n      if (aExtent[1] > bExtent[1]) {\n        // shrink head\n        const i = aCommands.findIndex(c => c[alongTo] > bExtent[1]);\n        head = getHead(aCommands.slice(i - 1), reverse, true, isBottom);\n      } else if (aExtent[1] < bExtent[1]) {\n        // extend head\n        const i = bCommands.findIndex(c => c[alongTo] > aExtent[1]);\n        head = getHead(bCommands.slice(i - 1), reverse, false, isBottom);\n      }\n\n      if (aExtent[0] < bExtent[0]) {\n        // shrink tail\n        const i = aCommands.findIndex(c => c[alongTo] >= bExtent[0]);\n        tail = getTail(aCommands.slice(0, i + 1), reverse, true, isBottom);\n      } else if (aExtent[0] > bExtent[0]) {\n        // extend tail\n        const i = bCommands.findIndex(c => c[alongTo] >= aExtent[0]);\n        tail = getTail(bCommands.slice(0, i + 1), reverse, false, isBottom);\n        // tail = getTail(bCommands.filter(c => c[alongTo] < aExtent[0]), false);\n      }\n\n      const bodyMin = Math.max(aExtent[0], bExtent[0]);\n      const bodyMax = Math.min(aExtent[1], bExtent[1]);\n      // get body\n      body = getBody(\n        aCommands.filter(c => c[alongTo] >= bodyMin && c[alongTo] <= bodyMax  ),\n        bCommands.filter(c => c[alongTo] >= bodyMin && c[alongTo] <= bodyMax  ),\n        reverse,\n        !isBottom && ((reverse && !head) || (!reverse && !tail))\n      );\n    }\n    if (reverse) {\n      return t => {\n        return (head ? head(t) : \"\") + body(t) + (tail ? tail(t) : \"\");\n      };\n    } else {\n      return t => {\n        return (tail ? tail(t) : \"\") + body(t) + (head ? head(t) : \"\");\n      };\n    }\n\n  }\n\n  function getBody(aCommands, bCommands, reverse = false, isTail = false) {\n    // extend to match equal size\n    const numPointsToExtend = Math.abs(bCommands.length - aCommands.length);\n    if (aCommands.length <= 1 && bCommands.length <= 1) {\n      return t => \"\";\n    }\n    if (numPointsToExtend !== 0) {\n      // B has more points than A, so add points to A before interpolating\n      if (bCommands.length > aCommands.length) {\n        aCommands = extend(aCommands, bCommands, numPointsToExtend);\n\n        // else if A has more points than B, add more points to B\n      } else if (bCommands.length < aCommands.length) {\n        bCommands = extend(bCommands, aCommands, numPointsToExtend);\n      }\n    }\n\n    // commands have same length now.\n    // convert A to the same type of B\n    aCommands = aCommands.map((aCommand, i) =>\n      convertToSameType(aCommand, bCommands[i])\n    );\n    aCommands = (reverse ? aCommands.reverse() : aCommands);\n    bCommands = (reverse ? bCommands.reverse() : bCommands);\n    if (isTail) {\n      aCommands[0] = Object.assign({}, aCommands[0], { type: \"M\" });\n      bCommands[0] = Object.assign({}, bCommands[0], { type: \"M\" });\n    }\n    const aProcessed = aCommands\n      .map(commandToString)\n      .join(\"\");\n    const bProcessed = bCommands\n      .map(commandToString)\n      .join(\"\");\n\n    const stringInterpolator = d3.interpolateString(aProcessed, bProcessed);\n\n    return function pathInterpolator(t) {\n      // at 1 return the final value without the extensions used during interpolation\n      if (t === 1) {\n        return bProcessed == null ? \"\" : bProcessed;\n      }\n\n      return stringInterpolator(t);\n    };\n  }\n\n  function getHead(commands, reverse = false, isShrink = false, isBottom=false) {\n    const d = commands.map(commandToString).join(\"\");\n    const L = commands.length;\n    const phases = [];\n    const debug = [];\n    for (let i = 1; i <= L - 1; i++) {\n      let aCommands = commands.slice(0, i).concat([commands[i - 1]]);\n      let bCommands = commands.slice(0, i + 1);\n      aCommands = (reverse ? aCommands.reverse() : aCommands);\n      bCommands = (reverse ? bCommands.reverse() : bCommands);\n      const aProcessed = aCommands\n        .map(commandToString)\n        .join(\"\");\n      const bProcessed = bCommands\n        .map(commandToString)\n        .join(\"\");\n      if (reverse && !isBottom) {\n        aCommands[0] = Object.assign({}, aCommands[0], { type: \"M\" });\n        bCommands[0] = Object.assign({}, bCommands[0], { type: \"M\" });\n      }\n      debug.push({ aProcessed, bProcessed });\n      phases.push(function(t) {\n        return d3.interpolateString(aProcessed, bProcessed)(t);\n      });\n    }\n\n    return function(t) {\n      if (isShrink) {\n        t = 1 - t;\n      }\n      if (t === 1) {\n        return d == null ? \"\" : d;\n      }\n      const phase = Math.floor(t * (L - 1));\n\n      return phases[phase](t * (L - 1) - phase);\n    };\n  }\n\n  function getTail(commands, reverse = false, isShrink = false, isBottom=false) {\n    const d = commands.map(commandToString).join(\"\");\n    const L = commands.length;\n    const phases = [];\n    for (let i = 1; i < L; i++) {\n      let aCommands = [commands[L - i]].concat(commands.slice(L - i, L));\n      let bCommands = commands.slice(L - i - 1, L);\n\n      aCommands = (reverse ? aCommands.reverse() : aCommands);\n      bCommands = (reverse ? bCommands.reverse() : bCommands);\n\n      if (!reverse && !isBottom) {\n        aCommands[0] = Object.assign({}, aCommands[0], { type: \"M\" });\n        bCommands[0] = Object.assign({}, bCommands[0], { type: \"M\" });\n      }\n\n      const aProcessed = aCommands\n        .map(commandToString)\n        .join(\"\");\n      const bProcessed = bCommands\n        .map(commandToString)\n        .join(\"\");\n\n      phases.push(function(t) {\n        return d3.interpolateString(aProcessed, bProcessed)(t);\n      });\n    }\n    return function(t) {\n      if (isShrink) {\n        t = 1 - t;\n      }\n      if (t === 1) {\n        return d == null ? \"\" : d;\n      }\n      const phase = Math.floor(t * (L - 1));\n      return phases[phase](t * (L - 1) - phase);\n    };\n  }\n}\n\nexport { interpolatePath, interpolatePath2, lineToArea };\n","/* eslint-disable camelcase */\nimport * as d3 from \"d3\";\nimport { interpolatePath, interpolatePath2 } from \"./interpolatePathYH\";\nimport {get} from \"../../util/util\";\n\n\n\n\nfunction rectInterpolator(scales, encodes, signals, d, oldD, getRect) {\n  let path_i;\n  let path_f;\n  const d_i = d.initial || oldD || d3.select(this).datum();\n  const d_f = d.final || d;\n  const encode_i = encodes.initial || encodes;\n  const encode_f = encodes.final || encodes;\n  const scale_i = {\n    primary: scales.initial || scales,\n    secondary: scales.final || scales\n  };\n  const scale_f = {\n    primary: scales.final || scales,\n    secondary: scales.initial || scales\n  };\n  const signal_i = signals.initial || signals;\n  const signal_f = signals.final || signals;\n\n  path_i = getRect(d_i, scale_i, encode_i, signal_i).path;\n  path_f = getRect(d_f, scale_f, encode_f, signal_f).path;\n\n  return interpolatePath(path_i, path_f);\n}\nfunction symbolInterpolator(scales, encodes, signals, d, oldD, getShape) {\n  let shape_i;\n  let shape_f;\n  let shape_i_diminished;\n  let shape_f_diminished;\n  const d_i = d.initial || oldD || d3.select(this).datum();\n  const d_f = d.final || d;\n  const encode_i = encodes.initial || encodes;\n  const encode_f = encodes.final || encodes;\n  const scale_i = scales.initial || scales;\n  const scale_f = scales.final || scales;\n  const signal_i = signals.initial || signals;\n  const signal_f = signals.final || signals;\n  let isMorph = false;\n\n  shape_i = getShape(d_i, scale_i, encode_i, signal_i);\n  shape_f = getShape(d_f, scale_f, encode_f, signal_f);\n  if (shape_i.meta.shape !== shape_f.meta.shape) {\n    isMorph = true;\n    shape_i_diminished = getShape(d_i, scale_i, encode_i, signal_i, true);\n    shape_f_diminished = getShape(d_f, scale_f, encode_f, signal_f, true);\n  }\n\n  if (isMorph) {\n    return t => {\n      if (t < 0.5) {\n        return interpolatePath(shape_i.path, shape_i_diminished.path)(t * 2);\n      }\n      return interpolatePath(\n        shape_f_diminished.path,\n        shape_f.path\n      )((t - 0.5) * 2);\n    };\n  }\n  return interpolatePath(shape_i.path, shape_f.path);\n}\n\nfunction areaLineInterpolatorWithScales(\n  scales,\n  encodes,\n  marktypes,\n  d,\n  oldD,\n  signals,\n  getPath,\n  interpolateStyle,\n  alongTos\n) {\n  const encode_i = encodes.initial || encodes;\n  const encode_f = encodes.final || encodes;\n  const marktype_i = marktypes.initial || marktypes;\n  // const marktype_i = \"area\";\n  const marktype_f = marktypes.final || marktypes;\n  const scale_i = scales.initial || scales;\n  const scale_f = scales.final || scales;\n  const signal_i = signals.initial || signals;\n  const signal_f = signals.final || signals;\n  const d_i = d.initial || oldD;\n  const d_f = d.final || d;\n  const alongTo_i = alongTos.initial || alongTos;\n  const alongTo_f = alongTos.final || alongTos;\n  const paths_11 = getPath(areaLineDToData(d_i), scale_i, encode_i, signal_i, marktype_i, alongTo_i);\n  const paths_12 = getPath(areaLineDToData(d_i), scale_f, encode_i, signal_i, marktype_i, alongTo_i);\n  const paths_21 = getPath(areaLineDToData(d_f), scale_i, encode_f, signal_f, marktype_f, alongTo_f);\n  const paths_22 = getPath(areaLineDToData(d_f), scale_f, encode_f, signal_f, marktype_f, alongTo_f);\n\n  if (\n    isValidPath(paths_11) &&\n    isValidPath(paths_12) &&\n    isValidPath(paths_21) &&\n    isValidPath(paths_22)\n  ) {\n    const interpolator_scale1 = interpolatePath(paths_11, paths_12, alongTo_i);\n    const interpolator_scale2 = interpolatePath(paths_21, paths_22, alongTo_f);\n    const interpolator_data =\n      interpolateStyle === \"update\" ? interpolatePath2 : interpolatePath;\n      // interpolateStyle === \"update\" ? interpolatePath3 : interpolatePath;\n    return t => {\n      return interpolator_data(\n        interpolator_scale1(t),\n        interpolator_scale2(t),\n        alongTo_i\n      )(t);\n    };\n  }\n  const interpolator_data =\n    interpolateStyle === \"update\" ? interpolatePath2 : interpolatePath;\n    // interpolateStyle === \"update\" ? interpolatePath3 : interpolatePath;\n\n  return interpolator_data(paths_11, paths_22, alongTo_i);\n}\n\nfunction areaLineInterpolator(\n  scales,\n  encodes,\n  marktypes,\n  d,\n  oldD,\n  signals,\n  getPath,\n  interpolateStyle\n) {\n  const marktype = typeof marktypes === \"string\" ? marktypes : undefined;\n\n  if (marktype === \"line\") {\n    const dataToPath = (data, scale, encode, signal) => {\n      return getPath(data, scale, encode, signal, \"line\");\n    };\n    const computId = (encode, d) => {\n      return !d\n        ? undefined\n        : [d.datum[encode.x.field], d.datum[encode.y.field]].join(\",\");\n    };\n    return computeLineInterpolator(\n      areaLineDToData(d.initial || oldD),\n      areaLineDToData(d.final || d),\n      scales,\n      encodes,\n      signals,\n      computId,\n      dataToPath\n    );\n    // if (interpolateStyle === \"update\") {\n    //   const dataToPath = (data, scale, encode, signal) => {\n    //     return getPath(data, scale, encode, signal, \"line\");\n    //   };\n    //   const computId = (encode, d) => {\n    //     return !d\n    //       ? undefined\n    //       : [d.datum[encode.x.field], d.datum[encode.y.field]].join(\",\");\n    //   };\n    //   return computeLineInterpolator(\n    //     areaLineDToData(oldD),\n    //     areaLineDToData(d),\n    //     scales,\n    //     encodes,\n    //     signals,\n    //     computId,\n    //     dataToPath\n    //   );\n    // }\n\n    // return areaLineInterpolatorWithScales.bind(this)(\n    //   scales,\n    //   encodes,\n    //   \"line\",\n    //   d,\n    //   oldD,\n    //   signals,\n    //   getPath,\n    //   interpolateStyle\n    // );\n  }\n  if (marktype === \"area\" || marktype === \"trail\") {\n    const alongTos = {\n      initial: get(encodes, \"initial\", \"orient\", \"value\") === \"horizontal\" ? \"y\": \"x\",\n      final: get(encodes, \"final\", \"orient\", \"value\") === \"horizontal\" ? \"y\": \"x\"\n    };\n    return areaLineInterpolatorWithScales.bind(this)(\n      scales,\n      encodes,\n      marktype,\n      d,\n      oldD,\n      signals,\n      getPath,\n      interpolateStyle,\n      alongTos\n    );\n  }\n\n  // when the marktype changes between \"area\" and \"line\", assume the line as area.\n\n  if (marktypes.initial === \"line\" && marktypes.final === \"area\") {\n    let alongTo = get(encodes, \"final\", \"orient\", \"value\") === \"horizontal\" ? \"y\": \"x\";\n    return areaLineInterpolatorWithScales.bind(this)(scales, encodes, \"area\", d, oldD, signals, getPath, interpolateStyle, alongTo);\n  } else { // area -> line\n    let alongTo = get(encodes, \"initial\", \"orient\", \"value\") === \"horizontal\" ? \"y\": \"x\";\n    let linePaths = getPath(\n      areaLineDToData(d.final || d),\n      scales.final || scales,\n      encodes.final || encodes,\n      signals.final || signals,\n      \"line\");\n    let intp = areaLineInterpolatorWithScales.bind(this)(scales, encodes, \"area\", d, oldD, signals, getPath, interpolateStyle, alongTo);\n    return (t) => {\n      return t >= 1 ? linePaths : intp(t);\n    };\n  }\n}\n\nfunction areaLineDToData(d) {\n  if (!d) {\n    return undefined;\n  }\n  return d.mark.marktype !== \"group\" ? d.mark.items : d.items[0].items;\n}\n\n// Interpolate path(dataA, scaleA) -> path(dataB, scaleB)\nfunction computeLineInterpolator(\n  dataA,\n  dataB,\n  scales,\n  encodes,\n  signals,\n  computeId,\n  getPath\n) {\n  const t = Date.now();\n  // 1) calculate two anchors between dataA and dataB\n  const _encodes = encodes.initial && encodes.final ? encodes : {\n    initial: encodes,\n    final: encodes\n  };\n  const computeIdA = d => computeId(_encodes.initial, d);\n  const computeIdB = d => computeId(_encodes.final, d);\n  const La = dataA.length;\n  const Lb = dataB.length;\n  let i = dataB.findIndex(d => computeIdB(d) === computeIdA(dataA[0]));\n  let j = dataB.findIndex(d => computeIdB(d) === computeIdA(dataA[La - 1]));\n  let head;\n  let tail;\n  let body;\n\n  if (i >= 0) {\n    if (j >= 0) {\n      if (j < i) {\n        body = getBody(dataA, dataB, scales, _encodes, signals, getPath);\n      } else {\n        tail = getTail(\n          dataB.slice(0, i + 1),\n          false,\n          scales,\n          _encodes,\n          signals,\n          getPath\n        );\n        body = getBody(\n          dataA,\n          dataB.slice(i, j + 1),\n          scales,\n          _encodes,\n          signals,\n          getPath,\n          false\n        );\n        head = getHead(\n          dataB.slice(j),\n          false,\n          scales,\n          _encodes,\n          signals,\n          getPath\n        );\n      }\n    } else if (\n      (j = dataA.findIndex(d => computeIdA(d) === computeIdB(dataB[Lb - 1]))) >= 0\n    ) {\n      tail = getTail(\n        dataB.slice(0, i + 1),\n        false,\n        scales,\n        _encodes,\n        signals,\n        getPath\n      );\n      body = getBody(\n        dataA.slice(0, j + 1),\n        dataB.slice(i),\n        scales,\n        _encodes,\n        signals,\n        getPath,\n        false\n      );\n      head = getHead(dataA.slice(j), true, scales, _encodes, signals, getPath);\n    } else {\n      body = getBody(dataA, dataB, scales, _encodes, signals, getPath);\n    }\n  } else if (j >= 0) {\n    if (\n      (i = dataA.findIndex(d => computeIdA(d) === computeIdB(dataB[0]))) >= 0\n    ) {\n      tail = getTail(\n        dataA.slice(0, i + 1),\n        true,\n        scales,\n        _encodes,\n        signals,\n        getPath\n      );\n      body = getBody(\n        dataA.slice(i),\n        dataB.slice(0, j + 1),\n        scales,\n        _encodes,\n        signals,\n        getPath,\n        false\n      );\n      head = getHead(dataB.slice(j), false, scales, _encodes, signals, getPath);\n    } else {\n      body = getBody(dataA, dataB, scales, _encodes, signals, getPath);\n    }\n  } else {\n    i = dataA.findIndex(d => computeIdA(d) === computeIdB(dataB[0]));\n    j = dataA.findIndex(d => computeIdA(d) === computeIdB(dataB[Lb - 1]));\n    if (i >= 0 && j >= 0) {\n      tail = getTail(\n        dataA.slice(0, i + 1),\n        true,\n        scales,\n        _encodes,\n        signals,\n        getPath\n      );\n      body = getBody(\n        dataA.slice(i, j + 1),\n        dataB,\n        scales,\n        _encodes,\n        signals,\n        getPath,\n        false\n      );\n      head = getHead(dataA.slice(j), true, scales, _encodes, signals, getPath);\n    } else {\n      body = getBody(dataA, dataB, scales, _encodes, signals, getPath);\n    }\n  }\n  console.log(Date.now() - t);\n  if (head && tail && body) {\n    return t => {\n      if (t === 1) {\n        return getPath(dataB, scales.final, _encodes.final, signals.final);\n      }\n      return tail(t) + body(t) + head(t);\n    };\n  }\n  return t => {\n    if (t === 1) {\n      return getPath(dataB, scales.final, _encodes.final, signals.final);\n    }\n    return body(t);\n  };\n}\n\nfunction getHead(data, isShrink, scales, encodes, signals, getPath) {\n  const L = data.length;\n  if (L <= 1) {\n    return t => \"\";\n  }\n\n  const interpolators = [\"initial\", \"final\"].map(which => {\n    const phases = [];\n    const scale = scales[which];\n    const encode = encodes[which];\n    const signal = signals[which] || signals;\n    for (let i = 0; i <= L - 2; i++) {\n      const fromPath = getPath(\n        data.slice(0, i + 1).concat(data.slice(i, i + 1)),\n        scale,\n        encode,\n        signal\n      ).replace(/^M/g, \"L\");\n      const toPath = getPath(\n        data.slice(0, i + 2),\n        scale,\n        encode,\n        signal\n      ).replace(/^M/g, \"L\");\n      phases.push(function(t) {\n        return d3.interpolateString(fromPath, toPath)(t);\n      });\n    }\n    return function(t) {\n      if (isShrink) {\n        t = 1 - t;\n      }\n      if (t === 1) {\n        return getPath(data, scale, encode, signal);\n      }\n      const phase = Math.floor(t * (L - 1));\n\n      return phases[phase](t * (L - 1) - phase);\n    };\n  });\n\n  return t => {\n    return d3.interpolateString(interpolators[0](t), interpolators[1](t))(t);\n  };\n}\n\nfunction getTail(data, isShrink, scales, encodes, signals, getPath) {\n  const L = data.length;\n  if (L <= 1) {\n    return t => \"\";\n  }\n  const interpolators = [\"initial\", \"final\"].map(which => {\n    const phases = [];\n    const scale = scales[which];\n    const encode = encodes[which];\n    const signal = signals[which] || signals;\n    for (let i = L - 2; i >= 0; i--) {\n      const fromPath = getPath(\n        data.slice(i + 1, i + 2).concat(data.slice(i + 1)),\n        scale,\n        encode,\n        signal\n      ).replace(/Z$/g, \"\");\n      const toPath = getPath(data.slice(i), scale, encode, signal).replace(\n        /Z$/g,\n        \"\"\n      );\n\n      phases.push(function(t) {\n        return d3.interpolateString(fromPath, toPath)(t);\n      });\n    }\n\n    return function(t) {\n      if (isShrink) {\n        t = 1 - t;\n      }\n      if (t === 1) {\n        return getPath(data, scale, encode, signal);\n      }\n      const phase = Math.floor(t * (L - 1));\n\n      return phases[phase](t * (L - 1) - phase);\n    };\n  });\n  return t => {\n    return d3.interpolateString(interpolators[0](t), interpolators[1](t))(t);\n  };\n}\n\nfunction getBody(\n  fromData,\n  toData,\n  scales,\n  encodes,\n  signals,\n  getPath,\n  toBeAssembled\n) {\n  const pathPairs = [\"initial\", \"final\"].map(which => {\n    const scale = scales[which];\n    const encode = encodes[which];\n    const signal = signals[which] || signals;\n    let fromPath = getPath(fromData, scale, encode, signal);\n    let toPath = getPath(toData, scale, encode, signal);\n\n    if (toBeAssembled) {\n      fromPath = fromPath.replace(/^M/g, \"L\").replace(/Z$/g, \"\");\n      toPath = toPath.replace(/^M/g, \"L\").replace(/Z$/g, \"\");\n    }\n    return [fromPath, toPath];\n  });\n\n  if (\n    isValidPath(pathPairs[0][0]) &&\n    isValidPath(pathPairs[0][1]) &&\n    isValidPath(pathPairs[1][0]) &&\n    isValidPath(pathPairs[1][0])\n  ) {\n    const interpolator1 = interpolatePath(pathPairs[0][0], pathPairs[0][1]);\n    const interpolator2 = interpolatePath(pathPairs[1][0], pathPairs[1][1]);\n    return t => {\n      return d3.interpolateString(interpolator1(t), interpolator2(t))(t);\n    };\n  }\n  return d3.interpolateString(pathPairs[0][0], pathPairs[1][1]);\n}\nfunction isValidPath(p) {\n  return p.indexOf(\"NaN\") < 0;\n}\n\nexport {\n  areaLineInterpolatorWithScales,\n  areaLineInterpolator,\n  symbolInterpolator,\n  areaLineDToData,\n  rectInterpolator\n};\n","/* eslint-disable prefer-destructuring */\n/* eslint-disable no-restricted-globals */\n/* eslint-disable no-use-before-define */\n/* eslint-disable camelcase */\nimport * as vega from \"vega\";\nimport * as vegaExpression from \"vega-expression\";\nimport * as d3 from \"d3\";\nimport { propMap, isLinearMarktype } from \"./util\";\nimport { textOffset, getStyle, transformItem } from \"./vega-render-util\";\nimport { copy, copy2, isNumber, get } from \"../util/util\";\nimport {\n  areaLineInterpolator,\n  symbolInterpolator,\n  areaLineDToData,\n  rectInterpolator\n} from \"./mark/interpolateHelper\";\nimport { BR_PROP_DEFAULT } from \"../default\";\n\nexport function fetchAttributes(d3Selection, props, scales, signal, encode, prevData) {\n  props.forEach(prop => {\n    propMap(prop).forEach(p => {\n      if (p.type === \"attrTween\") {\n        if (d3Selection.attrTween) {\n          d3Selection.attrTween(getStyle(p.val), function(d) {\n            const oldD = prevData ? prevData.get(this) : undefined;\n            return getPropVal.bind(this)(p, encode, scales, signal, d, oldD);\n          });\n        } else {\n          const tempP = Object.assign({}, p, { type: \"attr\" });\n          d3Selection.attr(tempP.val, function(d) {\n            const oldD = prevData ? prevData.get(this) : undefined;\n            return getPropVal.bind(this)(\n              tempP,\n              encode,\n              scales,\n              signal,\n              d,\n              oldD\n            );\n          });\n        }\n      } else if (p.type === \"attr\") {\n        d3Selection.attr(getStyle(p.val), function(d) {\n          const oldD = prevData ? prevData.get(this) : undefined;\n          return getPropVal.bind(this)(p, encode, scales, signal, d, oldD);\n        });\n      } else if (p.type === \"text\") {\n        d3Selection.text(function(d) {\n          const oldD = prevData ? prevData.get(this) : undefined;\n          return getPropVal.bind(this)(p, encode, scales, signal, d, oldD);\n        });\n      } else if (p.type === \"style\") {\n        if (p.asTween) {\n          d3Selection.styleTween(getStyle(p.val), function(d) {\n            const oldD = prevData ? prevData.get(this) : undefined;\n            return getPropVal.bind(this)(p, encode, scales, signal, d, oldD);\n          });\n        } else {\n          d3Selection.style(getStyle(p.val), function(d) {\n            const oldD = prevData ? prevData.get(this) : undefined;\n            return getPropVal.bind(this)(p, encode, scales, signal, d, oldD);\n          });\n        }\n      }\n    });\n  });\n}\n\nexport function getPropVal(propInfo, encodes, scales, signals, d, oldD) {\n  const signal = signals.final || signals;\n  const encode = encodes.final || encodes;\n\n  if (propInfo.elmType === \"text\") {\n    if (propInfo.val === \"transform\") {\n      // get transform\n      const trfD = transformD.bind(this)(encode, scales, signal, d, false);\n      const dx = decodeEncode.bind(this)(\"dx\", encode, scales, signal, d);\n      const dy = decodeEncode.bind(this)(\"dy\", encode, scales, signal, d);\n      trfD.x = (trfD.x || 0) + (dx || 0);\n      trfD.y = (trfD.y || 0) + (dy || 0);\n      const baseline = decodeEncode.bind(this)(\n        \"baseline\",\n        encode,\n        scales,\n        signal,\n        d\n      );\n      const fontSize = decodeEncode.bind(this)(\n        \"fontSize\",\n        encode,\n        scales,\n        signal,\n        d\n      );\n      if (oldD && oldD.align !== d.align) {\n        const alignFactor = { right: -0.5, center: 0, left: 0.5 };\n        trfD.x +=\n          this.getBBox().width *\n          (alignFactor[d.align] - alignFactor[oldD.align]);\n      }\n\n      return `${transformItem(trfD)} ${transformItem({\n        y: textOffset(Object.assign({ baseline, fontSize }, d))\n      })}`;\n    }\n    if (propInfo.val === \"text\") {\n      return encode.text\n        ? decodeEncode.bind(this)(\"text\", encode, scales, signal, d)\n        : d.text;\n    }\n  } else if (propInfo.elmType === \"title\") {\n    if (propInfo.val === \"transform\") {\n      // get transform\n      const trfD = transformD.bind(this)(encode, scales, signal, d);\n      // let trfD = transformD.bind(this)(encode, scales, signal, d, false);\n      const dx = decodeEncode.bind(this)(\"dx\", encode, scales, signal, d);\n      const dy = decodeEncode.bind(this)(\"dy\", encode, scales, signal, d);\n      trfD.x = (trfD.x || 0) + (dx || 0);\n      trfD.y = (trfD.y || 0) + (dy || 0);\n      const baseline = decodeEncode.bind(this)(\n        \"baseline\",\n        encode,\n        scales,\n        signal,\n        d\n      );\n      const fontSize = decodeEncode.bind(this)(\n        \"fontSize\",\n        encode,\n        scales,\n        signal,\n        d\n      );\n      return `${transformItem(trfD)} ${transformItem({\n        y: textOffset(Object.assign({ baseline, fontSize }, d))\n      })}`;\n    }\n    if (propInfo.val === \"text\") {\n      return encode.text\n        ? decodeEncode.bind(this)(\"text\", encode, scales, signal, d)\n        : d.text;\n    }\n  } else if (\n    propInfo.elmType === \"tick\" ||\n    propInfo.elmType === \"grid\" ||\n    propInfo.elmType === \"domain\"\n  ) {\n    // hotfix\n    if (propInfo.val === \"transform\") {\n      // get transform\n      let trfD = transformD.bind(this)(encode, scales, signal, d, false);\n      trfD = Object.keys(trfD).length === 0 ? d : trfD;\n      const x2 = decodeEncode.bind(this)(\"x2\", encode, scales, signal, d);\n      const y2 = decodeEncode.bind(this)(\"y2\", encode, scales, signal, d);\n      if (oldD) {\n        if (x2 === 0 && (oldD.y2 - oldD.y) * y2 < 0) {\n          trfD.y += y2;\n        } else if (y2 === 0 && (oldD.x2 - oldD.x) * x2 < 0) {\n          trfD.x += x2;\n        }\n      }\n      return transformItem(Object.keys(trfD).length === 0 ? d : trfD);\n    }\n    if (propInfo.val === \"x2\") {\n      let x2 = decodeEncode.bind(this)(\"x2\", encode, scales, signal, d);\n      if (isNaN(x2)) {\n        return d.x2 - d.x;\n      }\n      if (oldD) {\n        if ((oldD.x2 - oldD.x) * x2 < 0) {\n          x2 = -x2;\n        }\n      }\n      return isNaN(x2) ? d.x2 - d.x : x2;\n    }\n    if (propInfo.val === \"y2\") {\n      let y2 = decodeEncode.bind(this)(\"y2\", encode, scales, signal, d);\n      if (isNaN(y2)) {\n        return d.y2 - d.y;\n      }\n      if (oldD) {\n        if ((oldD.y2 - oldD.y) * y2 < 0) {\n          y2 = -y2;\n        }\n      }\n      return y2;\n    }\n  } else if (propInfo.elmType === \"rect\") {\n    if (propInfo.val === \"transform\") {\n      return \"\";\n    }\n    if (propInfo.val === \"d\") {\n      if (propInfo.type === \"attrTween\") {\n        return rectInterpolator.bind(this)(\n          scales,\n          encodes,\n          signals,\n          d,\n          oldD,\n          getRect\n        );\n      }\n      return getRect(d, scales, encodes, signal).path;\n    }\n  } else if (propInfo.elmType === \"symbol\") {\n    if (propInfo.val === \"d\") {\n      if (propInfo.type === \"attrTween\") {\n        return symbolInterpolator.bind(this)(\n          scales,\n          encodes,\n          signals,\n          d,\n          oldD,\n          getShape\n        );\n      }\n      return getShape(d, scales, encode, signal).path;\n    }\n    if (propInfo.val === \"transform\") {\n      const trfD = transformD.bind(this)(encode, scales, signal, d, false);\n      return transformItem(Object.keys(trfD).length === 0 ? d : trfD);\n    }\n  } else if (propInfo.elmType === \"gradient\") {\n    if (propInfo.val === \"d\") {\n      const newD = Object.keys(encode.primary || encode)\n        .filter(\n          key =>\n            [\"x\", \"x2\", \"xc\", \"width\", \"y\", \"y2\", \"yc\", \"height\"].indexOf(\n              key\n            ) >= 0\n        )\n        .reduce((acc, curr) => {\n          acc[curr] = decodeEncode.bind(this)(curr, encode, scales, signal, d);\n          return acc;\n        }, {});\n      let x; let y; let width; let height;\n      if (isNaN(newD.x)) {\n        x = isNaN(newD.xc - newD.width / 2)\n          ? newD.x2\n          : newD.xc - newD.width / 2;\n      } else {\n        x = newD.x;\n      }\n      if (isNaN(newD.width)) {\n        width = isNaN(newD.x2 - newD.x) ? undefined : newD.x2 - newD.x;\n      } else {\n        width = newD.width;\n      }\n\n      if (!isNaN(newD.y2) && !isNaN(newD.y)) {\n        y = Math.min(newD.y2, newD.y);\n        height = Math.abs(newD.y2 - newD.y);\n      } else {\n        y = isNaN(newD.y) ? newD.y2 : newD.y;\n        height = newD.height;\n      }\n\n      //  height = isNaN(newD.height) ? ( isNaN(newD.y2 - newD.y) ? undefined : (newD.y2 - newD.y)) : newD.height;\n      // return vega.pathRectangle().x(x).y(y).width(width).height(height)();\n\n      return vega\n        .pathRectangle()\n        .x(x)\n        .y(y)\n        .width(width)\n        .height(height)();\n    }\n    if (propInfo.val === \"transform\") {\n      const trfD = transformD.bind(this)(encode, scales, signal, d, false);\n      return transformItem(Object.keys(trfD).length === 0 ? d : trfD);\n    }\n    if (propInfo.val === \"fill\") {\n      if (propInfo.defs && !propInfo.isUpdate) {\n        const url = propInfo.defs(d3.select(this.closest(\"svg\")), d);\n        return `url(\"${url}\")`;\n      }\n    }\n  } else if (propInfo.elmType === \"rule\") {\n    if (propInfo.val === \"transform\") {\n      // get transform\n      const trfD = transformD.bind(this)(encode, scales, signal, d, false);\n      return transformItem(Object.keys(trfD).length === 0 ? d : trfD);\n    }\n    if (propInfo.val === \"x2\") {\n      const x2 = decodeEncode.bind(this)(\"x2\", encode, scales, signal, d);\n      const x = decodeEncode.bind(this)(\"x\", encode, scales, signal, d);\n      return isNumber(x2 - x) ? x2 - x : d.x2 || 0;\n    }\n    if (propInfo.val === \"y2\") {\n      const y2 = decodeEncode.bind(this)(\"y2\", encode, scales, signal, d);\n      const y = decodeEncode.bind(this)(\"y\", encode, scales, signal, d);\n      return isNumber(y2 - y) ? y2 - y : d.y2 || 0;\n    }\n  } else if (propInfo.elmType === \"group\") {\n    if (propInfo.val === \"transform\") {\n      const trfD = transformD.bind(this)(encode, scales, signal, d);\n      return transformItem(Object.keys(trfD).length === 0 ? d : trfD);\n    }\n  } else if (propInfo.elmType === \"background\") {\n    if (propInfo.val === \"d\") {\n      const rectD = {\n        x: decodeEncode.bind(this)(\"x\", encode, scales, signal, d) || 0,\n        y: decodeEncode.bind(this)(\"y\", encode, scales, signal, d) || 0,\n        height: decodeEncode.bind(this)(\"height\", encode, scales, signal, d),\n        width: decodeEncode.bind(this)(\"width\", encode, scales, signal, d)\n      };\n      return vega\n        .pathRectangle()\n        .x(rectD.x)\n        .y(rectD.y)\n        .width(rectD.width)\n        .height(rectD.height)();\n    }\n  } else if (isLinearMarktype(propInfo.elmType)) {\n    if (propInfo.val === \"d\") {\n      if (propInfo.type === \"attrTween\") {\n        const marktypes = propInfo.initialMarktype\n          ? { initial: propInfo.initialMarktype, final: propInfo.elmType }\n          : propInfo.elmType;\n        return areaLineInterpolator.bind(this)(\n          scales,\n          encodes,\n          marktypes,\n          d,\n          oldD,\n          signals,\n          getPath.bind(this),\n          propInfo.interpolateStyle\n        );\n      }\n      return getPath.bind(this)(\n        areaLineDToData(d),\n        scales,\n        encode,\n        signal,\n        propInfo.elmType\n      );\n    }\n    if (propInfo.val === \"fill\" && propInfo.asTween) {\n      const getFill = encode =>\n        decodeEncode.bind(this)(\n          \"fill\",\n          encode,\n          scales,\n          signal,\n          d.mark.marktype !== \"group\" ? { datum: {} } : d\n        );\n      if (propInfo.initialMarktype === \"area\" && propInfo.elmType === \"line\") {\n        // while area -> line, keep the fill of the path and remove at the end.\n        const decodedValue = getFill({\n          fill: (encodes.initial || encode).fill\n        });\n        return t => (t >= 1 ? \"none\" : decodedValue);\n      }\n      const decodedValue = getFill(encode);\n      return (t) => decodedValue;\n    }\n    if (\n      propInfo.val === \"stroke\" &&\n      propInfo.initialMarktype === \"line\" &&\n      propInfo.elmType === \"area\"\n    ) {\n      const _encode = { stroke: encode.stroke || encode.fill };\n      return decodeEncode.bind(this)(\n        \"stroke\",\n        _encode,\n        scales,\n        signal,\n        d.mark.marktype !== \"group\" ? { datum: {} } : d\n      );\n    }\n    if (hasProp(encode, propInfo)) {\n      // since data bind to the group of the line\n      return decodeEncode.bind(this)(\n        propInfo.val,\n        encode,\n        scales,\n        signal,\n        d.mark.marktype !== \"group\" ? { datum: {} } : d\n      ) + (propInfo.val === \"strokeWidth\" ? \"px\" : \"\");\n    }\n  }\n\n  if (propInfo.val === \"text-anchor\") {\n    const textAnchor = {\n      left: \"start\",\n      center: \"middle\",\n      right: \"end\"\n    };\n    return textAnchor[\n      (oldD ? oldD.align : d.align) ||\n        decodeEncode.bind(this)(\"align\", encode, scales, signal, d)\n    ];\n  }\n  if (hasProp(encode, propInfo)) {\n    return decodeEncode.bind(this)(propInfo.val, encodes, scales, signal, d);\n  }\n  // Vega make some lables transparent to avoid the overlaps.\n  // Gemini takes the vega's decisions.\n  if (propInfo.elmType === \"text\" && propInfo.val === \"opacity\") {\n    return d[propInfo.val];\n  }\n  return BR_PROP_DEFAULT[propInfo.elmType][propInfo.val];\n\n  function hasProp(encode, propInfo) {\n    return (\n      get(encode, \"primary\", propInfo.val) ||\n      get(encode, \"secondary\", propInfo.val) ||\n      get(encode, propInfo.val)\n    );\n  }\n  function getRect(d, scales, encodes, signal, isDiminished) {\n    const encode = encodes.primary || encodes;\n    const subEncode = encodes.secondary || encodes;\n    const POSITION_ATTRS = [\n      \"x\",\n      \"x2\",\n      \"xc\",\n      \"width\",\n      \"y\",\n      \"y2\",\n      \"yc\",\n      \"height\",\n      \"cornerRadius\"\n    ];\n    const newD = POSITION_ATTRS.reduce((acc, attr) => {\n      if (encode[attr] || subEncode[attr]) {\n        acc[attr] = decodeEncode.bind(this)(\n          attr,\n          encodes,\n          scales,\n          signal,\n          d,\n          false\n        );\n      }\n      return acc;\n    }, {});\n\n    let x; let y; let width; let height; let cornerRadius;\n    if (isNumber(newD.xc) && isNumber(newD.width)) {\n      x = newD.xc - newD.width / 2;\n      width = newD.width;\n    } else if (isNumber(newD.x) && isNumber(newD.x2)) {\n      x = Math.min(newD.x, newD.x2);\n      width = Math.abs(newD.x - newD.x2);\n    } else {\n      x = isNumber(newD.x) ? newD.x : newD.x2;\n      width = newD.width;\n    }\n\n    if (isNumber(newD.yc) && isNumber(newD.height)) {\n      y = newD.yc - newD.height / 2;\n      height = newD.height;\n    } else if (isNumber(newD.y2) && isNumber(newD.y)) {\n      y = Math.min(newD.y2, newD.y);\n      height = Math.abs(newD.y2 - newD.y);\n    } else {\n      y = isNumber(newD.y) ? newD.y : newD.y2;\n      height = newD.height;\n    }\n\n    cornerRadius = !isNumber(newD.cornerRadius) ? 0 : newD.cornerRadius;\n    if (isDiminished) {\n      return {\n        path: vega\n          .pathRectangle()\n          .x(0)\n          .y(0)\n          .width(1)\n          .height(1)(),\n        meta: newD\n      };\n    }\n    //  height = isNaN(newD.height) ? ( isNaN(newD.y2 - newD.y) ? undefined : (newD.y2 - newD.y)) : newD.height;\n    // return vega.pathRectangle().x(x).y(y).width(width).height(height)();\n\n    return {\n      path: vega\n        .pathRectangle()\n        .x(x)\n        .y(y)\n        .width(width)\n        .height(height)\n        .cornerRadius(cornerRadius)(),\n      meta: newD\n    };\n  }\n\n  function getShape(d, scales, encodes, signal, isDiminished = false) {\n    const encode = encodes.primary || encodes;\n    let newD = Object.keys(encode)\n      .filter(key => [\"size\", \"shape\"].indexOf(key) >= 0)\n      .reduce((acc, curr) => {\n        acc[curr] = decodeEncode.bind(this)(curr, encodes, scales, signal, d);\n        return acc;\n      }, {});\n    const context = d3.path();\n    newD = {\n      shape: newD.shape || \"circle\",\n      size: isNumber(newD.size) ? newD.size : isNumber(d.size) ? d.size : 30\n    };\n\n    vega.pathSymbols(newD.shape).draw(context, isDiminished ? 1 : newD.size);\n    return {\n      path: context.toString(),\n      meta: newD\n    };\n  }\n\n  function getPath(data, scales, encodes, signal, type, alongTo=\"x\") {\n    // let data = (d.mark.marktype !== \"group\" ? d : d.items[0].items[0]).mark.items;\n    const encode = encodes.primary || encodes;\n    const newData = data.map(oldD => {\n      const defaultD = Object.keys(encode)\n        .filter(key => [\"x\", \"x2\", \"xc\", \"width\", \"y\", \"y2\", \"yc\", \"height\", \"size\"].indexOf(key) >= 0) // \"defined\" channel is ignored due to performance issue.\n        .reduce((acc, curr) => {\n          const newVal = decodeEncode.bind(this)(\n            curr,\n            encodes,\n            scales,\n            signal,\n            oldD\n          );\n          if (!isNumber(newVal)) {\n            return acc;\n          }\n          acc[curr] = newVal;\n          if (scales[curr] && scales[curr].type === \"band\") {\n            acc[curr] += Math.round(\n              scales[curr].bandwidth() * (encode.bandPosition || 0.5)\n            );\n          }\n          return acc;\n        }, {});\n      defaultD.height = isNumber(defaultD.height)\n        ? defaultD.height\n        : Math.abs(defaultD.y2 - defaultD.y);\n      defaultD.width = isNumber(defaultD.width)\n        ? defaultD.width\n        : Math.abs(defaultD.x2 - defaultD.x);\n      return Object.assign(\n        // {\n        //   x: oldD.x,\n        //   y: oldD.y,\n        //   width: oldD.width,\n        //   height: oldD.height\n        // },\n        defaultD\n      );\n    });\n\n    if (type === \"line\") {\n      return (\n        d3\n          .line()\n          .x(d => Math.floor(d.x * 100) / 100)\n          .y(d => Math.floor(d.y * 100) / 100)(newData) || \"\"\n      );\n    } else if (type === \"area\") {\n      // areahShape  = d3_area().y(y).x1(x).x0(xw).defined(def),\n      if (alongTo === \"x\") {\n        newData.forEach(d => {\n          d.y2 = isNumber(d.y2) ? d.y2 : d.y;\n        });\n        return (\n          d3\n            .area()\n            .x(d => Math.floor(d.x * 100) / 100)\n            .y1(d => Math.floor(Math.min(d.y, d.y2) * 100) / 100)\n            .y0(\n              d => Math.floor((Math.min(d.y, d.y2) + (d.height || 0)) * 100) / 100\n            )(newData) || \"\"\n        );\n      } else {\n        newData.forEach(d => {\n          d.x2 = isNumber(d.x2) ? d.x2 : d.x;\n        });\n        return (\n          d3\n            .area()\n            .y(d => Math.floor(d.y * 100) / 100)\n            .x1(d => Math.floor(Math.min(d.x, d.x2) * 100) / 100)\n            .x0(\n              d => Math.floor((Math.min(d.x, d.x2) + (d.width || 0)) * 100) / 100\n            )(newData) || \"\"\n        );\n      }\n\n    } else if (type === \"trail\") {\n\n      return vega.pathTrail()\n        .x(d => d.x)\n        .y(d=> d.y)\n        .size(d=> (isNumber(d.size) ? d.size : 2)) // 2 is default size in Vega\n        .defined(d=>(d.defined || true))(newData);\n    }\n  }\n}\n\nexport function transformD(encodes, scales, signal, d, inherit = true) {\n  const encode = encodes.primary || encodes;\n  return Object.assign(\n    {},\n    Object.keys(encode)\n      .filter(key => [\"x\", \"y\", \"angle\", \"yc\", \"xc\"].indexOf(key) >= 0)\n      .reduce((acc, curr) => {\n        const newVal = decodeEncode.bind(this)(\n          curr,\n          encodes,\n          scales,\n          signal,\n          d\n        );\n        let prop = curr;\n        if (isNaN(newVal)) {\n          return acc;\n        }\n        if (curr === \"xc\") {\n          prop = \"x\";\n        } else if (curr === \"yc\") {\n          prop = \"y\";\n        }\n\n        acc[prop] = isNaN(acc[prop]) ? newVal : acc[prop];\n        return acc;\n      }, {}),\n    inherit ? d : {}\n  );\n}\nexport\nfunction calculateGetValeus(encodes, scales, signals, computeScale, scNames) {\n  return {\n    update: {\n      initial: (attr, getScales, d) => {\n        const computedScales = computeScale(scales, scNames, getScales);\n        return getPropVal(\n          attr,\n          encodes.initial.update,\n          computedScales.initial,\n          signals.initial,\n          d\n        );\n      },\n      final: (attr, getScales, d) => {\n        const computedScales = computeScale(scales, scNames, getScales);\n        return getPropVal(\n          attr,\n          encodes.final.update,\n          computedScales.final,\n          signals.final,\n          d\n        );\n      },\n      custom(attr, getScales, d_i, d_f) {\n        const datum = {\n          initial: d_i,\n          final: d_f\n        };\n\n        const computedScales = computeScale(scales, scNames, getScales);\n        return getPropVal.bind(this)(\n          attr,\n          encodes.final.update,\n          computedScales,\n          signals.final,\n          datum\n        );\n      }\n    },\n    enter: {\n      initial: (attr, getScales, d) => {\n        const computedScales = computeScale(scales, scNames, getScales);\n\n        return getPropVal(\n          attr,\n          encodes.initial.enter,\n          { primary: computedScales.initial, secondary: computedScales.final },\n          signals.initial,\n          d\n        );\n      },\n      final: (attr, getScales, d) => {\n        const computedScales = computeScale(scales, scNames, getScales);\n        return getPropVal(\n          attr,\n          encodes.final.enter,\n          computedScales.final,\n          signals.final,\n          d\n        );\n      },\n      custom(attr, getScales, d_i, d_f) {\n        const datum = {\n          initial: d_i,\n          final: d_f\n        };\n\n        const computedScales = computeScale(scales, scNames, getScales);\n        return getPropVal.bind(this)(\n          attr,\n          encodes.final.enter,\n          computedScales,\n          signals.final,\n          datum\n        );\n      }\n    },\n    exit: {\n      initial: (attr, getScales, d) => {\n        const computedScales = computeScale(scales, scNames, getScales);\n        return getPropVal(\n          attr,\n          encodes.initial.exit,\n          computedScales.initial,\n          signals.initial,\n          d\n        );\n      },\n      final: (attr, getScales, d) => {\n        const computedScales = computeScale(scales, scNames, getScales);\n        return getPropVal(\n          attr,\n          encodes.final.exit,\n          { primary: computedScales.final, secondary: computedScales.initial },\n          signals.final,\n          d\n        );\n      },\n      custom(attr, getScales, d_i, d_f) {\n        const datum = {\n          initial: d_i,\n          final: d_f\n        };\n\n        const computedScales = computeScale(scales, scNames, getScales);\n        return getPropVal.bind(this)(\n          attr,\n          encodes.final.exit,\n          computedScales,\n          signals.final,\n          datum\n        );\n      }\n    }\n  };\n}\n\nfunction decodeEncode(prop, encodes, scales, signal, d) {\n  let subScales = copy2(scales);\n  if (scales.primary && scales.secondary) {\n    subScales = scales.secondary;\n    scales = scales.primary;\n  } else if (scales.initial && scales.final) {\n    scales = scales.final;\n  }\n\n  let encode = copy(encodes);\n  let subEncode = copy(encodes);\n  if (encodes.primary && encodes.secondary) {\n    encode = encodes.primary;\n    subEncode = encodes.secondary;\n  } else if (encodes.initial && encodes.final) {\n    subEncode = encode = encodes.final;\n  }\n\n  const enAttr = encode[prop];\n  const subEnAttr = subEncode[prop];\n\n  function getVal(enAttr, scales) {\n    if (!enAttr) {\n      return;\n    }\n    if (Array.isArray(enAttr)) {\n      for (let i = 0; i < enAttr.length - 1; i++) {\n        // Then the items should contain 'test' prop to test (except the last)\n        if (evalSignalVal(enAttr[i].test, signal, scales, d.datum)) {\n          return enAttr[i].value;\n        }\n      }\n      enAttr = copy(enAttr[enAttr.length - 1]);\n    }\n\n    let finalVal = enAttr.value;\n    if (enAttr.field) {\n      if (enAttr.scale) {\n        const scName = enAttr.scale;\n        finalVal = scales[scName]\n          ? scales[scName](d.datum[enAttr.field])\n          : undefined;\n      } else if (enAttr.field.group) {\n        return d.mark.group[enAttr.field.group];\n      } else {\n        finalVal = d.datum[enAttr.field];\n      }\n    }\n    if (enAttr.signal) {\n      const val = evalSignalVal(enAttr.signal, signal, scales, d.datum);\n\n      if (enAttr.scale) {\n        const scName = enAttr.scale;\n        finalVal = scales[scName] ? scales[scName](val) : undefined;\n      } else {\n        finalVal = val;\n      }\n    }\n    if (enAttr.scale) {\n      const scName = enAttr.scale;\n\n      if (enAttr.value !== undefined) {\n        finalVal = scales[scName] ? scales[scName](enAttr.value) : undefined;\n      }\n\n      if (enAttr.band) {\n        const sc = scales[scName];\n        let bw = sc && sc.type === \"band\" ? sc.bandwidth() : 0;\n        bw = Math.round(\n          bw *\n            (enAttr.band === true || isNumber(enAttr.band) ? enAttr.band : 0.5)\n        );\n        finalVal = isNumber(finalVal) ? bw + finalVal : bw;\n      }\n    }\n\n    if (enAttr.exp) {\n      console.error(\"Todo decodeEncdoe with exp.\");\n    }\n    if (enAttr.mult) {\n      if (isNumber(enAttr.mult)) {\n        finalVal *= enAttr.mult;\n      } else {\n        finalVal *= decodeEncode(\n          \"mult\",\n          { mult: enAttr.mult },\n          scales,\n          signal,\n          d\n        );\n      }\n    }\n    if (enAttr.offset) {\n      if (isNumber(enAttr.offset)) {\n        finalVal += enAttr.offset;\n      } else {\n        finalVal += decodeEncode(\n          \"offset\",\n          { offset: enAttr.offset },\n          scales,\n          signal,\n          d\n        );\n      }\n    }\n    return finalVal;\n  }\n  const fValPrimary = getVal(enAttr, scales);\n  const fValSecondary = getVal(subEnAttr, subScales);\n  return fValPrimary !== undefined ? fValPrimary : fValSecondary;\n}\n\n\nfunction evalSignalVal(signalVal, signal, scales, datum) {\n  const VEGA_FUNCTIONS = [\n    {\n      name: \"scale\",\n      fn: (scName, val) => (scales[scName] ? scales[scName](val) : undefined)\n    },\n    { name: \"isValid\", fn: o => o !== null && o === o },\n    { name: \"timeFormat\", fn: (a, b) => vega.timeFormat(b)(a) },\n    { name: \"timeUnitSpecifier\", fn: (a, b) => vega.timeUnitSpecifier(a, b) }\n  ];\n\n  const codegen = vegaExpression.codegen({\n    whitelist: [\"datum\"].concat(Object.keys(signal || {})),\n    globalvar: \"global\"\n  });\n\n\n  VEGA_FUNCTIONS.forEach(fnDef => {\n    codegen.functions[fnDef.name] = fnDef.name;\n  });\n  const extraFunctions = VEGA_FUNCTIONS.map(fnDef => fnDef.fn);\n  const extraFunctionNames = VEGA_FUNCTIONS.map(fnDef => fnDef.name);\n\n  const codegenVal = codegen(vegaExpression.parse(signalVal));\n\n  const fn = Function(\n    \"datum\",\n    ...Object.keys(signal || {}),\n    ...extraFunctionNames,\n    `return (${codegenVal.code})`\n  );\n  return fn(\n    datum,\n    ...Object.keys(signal || {}).map(key => signal[key]),\n    ...extraFunctions\n  );\n\n}","import * as d3 from \"d3\";\nimport { flatten } from \"../util/util.js\";\nimport { getEaseFn } from \"./util\";\n\nconst ORDER = {\n  ascending: d3.ascending,\n  descending: d3.descending\n};\n\nfunction getOrderFn(isNumber, order) {\n  if (isNumber && order) {\n    return (a, b) => ORDER[order](Number(a), Number(b));\n  }\n  return ORDER[order];\n}\n\nfunction staggeredTiming(staggering, data, duration) {\n  let N;\n  let grouped;\n  const dataWithTiming = data.map((d, i) => {\n    return { ...d, __staggering_id__: i };\n  });\n  const subStaggering = staggering.staggering;\n\n  const isNumber =\n    staggering.by &&\n    dataWithTiming.reduce((acc, d) => {\n      let val;\n      if (typeof staggering.by === \"string\") {\n        val = (d.initial || d.final)[staggering.by];\n      } else if (staggering.by.initial || staggering.by.final) {\n        const which = staggering.by.initial ? \"initial\" : \"final\";\n        val = (which === \"initial\"\n          ? d.initial || d.final\n          : d.final || d.initial)[staggering.by[which]];\n      }\n      return (acc = acc && (val !== undefined ? !isNaN(Number(val)) : true));\n    }, true);\n  if (!staggering.by) {\n    grouped = d3\n      .nest()\n      .key(d => {\n        const val = d.__staggering_id__;\n        return val === undefined ? \"__empty__\" : val;\n      })\n      .sortKeys(getOrderFn(true, staggering.order))\n      .entries(dataWithTiming);\n  } else if (typeof staggering.by === \"string\") {\n    grouped = d3\n      .nest()\n      .key(d => {\n        const val = (d.initial || d.final)[staggering.by];\n        return val === undefined ? \"__empty__\" : val;\n      })\n      .sortKeys(getOrderFn(isNumber, staggering.order))\n      .entries(dataWithTiming);\n  } else if (staggering.by.initial || staggering.by.final) {\n    const which = staggering.by.initial ? \"initial\" : \"final\";\n    grouped = d3\n      .nest()\n      .key(d => {\n        const val = (which === \"initial\"\n          ? d.initial || d.final\n          : d.final || d.initial)[staggering.by[which]];\n        return val === undefined ? \"__empty__\" : val;\n      })\n      .sortKeys(getOrderFn(isNumber, staggering.order))\n      .entries(dataWithTiming);\n  }\n\n  N = grouped.length;\n\n  const ease = getEaseFn(staggering.ease || \"linear\") || d3.easeLinear;\n  const r = staggering.overlap === undefined ? 1 : staggering.overlap;\n  const delta_e = i => ease((i + 1) / N) - ease(i / N);\n  const alpha = 1 / (delta_e(0) * r + 1 - r);\n\n  let durations = new Array(N).fill(0);\n  durations = durations.map((d, i) => delta_e(i) * alpha * duration);\n  let delayAcc = 0;\n  const delays = durations.map((dur, i, durations) => {\n    const currDelay = delayAcc;\n    if (i < N - 1) {\n      delayAcc = delayAcc + dur - durations[i + 1] * r;\n    }\n    return currDelay;\n  });\n\n  if (subStaggering) {\n    const timings = delays.map((d, i) => {\n      return {\n        delay: d,\n        duration: durations[i]\n      };\n    });\n\n    timings.groups = grouped.map((g, i) => {\n      return staggeredTiming(subStaggering, g.values, durations[i]);\n    });\n\n    return getFlattenTimings(timings);\n  }\n  grouped.forEach((group, i) => {\n    group.values.forEach(datum => {\n      datum.delay = delays[i];\n      datum.duration = durations[i];\n    });\n  });\n\n  return dataWithTiming;\n}\n\nfunction getFlattenTimings(timings) {\n  if (!timings.groups) {\n    return timings;\n  }\n  return flatten(\n    timings.map((g_t, i) => {\n      return getFlattenTimings(timings.groups[i]).map(t => {\n        return Object.assign({}, t, { delay: t.delay + g_t.delay });\n      });\n    })\n  );\n}\n\nexport { staggeredTiming };\n","import { staggeredTiming } from \"./staggering\";\n\nfunction computeTiming(initialData, finalData, stepTiming, joinKey, joinSet) {\n  let timings = initialData.map((d_i, i) => {\n    const key = joinKey(d_i, i, \"initial\");\n    const found = finalData.find((d_f, j) => key === joinKey(d_f, j, \"final\"));\n    return {\n      initial: d_i.datum,\n      final: found ? found.datum : null,\n      set: found ? \"update\" : \"exit\",\n      id: key,\n      duration: stepTiming.duration,\n      delay: stepTiming.delay\n    };\n  });\n  timings = timings.concat(\n    finalData\n      .filter(d => joinSet(d) === \"enter\")\n      .map((d, i) => {\n        const key = joinKey(d, i, \"final\");\n        return {\n          initial: null,\n          final: d.datum,\n          set: \"enter\",\n          id: key,\n          duration: stepTiming.duration,\n          delay: stepTiming.delay\n        };\n      })\n  );\n\n  if (stepTiming.staggering) {\n    timings = staggeredTiming(\n      stepTiming.staggering,\n      timings,\n      stepTiming.duration\n    );\n  }\n  return timings;\n}\n\nfunction enumStepComputeTiming(enumerator, stepTiming) {\n  // staggering\n  let timings = enumerator.allKeys.map((d, i) => {\n    let datum_i = enumerator.getDatum(d, 0);\n    let datum_f = enumerator.getDatum(d, 0);\n    for (let k = 1; k < enumerator.stopN; k++) {\n      datum_i = datum_i || enumerator.getDatum(d, 0);\n      datum_f = enumerator.getDatum(d, k) || datum_f;\n    }\n\n    return {\n      initial: datum_i,\n      final: datum_f,\n      set: \"update\", // Todo\n      id: i,\n      key: d,\n      duration: stepTiming.duration,\n      delay: stepTiming.delay\n    };\n  });\n\n  if (stepTiming.staggering) {\n    timings = staggeredTiming(\n      stepTiming.staggering,\n      timings,\n      stepTiming.duration\n    );\n  }\n  timings = timings.sort((a, b) => a.id - b.id);\n  return timings;\n}\n\nexport { computeTiming, enumStepComputeTiming };\n","import * as d3 from \"d3\";\nimport { findAfterSibling, propMap, getEaseFn, getJoinInfo, computeScale} from \"../util.js\";\nimport { getPropVal, fetchAttributes} from \"../attributeFetcher\";\nimport { getStyle } from \"../vega-render-util.js\";\nimport { computeTiming, enumStepComputeTiming } from \"../timings\";\n\nfunction markInterpolate(rawInfo, step, targetElm) {\n  const joinKey = (d, i, initialOrFinal) => {\n    return d.__gemini__ ?\n      getJoinInfo(d, i, step, \"joinKey\") :\n      (\n        typeof(step.computeDatumId) === \"function\"\n          ? step.computeDatumId(d, i)\n          : step.computeDatumId[initialOrFinal || \"initial\"](d, i)\n      );\n  }; const joinSet = (d, i) => {\n    return d.__gemini__ ? getJoinInfo(d, i, step, \"animSet\") : undefined;\n  };\n\n  const animVis = targetElm;\n  const eView = rawInfo.eVis.view;\n\n  const MARK_ATTRS = {\n    rect: [\"rect\"],\n    symbol: [\"symbol\"],\n    rule: [\"rule\"],\n    text: [\"text\", \"align\"]\n  };\n\n  return new Promise((resolve) => {\n    const done = doneMaker();\n    const timings = computeTiming(\n      step.currData,\n      step.nextData,\n      step.timing,\n      joinKey,\n      joinSet\n    );\n    const {\n      change,\n      marktypes,\n      scales,\n      encodes,\n      signals\n    } = step;\n\n    const isAdd = !change.initial && !!change.final,\n      isRemove = !!change.initial && !change.final;\n    // if (isValidMarktype(marktypes.initial) && isValidMarktype(marktypes.final) && marktypes.initial !== marktypes.final) {\n    //   isAdd = isRemove = true;\n    // }\n    const easeFn = getEaseFn(step.timing.ease);\n\n    // let doUpdate =  !isRemove && !isAdd && (change.encode !== false),\n    //   doEnter = !isRemove && (isAdd || change.encode !== false),\n    //   doExit = !isAdd && (isRemove || change.encode !== false);\n\n    // if (change.encode) {\n    //   doUpdate = change.encode.update === false ? false : doUpdate;\n    //   doEnter = change.encode.enter === false ? false : doEnter;\n    //   doExit = change.encode.exit === false ? false : doExit;\n    // }\n    // doExit = true;\n    // doEnter = true;\n    let marktype;\n\n    if (isRemove) {\n      marktype = marktypes.initial;\n    } else if (isAdd) {\n      marktype = marktypes.final;\n    } else if (\n      marktypes.initial &&\n      marktypes.final &&\n      marktypes.initial !== marktypes.final\n    ) {\n      if (change.marktype === false) {\n        marktype = marktypes.initial;\n      } else {\n        marktype = marktypes.final;\n      }\n    } else {\n      marktype = marktypes.initial || marktypes.final;\n    }\n\n    const svgElmType = getSvgElmType(marktype);\n    const svgElmTypes = {\n      initial: getSvgElmType(marktypes.initial),\n      final: getSvgElmType(marktypes.final)\n    };\n\n    let marks = d3.select(`${animVis  } .mark-${marktype}.role-mark.${change.compName}`);\n\n\n    if (\n      isAdd ||\n      (marktypes.initial !== marktypes.final &&\n        isValidMarktype(marktypes.final))\n    ) {\n      const sib = findAfterSibling(eView.scenegraph().root, change.compName);\n\n      marks = addMark(\n        d3.select(`${animVis  } .${change.final.parent.name} > g > g`),\n        change.final,\n        sib ? `.${sib.name}` : undefined\n      );\n    }\n\n    if (step.enumerator) {\n      if (!change.data) {\n        console.error(\n          \"Cannot apply enumerator for a mark interpolation without data change!\"\n        );\n      }\n      const {enumerator} = step;\n      let finalScaleNames = [];\n      if (change.scale === true) {\n        finalScaleNames = Object.keys(eView._runtime.scales);\n      } else if (Array.isArray(change.scale)) {\n        finalScaleNames = change.scale;\n      }\n\n      const getValues = {\n        update: {\n          initial(attr, getScales, d){\n\n            let computedScales = computeScale(scales, finalScaleNames, getScales);\n            return getPropVal.bind(this)(\n              attr,\n              encodes.initial.update,\n              computedScales.initial,\n              signals.initial,\n              d);\n          },\n\n          final: function(attr, getScales, d){\n            const computedScales = computeScale(scales, finalScaleNames, getScales);\n            return getPropVal.bind(this)(\n              attr,\n              encodes.final.update,\n              computedScales.final,\n              signals.initial,\n              d\n            );\n          },\n          custom(attr, getScales, d_i, d_f) {\n            let datum = {\n              initial: d_i,\n              final: d_f\n            };\n\n            let computedScales = computeScale(scales, finalScaleNames, getScales);\n            return getPropVal.bind(this)(\n              attr,\n              encodes.final.update,\n              computedScales,\n              signals.final,\n              datum);\n          }\n        },\n        enter: {\n          initial(attr, getScales, d){\n\n            let computedScales = computeScale(scales, finalScaleNames, getScales);\n            return getPropVal.bind(this)(\n              attr,\n              encodes.initial.enter,\n              {primary: computedScales.initial, secondary: computedScales.final},\n              signals.initial,\n              d);\n          },\n          final(attr, getScales, d){\n            let computedScales = computeScale(scales, finalScaleNames, getScales);\n            return getPropVal.bind(this)(\n              attr,\n              encodes.final.enter,\n              computedScales.final,\n              signals.initial,\n              d);\n\n          },\n          custom(attr, getScales, d_i, d_f){\n            let datum = {\n              initial: d_i,\n              final: d_f\n            };\n\n            let computedScales = computeScale(scales, finalScaleNames, getScales);\n            return getPropVal.bind(this)(\n              attr,\n              encodes.final.enter,\n              computedScales,\n              signals.final,\n              datum);\n          }\n        },\n        exit: {\n          initial(attr, getScales, d){\n\n            let computedScales = computeScale(scales, finalScaleNames, getScales);\n            return getPropVal.bind(this)(\n              attr,\n              encodes.initial.exit,\n              computedScales.initial,\n              signals.initial,\n              d);\n          },\n          final(attr, getScales, d){\n            let computedScales = computeScale(scales, finalScaleNames, getScales);\n            return getPropVal.bind(this)(\n              attr,\n              encodes.final.exit,\n              {primary: computedScales.final, secondary: computedScales.initial},\n              signals.final,\n              d);\n          },\n          custom(attr, getScales, d_i, d_f){\n            let datum = {\n              initial: d_i,\n              final: d_f\n            };\n\n            let computedScales = computeScale(scales, finalScaleNames, getScales);\n            return getPropVal.bind(this)(\n              attr,\n              encodes.final.exit,\n              computedScales,\n              signals.final,\n              datum);\n          }\n        }\n      };\n      // bind allKeys\n      const newBoundMarks = marks\n        .selectAll(svgElmType)\n        .data(enumerator.allKeys, d => d);\n      newBoundMarks.exit().remove();\n      newBoundMarks.enter().append(svgElmType);\n\n      const initialMarks = marks\n        .selectAll(svgElmType)\n        .filter(id => [\"update\", \"exit\"].indexOf(enumerator.set(id, 0)) >= 0);\n      const allProps = MARK_ATTRS[marktype].reduce((acc, prop) => {\n        return acc.concat(propMap(prop));\n      }, []);\n      allProps.forEach(p => {\n        if (p.type === \"attrTween\") {\n          const tempP = Object.assign({}, p, { type: \"attr\" });\n          initialMarks[tempP.type](getStyle(tempP.val), id =>\n            enumerator.getPropVal(tempP, getValues, 0, id)\n          );\n        } else if (p.type === \"text\") {\n          initialMarks[p.type](id =>\n            enumerator.getPropVal(p, getValues, 0, id)\n          );\n        } else {\n          initialMarks[p.type](getStyle(p.val), id =>\n            enumerator.getPropVal(p, getValues, 0, id)\n          );\n        }\n      });\n\n\n\n      // staggering\n      const timings = enumStepComputeTiming(enumerator, step.timing);\n\n      const animMarks = marks.selectAll(svgElmType).transition();\n\n      allProps.forEach(p => {\n        if (p.type === \"attr\") {\n          animMarks.attrTween(p.val, function(d) {\n            return enumerator.interpolateAlongEnumMaker(p, getValues, this)(d);\n          });\n        } else if (p.type === \"attrTween\") {\n          animMarks.attrTween(p.val, function(d) {\n            return enumerator.interpolateAlongEnumMaker(p, getValues, this)(d);\n          });\n        } else if (p.type === \"text\") {\n          animMarks.tween(\"text\", function(d) {\n            const textInterpolator = enumerator.interpolateAlongEnumMaker(\n              p,\n              getValues,\n              this\n            )(d);\n            return function(t) {\n              this.setAttribute(\"text\", textInterpolator(t));\n            };\n          });\n        } else if (p.type === \"style\") {\n          animMarks.styleTween(getStyle(p.val), d => {\n            return enumerator.interpolateAlongEnumMaker(p, getValues, this)(d);\n          });\n        }\n      });\n\n      // interpolate them\n      animMarks\n        .duration((d, i) => timings[i].duration)\n        .delay((d, i) => timings[i].delay)\n        .ease(easeFn)\n        .end()\n        .then(() => {\n          marks.selectAll(svgElmType).data(step.nextData);\n          done(\"all\", () => {resolve();});\n        });\n\n\n\n    } else {\n      // If there is a marktype change between different svgElmTypes\n      if (marktypes.initial !== marktypes.final) {\n        let animMarksI; let animMarksF;\n        if (isValidMarktype(marktypes.initial)) {\n          const marks = d3.select(\n            animVis + ` .mark-${marktypes.initial}.role-mark.${change.compName}`\n          );\n          animMarksI = marks.selectAll(svgElmTypes.initial);\n          const newTimings =\n            marktypes.final && !isValidMarktype(marktypes.final)\n              ? computeTiming(\n                step.currData,\n                step.unpackedData,\n                step.timing,\n                joinKey,\n                joinSet\n              )\n              : timings;\n          const prevData = d3.local();\n          let nextData =\n              marktypes.final && !isValidMarktype(marktypes.final)\n                ? step.unpackedData\n                : step.nextData;\n\n          if (change.data || isAdd || isRemove) {\n            animMarksI = animMarksI.data(step.currData);\n            animMarksI.each(function(d) {\n              prevData.set(this, d);\n            });\n            animMarksI = animMarksI.data(nextData, (d, i) =>\n              joinKey(d, i, \"initial\")\n            );\n          } else {\n            animMarksI.each(function(d) {\n              prevData.set(this, d);\n            });\n          }\n\n          exit(\n            newTimings,\n            animMarksI,\n            marktypes.initial,\n            {\n              initial: encodes.initial.exit,\n              final: encodes.final.exit\n            },\n            signals,\n            prevData\n          );\n\n          update(\n            newTimings,\n            animMarksI,\n            marktypes.initial,\n            {\n              initial: encodes.initial.update,\n              final: encodes.initial.intermediate\n            },\n            // encode,\n            signals,\n            prevData,\n            false,\n            false\n          );\n        } else {\n          done(\"exit\", () => {\n            resolve();\n          });\n        }\n\n        if (isValidMarktype(marktypes.final)) {\n          const prevData = d3.local();\n          let newTimings = marktypes.initial && !isValidMarktype(marktypes.initial) ? computeTiming(step.unpackedData, step.nextData, step.timing, joinKey, joinSet) : timings;\n          let currData = !marktypes.initial\n            ? []\n            : !isValidMarktype(marktypes.initial)\n              ? step.unpackedData\n              : animMarksI.data();\n          const marks = d3.select(\n            animVis + ` .mark-${marktypes.final}.role-mark.${change.compName}`\n          );\n          animMarksF = marks\n            .selectAll(svgElmTypes.final)\n            .filter(d => !d)\n            .data(currData);\n\n          fetchAttributes(\n            animMarksF.enter().append(svgElmTypes.final),\n            MARK_ATTRS[marktypes.final],\n            { primary: scales.initial, secondary: scales.final },\n            signals.initial,\n            encodes.final.intermediate\n          );\n          animMarksF = marks.selectAll(svgElmTypes.final);\n          animMarksF.each(function(d) {\n            prevData.set(this, d);\n          });\n          if (change.data || isAdd || isRemove) {\n            animMarksF = animMarksF.data(step.nextData, (d, i) =>\n              joinKey(d, i, \"final\")\n            );\n          }\n\n          enter(newTimings, animMarksF, marktypes.final);\n          // fade-in the new martype\n          update(\n            newTimings,\n            animMarksF,\n            marktypes.final,\n            {\n              initial: encodes.final.intermediate,\n              final: encodes.final.update\n            },\n            signals,\n            prevData,\n            true,\n            true\n          );\n        } else {\n          done(\"update\", () => {\n            resolve();\n          });\n          done(\"enter\", () => {\n            resolve();\n          });\n        }\n      } else {\n        let animMarks = marks.selectAll(svgElmType);\n        const prevData = d3.local();\n        animMarks.each(function(d) {\n          prevData.set(this, d);\n        });\n        if (change.data || isAdd || isRemove) {\n          // let nextData = change.marktype === false ? step.unpackedData : step.nextData;\n\n          if (step.preFetchCurrData) {\n            animMarks = animMarks.data(step.currData);\n          }\n\n          animMarks = animMarks.data(step.nextData, (d, i) => {\n            // console.log(joinKey(d, i));\n            return joinKey(d, i);\n          });\n        }\n\n        // enter\n        enter(timings, animMarks, marktype);\n\n        // exit\n        exit(\n          timings,\n          animMarks,\n          marktype,\n          {\n            initial: encodes.initial.exit, // encodes.final.exit,\n            final: encodes.final.exit\n          },\n          signals,\n          prevData\n        );\n\n        update(\n          timings,\n          animMarks,\n          marktype,\n          {\n            initial: encodes.initial.update, // encodes.final.update,\n            final: encodes.final.update\n          },\n          signals,\n          prevData\n        );\n      }\n    }\n    function enter(\n      timings,\n      animMarks,\n      marktype,\n      encodeInitial = encodes.initial.enter,\n      encode = encodes.final.enter\n    ) {\n      // enter\n      let enterI = animMarks.enter().append(getSvgElmType(marktype));\n      fetchAttributes(\n        enterI,\n        MARK_ATTRS[marktype],\n        // Todo: When using the final scale, it should use the final encode as well.\n        { primary: scales.initial, secondary: scales.final },\n        signals.initial,\n        {\n          primary: encodeInitial,\n          secondary: Object.assign({}, encode, { opacity: { value: 0 } })\n        }\n      );\n\n      // If they are already entered,\n      if (enterI.data().length <= 0) {\n        enterI = animMarks.filter((d, i) => joinSet(d, i) === \"enter\");\n      }\n      if (enterI.data().length > 0) {\n        // if (doEnter && enterI.data().length > 0) {\n        const setType = \"final\";\n        const enterF = enterI.transition();\n\n        fetchAttributes(\n          enterF,\n          MARK_ATTRS[marktype],\n          scales.final,\n          signals.final,\n          {\n            initial: {\n              primary: encodeInitial,\n              secondary: Object.assign({}, encode, { opacity: { value: 0 } })\n            },\n            final: encode\n          }\n        );\n\n        enterF\n          .duration(\n            (d, i) =>\n              timings.find(t => t.id === joinKey(d, i, setType)).duration\n          )\n          .delay(\n            (d, i) => timings.find(t => t.id === joinKey(d, i, setType)).delay\n          )\n          .ease(easeFn)\n          .end()\n          .then(() => {\n            done(\"enter\", () => {resolve();});\n          });\n      } else {\n        done(\"enter\", () => {\n          resolve();\n        });\n      }\n    }\n    function exit(timings, animMarks, marktype, encode, signals, prevData) {\n      // exit\n      // initiate exit\n      let exitI = animMarks.exit();\n      // If they are already entered,\n      if (exitI.data().length <= 0) {\n        exitI = animMarks.filter((d, i) => joinSet(d, i) === \"exit\");\n      }\n      if (exitI.data().length > 0) {\n        // if (doExit && exitI.data().length > 0) {\n        const setType = \"initial\";\n        const exitF = exitI.transition();\n\n        fetchAttributes(\n          exitF,\n          MARK_ATTRS[marktype],\n          Object.assign({}, scales, {\n            primary: scales.final,\n            secondary: scales.initial\n          }),\n          signals,\n          encode || encodes.final.exit,\n          prevData\n        );\n\n        exitF\n          .duration(\n            (d, i) =>\n              timings.find(t => t.id === joinKey(d, i, setType)).duration\n          )\n          .delay(\n            (d, i) => timings.find(t => t.id === joinKey(d, i, setType)).delay\n          )\n          .ease(easeFn)\n          .remove()\n          .end()\n          .then(function() {\n            done(\"exit\", () => {resolve();});\n          });\n        // Todo: when should we remove exit-marks?\n      } else {\n        done(\"exit\", () => {\n          resolve();\n        });\n      }\n    }\n    function update(\n      timings,\n      animMarks,\n      marktype,\n      encodes,\n      signals,\n      prevData,\n      doStatusUpdate = true,\n      filterUpdate = true\n    ) {\n      let updateF = filterUpdate\n        ? animMarks.filter((d, i) => joinSet(d, i) === \"update\")\n        : animMarks;\n      if (change.data === false && updateF.data().length === 0) {\n        updateF = animMarks;\n      }\n\n      if (updateF.data().length > 0) {\n        const setType = \"initial\"; // Actually, it also can be 'final'.\n        updateF = updateF.transition();\n\n        fetchAttributes(\n          updateF,\n          MARK_ATTRS[marktype],\n          scales,\n          signals,\n          encodes,\n          prevData\n        );\n        updateF\n          .duration(\n            (d, i) =>\n              timings.find(t => t.id === joinKey(d, i, setType)).duration\n          )\n          .delay(\n            (d, i) => timings.find(t => t.id === joinKey(d, i, setType)).delay\n          )\n          .ease(easeFn)\n          .end()\n          .then(() => {\n            if (doStatusUpdate) {\n              done(\"update\", () => {resolve();});\n            }\n          });\n      } else if (doStatusUpdate) {\n        done(\"update\", () => {resolve();});\n      }\n    }\n  });\n  function isValidMarktype(marktype) {\n    return !!MARK_ATTRS[marktype];\n  }\n}\nfunction doneMaker() {\n  const transitionStatus = {\n    update: false,\n    enter: false,\n    exit: false\n  };\n\n  return function(which, cb, args) {\n    if (which === \"all\") {\n      transitionStatus.update = transitionStatus.enter = transitionStatus.exit = true;\n    } else {\n      transitionStatus[which] = true;\n    }\n    if (\n      transitionStatus.update &&\n      transitionStatus.enter &&\n      transitionStatus.exit\n    ) {\n      cb(args);\n    }\n  };\n}\n\n\nfunction addMark(d3Selection, compSpec, before) {\n  return d3Selection\n    .insert(\"g\", before)\n    .attr(\"class\", `mark-${compSpec.type} role-mark ${compSpec.name}`);\n}\nfunction getSvgElmType(markType){\n  switch (markType) {\n  case \"rect\":\n  case \"symbol\":\n    return \"path\";\n  case \"rule\":\n    return \"line\";\n  case \"text\":\n    return \"text\";\n  default:\n\n  }\n}\nexport { markInterpolate };\n","import * as d3 from \"d3\";\nimport { propMap, getEaseFn, findAfterSibling, getJoinInfo, computeScale, isLinearMarktype } from \"../util.js\";\nimport { getPropVal, fetchAttributes} from \"../attributeFetcher\";\nimport { getStyle } from \"../vega-render-util.js\";\nimport { computeTiming, enumStepComputeTiming } from \"../timings\";\n\nfunction areaLineInterpolate(rawInfo, step, targetElm) {\n  const joinKey = (d, i, initialOrFinal) => {\n    return d.__gemini__ ?\n      getJoinInfo(d, i, step, \"joinKey\") :\n      ( typeof(step.computeDatumId) === \"function\"\n        ? step.computeDatumId(d, i)\n        : step.computeDatumId[initialOrFinal || \"final\"](d, i));\n  }; const joinSet = (d, i) => {\n    return d.__gemini__ ? getJoinInfo(d, i, step, \"animSet\") : undefined;\n  };\n  const MARK_ATTRS = {\n    area: [{ name: \"area\", tweaks: [] }],\n    line: [{ name: \"line\", tweaks: [] }],\n    trail: [{ name: \"trail\", tweaks: [] }]\n  };\n  const tweaks = [{ type: \"attrTween\", val: \"d\", interpolateStyle: \"update\" }];\n  const MARK_ATTRS_DATA_INTERPOLATE = {\n    area: [{ name: \"area\", tweaks}],\n    line: [{ name: \"line\", tweaks}],\n    trail: [{ name: \"trail\", tweaks}]\n  };\n\n\n  // Get Timing\n\n  const animVis = targetElm;\n  const eView = rawInfo.eVis.view;\n  const transitionStatus = {\n    update: false,\n    enter: false,\n    exit: false\n  };\n\n  function done(which, cb, args) {\n    if (which === \"all\") {\n      transitionStatus.update = transitionStatus.enter = transitionStatus.exit = true;\n    } else {\n      transitionStatus[which] = true;\n    }\n    if (\n      transitionStatus.update &&\n      transitionStatus.enter &&\n      transitionStatus.exit\n    ) {\n      cb(args);\n    }\n  }\n  function isAreaLineMarktype(marktype) {\n    return !!MARK_ATTRS[marktype];\n  }\n\n  return new Promise((resolve) => {\n    const timings = computeTiming(\n      step.currData,\n      step.nextData,\n      step.timing,\n      joinKey,\n      joinSet\n    );\n    const {change} = step;\n    const easeFn = getEaseFn(step.timing.ease);\n    const {marktypes} = step;\n\n    const isAdd = !change.initial && !!change.final,\n      isRemove = !!change.initial && !change.final;\n\n    let marktype;\n    if (\n      marktypes.initial &&\n      marktypes.final &&\n      marktypes.initial !== marktypes.final\n    ) {\n      if (change.marktype === false) {\n        marktype = marktypes.initial;\n      } else {\n        marktype = marktypes.final;\n      }\n    } else if (isRemove) {\n      marktype = marktypes.initial;\n    } else if (isAdd) {\n      marktype = marktypes.final;\n    } else {\n      marktype = marktypes.initial || marktypes.final;\n    }\n    const {hasFacet} = step;\n    // collect the scale objects to scale the initial/final values\n    const {scales} = step;\n    const {encodes} = step;\n    const {signals} = step;\n\n    if (isAdd || !isAreaLineMarktype(marktypes.initial)) {\n      if (hasFacet.final) {\n        const sib = findAfterSibling(\n          eView.scenegraph().root,\n          change.final.parent.name\n        );\n\n        addMark(\n          d3.select(`${animVis  } .${change.final.parent.parent.name} > g > g`),\n          change.final,\n          sib ? `.${sib.name}` : undefined,\n          { hasGroup: true }\n        );\n      } else {\n        const sib = findAfterSibling(eView.scenegraph().root, change.compName);\n\n        addMark(\n          d3.select(`${animVis  } .${change.final.parent.name} > g > g`),\n          change.final,\n          sib ? `.${sib.name}` : undefined\n        );\n      }\n    }\n\n    if (step.enumerator) {\n      let finalScaleNames = [];\n      if (change.scale === true) {\n        finalScaleNames = Object.keys(eView._runtime.scales);\n      } else if (Array.isArray(change.scale)) {\n        finalScaleNames = change.scale;\n      }\n\n\n      const {enumerator} = step;\n      const getValues = {\n        update: {\n          initial: (attr, getScales, d) => {\n            const computedScales = computeScale(scales, finalScaleNames, getScales);\n            return getPropVal(\n              attr,\n              encodes.initial.update,\n              computedScales.initial,\n              signals.initial,\n              d\n            );\n          },\n          final: (attr, getScales, d) => {\n            const computedScales = computeScale(scales, finalScaleNames, getScales);\n            return getPropVal(\n              attr,\n              encodes.final.update,\n              computedScales.final,\n              signals.final,\n              d\n            );\n          },\n          custom: (attr, getScales, d_i, d_f) => {\n            const pahtData = {\n              initial: d_i.items[0].items[0],\n              final: d_f.items[0].items[0]\n            };\n            const nuancedAttr = Object.assign({}, attr, {\n              interpolateStyle: \"update\"\n            });\n            const computedScales = computeScale(scales, finalScaleNames, getScales);\n\n            return getPropVal.bind(this)(\n              change.scale ? attr : nuancedAttr,\n              encodes.final.update,\n              change.scale ? computedScales : computedScales.final,\n              signals.final,\n              pahtData\n            );\n          }\n        },\n        enter: {\n          initial: (attr, getScales, d) => {\n            const computedScales = computeScale(scales, finalScaleNames, getScales);\n\n            return getPropVal(\n              attr,\n              encodes.initial.enter,\n              {\n                primary: computedScales.initial,\n                secondary: computedScales.final\n              },\n              signals.initial,\n              d\n            );\n          },\n          final: (attr, getScales, d) => {\n            const computedScales = computeScale(scales, finalScaleNames, getScales);\n            return getPropVal(\n              attr,\n              encodes.final.enter,\n              computedScales.final,\n              signals.final,\n              d\n            );\n          },\n          custom(attr, getScales, d_i, d_f){\n            let pahtData = {\n              initial: change.scale ? d_f.items[0].items[0] : { mark: { items:[] } },\n              final: d_f.items[0].items[0]\n            };\n            let nuancedAttr = Object.assign({}, attr, {interpolateStyle: \"update\"});\n            let computedScales = computeScale(scales, finalScaleNames, getScales);\n\n            return getPropVal.bind(this)(\n              change.scale ? attr : nuancedAttr,\n              encodes.final.update,\n              change.scale ? computedScales : computedScales.final,\n              signals.final,\n              pahtData);\n          }\n        },\n        exit: {\n          initial: (attr, getScales, d) => {\n            const computedScales = computeScale(scales, finalScaleNames, getScales);\n            return getPropVal(\n              attr,\n              encodes.initial.exit,\n              computedScales.initial,\n              signals.initial,\n              d\n            );\n          },\n          final: (attr, getScales, d) => {\n            const computedScales = computeScale(scales, finalScaleNames, getScales);\n            return getPropVal(\n              attr,\n              encodes.final.exit,\n              {\n                primary: computedScales.final,\n                secondary: computedScales.initial\n              },\n              signals.final,\n              d\n            );\n          },\n          custom: (attr, getScales, d_i) => {\n            const pahtData = {\n              initial: d_i.items[0].items[0],\n              final: change.scale\n                ? d_i.items[0].items[0]\n                : { mark: { items: [] } }\n            };\n\n            const computedScales = computeScale(scales, finalScaleNames, getScales);\n            const nuancedAttr = Object.assign({}, attr, {\n              interpolateStyle: \"update\"\n            });\n            return getPropVal.bind(this)(\n              change.scale ? attr : nuancedAttr,\n              encodes.final.exit,\n              change.scale ? computedScales : computedScales.initial,\n              signals.final,\n              pahtData\n            );\n          }\n        }\n      };\n      if (hasFacet.initial && hasFacet.final) {\n        // bind allKeys\n        let markGs = d3\n          .selectAll(animVis + ` .role-scope.${change.final.parent.name} > g`)\n          .attr(\"class\", \"__sub\");\n        markGs = d3\n          .select(animVis + ` .role-scope.${change.final.parent.name}`)\n          .selectAll(\".__sub\");\n        markGs = markGs.data(enumerator.allKeys, d => d);\n        markGs.exit().remove();\n        markGs = markGs.enter().append(\"g\");\n        markGs.append(\"path\").attr(\"class\", \"background\");\n\n        // append mark mark\n        let marks = markGs\n          .append(\"g\")\n          .append(\"g\")\n          .attr(\"class\", `${marktype}-mark role-mark ${change.compName}`)\n          .append(\"path\");\n\n        const initialMarks = marks.filter(\n          id => [\"update\", \"exit\"].indexOf(enumerator.set(id, 0)) >= 0\n        );\n        const allProps = MARK_ATTRS[marktype].reduce((acc, prop) => {\n          return acc.concat(propMap(prop));\n        }, []);\n\n        // init\n        allProps.forEach(p => {\n          if (p.type === \"attrTween\") {\n            const tempP = Object.assign({}, p, { type: \"attr\" });\n            initialMarks[tempP.type](getStyle(tempP.val), id =>\n              enumerator.getPropVal(tempP, getValues, 0, id)\n            );\n          } else {\n            initialMarks[p.type](getStyle(p.val), id =>\n              enumerator.getPropVal(p, getValues, 0, id)\n            );\n          }\n        });\n\n        const timings = enumStepComputeTiming(enumerator, step.timing);\n\n        marks = marks.transition();\n\n        allProps.forEach(p => {\n          if (p.type === \"attr\") {\n            marks.attrTween(p.val, function(d) {\n              return enumerator.interpolateAlongEnumMaker(\n                p,\n                getValues,\n                this\n              )(d);\n            });\n          } else if (p.type === \"attrTween\") {\n            marks.attrTween(p.val, function(d) {\n              return enumerator.interpolateAlongEnumMaker(\n                p,\n                getValues,\n                this\n              )(d);\n            });\n          } else if (p.type === \"text\") {\n            marks.tween(\"text\", function(d) {\n              const textInterpolator = enumerator.interpolateAlongEnumMaker(\n                p,\n                getValues,\n                this\n              )(d);\n              return function(t) {\n                this.innerHTML = textInterpolator(t);\n              };\n            });\n          } else if (p.type === \"style\") {\n            marks.styleTween(getStyle(p.val), function(d) {\n              return enumerator.interpolateAlongEnumMaker(\n                p,\n                getValues,\n                this\n              )(d);\n            });\n          }\n        });\n\n        // interpolate them\n        marks\n          .duration((d, i) => timings[i].duration)\n          .delay((d, i) => timings[i].delay)\n          .ease(easeFn)\n          .end()\n          .then(() => {\n            done(\"all\", () => {\n              resolve();\n            });\n          });\n      } else if (!hasFacet.initial && !hasFacet.final) {\n        let mark = d3\n          .select(animVis + ` .mark-${marktype}.role-mark.${change.compName}`)\n          .selectAll(\"path\");\n\n        mark = mark.data(enumerator.allKeys, d => d);\n        mark.exit().remove();\n        mark = mark.enter().append(\"path\");\n\n        const allProps = MARK_ATTRS[marktype].reduce((acc, prop) => {\n          return acc.concat(propMap(prop));\n        }, []);\n\n        // init\n        allProps.forEach(p => {\n          if (p.type === \"attrTween\") {\n            const tempP = Object.assign({}, p, { type: \"attr\" });\n            mark[tempP.type](getStyle(tempP.val), id =>\n              enumerator.getPropVal(tempP, getValues, 0, id)\n            );\n          } else {\n            mark[p.type](getStyle(p.val), id =>\n              enumerator.getPropVal(p, getValues, 0, id)\n            );\n          }\n        });\n\n        const timings = enumStepComputeTiming(enumerator, step.timing);\n\n        mark = mark.transition();\n\n        allProps.forEach(p => {\n          if (p.type === \"attr\") {\n            mark.attrTween(p.val, function(d) {\n              return enumerator.interpolateAlongEnumMaker(\n                p,\n                getValues,\n                this\n              )(d);\n            });\n          } else if (p.type === \"attrTween\") {\n            mark.attrTween(p.val, function(d) {\n              return enumerator.interpolateAlongEnumMaker(\n                p,\n                getValues,\n                this\n              )(d);\n            });\n          } else if (p.type === \"text\") {\n            mark.tween(\"text\", function(d) {\n              const textInterpolator = enumerator.interpolateAlongEnumMaker(\n                p,\n                getValues,\n                this\n              )(d);\n              return function(t) {\n                this.innerHTML = textInterpolator(t);\n              };\n            });\n          } else if (p.type === \"style\") {\n            mark.styleTween(getStyle(p.val), function(d) {\n              return enumerator.interpolateAlongEnumMaker(\n                p,\n                getValues,\n                this\n              )(d);\n            });\n          }\n        });\n\n        // interpolate them\n        mark\n          .duration((d, i) => timings[i].duration)\n          .delay((d, i) => timings[i].delay)\n          .ease(easeFn)\n          .end()\n          .then(() => {\n            done(\"all\", () => {\n              resolve();\n            });\n          });\n      }\n    } else if (marktypes.initial && !isAreaLineMarktype(marktypes.initial)) {\n      // when marktype changes from other marks to area/line mark\n\n      const setType = \"final\"; const marktype = marktypes.final;\n      const prevData = d3.local();\n\n      if (hasFacet.final) {\n        const timings = computeTiming(\n          step.groupedData,\n          step.nextData,\n          step.timing,\n          joinKey,\n          joinSet\n        );\n        let markGs = d3.selectAll(\n          animVis + ` .role-scope.${change.final.parent.name} > g`\n        );\n        markGs = d3\n          .select(`${animVis  } .role-scope.${change.final.parent.name}`)\n          .selectAll(`.role-scope.${change.final.parent.name} > g`)\n          .data(step.groupedData, (d, i) => joinKey(d, i, setType));\n\n        // append group mark\n        const enterIG = markGs.enter().append(\"g\");\n        enterIG.append(\"path\").attr(\"class\", \"background\");\n\n        // append mark mark\n        const enterIMark = enterIG\n          .append(\"g\")\n          .append(\"g\")\n          .attr(\"class\", `mark-${marktype} role-mark ${change.compName}`)\n          .append(\"path\");\n\n        fetchAttributes(\n          enterIMark,\n          MARK_ATTRS[marktype],\n          { primary: scales.initial, secondary: scales.final },\n          signals.initial,\n          encodes.final.intermediate\n        );\n\n        markGs = d3\n          .select(`${animVis  } .role-scope.${change.final.parent.name}`)\n          .selectAll(`.role-scope.${change.final.parent.name} > g`);\n\n        markGs.each(function(d) {\n          prevData.set(this, d);\n        });\n        markGs = markGs.data(step.nextData, (d, i) => joinKey(d, i, setType));\n\n        update(\n          timings,\n          markGs,\n          marktype,\n          {\n            initial: encodes.final.intermediate,\n            final: encodes.final.update\n          },\n          prevData\n        );\n\n        enter(timings, markGs, marktype);\n\n        done(\"exit\", () => resolve());\n      } else {\n        let mark = d3\n          .select(animVis + ` .mark-${marktype}.role-mark.${change.compName}`)\n          .selectAll(\"path\");\n        mark = mark.data(step.groupedData);\n\n        const enterI = mark.enter().append(\"path\");\n\n        fetchAttributes(\n          enterI,\n          MARK_ATTRS[marktype],\n          { primary: scales.initial, secondary: scales.final },\n          signals.initial,\n          encodes.final.intermediate\n        );\n\n        let enterF = d3\n          .select(\n            animVis + ` .mark-${marktypes.final}.role-mark.${change.compName}`\n          )\n          .selectAll(\"path\");\n        enterF.each(function(d) {\n          prevData.set(this, d);\n        });\n\n        enterF = enterF.data(step.nextData).transition();\n\n        fetchAttributes(\n          enterF,\n          MARK_ATTRS[marktypes.final], // MARK_ATTRS_DATA_INTERPOLATE[marktype],\n          scales,\n          signals.final,\n          encodes.final.update,\n          prevData\n        );\n\n        enterF\n          .duration(step.timing.duration)\n          .delay(step.timing.delay)\n          .ease(easeFn)\n          .end()\n          .then(() => {\n            done(\"all\", () => {resolve();});\n          });\n\n      }\n    } else if (marktypes.final && !isAreaLineMarktype(marktypes.final)) {\n      // when marktype changes from area/line to the other marktypes\n      // exit\n      const timings = computeTiming(\n        step.currData,\n        step.groupedData,\n        step.timing,\n        joinKey,\n        joinSet\n      );\n      const prevData = d3.local();\n      const setType = \"initial\"; const marktype = marktypes.initial;\n      if (hasFacet.initial) {\n        let markGs = d3.selectAll(\n          animVis + ` .role-scope.${change.initial.parent.name} > g`\n        );\n        markGs = d3\n          .select(`${animVis  } .role-scope.${change.initial.parent.name}`)\n          .selectAll(`.role-scope.${change.initial.parent.name} > g`);\n\n        markGs.each(function(d) {\n          prevData.set(this, d);\n        });\n        markGs = markGs.data(step.groupedData, (d, i) =>\n          joinKey(d, i, setType)\n        );\n\n        exit(\n          timings,\n          markGs,\n          marktype,\n          {\n            initial: encodes.initial.exit,\n            final: encodes.final.exit\n          },\n          prevData,\n          \"initial\"\n        );\n\n        update(\n          timings,\n          markGs,\n          marktype,\n          {\n            initial: encodes.initial.update,\n            final: encodes.initial.intermediate\n          },\n          prevData\n        );\n        done(\"enter\", () => resolve());\n      } else {\n        let mark = d3\n          .select(animVis + ` .mark-${marktype}.role-mark.${change.compName}`)\n          .selectAll(\"path\");\n        mark.each(function(d) {\n          prevData.set(this, d);\n        });\n        mark = mark.data(step.groupedData).transition();\n        // fade-out by the exit encoding\n\n        fetchAttributes(\n          mark,\n          MARK_ATTRS[marktype],\n          Object.assign({}, scales, {\n            primary: scales.final,\n            secondary: scales.initial\n          }),\n          signals.final,\n          {\n            initial: encodes.initial.update,\n            final: encodes.initial.intermediate\n          },\n          prevData\n        );\n\n        mark\n          .duration(step.duration)\n          .delay(step.delay)\n          .ease(easeFn)\n          // .remove()\n          .end()\n          .then(function() {\n            done(\"all\", () => {resolve();});\n          });\n      }\n    } else if ((isRemove || hasFacet.final) && (isAdd || hasFacet.initial)) {\n      // When adding or removing or changing marks with pathGroup\n      const parentName = isAdd\n        ? change.final.parent.name\n        : isRemove\n          ? change.initial.parent.name\n          : change.initial.type === marktypes.initial\n            ? change.initial.parent.name\n            : change.final.parent.name;\n      let markGs = d3\n        .selectAll(animVis + ` .role-scope.${parentName} > g`)\n        .attr(\"class\", \"__sub\");\n\n      markGs = d3\n        .select(animVis + ` .role-scope.${parentName}`)\n        .selectAll(\".__sub\");\n      const prevData = d3.local();\n      markGs.each(function(d) {\n        prevData.set(this, d);\n      });\n      if (change.data || isAdd || isRemove) {\n        markGs = markGs.data(step.nextData, (d, i) => joinKey(d, i));\n      }\n\n      // enter\n      // if (doEnter) {\n      enter(timings, markGs, marktypes.final); // , encodes.initial.enter, encodes.final.enter, \"final\")\n\n      // exit\n      // if (doExit) {\n      exit(\n        timings,\n        markGs,\n        marktypes.initial,\n        {\n          initial: encodes.initial.exit,\n          final: encodes.final.exit\n        },\n        prevData,\n        \"initial\"\n      );\n\n      // finalize update\n      // if (doUpdate) {\n\n      update(\n        timings,\n        markGs,\n        marktypes,\n        {\n          initial: encodes.initial.update,\n          final: encodes.final.update\n        },\n        prevData\n      );\n\n    } else if ((isRemove || !hasFacet.final) && (isAdd || !hasFacet.initial)) {\n      // When adding or removing or updating a single mark without pathgroup\n\n      const markG = d3.select(\n        animVis + ` .mark-${marktypes.initial}.role-mark.${change.compName}`\n      );\n      let mark = markG.selectAll(\"path\");\n      const prevData = d3.local();\n      mark.each(function(d) {\n        prevData.set(this, d);\n      });\n      if (change.data || isAdd || isRemove) {\n        mark = mark.data(step.nextData);\n      }\n\n      // enter\n\n      const enterI = mark.enter().append(\"path\");\n\n      fetchAttributes(\n        enterI,\n        MARK_ATTRS[marktype],\n        { primary: scales.initial, secondary: scales.final },\n        signals.initial,\n        encodes.initial.enter\n      );\n      if (enterI.data().length > 0) {\n        let enterF = enterI.transition();\n\n        fetchAttributes(\n          enterF,\n          MARK_ATTRS[marktype], // MARK_ATTRS_DATA_INTERPOLATE[marktype],\n          scales.final,\n          signals.final,\n          encodes.final.enter\n        );\n\n        enterF\n          .duration(step.timing.duration)\n          .delay(step.timing.delay)\n          .ease(easeFn)\n          .end()\n          .then(() => {\n            done(\"enter\", () => {resolve();});\n          });\n      } else {\n        done(\"enter\", () => {\n          resolve();\n        });\n      }\n\n\n      // exit\n\n      // initiate exit\n      const exitI = mark.exit();\n\n      if (exitI.data().length > 0) {\n        // finalize exit\n        const exitF = exitI.transition();\n\n        fetchAttributes(\n          exitF,\n          MARK_ATTRS[marktype], // MARK_ATTRS_DATA_INTERPOLATE[marktype],\n          { primary: scales.final, secondary: scales.initial },\n          signals.final,\n          encodes.final.exit\n        );\n\n        exitF\n          .duration((d, i) => step.timing.duration)\n          .delay((d, i) => step.timing.delay)\n          .ease(easeFn)\n          .end()\n          .then(function() {\n            done(\"exit\", () => {resolve();});\n          });\n      } else {\n        done(\"exit\", () => {\n          resolve();\n        });\n      }\n\n\n      // finalize update\n\n      if (mark.data().length > 0) {\n        if (marktypes.initial !== marktypes.final) {\n          markG.classed(`mark-${marktypes.initial}`, false);\n          markG.classed(`mark-${marktypes.final}`, true);\n        }\n\n        const updateF = mark.transition();\n\n        fetchAttributes(\n          updateF,\n          getProp(marktypes),\n          scales,\n          signals.final,\n          {\n            initial: encodes.initial.update,\n            final: encodes.final.update\n          },\n          prevData\n        );\n        updateF\n          .duration(step.timing.duration)\n          .delay(step.timing.delay)\n          .ease(easeFn)\n          .end()\n          .then(() => {\n            done(\"update\", () => {resolve();});\n          });\n      } else {\n        done(\"update\", () => {\n          resolve();\n        });\n      }\n\n\n    } else if (!hasFacet.initial && hasFacet.final) {\n      // single mark without pathgroup -> marks with pathgroup\n      const prevData = d3.local();\n\n      // Remove the single area\n      let exitMark = d3\n        .select(\n          animVis + ` .mark-${marktypes.initial}.role-mark.${change.compName}`\n        )\n        .selectAll(\"path\");\n      exitMark = exitMark\n        .each(function(d) {\n          prevData.set(this, d);\n        })\n        .transition();\n\n      fetchAttributes(\n        exitMark,\n        MARK_ATTRS[marktypes.initial], // MARK_ATTRS_DATA_INTERPOLATE[marktypes.initial],\n        Object.assign({}, scales, {\n          primary: scales.final,\n          secondary: scales.initial\n        }),\n        signals.final,\n        Object.assign({}, encodes.initial.exit, { opacity: { value: 0 } }),\n        prevData\n      );\n\n      exitMark\n        .duration((d, i) => timings.find(t => t.set === \"exit\").duration)\n        .delay((d, i) => timings.find(t => t.set === \"exit\").delay)\n        .ease(easeFn)\n        .remove()\n        .end()\n        .then(function() {\n          d3.select(`${animVis  } .mark-${marktypes.initial}.role-mark.${change.compName}`).remove();\n          done(\"exit\", () => {resolve();});\n        });\n\n      // Add pathgroup with marks\n      const {parent} = change.final;\n      const sib = findAfterSibling(eView.scenegraph().root, parent.name);\n\n      addMark(\n        d3.select(`${animVis  } .${parent.parent.name} > g > g`),\n        change.final,\n        sib ? `.${sib.name}` : undefined,\n        { hasGroup: true }\n      );\n\n      const markGs = d3\n        .select(animVis + ` .role-scope.${parent.name}`)\n        .selectAll(\"g\")\n        .data(step.nextData);\n\n      // append group mark\n      const enterIG = markGs.enter().append(\"g\");\n      enterIG.append(\"path\").attr(\"class\", \"background\");\n      // d (rect)\n      // fill (none)\n\n      // append mark mark\n      const enterIMark = enterIG\n        .append(\"g\")\n        .append(\"g\")\n        .attr(\"class\", `${marktypes.final}-mark role-mark ${change.compName}`)\n        .append(\"path\");\n\n      fetchAttributes(\n        enterIMark,\n        MARK_ATTRS[marktypes.final],\n        { primary: scales.initial, secondary: scales.final },\n        signals.initial,\n        Object.assign({}, encodes.final.enter, { opacity: { value: 0 } })\n        // encodes.initial.enter\n      );\n\n      const enterFMark = enterIMark\n        .each(function(d) {\n          prevData.set(this, d);\n        })\n        .transition();\n\n      fetchAttributes(\n        enterFMark,\n        MARK_ATTRS[marktypes.final],\n        scales,\n        signals.final,\n        encodes.final.enter,\n        prevData\n      );\n\n      enterFMark\n        .duration(\n          (d, i) => timings.find(t => t.id === joinKey(d, i, \"final\")).duration\n        )\n        .delay(\n          (d, i) => timings.find(t => t.id === joinKey(d, i, \"final\")).delay\n        )\n        .ease(easeFn)\n        .end()\n        .then(() => {\n          done(\"enter\", () => {resolve();});\n        });\n      done(\"update\", () => {\n        resolve();\n      });\n    } else if (hasFacet.initial && !hasFacet.final) {\n      // marks with pathgroup -> single mark without pathgroup\n\n      const {parent} = change.initial,\n        prevData = d3.local();\n      // Remove the pathgroup and the marks\n\n      let exitMarks = d3\n        .select(animVis + ` .role-scope.${parent.name}`)\n        .selectAll(` .role-scope.${parent.name} > g`)\n        .data(step.currData)\n        .select(`.${change.compName} > path`)\n        .each(function(d) {\n          prevData.set(this, d);\n        });\n\n      exitMarks = exitMarks.transition();\n\n      fetchAttributes(\n        exitMarks,\n        // MARK_ATTRS_DATA_INTERPOLATE[marktype],\n        MARK_ATTRS[marktypes.initial],\n        Object.assign({}, scales, {\n          primary: scales.final,\n          secondary: scales.initial\n        }),\n        signals.final,\n        Object.assign({}, encodes.initial.exit, { opacity: { value: 0 } }),\n        prevData\n      );\n\n      exitMarks\n        .duration(\n          (d, i) =>\n            timings.find(t => t.id === joinKey(d, i, \"initial\")).duration\n        )\n        .delay(\n          (d, i) => timings.find(t => t.id === joinKey(d, i, \"initial\")).delay\n        )\n        .ease(easeFn)\n        .remove()\n        .end()\n        .then(function() {\n          done(\"exit\", () => {resolve();});\n        });\n\n      // Add the single area\n      const sib = findAfterSibling(eView.scenegraph().root, change.compName);\n\n      let enterIMark = addMark(\n        d3.select(`${animVis  } .${change.final.parent.name} > g > g`),\n        change.final,\n        sib ? `.${sib.name}` : undefined\n      );\n\n      enterIMark = enterIMark\n        .selectAll(\"path\")\n        .data(step.nextData)\n        .enter()\n        .append(\"path\");\n\n      fetchAttributes(\n        enterIMark,\n        MARK_ATTRS[marktypes.final],\n        { primary: scales.initial, secondary: scales.final },\n        signals.initial,\n        Object.assign({}, encodes.final.enter, { opacity: { value: 0 } })\n      );\n\n      enterIMark.each(function(d) {\n        prevData.set(this, d);\n      });\n      const enterF = enterIMark.transition();\n\n      fetchAttributes(\n        enterF,\n        MARK_ATTRS[marktypes.final],\n        scales,\n        signals.final,\n        encodes.final.enter,\n        prevData\n      );\n\n      enterF\n        .duration((d, i) => timings.find(t => t.set === \"enter\").duration)\n        .delay((d, i) => timings.find(t => t.set === \"enter\").delay)\n        .ease(easeFn)\n        .end()\n        .then(() => {\n          done(\"enter\", () => {resolve();});\n        });\n      done(\"update\", () => {\n        resolve();\n      });\n    }\n\n    function getProp(marktypes) {\n      const marktype =\n        typeof marktypes === \"string\" ? marktypes : marktypes.final;\n      const props = change.data && (isLinearMarktype(marktype)) ?\n        MARK_ATTRS_DATA_INTERPOLATE[marktype] :\n        MARK_ATTRS[marktype];\n      if (\n        isAreaLineMarktype(marktypes.initial) &&\n        isAreaLineMarktype(marktypes.final) &&\n        marktypes.final !== marktypes.initial\n      ) {\n        props[0].tweaks.push({\n          type: \"attrTween\",\n          val: \"d\",\n          initialMarktype: marktypes.initial,\n          interpolateStyle: \"update\"\n        });\n        props[0].tweaks.push({\n          type: \"style\",\n          val: \"fill\",\n          initialMarktype: marktypes.initial,\n          asTween: true\n        });\n        props[0].tweaks.push({\n          type: \"style\",\n          val: \"stroke\",\n          initialMarktype: marktypes.initial\n        });\n      }\n      return props;\n    }\n    function exit(\n      timings,\n      markGs,\n      marktype,\n      encodes,\n      prevData,\n      setType,\n      isAllDone = false\n    ) {\n      // initiate exit\n      let exitI = markGs.exit();\n\n      // If they are already entered,\n      if (exitI.data().length === 0 || !(change.data || isAdd || isRemove)) {\n        exitI = markGs.filter(d => joinSet(d) === \"exit\");\n      }\n      if (exitI.data().length > 0) {\n        const exitIMark = exitI.select(`.${change.compName} > path`);\n\n        // finalize exit\n        const exitFMark = exitIMark.transition();\n\n        fetchAttributes(\n          exitFMark,\n          MARK_ATTRS[marktype],\n          Object.assign({}, scales, {\n            primary: scales.final,\n            secondary: scales.initial\n          }),\n          signals.final,\n          encodes,\n          prevData\n        );\n\n        exitFMark\n          .duration(\n            (d, i) =>\n              timings.find(t => t.id === joinKey(d, i, setType)).duration\n          )\n          .delay(\n            (d, i) => timings.find(t => t.id === joinKey(d, i, setType)).delay\n          )\n          .ease(easeFn)\n          .remove()\n          .end()\n          .then(function() {\n            exitI.remove();\n            done(isAllDone ? \"all\" : \"exit\", () => {resolve();});\n          });\n      } else {\n        done(isAllDone ? \"all\" : \"exit\", () => {\n          resolve();\n        });\n      }\n    }\n    function update(timings, markGs, marktypes, encodes, prevData) {\n      let updateF = markGs.filter(d => joinSet(d) === \"update\");\n\n      if (change.data === false && updateF.data().length === 0) {\n        updateF = markGs;\n      }\n      let updateFMark = updateF.select(`.${change.compName}`);\n      if (marktypes.initial !== marktypes.final) {\n        updateFMark.classed(`mark-${marktypes.initial}`, false);\n        updateFMark.classed(`mark-${marktypes.final}`, true);\n      }\n      updateFMark = updateFMark.select(\"path\");\n      if (updateFMark.data().length > 0) {\n        updateFMark = updateFMark.transition();\n        const props = getProp(marktypes);\n        fetchAttributes(\n          updateFMark,\n          props,\n          // change.data ? MARK_ATTRS_DATA_INTERPOLATE[marktype] : MARK_ATTRS[marktype],\n          scales,\n          signals.final,\n          encodes,\n          prevData\n        );\n        updateFMark\n          .duration(\n            (d, i) => timings.find(t => t.id === joinKey(d, i)).duration\n          )\n          .delay((d, i) => timings.find(t => t.id === joinKey(d, i)).delay)\n          .ease(easeFn)\n          .end()\n          .then(() => {\n            done(\"update\", () => {resolve();});\n          });\n      } else {\n        done(\"update\", () => {\n          resolve();\n        });\n      }\n    }\n    function enter(\n      timings,\n      markGs,\n      marktype,\n      encodeInitial = encodes.initial.enter,\n      encode = encodes.final.enter\n    ) {\n      // append group mark\n      const enterIG = markGs.enter().append(\"g\");\n      enterIG.append(\"path\").attr(\"class\", \"background\");\n\n      // append mark mark\n      let enterIMark = enterIG\n        .append(\"g\")\n        .append(\"g\")\n        .attr(\"class\", `mark-${marktype} role-mark ${change.compName}`)\n        .append(\"path\");\n\n      fetchAttributes(\n        enterIMark,\n        MARK_ATTRS[marktype],\n        { primary: scales.initial, secondary: scales.final },\n        signals.initial,\n        encodeInitial\n      );\n\n      // If they are already entered,\n      if (enterIG.data().length === 0 || !(change.data || isAdd || isRemove)) {\n        enterIMark = markGs\n          .filter(d => joinSet(d) === \"enter\")\n          .selectAll(`.${change.compName} > path`);\n      }\n\n      if (enterIMark.data().length > 0) {\n        const prevData = d3.local();\n        enterIMark.each(function(d) {\n          prevData.set(this, d);\n        });\n        const enterFMark = enterIMark.transition();\n\n        fetchAttributes(\n          enterFMark,\n          // MARK_ATTRS_DATA_INTERPOLATE[marktype],\n          MARK_ATTRS[marktype],\n          scales,\n          signals.final,\n          encode,\n          prevData\n        );\n\n        enterFMark\n          .duration(\n            (d, i) =>\n              timings.find(t => t.id === joinKey(d, i, \"final\")).duration\n          )\n          .delay(\n            (d, i) => timings.find(t => t.id === joinKey(d, i, \"final\")).delay\n          )\n          .ease(easeFn)\n          .end()\n          .then(() => {\n            done(\"enter\", () => {resolve();});\n          });\n      } else {\n        done(\"enter\", () => {\n          resolve();\n        });\n      }\n    }\n  });\n\n}\nfunction addMark (d3Selection, compSpec, before, opt = {}) {\n  if (opt.hasGroup) {\n    return d3Selection.insert(\"g\", before)\n      .attr(\"class\", `mark-group role-scope ${compSpec.parent.name}`);\n  }\n  return d3Selection.insert(\"g\", before)\n    .attr(\"class\", `mark-${compSpec.type} role-mark ${compSpec.name}`);\n\n}\n\nexport { areaLineInterpolate };\n","import * as d3 from \"d3\";\nimport {\n  propMap,\n  getEaseFn,\n  findAfterSibling,\n  getJoinInfo,\n  findComp,\n  computeScale\n} from \"./util\";\nimport { fetchAttributes, getPropVal } from \"./attributeFetcher\";\nimport { getStyle, transformItem } from \"./vega-render-util\";\nimport { copy } from \"../util/util\";\nimport { computeTiming, enumStepComputeTiming } from \"./timings\";\nimport { DEFAULT_ENCODE } from \"../default\";\n\nconst INITIAL_STATUS = {\n  update: false,\n  enter: false,\n  exit: false\n};\n\nfunction addAxis(d3Selection, newAxisScene, prior) {\n  const scName = newAxisScene.name;\n  const axisSubG = d3Selection\n    .insert(\"g\", prior)\n    .attr(\"class\", `mark-group role-axis ${scName}`)\n    .append(\"g\")\n    .attr(\"transform\", transformItem(newAxisScene.items[0]));\n\n  const { datum } = newAxisScene.items[0];\n  if (datum.ticks) {\n    axisSubG.append(\"g\").attr(\"class\", \"mark-rule role-axis-tick\");\n  }\n  if (datum.labels) {\n    axisSubG.append(\"g\").attr(\"class\", \"mark-text role-axis-label\");\n  }\n  if (datum.grid) {\n    axisSubG.append(\"g\").attr(\"class\", \"mark-rule role-axis-grid\");\n  }\n  if (datum.domain) {\n    axisSubG.append(\"g\").attr(\"class\", \"mark-rule role-axis-domain\");\n  }\n  if (datum.title) {\n    axisSubG.append(\"g\").attr(\"class\", \"mark-text role-axis-title\");\n  }\n\n  return d3Selection;\n}\n\nfunction doneMaker(subComponents) {\n  const transitionStatus = subComponents.reduce((acc, curr) => {\n    acc[curr] = copy(INITIAL_STATUS);\n    return acc;\n  }, {});\n\n  return function(which, cb) {\n    if (which.length === 2) {\n      if (which[1] === \"all\") {\n        transitionStatus[which[0]].exit = true;\n        transitionStatus[which[0]].enter = true;\n        transitionStatus[which[0]].update = true;\n      } else {\n        transitionStatus[which[0]][which[1]] = true;\n      }\n    } else if (which === \"all\") {\n      transitionStatus.update = true;\n      transitionStatus.enter = true;\n      transitionStatus.exit = true;\n    } else {\n      transitionStatus[which] = true;\n    }\n\n    const allDone = Object.keys(transitionStatus).reduce((acc, key) => {\n      return (\n        acc &&\n        transitionStatus[key].update &&\n        transitionStatus[key].enter &&\n        transitionStatus[key].exit\n      );\n    }, true);\n    if (allDone) {\n      cb();\n    }\n  };\n}\nfunction axisInterpolate(rawInfo, step, targetElm) {\n  function joinKeyGen(subcomp) {\n    return (d, i, initialOrFinal = \"initial\") => {\n      if (!d) {\n        return i.toString();\n      }\n      if (!d.__gemini__) {\n        return typeof step.computeDatumId[subcomp] === \"function\"\n          ? step.computeDatumId[subcomp](d, i)\n          : step.computeDatumId[subcomp][initialOrFinal](d, i);\n        // return step.computeDatumId[subcomp](d, i);\n      }\n      return getJoinInfo(d, i, step, \"joinKey\");\n    };\n  }\n  const joinSet = (d, i) => getJoinInfo(d, i, step, \"animSet\");\n  const animVis = targetElm;\n  const eView = rawInfo.eVis.view;\n\n  const done = doneMaker([\"tick\", \"label\", \"grid\", \"title\", \"domain\"]);\n\n  return new Promise(resolve => {\n    // Mark Interpolate Data\n\n    const { change } = step;\n    const easeFn = getEaseFn(step.timing.ease);\n\n    let defaultDo = true;\n    if (change.encode === false) {\n      defaultDo = false;\n    }\n    let doTicks = defaultDo;\n    let doLabels = defaultDo;\n    let doAxisG = defaultDo;\n    let doTitle = defaultDo;\n    let doDomain = defaultDo;\n    let doGrid = defaultDo;\n\n    if (change.encode) {\n      doTicks = !(change.encode.ticks === false);\n      doLabels = !(change.encode.labels === false);\n      doAxisG = !(change.encode.axis === false);\n      doTitle = !(change.encode.title === false);\n      doGrid = !(change.encode.grid === false);\n      doDomain = !(change.encode.domain === false);\n    }\n\n    let isRemove = false;\n    let axis = d3.selectAll(`${animVis} .role-axis.${change.compName}`);\n\n    const scName = change.compName;\n    // collect the scale objects to scale the initial/final values\n    const { scales } = step;\n    const { signals } = step;\n\n    // Add Axis\n    if (change.initial === null) {\n      // todo: find where-to-add d3Selection by searching eView.scenegraph\n      const rootMark = d3.select(`${animVis} .mark-group.root g g `);\n      const rootScene = eView.scenegraph().root;\n      const sib = findAfterSibling(rootScene, change.compName);\n      addAxis(\n        rootMark,\n        findComp(rootScene, scName, \"axis\")[0],\n        sib ? `.${sib.name}` : undefined\n      );\n      axis = d3.selectAll(`${animVis} .role-axis.${change.compName}`);\n    } else if (change.final === null) {\n      // Remove Axis\n      isRemove = true;\n    }\n\n    // update axis group\n    if (isRemove) {\n      const manualEncode =\n        change.encode && change.encode.axis ? change.encode.axis.exit : {};\n      const axisG = axis.select(\"g\");\n      const fAxisG = axisG.transition();\n      fetchAttributes(\n        fAxisG,\n        [\"group\"],\n        scales.final,\n        signals.final,\n        Object.assign({}, DEFAULT_ENCODE.axis.axis.exit, manualEncode)\n      );\n      fAxisG.duration(step.duration);\n    } else if (doAxisG) {\n      const axisG = axis.select(\"g\");\n      axisG.data(step.nextData.axis);\n      const fAxisG = axisG.transition();\n      fetchAttributes(\n        fAxisG,\n        [\"group\"],\n        scales.final,\n        signals.final,\n        step.encodes.axis.final.update\n      );\n      fAxisG\n        .delay(step.delay)\n        .duration(step.duration)\n        .ease(easeFn);\n    }\n\n    function calculateGetValues(encodes) {\n      return {\n        update: {\n          initial: (attr, getScales, d) => {\n            const computedScales = computeScale(scales, [scName], getScales);\n            return getPropVal(\n              attr,\n              encodes.initial.update,\n              computedScales.initial,\n              signals.initial,\n              d\n            );\n          },\n          final: (attr, getScales, d) => {\n            const computedScales = computeScale(scales, [scName], getScales);\n            return getPropVal(\n              attr,\n              encodes.final.update,\n              computedScales.final,\n              signals.final,\n              d\n            );\n          }\n        },\n        enter: {\n          initial: (attr, getScales, d) => {\n            const computedScales = computeScale(scales, [scName], getScales);\n\n            return getPropVal(\n              attr,\n              encodes.initial.enter,\n              computedScales.initial[scName]\n                ? computedScales.initial\n                : computedScales.final,\n              signals.initial,\n              d\n            );\n          },\n          final: (attr, getScales, d) => {\n            const computedScales = computeScale(scales, [scName], getScales);\n            return getPropVal(\n              attr,\n              encodes.final.enter,\n              computedScales.final,\n              signals.final,\n              d\n            );\n          }\n        },\n        exit: {\n          initial: (attr, getScales, d) => {\n            const computedScales = computeScale(scales, [scName], getScales);\n            return getPropVal(\n              attr,\n              encodes.initial.exit,\n              computedScales.initial,\n              signals.initial,\n              d\n            );\n          },\n          final: (attr, getScales, d) => {\n            const computedScales = computeScale(scales, [scName], getScales);\n            return getPropVal(\n              attr,\n              encodes.final.exit,\n              computedScales.final,\n              signals.final,\n              d\n            );\n          }\n        }\n      };\n    }\n    // update tick\n    if (doTicks) {\n      const tickG = axis.selectAll(\".role-axis-tick\");\n      const encodes = step.encodes.ticks;\n\n      const TICK_ATTRS = [\"tick\"];\n\n      if (step.enumerator) {\n        const enumerator = step.enumerator.tick;\n        const getValues = calculateGetValues(encodes);\n        // bind allKeys\n        const newBoundTicks = tickG\n          .selectAll(\"line\")\n          .data(enumerator.allKeys, d => d);\n        newBoundTicks.exit().remove();\n        newBoundTicks.enter().append(\"line\");\n        const allProps = TICK_ATTRS.reduce((acc, prop) => {\n          return acc.concat(propMap(prop));\n        }, []);\n        const initialTicks = tickG\n          .selectAll(\"line\")\n          .filter(id => [\"update\", \"exit\"].indexOf(enumerator.set(id, 0)) >= 0);\n        allProps.forEach(p => {\n          if (p.type === \"attrTween\") {\n            const tempP = Object.assign({}, p, { type: \"attr\" });\n            initialTicks[tempP.type](getStyle(tempP.val), id =>\n              enumerator.getPropVal(tempP, getValues, 0, id)\n            );\n          } else if (p.type === \"text\") {\n            initialTicks[p.type](id =>\n              enumerator.getPropVal(p, getValues, 0, id)\n            );\n          } else {\n            initialTicks[p.type](getStyle(p.val), id =>\n              enumerator.getPropVal(p, getValues, 0, id)\n            );\n          }\n        });\n\n        const timings = enumStepComputeTiming(enumerator, step.timing);\n        const ticks = tickG.selectAll(\"line\").transition();\n\n        allProps.forEach(p => {\n          if (p.type === \"attr\") {\n            ticks.attrTween(p.val, d => {\n              return enumerator.interpolateAlongEnumMaker(p, getValues)(d);\n            });\n          } else if (p.type === \"text\") {\n            ticks.tween(\"text\", function(d) {\n              const textInterpolator = enumerator.interpolateAlongEnumMaker(\n                p,\n                getValues\n              )(d);\n              return function(t) {\n                this.innerHTML = textInterpolator(t);\n              };\n            });\n          } else if (p.type === \"style\") {\n            ticks.styleTween(getStyle(p.val), d => {\n              return enumerator.interpolateAlongEnumMaker(p, getValues)(d);\n            });\n          }\n        });\n\n        // interpolate them\n        ticks\n          .duration((d, i) => timings[i].duration)\n          .delay((d, i) => timings[i].delay)\n          .ease(easeFn)\n          .end()\n          .then(() => {\n            done([\"tick\", \"all\"], () => {\n              resolve();\n            });\n          });\n      } else {\n        let ticks = tickG.selectAll(\"line\");\n        const currData = step.currData.tick;\n        const newData = step.nextData.tick;\n        const joinKey = joinKeyGen(\"tick\");\n        const timings = computeTiming(\n          currData,\n          newData,\n          step.timing,\n          joinKey,\n          joinSet\n        );\n\n        ticks = ticks.data(newData, d => joinKey(d));\n        let enterTicksI = ticks.enter().append(\"line\");\n        fetchAttributes(\n          enterTicksI,\n          TICK_ATTRS,\n          step.sameDomainDimension\n            ? { primary: scales.initial, secondary: scales.final }\n            : { primary: scales.final, secondary: scales.initial },\n          signals.initial,\n          encodes.initial.enter\n        );\n\n        if (enterTicksI.data().length <= 0) {\n          enterTicksI = ticks.filter(d => joinSet(d) === \"enter\");\n        }\n\n        const enterTicksF = enterTicksI.transition();\n        fetchAttributes(\n          enterTicksF,\n          TICK_ATTRS,\n          scales.final,\n          signals.final,\n          encodes.final.enter\n        );\n        enterTicksF\n          .duration(\n            (d, i) =>\n              timings.find(t => t.id === joinKey(d, i, \"final\")).duration\n          )\n          .delay(\n            (d, i) => timings.find(t => t.id === joinKey(d, i, \"final\")).delay\n          )\n          .ease(easeFn)\n          .end()\n          .then(done([\"tick\", \"enter\"], () => resolve()));\n\n        let exitTicksI = ticks.exit();\n        if (exitTicksI.data().length <= 0) {\n          exitTicksI = ticks.filter(d => joinSet(d) === \"exit\");\n        }\n\n        const exitTicksF = exitTicksI.transition();\n        fetchAttributes(\n          exitTicksF,\n          TICK_ATTRS,\n          // scales.final[scName] ? scales.final : scales.initial,\n          step.sameDomainDimension\n            ? { primary: scales.final, secondary: scales.initial }\n            : { primary: scales.initial, secondary: scales.final }, // { primary: scales.final, secondary: scales.initial },\n          signals.final,\n          encodes.final.exit\n        );\n        exitTicksF\n          .duration(\n            (d, i) =>\n              timings.find(t => t.id === joinKey(d, i, \"initial\")).duration\n          )\n          .delay(\n            (d, i) => timings.find(t => t.id === joinKey(d, i, \"initial\")).delay\n          )\n          .ease(easeFn)\n          .remove()\n          .end()\n          .then(done([\"tick\", \"exit\"], () => resolve()));\n\n        if (true && ticks.data().length > 0) {\n          ticks = ticks.filter(d => joinSet(d) === \"update\").transition();\n          // finalize the update set of the ticks\n          fetchAttributes(\n            ticks,\n            TICK_ATTRS,\n            scales.final,\n            signals.final,\n            encodes.final.update\n          );\n\n          ticks\n            .duration(\n              (d, i) => timings.find(t => t.id === joinKey(d, i)).duration\n            )\n            .delay((d, i) => timings.find(t => t.id === joinKey(d, i)).delay)\n            .ease(easeFn)\n            .end()\n            .then(done([\"tick\", \"update\"], () => resolve()));\n        } else {\n          done([\"tick\", \"update\"], () => resolve());\n        }\n      }\n    } else {\n      done([\"tick\", \"enter\"], () => resolve());\n      done([\"tick\", \"exit\"], () => resolve());\n      done([\"tick\", \"update\"], () => resolve());\n    }\n\n    // update label\n    const labelG = axis.selectAll(\".role-axis-label\");\n\n    const LABEL_ATTRS = [\"text\", \"align\"];\n    // const LABEL_ATTRS = [ \"text\" ];\n\n    if (!labelG.empty() && doLabels) {\n      const encodes = step.encodes.labels;\n\n      if (step.enumerator) {\n        const enumerator = step.enumerator.label;\n\n        const getValues = calculateGetValues(encodes);\n        // bind allKeys\n        const newBoundLabels = labelG\n          .selectAll(\"text\")\n          .data(enumerator.allKeys, d => d);\n        newBoundLabels.exit().remove();\n        newBoundLabels.enter().append(\"text\");\n        const allProps = LABEL_ATTRS.reduce((acc, prop) => {\n          return acc.concat(propMap(prop));\n        }, []);\n        const initialLabels = labelG\n          .selectAll(\"text\")\n          .filter(id => [\"update\", \"exit\"].indexOf(enumerator.set(id, 0)) >= 0);\n        allProps.forEach(p => {\n          if (p.type === \"attrTween\") {\n            const tempP = Object.assign({}, p, { type: \"attr\" });\n            initialLabels[tempP.type](getStyle(tempP.val), id =>\n              enumerator.getPropVal(tempP, getValues, 0, id)\n            );\n          } else if (p.type === \"text\") {\n            initialLabels[p.type](id =>\n              enumerator.getPropVal(p, getValues, 0, id)\n            );\n          } else {\n            initialLabels[p.type](getStyle(p.val), id =>\n              enumerator.getPropVal(p, getValues, 0, id)\n            );\n          }\n        });\n\n        const labels = labelG.selectAll(\"text\").transition();\n        const timings = enumStepComputeTiming(enumerator, step.timing);\n        allProps.forEach(p => {\n          if (p.type === \"attr\") {\n            labels.attrTween(p.val, d => {\n              return enumerator.interpolateAlongEnumMaker(p, getValues)(d);\n            });\n          } else if (p.type === \"text\") {\n            labels.tween(\"text\", function(d) {\n              const textInterpolator = enumerator.interpolateAlongEnumMaker(\n                p,\n                getValues\n              )(d);\n              return function(t) {\n                this.innerHTML = textInterpolator(t);\n              };\n            });\n          } else if (p.type === \"style\") {\n            labels.styleTween(getStyle(p.val), d => {\n              return enumerator.interpolateAlongEnumMaker(p, getValues)(d);\n            });\n          }\n        });\n\n        // interpolate them\n        labels\n          .duration((d, i) => timings[i].duration)\n          .delay((d, i) => timings[i].delay)\n          .ease(easeFn)\n          .end()\n          .then(() => {\n            done([\"label\", \"all\"], () => {\n              resolve();\n            });\n          });\n      } else {\n        let labels = labelG.selectAll(\"text\");\n        const currData = step.currData.label;\n        const newData = step.nextData.label;\n        const joinKey = joinKeyGen(\"label\");\n        const timings = computeTiming(\n          currData,\n          newData,\n          step.timing,\n          joinKey,\n          joinSet\n        );\n        const prevData = d3.local();\n        labels.each(function(d) {\n          prevData.set(this, d);\n        });\n        labels = labels.data(newData, d => joinKey(d));\n\n        let enterLabelI = labels.enter().append(\"text\");\n        fetchAttributes(\n          enterLabelI,\n          LABEL_ATTRS,\n          step.sameDomainDimension\n            ? { primary: scales.initial, secondary: scales.final }\n            : { primary: scales.final, secondary: scales.initial }, // { primary: scales.final, secondary: scales.initial },\n          signals.initial,\n          encodes.initial.enter\n        );\n\n        // entered labels\n\n        if (enterLabelI.data().length <= 0) {\n          enterLabelI = labels.filter(d => joinSet(d) === \"enter\");\n        }\n\n        const enterLabelF = enterLabelI.transition();\n        fetchAttributes(\n          enterLabelF,\n          LABEL_ATTRS,\n          scales.final,\n          signals.final,\n          encodes.final.enter\n        );\n        enterLabelF\n          .duration(\n            (d, i) =>\n              timings.find(t => t.id === joinKey(d, i, \"final\")).duration\n          )\n          .delay(\n            (d, i) => timings.find(t => t.id === joinKey(d, i, \"final\")).delay\n          )\n          .ease(easeFn)\n          .end()\n          .then(done([\"label\", \"enter\"], () => resolve()));\n\n        // exit labels\n        let exitLabelI = labels.exit();\n        if (exitLabelI.data().length <= 0) {\n          exitLabelI = labels.filter(d => joinSet(d) === \"exit\");\n        }\n\n        const exitLabelF = exitLabelI.transition();\n        fetchAttributes(\n          exitLabelF,\n          LABEL_ATTRS,\n          step.sameDomainDimension\n            ? { primary: scales.final, secondary: scales.initial }\n            : { primary: scales.initial, secondary: scales.final }, // { primary: scales.final, secondary: scales.initial },\n          signals.final,\n          encodes.final.exit,\n          prevData\n        );\n        exitLabelF\n          .duration(\n            (d, i) =>\n              timings.find(t => t.id === joinKey(d, i, \"initial\")).duration\n          )\n          .delay(\n            (d, i) => timings.find(t => t.id === joinKey(d, i, \"initial\")).delay\n          )\n          .ease(easeFn)\n          .remove()\n          .end()\n          .then(done([\"label\", \"exit\"], () => resolve()));\n\n        // Todo update labels!!\n        if (true && labels.data().length > 0) {\n          labels = labels.filter(d => joinSet(d) === \"update\").transition();\n          // finalize the update set of the labels\n          fetchAttributes(\n            labels,\n            LABEL_ATTRS,\n            scales.final,\n            signals.final,\n            encodes.final.update,\n            prevData\n          );\n\n          labels\n            .duration(\n              (d, i) => timings.find(t => t.id === joinKey(d, i)).duration\n            )\n            .delay((d, i) => timings.find(t => t.id === joinKey(d, i)).delay)\n            .ease(easeFn)\n            .end()\n            .then(done([\"label\", \"update\"], () => resolve()));\n        } else {\n          done([\"label\", \"update\"], () => resolve());\n        }\n      }\n    } else {\n      done([\"label\", \"enter\"], () => resolve());\n      done([\"label\", \"exit\"], () => resolve());\n      done([\"label\", \"update\"], () => resolve());\n    }\n\n    // update grid\n    let gridG = axis.selectAll(\".role-axis-grid\");\n    const GRID_ATTRS = [\"grid\"];\n\n    if (\n      (!step.change.initial || step.change.initial.grid === false) &&\n      step.change.final &&\n      step.change.final.grid === true\n    ) {\n      // add grid\n      gridG = axis\n        .select(\"g\")\n        .select(\"g\")\n        .append(\"g\")\n        .attr(\"class\", \"mark-rule role-axis-grid\");\n    }\n    if (!gridG.empty() && doGrid) {\n      const encodes = step.encodes.grid;\n\n      if (step.enumerator) {\n        const enumerator = step.enumerator.grid;\n\n        const getValues = calculateGetValues(encodes);\n\n        // bind allKeys\n        const newBoundGrids = gridG\n          .selectAll(\"line\")\n          .data(enumerator.allKeys, d => d);\n        newBoundGrids.exit().remove();\n        newBoundGrids.enter().append(\"line\");\n        const initialGrids = gridG\n          .selectAll(\"line\")\n          .filter(id => [\"update\", \"exit\"].indexOf(enumerator.set(id, 0)) >= 0);\n        // init\n        const allProps = GRID_ATTRS.reduce((acc, prop) => {\n          return acc.concat(propMap(prop));\n        }, []);\n\n        allProps.forEach(p => {\n          if (p.type === \"attrTween\") {\n            const tempP = Object.assign({}, p, { type: \"attr\" });\n            initialGrids[tempP.type](getStyle(tempP.val), id =>\n              enumerator.getPropVal(tempP, getValues, 0, id)\n            );\n          } else if (p.type === \"text\") {\n            initialGrids[p.type](id =>\n              enumerator.getPropVal(p, getValues, 0, id)\n            );\n          } else {\n            initialGrids[p.type](getStyle(p.val), id =>\n              enumerator.getPropVal(p, getValues, 0, id)\n            );\n          }\n        });\n\n        const grids = gridG.selectAll(\"line\").transition();\n        const timings = enumStepComputeTiming(enumerator, step.timing);\n\n        allProps.forEach(p => {\n          if (p.type === \"attr\") {\n            grids.attrTween(p.val, d => {\n              return enumerator.interpolateAlongEnumMaker(p, getValues)(d);\n            });\n          } else if (p.type === \"text\") {\n            grids.tween(\"text\", function(d) {\n              const textInterpolator = enumerator.interpolateAlongEnumMaker(\n                p,\n                getValues\n              )(d);\n              return function(t) {\n                this.innerHTML = textInterpolator(t);\n              };\n            });\n          } else if (p.type === \"style\") {\n            grids.styleTween(getStyle(p.val), d => {\n              return enumerator.interpolateAlongEnumMaker(p, getValues)(d);\n            });\n          }\n        });\n\n        // interpolate them\n        grids\n          .duration((d, i) => timings[i].duration)\n          .delay((d, i) => timings[i].delay)\n          .ease(easeFn)\n          .end()\n          .then(() => {\n            done([\"grid\", \"all\"], () => {\n              resolve();\n            });\n          });\n      } else {\n        let grids = gridG.selectAll(\"line\");\n        const currData = step.currData.grid;\n        const newData = step.nextData.grid;\n        const joinKey = joinKeyGen(\"grid\");\n        const timings = computeTiming(\n          currData,\n          newData,\n          step.timing,\n          joinKey,\n          joinSet\n        );\n        const prevData = d3.local();\n        grids.each(function(d) {\n          prevData.set(this, d);\n        });\n        grids = grids.data(newData, d => joinKey(d));\n        let enterGridI = grids.enter().append(\"line\");\n        fetchAttributes(\n          enterGridI,\n          GRID_ATTRS,\n          // scales.initial[scName] ? scales.initial : scales.final,\n          step.sameDomainDimension\n            ? { primary: scales.initial, secondary: scales.final }\n            : { primary: scales.final, secondary: scales.initial },\n          signals.initial,\n          encodes.initial.enter\n        );\n\n        if (enterGridI.data().length <= 0) {\n          enterGridI = grids.filter(d => joinSet(d) === \"enter\");\n        }\n\n        const enterGridF = enterGridI.transition();\n        fetchAttributes(\n          enterGridF,\n          GRID_ATTRS,\n          scales.final,\n          signals.final,\n          encodes.final.enter\n        );\n        enterGridF\n          .duration(\n            (d, i) =>\n              timings.find(t => t.id === joinKey(d, i, \"final\")).duration\n          )\n          .delay(\n            (d, i) => timings.find(t => t.id === joinKey(d, i, \"final\")).delay\n          )\n          .ease(easeFn)\n          .end()\n          .then(done([\"grid\", \"enter\"], () => resolve()));\n\n        let exitGridI = grids.exit();\n        if (exitGridI.data().length <= 0) {\n          exitGridI = grids.filter(d => joinSet(d) === \"exit\");\n        }\n\n        const exitGridF = exitGridI.transition();\n\n        fetchAttributes(\n          exitGridF,\n          GRID_ATTRS,\n          step.sameDomainDimension\n            ? { primary: scales.final, secondary: scales.initial }\n            : { primary: scales.initial, secondary: scales.final },\n          // scales.final[scName] ? scales.final : scales.initial,\n          signals.final,\n          encodes.final.exit,\n          prevData\n        );\n        exitGridF\n          .duration(\n            (d, i) =>\n              timings.find(t => t.id === joinKey(d, i, \"initial\")).duration\n          )\n          .delay(\n            (d, i) => timings.find(t => t.id === joinKey(d, i, \"initial\")).delay\n          )\n          .ease(easeFn)\n          .remove()\n          .end()\n          .then(done([\"grid\", \"exit\"], () => resolve()));\n\n        grids = grids.filter(d => joinSet(d) === \"update\").transition();\n        // finalize the update set of the grids\n        fetchAttributes(\n          grids,\n          GRID_ATTRS,\n          scales.final,\n          signals.final,\n          encodes.final.update,\n          prevData\n        );\n\n        grids\n          .duration(\n            (d, i) => timings.find(t => t.id === joinKey(d, i)).duration\n          )\n          .delay((d, i) => timings.find(t => t.id === joinKey(d, i)).delay)\n          .ease(easeFn)\n          .end()\n          .then(done([\"grid\", \"update\"], () => resolve()));\n      }\n    } else {\n      done([\"grid\", \"enter\"], () => resolve());\n      done([\"grid\", \"exit\"], () => resolve());\n      done([\"grid\", \"update\"], () => resolve());\n    }\n    // update title\n    const TITLE_ATTRS = [\"title\", \"align\"];\n    const titleG = axis.selectAll(\".role-axis-title\");\n    if (!titleG.empty() && doTitle) {\n      // Assume that there is no data binding (no enter and exit)\n\n      const encodes = step.encodes.title;\n      let title = titleG.selectAll(\"text\");\n\n      const iData = title.data();\n      let fData = [];\n      if (!isRemove) {\n\n        if (step.change.scale === false) {\n          fData = iData;\n        } else {\n          fData = eView._runtime.data[scName].values.value[0].items.filter(\n            item => item.role === \"axis-title\"\n          )[0].items;\n        }\n      }\n\n      title.data(iData, d => d.text);\n      title = title.data(fData, d => d.text);\n      const enterTitleI = title.enter().append(\"text\");\n\n      fetchAttributes(\n        enterTitleI,\n        TITLE_ATTRS,\n        {},\n        signals.initial,\n        encodes.initial.enter\n      );\n\n      const enterTitleF = enterTitleI.transition();\n      fetchAttributes(\n        enterTitleF,\n        TITLE_ATTRS,\n        {},\n        signals.final,\n        encodes.final.enter\n      );\n      enterTitleF\n        .duration(step.duration)\n        .delay(step.delay)\n        .ease(easeFn)\n        .end()\n        .then(done([\"title\", \"enter\"], () => resolve()));\n\n      const exitTitleI = title.exit();\n      const exitTitleF = exitTitleI.transition();\n      fetchAttributes(\n        exitTitleF,\n        TITLE_ATTRS,\n        {},\n        signals.final,\n        encodes.final.exit\n      );\n      exitTitleF\n        .duration(step.duration)\n        .delay(step.delay)\n        .ease(easeFn)\n        .end()\n        .then(done([\"title\", \"exit\"], () => resolve()));\n\n      title = title.transition();\n      // update the title\n      fetchAttributes(\n        title,\n        TITLE_ATTRS,\n        {},\n        signals.final,\n        encodes.final.update\n      );\n\n      title\n        .duration(step.duration)\n        .delay(step.delay)\n        .ease(easeFn)\n        .end()\n        .then(done([\"title\", \"update\"], () => resolve()));\n    } else {\n      done([\"title\", \"enter\"], () => resolve());\n      done([\"title\", \"exit\"], () => resolve());\n      done([\"title\", \"update\"], () => resolve());\n    }\n\n    // update domain\n    const DOMAIN_ATTRS = [\"domain\"];\n\n    const domainG = axis.selectAll(\".role-axis-domain\");\n    if (!domainG.empty() && doDomain) {\n      const encodes = step.encodes.domain;\n      let fData = [];\n      if (!isRemove) {\n        fData = eView._runtime.data[scName].values.value[0].items.filter(\n          item => item.role === \"axis-domain\"\n        )[0].items;\n      }\n      let domain = domainG.selectAll(\"line\").data(fData);\n\n      const iDomainEnter = domain.enter().append(\"line\");\n      fetchAttributes(\n        iDomainEnter,\n        DOMAIN_ATTRS,\n        {},\n        signals.initial,\n        encodes.initial.enter\n      );\n      const fDomainEnter = iDomainEnter.transition();\n      fetchAttributes(\n        fDomainEnter,\n        DOMAIN_ATTRS,\n        {},\n        signals.final,\n        encodes.final.enter\n      );\n      fDomainEnter\n        .duration(step.duration)\n        .delay(step.delay)\n        .ease(easeFn)\n        .end()\n        .then(done([\"domain\", \"enter\"], () => resolve()));\n\n      const iDomainExit = domain.exit();\n      fetchAttributes(\n        iDomainExit,\n        DOMAIN_ATTRS,\n        {},\n        signals.initial,\n        encodes.initial.exit\n      );\n      const fDomainExit = iDomainExit.transition();\n      fetchAttributes(\n        fDomainExit,\n        DOMAIN_ATTRS,\n        {},\n        signals.final,\n        encodes.final.exit\n      );\n      fDomainExit\n        .duration(step.duration)\n        .delay(step.delay)\n        .ease(easeFn)\n        .end()\n        .then(done([\"domain\", \"exit\"], () => resolve()));\n\n      // update the domain\n\n      fetchAttributes(\n        domain,\n        DOMAIN_ATTRS,\n        scales.initial,\n        signals.initial,\n        encodes.initial.update\n      );\n      domain = domain.transition();\n\n      fetchAttributes(\n        domain,\n        DOMAIN_ATTRS,\n        scales.final,\n        signals.final,\n        encodes.final.update\n      );\n\n      domain\n        .duration(step.duration)\n        .delay(step.delay)\n        .ease(easeFn)\n        .end()\n        .then(done([\"domain\", \"update\"], () => resolve()));\n    } else {\n      done([\"domain\", \"enter\"], () => resolve());\n      done([\"domain\", \"exit\"], () => resolve());\n      done([\"domain\", \"update\"], () => resolve());\n    }\n  });\n}\n\nexport { axisInterpolate };\n","import * as d3 from \"d3\";\nimport {\n  propMap,\n  getEaseFn,\n  findAfterSibling,\n  getJoinInfo,\n  findComp,\n  svgRender,\n  computeScale\n} from \"./util.js\";\nimport { fetchAttributes, calculateGetValeus } from \"./attributeFetcher\";\nimport { getStyle } from \"./vega-render-util.js\";\nimport { copy } from \"../util/util.js\";\nimport { computeTiming, enumStepComputeTiming } from \"./timings\";\n\nconst LEGEND_CHANNELS = [\n  \"fill\",\n  \"opacity\",\n  \"shape\",\n  \"size\",\n  \"stroke\",\n  \"strokeDash\",\n  \"strokeWidth\"\n];\nconst INITIAL_STATUS = {\n  update: false,\n  enter: false,\n  exit: false\n};\n\nfunction doneMaker(subComponents, legendTypes, legend) {\n  const transitionStatus = subComponents.reduce((acc, curr) => {\n    acc[curr] = copy(INITIAL_STATUS);\n    return acc;\n  }, {});\n\n  return function(which, cb) {\n    if (which.length === 2) {\n      if (which[1] === \"all\") {\n        transitionStatus[which[0]].update = transitionStatus[\n          which[0]\n        ].enter = transitionStatus[which[0]].exit = true;\n      } else {\n        transitionStatus[which[0]][which[1]] = true;\n      }\n    } else if (which === \"all\") {\n      transitionStatus.update = transitionStatus.enter = transitionStatus.exit = true;\n    } else {\n      transitionStatus[which] = true;\n    }\n\n    const allDone =\n      [\"title\", \"labels\", \"symbols\", \"pairs\", \"entries\", \"legend\"].reduce(\n        (acc, key) => {\n          return (\n            acc &&\n            transitionStatus[key].update &&\n            transitionStatus[key].enter &&\n            transitionStatus[key].exit\n          );\n        },\n        true\n      ) ||\n      [\"title\", \"labels\", \"gradient\", \"bands\", \"entries\", \"legend\"].reduce(\n        (acc, key) => {\n          return (\n            acc &&\n            transitionStatus[key].update &&\n            transitionStatus[key].enter &&\n            transitionStatus[key].exit\n          );\n        },\n        true\n      );\n    if (allDone) {\n      if (legendTypes.final) {\n        if (legendTypes.final === \"gradient\") {\n          legend.selectAll(\".mark-group.role-scope\").remove();\n        } else {\n          const entryG = legend.select(\".role-legend-entry > g > g\");\n          legend\n            .select(\".role-legend-entry > g > g > .mark-text.role-legend-label\")\n            .remove();\n          entryG.select(\".mark-text.role-legend-band\").remove();\n          entryG.select(\".mark-text.role-legend-gradient\").remove();\n        }\n      }\n      cb();\n    }\n  };\n}\n\nfunction legendInterpolate(rawInfo, step, targetElm) {\n  function joinKeyGen(subcomp) {\n    return (d, i, initialOrFinal = \"initial\") => {\n      if (!d) {\n        return i.toString();\n      }\n      if (!d.__gemini__) {\n        return typeof step.computeDatumId[subcomp] === \"function\"\n          ? step.computeDatumId[subcomp](d, i)\n          : step.computeDatumId[subcomp][initialOrFinal](d, i);\n        // return step.computeDatumId[subcomp](d, i);\n      }\n      return getJoinInfo(d, i, step, \"joinKey\");\n    };\n  }\n  const joinSet = (d, i) => {\n    return d.__gemini__ ? getJoinInfo(d, i, step, \"animSet\") : undefined;\n  };\n  const eView = rawInfo.eVis.view;\n\n  return new Promise((resolve) => {\n    // Mark Interpolate Data\n\n    const { change } = step;\n    const easeFn = getEaseFn(step.timing.ease);\n\n    let doTitle;\n    let doSymbols;\n    let doLabels;\n    let doGradient;\n\n    doTitle = doSymbols = doLabels = doGradient = true;\n\n    if (change.encode === false) {\n      doTitle = doSymbols = doLabels = doGradient = false;\n    } else if (change.encode) {\n      doTitle = !(change.encode.title === false);\n      doSymbols = !(change.encode.symbols === false);\n      doLabels = !(change.encode.labels === false);\n      doGradient = !(change.encode.gradient === false);\n    }\n\n    const { isRemove } = step;\n    const { isAdd } = step;\n    let legend = d3.select(`${targetElm} .role-legend.${change.compName}`);\n    const done = doneMaker(\n      [\n        \"entries\",\n        \"title\",\n        \"labels\",\n        \"gradient\",\n        \"symbols\",\n        \"legend\",\n        \"pairs\",\n        \"bands\"\n      ],\n      step.legendTypes,\n      legend\n    );\n    const { compName } = change;\n    // collect the scale objects to scale the initial/final values\n    const { scales } = step;\n    const { signals } = step;\n    const { encodes } = step;\n    const { legendTypes } = step;\n\n    // add/remove/update legend\n    if (isAdd) {\n      const rootMark = d3.select(`${targetElm} .mark-group.root g g `);\n      const rootScene = eView.scenegraph().root;\n      const sib = findAfterSibling(rootScene, change.compName);\n      addLegend(\n        rootMark,\n        findComp(rootScene, change.compName, \"legend\")[0],\n        sib ? `.${sib.name}` : undefined\n      );\n      legend = d3.selectAll(`${targetElm} .role-legend.${change.compName}`);\n\n      done([\"legend\", \"all\"], () => resolve());\n      done([\"entries\", \"all\"], () => resolve());\n    } else if (isRemove) {\n      const manualEncode =\n        change.encode && change.encode.legend ? change.encode.legend.exit : {};\n      const legendG = legend.select(\"g\");\n      const fLegendG = legendG.transition();\n      fetchAttributes(\n        fLegendG,\n        [\"group\"],\n        scales.final,\n        signals.final,\n        Object.assign({}, step.encodes.legend.final.exit, manualEncode)\n      );\n      fLegendG\n        .duration(step.duration)\n        .end()\n        .then(() => {\n          done([\"legend\", \"all\"], () => resolve());\n          done([\"entries\", \"all\"], () => resolve());\n        });\n    } else {\n      // update legend G\n      const fLegendD = findComp(eView.scenegraph().root, compName, \"legend\")[0]\n        .items[0];\n      const encode = {\n        x: { value: fLegendD.x },\n        y: { value: fLegendD.y }\n      };\n\n      const legendG = legend.select(\"g\");\n      const fData = [eView._runtime.data[compName].values.value[0].datum];\n      legendG.data(fData);\n      const fLegendG = legendG.transition();\n      fetchAttributes(\n        fLegendG,\n        [\"group\"],\n        scales.final,\n        signals.final,\n        Object.assign({}, step.encodes.legend.update, encode)\n      );\n      fLegendG\n        .duration(step.duration)\n        .end()\n        .then(() => {\n          done([\"legend\", \"all\"], () => resolve());\n          done([\"entries\", \"all\"], () => resolve());\n        });\n    }\n\n    const scNames = {\n      initial: [],\n      final: []\n    };\n    LEGEND_CHANNELS.forEach(channel => {\n      if (change.initial && change.initial[channel]) {\n        scNames.initial.push(change.initial[channel]);\n      }\n      if (change.final && change.final[channel]) {\n        scNames.final.push(change.final[channel]);\n      }\n    });\n\n    let finalScaleNames = [];\n    if (change.scale === true || isAdd) {\n      finalScaleNames = scNames.final;\n    } else if (Array.isArray(change.scale)) {\n      finalScaleNames = change.scale;\n    } else if (typeof change.scale === \"object\") {\n      finalScaleNames = Object.keys(change.scale).filter(\n        scName => change.scale[scName]\n      );\n    }\n\n    if (step.enumerator) {\n      if (legendTypes.initial !== legendTypes.final) {\n        console.error(\"Cannot enumerate the change of the legend type.\");\n      }\n      const legType = legendTypes.initial || legendTypes.final;\n      let subComps;\n      if (legType === \"symbol\") {\n        const pairs = legend\n          .select(\".role-legend-entry .role-scope\")\n          .selectAll(\".role-scope > g\")\n          .data(step.enumerator.pairs.allKeys, d => d);\n        pairs.exit().remove();\n        const enterPairSubGs = pairs\n          .enter()\n          .append(\"g\")\n          .append(\"g\");\n        enterPairSubGs\n          .append(\"g\")\n          .attr(\"class\", \"mark-symbol role-legend-symbol\")\n          .append(\"path\")\n          .datum((d, i) => step.enumerator.symbols.allKeys[i]);\n        enterPairSubGs\n          .append(\"g\")\n          .attr(\"class\", \"mark-text role-legend-label\")\n          .append(\"text\")\n          .datum((d, i) => step.enumerator.labels.allKeys[i]);\n\n        subComps = [\n          {\n            name: \"pairs\",\n            selection: legend\n              .select(\".role-legend-entry .role-scope\")\n              .selectAll(\".role-scope > g\"),\n            props: [\"group\"]\n          },\n          {\n            name: \"symbols\",\n            selection: legend\n              .select(\".role-legend-entry .role-scope\")\n              .selectAll(\".role-legend-symbol > path\"),\n            props: [\"symbol\"]\n          },\n          {\n            name: \"labels\",\n            selection: legend\n              .select(\".role-legend-entry .role-scope\")\n              .selectAll(\".role-legend-label > text\"),\n            props: [\"text\"]\n          }\n        ];\n      } else {\n        // bind allKeys\n        const selection = legend\n          .select(\".role-legend-label\")\n          .selectAll(\"text\")\n          .data(step.enumerator.labels.allKeys, d => d);\n        selection.exit().remove();\n        selection.enter().append(\"text\");\n\n        subComps = [\n          {\n            name: \"labels\",\n            selection: legend.select(\".role-legend-label\").selectAll(\"text\"),\n            svgElmType: \"text\",\n            props: [\"text\"]\n          }\n        ];\n        if (step.change.initial.isBand) {\n          const selection = legend\n            .select(\".role-legend-band \")\n            .selectAll(\"path\")\n            .data(step.enumerator.bands.allKeys, d => d);\n          selection.exit().remove();\n          selection.enter().append(\"path\");\n\n          subComps.push({\n            name: \"bands\",\n            selection: legend.select(\".role-legend-band \").selectAll(\"path\"),\n            svgElmType: \"path\",\n            props: [\"rect\"]\n          });\n        } else {\n          done([\"bands\", \"all\"], () => {\n            resolve();\n          });\n        }\n        done([\"gradient\", \"all\"], () => {\n          resolve();\n        }); // The gradient elms cannot be enumerated.\n      }\n\n      subComps.forEach(subComp => {\n        const subCompEnumerator = step.enumerator[subComp.name];\n        const getValues = calculateGetValeus(\n          encodes[subComp.name],\n          scales,\n          signals,\n          computeScale,\n          finalScaleNames\n        );\n        const allProps = subComp.props.reduce((acc, prop) => {\n          return acc.concat(propMap(prop));\n        }, []);\n\n        const initials = subComp.selection.filter(\n          id => [\"update\", \"exit\"].indexOf(subCompEnumerator.set(id, 0)) >= 0\n        );\n        allProps.forEach(p => {\n          if (p.type === \"attrTween\") {\n            const tempP = Object.assign({}, p, { type: \"attr\" });\n            initials[tempP.type](getStyle(tempP.val), id =>\n              subCompEnumerator.getPropVal(tempP, getValues, 0, id)\n            );\n          } else if (p.type === \"text\") {\n            initials[p.type](id =>\n              subCompEnumerator.getPropVal(p, getValues, 0, id)\n            );\n          } else {\n            initials[p.type](getStyle(p.val), id =>\n              subCompEnumerator.getPropVal(p, getValues, 0, id)\n            );\n          }\n        });\n\n        const subCompTransition = subComp.selection.transition();\n        const timings = enumStepComputeTiming(subCompEnumerator, step.timing);\n        allProps.forEach(p => {\n          if (p.type === \"attr\") {\n            subCompTransition.attrTween(p.val, d => {\n              return subCompEnumerator.interpolateAlongEnumMaker(\n                p,\n                getValues\n              )(d);\n            });\n          } else if (p.type === \"attrTween\") {\n            subCompTransition.attrTween(p.val, function(d) {\n              return subCompEnumerator.interpolateAlongEnumMaker(\n                p,\n                getValues,\n                this\n              )(d);\n            });\n          } else if (p.type === \"text\") {\n            subCompTransition.tween(\"text\", function(d) {\n              const textInterpolator = subCompEnumerator.interpolateAlongEnumMaker(\n                p,\n                getValues\n              )(d);\n              return function(t) {\n                this.innerHTML = textInterpolator(t);\n              };\n            });\n          } else if (p.type === \"style\") {\n            subCompTransition.styleTween(getStyle(p.val), d => {\n              return subCompEnumerator.interpolateAlongEnumMaker(\n                p,\n                getValues\n              )(d);\n            });\n          }\n        });\n\n        // interpolate them\n        subCompTransition\n          .duration((d, i) => timings[i].duration)\n          .delay((d, i) => timings[i].delay)\n          .ease(easeFn)\n          .end()\n          .then(() => {\n            done([subComp.name, \"all\"], () => {\n              resolve();\n            });\n          });\n      });\n    } else {\n      if (\n        [legendTypes.initial, legendTypes.final].indexOf(\"symbol\") >= 0 &&\n        (doSymbols || doLabels)\n      ) {\n        if (legendTypes.initial !== \"symbol\") {\n          // add the frame for the symbol legend.\n          legend\n            .select(\" .role-legend-entry > g > g\")\n            .append(\"g\")\n            .attr(\"class\", \"mark-group role-scope\");\n        }\n\n        let pairs = legend\n          .select(\".role-legend-entry .role-scope\")\n          .selectAll(\".role-scope > g\");\n\n        const joinKey = {\n          pairs: joinKeyGen(\"pairs\"),\n          symbols: joinKeyGen(\"symbols\"),\n          labels: joinKeyGen(\"labels\")\n        }; // currData.symbols === currData.labels\n        const nextDataLabels =\n          legendTypes.final !== \"symbol\" ? [] : step.nextData.labels;\n        const currDataLabels =\n          legendTypes.initial !== \"symbol\" ? [] : step.currData.labels;\n        const timings = {\n          pairs: computeTiming(\n            step.currData.pairs,\n            step.nextData.pairs,\n            step.timing,\n            joinKey.pairs,\n            joinSet\n          ),\n          symbols: computeTiming(\n            step.currData.symbols,\n            step.nextData.symbols,\n            step.timing,\n            joinKey.symbols,\n            joinSet\n          ),\n          labels: computeTiming(\n            currDataLabels,\n            nextDataLabels,\n            step.timing,\n            joinKey.labels,\n            joinSet\n          )\n        };\n\n        const prevData = d3.local();\n\n        pairs.selectAll(\".role-legend-symbol > path\").each(function(d) {\n          prevData.set(this, d);\n        });\n\n        pairs = pairs.data(step.nextData.pairs, d => joinKey.pairs(d));\n        // if (!isRemove && (isAnimSetSymbols.enter || isAnimSetLabels.enter)) {\n        if (!isRemove && pairs.enter().data().length > 0) {\n          let enterPairsI = pairs.enter().append(\"g\");\n          const enterPairsIsubG = enterPairsI.append(\"g\");\n          let enterSymbolsI = enterPairsIsubG\n            .append(\"g\")\n            .attr(\"class\", \"mark-symbol role-legend-symbol\")\n            .append(\"path\")\n            .datum((d, i) => step.nextData.symbols[i]);\n          let enterLabelsI = enterPairsIsubG\n            .append(\"g\")\n            .attr(\"class\", \"mark-text role-legend-label\")\n            .append(\"text\")\n            .datum((d, i) => step.nextData.labels[i]);\n\n          const actingScales = step.sameDomainDimension\n            ? { primary: scales.initial, secondary: scales.final }\n            : { primary: scales.final, secondary: scales.initial };\n\n          fetchAttributes(\n            enterPairsI,\n            [\"group\"],\n            actingScales,\n            signals.initial,\n            encodes.pairs.initial.enter\n          );\n\n          fetchAttributes(\n            enterSymbolsI,\n            [\"symbol\"],\n            actingScales,\n            signals.initial,\n            encodes.symbols.initial.enter\n          );\n\n          fetchAttributes(\n            enterLabelsI,\n            [\"text\"],\n            actingScales,\n            signals.initial,\n            encodes.labels.initial.enter\n          );\n\n          if (enterPairsI.data().length <= 0) {\n            enterPairsI = pairs.filter(d => joinSet(d) === \"enter\");\n          }\n\n          const enterPairsF = enterPairsI.transition();\n          fetchAttributes(\n            enterPairsF,\n            [\"group\"],\n            scales.final,\n            signals.final,\n            encodes.pairs.final.enter\n          );\n          enterPairsF\n            .duration(\n              (d, i) =>\n                timings.pairs.find(t => t.id === joinKey.pairs(d, i, \"final\"))\n                  .duration\n            )\n            .delay(\n              (d, i) =>\n                timings.pairs.find(t => t.id === joinKey.pairs(d, i, \"final\"))\n                  .delay\n            )\n            .ease(easeFn)\n            .end()\n            .then(done([\"pairs\", \"enter\"], () => resolve()));\n\n          if (enterSymbolsI.data().length <= 0) {\n            enterSymbolsI = pairs\n              .selectAll(\".role-legend-symbol > path\")\n              .filter(d => joinSet(d) === \"enter\");\n          }\n          const enterSymbolsF = enterSymbolsI.transition();\n          fetchAttributes(\n            enterSymbolsF,\n            [\"symbol\"],\n            scales,\n            signals.final,\n            encodes.symbols.final.enter\n          );\n          enterSymbolsF\n            .duration(\n              (d, i) =>\n                timings.symbols.find(\n                  t => t.id === joinKey.symbols(d, i, \"final\")\n                ).duration\n            )\n            .delay(\n              (d, i) =>\n                timings.symbols.find(\n                  t => t.id === joinKey.symbols(d, i, \"final\")\n                ).delay\n            )\n            .ease(easeFn)\n            .end()\n            .then(done([\"symbols\", \"enter\"], () => resolve()));\n\n          if (enterLabelsI.data().length <= 0) {\n            enterLabelsI = pairs\n              .selectAll(\".role-legend-label > text\")\n              .filter(d => joinSet(d) === \"enter\");\n          }\n          const enterLabelsF = enterLabelsI.transition();\n          fetchAttributes(\n            enterLabelsF,\n            [\"text\"],\n            scales.final,\n            signals.final,\n            encodes.labels.final.enter\n          );\n          enterLabelsF\n            .duration(\n              (d, i) =>\n                timings.labels.find(t => t.id === joinKey.labels(d, i, \"final\"))\n                  .duration\n            )\n            .delay(\n              (d, i) =>\n                timings.labels.find(t => t.id === joinKey.labels(d, i, \"final\"))\n                  .delay\n            )\n            .ease(easeFn)\n            .end()\n            .then(done([\"labels\", \"enter\"], () => resolve()));\n        } else {\n          done([\"pairs\", \"enter\"], () => resolve());\n          done([\"symbols\", \"enter\"], () => resolve());\n          done([\"labels\", \"enter\"], () => resolve());\n        }\n\n        // if (!isAdd && (isAnimSetSymbols.exit || isAnimSetLabels.exit)) {\n        if (!isAdd && pairs.exit().data().length > 0) {\n          let exitPairsI = pairs.exit();\n          if (exitPairsI.data().length <= 0) {\n            exitPairsI = pairs.filter(d => joinSet(d) === \"exit\");\n          }\n          const actingScales = step.sameDomainDimension\n            ? { primary: scales.final, secondary: scales.initial }\n            : { primary: scales.initial, secondary: scales.final };\n\n          const exitPairsF = exitPairsI.transition();\n          fetchAttributes(\n            exitPairsF,\n            [\"group\"],\n            actingScales,\n            signals.final,\n            encodes.pairs.final.exit\n          );\n          exitPairsF\n            .duration(\n              (d, i) =>\n                timings.pairs.find(t => t.id === joinKey.pairs(d, i, \"initial\"))\n                  .duration\n            )\n            .delay(\n              (d, i) =>\n                timings.pairs.find(t => t.id === joinKey.pairs(d, i, \"initial\"))\n                  .delay\n            )\n            .ease(easeFn)\n            .remove()\n            .end()\n            .then(done([\"pairs\", \"exit\"], () => resolve()));\n\n          const exitSymbolsI = exitPairsI.selectAll(\n            \".role-legend-symbol > path\"\n          );\n          const exitSymbolsF = exitSymbolsI.transition();\n          fetchAttributes(\n            exitSymbolsF,\n            [\"symbol\"],\n            Object.assign({}, scales, {\n              primary: scales.final,\n              secondary: scales.initial\n            }),\n            signals.final,\n            encodes.symbols.final.exit\n          );\n          exitSymbolsF\n            .duration(\n              (d, i) =>\n                timings.symbols.find(\n                  t => t.id === joinKey.symbols(d, i, \"initial\")\n                ).duration\n            )\n            .delay(\n              (d, i) =>\n                timings.symbols.find(\n                  t => t.id === joinKey.symbols(d, i, \"initial\")\n                ).delay\n            )\n            .ease(easeFn)\n            .remove()\n            .end()\n            .then(done([\"symbols\", \"exit\"], () => resolve()));\n\n          const exitLabelsI = exitPairsI.selectAll(\".role-legend-label > text\");\n          const exitLabelsF = exitLabelsI.transition();\n          fetchAttributes(\n            exitLabelsF,\n            [\"text\"],\n            actingScales,\n            signals.final,\n            encodes.labels.final.exit\n          );\n          exitLabelsF\n            .duration(\n              (d, i) =>\n                timings.labels.find(\n                  t => t.id === joinKey.labels(d, i, \"initial\")\n                ).duration\n            )\n            .delay(\n              (d, i) =>\n                timings.labels.find(\n                  t => t.id === joinKey.labels(d, i, \"initial\")\n                ).delay\n            )\n            .ease(easeFn)\n            .remove()\n            .end()\n            .then(done([\"labels\", \"exit\"], () => resolve()));\n        } else {\n          done([\"pairs\", \"exit\"], () => resolve());\n          done([\"labels\", \"exit\"], () => resolve());\n          done([\"symbols\", \"exit\"], () => resolve());\n        }\n\n        if (pairs.data().length > 0) {\n          // if ((isAnimSetSymbols.update || isAnimSetLabels.update) && pairs.data().length > 0) {\n          const updatePairsF = pairs\n            .filter(d => joinSet(d) === \"update\")\n            .transition();\n          // finalize the update set of the pairs\n          fetchAttributes(\n            updatePairsF,\n            [\"group\"],\n            scales.final,\n            signals.final,\n            encodes.pairs.final.update\n          );\n\n          updatePairsF\n            .duration(\n              (d, i) =>\n                timings.pairs.find(t => t.id === joinKey.pairs(d, i)).duration\n            )\n            .delay(\n              (d, i) =>\n                timings.pairs.find(t => t.id === joinKey.pairs(d, i)).delay\n            )\n            .ease(easeFn)\n            .end()\n            .then(done([\"pairs\", \"update\"], () => resolve()));\n\n          const updateSymbolsI = pairs\n            .select(\".role-legend-symbol > path\")\n            .datum((d, i) => step.nextData.symbols[i]);\n          const updateSymbolsF = updateSymbolsI.transition();\n          fetchAttributes(\n            updateSymbolsF,\n            [\"symbol\"],\n            scales,\n            signals.final,\n            {\n              initial: encodes.symbols.initial.update,\n              final: encodes.symbols.final.update\n            },\n            prevData\n          );\n          updateSymbolsF\n            .duration(\n              (d, i) =>\n                timings.symbols.find(t => t.id === joinKey.symbols(d, i))\n                  .duration\n            )\n            .delay(\n              (d, i) =>\n                timings.symbols.find(t => t.id === joinKey.symbols(d, i)).delay\n            )\n            .ease(easeFn)\n            .end()\n            .then(done([\"symbols\", \"update\"], () => resolve()));\n\n          const updateLabelsI = pairs\n            .select(\".role-legend-label > text\")\n            .datum((d, i) => step.nextData.labels[i]);\n          const updateLabelsF = updateLabelsI.transition();\n          fetchAttributes(\n            updateLabelsF,\n            [\"text\"],\n            scales.final,\n            signals.final,\n            encodes.labels.final.update\n          );\n          updateLabelsF\n            .duration(\n              (d, i) =>\n                timings.labels.find(t => t.id === joinKey.labels(d, i)).duration\n            )\n            .delay(\n              (d, i) =>\n                timings.labels.find(t => t.id === joinKey.labels(d, i)).delay\n            )\n            .ease(easeFn)\n            .end()\n            .then(done([\"labels\", \"update\"], () => resolve()));\n        } else {\n          done([\"pairs\", \"update\"], () => resolve());\n          done([\"symbols\", \"update\"], () => resolve());\n          done([\"labels\", \"update\"], () => resolve());\n        }\n      }\n      if (\n        [legendTypes.initial, legendTypes.final].indexOf(\"gradient\") >= 0 &&\n        (doGradient || doLabels)\n      ) {\n        const entryG = legend.select(\" .role-legend-entry > g > g\");\n        if (legendTypes.initial !== \"gradient\") {\n          // add the frame for the symbol legend.\n          entryG.append(\"g\").attr(\"class\", \"mark-text role-legend-label\");\n\n          if (step.change.final.isBand) {\n            entryG.append(\"g\").attr(\"class\", \"mark-rect role-legend-band\");\n          } else {\n            entryG.append(\"g\").attr(\"class\", \"mark-rect role-legend-gradient\");\n          }\n        }\n\n        if (step.change.initial.isBand && !step.change.final.isBand ) {\n          entryG.append(\"g\").attr(\"class\", \"mark-rect role-legend-gradient\");\n        } else if (!step.change.initial.isBand && step.change.final.isBand) {\n          entryG.append(\"g\").attr(\"class\", \"mark-rect role-legend-band\");\n        }\n\n        const labelG = legend.select(\n          \" .role-legend-entry > g > g > .role-legend-label\"\n        );\n        if (doLabels && !labelG.empty()) {\n          gradientSubComp(\"labels\", labelG, \"text\", [\"text\"]);\n        } else {\n          done([\"labels\", \"all\"], () => resolve());\n        }\n\n        const gradientG = legend.select(\".role-legend-gradient\");\n        if (doGradient && !gradientG.empty()) {\n          gradientSubComp(\"gradient\", gradientG, \"path\", [\"gradient\"]);\n        } else {\n          done([\"gradient\", \"all\"], () => resolve());\n        }\n\n        const bandsG = legend.select(\".role-legend-band\");\n        if (doGradient && !bandsG.empty()) {\n          gradientSubComp(\"bands\", bandsG, \"path\", [\"rect\"]);\n        } else {\n          done([\"bands\", \"all\"], () => resolve());\n        }\n      }\n    }\n\n    // Title\n    const titleG = legend.select(\".role-legend-title\");\n    if (!titleG.empty() && doTitle) {\n      let title = titleG.selectAll(\"text\");\n\n\n      const joinKey = joinKeyGen(\"title\");\n      const timings = computeTiming(\n        step.currData.title,\n        step.nextData.title,\n        step.timing,\n        joinKey,\n        joinSet\n      );\n\n      title = title.data(step.nextData.title, d => d.text);\n      const enterTitleI = title.enter().append(\"text\");\n\n      fetchAttributes(\n        enterTitleI,\n        [\"title\", \"align\"],\n        {},\n        signals.initial,\n        encodes.title.initial.enter\n      );\n\n\n      const enterTitleF = enterTitleI.transition();\n      fetchAttributes(\n        enterTitleF,\n        [\"title\", \"align\"],\n        {},\n        signals.final,\n        encodes.title.final.enter\n      );\n      enterTitleF\n        .duration(\n          (d, i) =>\n            timings.find(t => t.id === joinKey(d, i, \"final\")).duration\n        )\n        .delay(\n          (d, i) => timings.find(t => t.id === joinKey(d, i, \"final\")).delay\n        )\n        .ease(easeFn)\n        .end()\n        .then(done([\"title\", \"enter\"], () => resolve()));\n\n\n\n\n      const exitTitleI = title.exit();\n      const exitTitleF = exitTitleI.transition();\n      fetchAttributes(\n        exitTitleF,\n        [\"title\", \"align\"],\n        {},\n        signals.final,\n        encodes.title.final.exit\n      );\n      exitTitleF\n        .duration(\n          (d, i) =>\n            timings.find(t => t.id === joinKey(d, i, \"initial\")).duration\n        )\n        .delay(\n          (d, i) => timings.find(t => t.id === joinKey(d, i, \"initial\")).delay\n        )\n        .ease(easeFn)\n        .remove()\n        .end()\n        .then(done([\"title\", \"exit\"], () => resolve()));\n\n\n\n\n      title = title.transition();\n      // update the title\n      fetchAttributes(\n        title,\n        [\"title\", \"align\"],\n        {},\n        signals.final,\n        encodes.title.final.update\n      );\n\n      title\n        .duration(\n          (d, i) => timings.find(t => t.id === joinKey(d, i)).duration\n        )\n        .delay((d, i) => timings.find(t => t.id === joinKey(d, i)).delay)\n        .ease(easeFn)\n        .end()\n        .then(done([\"title\", \"update\"], () => resolve()));\n\n    }\n\n\n    function gradientSubComp(\n      subCompName,\n      subCompG,\n      subCompSvgElmType,\n      subCompProps\n    ) {\n      const prevData = d3.local();\n      let subCompSelection = subCompG.selectAll(subCompSvgElmType);\n\n      const joinKey = joinKeyGen(subCompName);\n      const nextData =\n        subCompName === \"labels\" && legendTypes.final !== \"gradient\"\n          ? []\n          : step.nextData[subCompName];\n      const currData =\n        subCompName === \"labels\" && legendTypes.initial !== \"gradient\"\n          ? []\n          : step.currData[subCompName];\n      const timings = computeTiming(\n        currData,\n        nextData,\n        step.timing,\n        joinKey,\n        joinSet\n      );\n      subCompSelection.each(function(d) {\n        prevData.set(this, d);\n      });\n      subCompSelection = subCompSelection.data(nextData, (d, i) =>\n        joinKey(d, i)\n      );\n\n      // if (!isRemove && isAnimSet.enter) {\n      if (!isRemove && subCompSelection.enter().data().length > 0) {\n        let enterSubCompI = subCompSelection.enter().append(subCompSvgElmType);\n\n        fetchAttributes(\n          enterSubCompI,\n          subCompProps,\n          step.sameDomainDimension\n            ? { primary: scales.initial, secondary: scales.final }\n            : { primary: scales.final, secondary: scales.initial },\n          signals.initial,\n          encodes[subCompName].initial.enter\n        );\n\n        if (enterSubCompI.data().length <= 0) {\n          enterSubCompI = subCompG\n            .selectAll(subCompSvgElmType)\n            .filter(d => joinSet(d) === \"enter\");\n        }\n        const enterSubCompF = enterSubCompI.transition();\n        fetchAttributes(\n          enterSubCompF,\n          subCompProps,\n          scales,\n          signals.final,\n          encodes[subCompName].final.enter,\n          prevData\n        );\n        enterSubCompF\n          .duration(\n            (d, i) =>\n              timings.find(t => t.id === joinKey(d, i, \"final\")).duration\n          )\n          .delay(\n            (d, i) => timings.find(t => t.id === joinKey(d, i, \"final\")).delay\n          )\n          .ease(easeFn)\n          .end()\n          .then(done([subCompName, \"enter\"], () => resolve()));\n      } else {\n        done([subCompName, \"enter\"], () => resolve());\n      }\n\n      // if (!isAdd && isAnimSet.exit) {\n      if (!isAdd && subCompSelection.exit().data().length > 0) {\n        const exitSubCompI = subCompSelection.exit();\n        const exitSubCompF = exitSubCompI.transition();\n        fetchAttributes(\n          exitSubCompF,\n          subCompProps,\n          step.sameDomainDimension\n            ? { primary: scales.final, secondary: scales.initial }\n            : { primary: scales.initial, secondary: scales.final },\n          signals.final,\n          encodes[subCompName].final.exit,\n          prevData\n        );\n        exitSubCompF\n          .duration(\n            (d, i) =>\n              timings.find(t => t.id === joinKey(d, i, \"initial\")).duration\n          )\n          .delay(\n            (d, i) => timings.find(t => t.id === joinKey(d, i, \"initial\")).delay\n          )\n          .ease(easeFn)\n          .remove()\n          .end()\n          .then(done([subCompName, \"exit\"], () => resolve()));\n      } else {\n        done([subCompName, \"exit\"], () => resolve());\n      }\n\n      // if ((isAnimSet.update) && subCompSelection.data().length > 0) {\n      if (subCompSelection.data().length > 0) {\n        const updateSubCompF = subCompSelection.transition();\n        let modifiedSubCompProps = subCompName === \"gradient\"\n          ? [{ name: \"gradient\", excludes: [{ type: \"style\", val: \"fill\" }] }]\n          : subCompProps;\n\n\n        fetchAttributes(\n          updateSubCompF,\n          modifiedSubCompProps,\n          scales,\n          signals.final,\n          {\n            initial: encodes[subCompName].initial.update,\n            final: encodes[subCompName].final.update\n          },\n          prevData\n        );\n        if (subCompName === \"gradient\") {\n          updateGradientFill(subCompSelection, step);\n        }\n\n\n\n        updateSubCompF\n          .duration(\n            (d, i) => timings.find(t => t.id === joinKey(d, i)).duration\n          )\n          .delay((d, i) => timings.find(t => t.id === joinKey(d, i)).delay)\n          .ease(easeFn)\n          .end()\n          .then(done([subCompName, \"update\"], () => resolve()));\n      } else {\n        done([subCompName, \"update\"], () => resolve());\n      }\n    }\n  });\n}\nfunction updateGradientFill(gradCompSelection, step) {\n  const url = gradCompSelection.node().style.fill.replace(/^url\\(['\"]/, \"\").replace(/['\"]\\)$/, \"\");\n  const vgDatum = gradCompSelection.data()[0];\n  const gradientId = url.split(\"#\").pop();\n  const gradient = d3.select(`#${gradientId}`);\n  gradient.selectAll(\"stop\")\n    .data(vgDatum.fill.stops, d => (d || {}).offset)\n    .transition()\n    .attr(\"stop-color\", d=> d.color)\n    .duration(step.duration)\n    .delay(step.delay);\n  gradient.transition()\n    .attr(\"x1\", vgDatum.fill.x1)\n    .attr(\"x2\", vgDatum.fill.x2)\n    .attr(\"y1\", vgDatum.fill.y1)\n    .attr(\"y2\", vgDatum.fill.y2)\n    .duration(step.duration)\n    .delay(step.delay);\n\n}\nfunction addLegend(d3Selection, newLegendScene) {\n  const compName = newLegendScene.name;\n  const elem = svgRender(newLegendScene).getElementsByClassName(\n    \"role-legend\"\n  )[0];\n  d3Selection.node().appendChild(elem);\n  const { datum } = newLegendScene.items[0];\n  // after adding the rendered result, delete the items to re-encode according to `encodes`.\n\n  if (datum.title) {\n    d3Selection.select(`.${compName} .role-legend-title text`).remove();\n  }\n  if (datum.type === \"symbol\") {\n    d3Selection\n      .selectAll(`.${compName} .role-legend-entry .role-scope > g`)\n      .remove();\n  } else {\n    d3Selection\n      .selectAll(`.${compName} .role-legend-entry .role-legend-label > text`)\n      .remove();\n    d3Selection\n      .selectAll(`.${compName} .role-legend-entry .role-legend-gradient > path`)\n      .remove();\n    d3Selection\n      .selectAll(`.${compName} .role-legend-entry .role-legend-band > path`)\n      .remove();\n  }\n\n  return d3Selection;\n}\n\nexport { legendInterpolate };\n","import { markInterpolate } from \"./mark/mark\";\nimport { areaLineInterpolate } from \"./mark/areaLine\";\nimport { axisInterpolate } from \"./axis\";\nimport { legendInterpolate } from \"./legend\";\nimport { viewInterpolate } from \"./view\";\nimport { isLinearMarktype} from \"./util\";\n\nconst LIBRARY = {\n  legend: legendInterpolate,\n  axis: axisInterpolate,\n  mark: {\n    interpolate: {\n      others: markInterpolate,\n      areaLine: areaLineInterpolate\n    },\n    marktypeChange\n  },\n  view: viewInterpolate,\n  pause: step => {\n    return new Promise((resolve) => {\n      setTimeout(function() {\n        resolve();\n      }, step.duration + step.delay);\n    });\n  }\n};\nexport default function(step) {\n  let template;\n  const { marktypes } = step;\n  if (step.compType === \"mark\") {\n    if (\n      marktypes.final &&\n      marktypes.initial &&\n      marktypes.initial !== step.marktypes.final\n    ) {\n      template = LIBRARY.mark.marktypeChange;\n    } else if (\n      isLinearMarktype(marktypes.initial) || isLinearMarktype(marktypes.final)\n    ) {\n      template = LIBRARY.mark.interpolate.areaLine;\n    } else {\n      template = LIBRARY.mark.interpolate.others;\n    }\n  } else {\n    template = LIBRARY[step.compType];\n  }\n\n  return template;\n}\n\nasync function marktypeChange(rawInfo, step, targetElm) {\n  const mTypeI = step.marktypes.initial;\n  const mTypeF = step.marktypes.final;\n  if ( isLinearMarktype(mTypeF) && isLinearMarktype(mTypeI)) {\n    return LIBRARY.mark.interpolate.areaLine(rawInfo, step, targetElm);\n  }\n  if (\n    ( isLinearMarktype(mTypeI) && [\"rule\", \"rect\", \"symbol\", \"text\"].indexOf(mTypeF) >= 0) ||\n    ( isLinearMarktype(mTypeF) && [\"rule\", \"rect\", \"symbol\", \"text\"].indexOf(mTypeI) >= 0)\n  ) {\n    return Promise.all([\n      LIBRARY.mark.interpolate.others(rawInfo, step, targetElm),\n      LIBRARY.mark.interpolate.areaLine(rawInfo, step, targetElm)\n    ]);\n  }\n  return LIBRARY.mark.interpolate.others(rawInfo, step, targetElm);\n}\nexport function testInterpolator(step, state) {\n  return new Promise((resolve) => {\n    setTimeout(function() {\n      const nextState = `${state} ${step.compName}`;\n      resolve(nextState);\n    }, step.duration + step.delay);\n  });\n}\n","import * as d3 from \"d3\";\nimport { transformItem } from \"./vega-render-util\";\nimport { getEaseFn } from \"./util.js\";\nimport { fetchAttributes } from \"./attributeFetcher\";\n\nfunction viewInterpolate(rawInfo, step, targetElm) {\n  const animVis = targetElm;\n\n  return new Promise((resolve) => {\n    const easeFn = getEaseFn(step.timing.ease);\n\n    if (step.change.signal === false) {\n      resolve();\n    }\n\n    const view = d3.select(`${animVis} svg`);\n    const svgEncode = step.encodes.final.svg;\n    // update svg\n    // When just applying attr(\"width\", ...), the size of the chart jitters.\n    view\n      .transition()\n      .tween(\"resize\", function() {\n        const w = d3.interpolate(\n          this.getAttribute(\"width\"),\n          svgEncode.width.value\n        );\n        const h = d3.interpolate(\n          this.getAttribute(\"height\"),\n          svgEncode.height.value\n        );\n        return function(t) {\n          const _w = Math.round(w(t) * 1) / 1;\n          const _h = Math.round(h(t) * 1) / 1;\n          this.setAttribute(\"width\", _w);\n          this.setAttribute(\"height\", _h);\n          this.setAttribute(\"viewBox\", `0 0 ${_w} ${_h}`);\n        };\n      })\n      .duration(step.duration)\n      .delay(step.delay)\n      .ease(easeFn)\n      .end()\n      .then(() => {\n        resolve();\n      });\n\n    // update svg > g\n    view\n      .select(\"g\")\n      .transition()\n      .attr(\n        \"transform\",\n        transformItem({ x: svgEncode.x.value, y: svgEncode.y.value })\n      )\n      .duration(step.duration)\n      .delay(step.delay)\n      .ease(easeFn);\n\n    // update background\n    let root = view.select(\".root g > .background\");\n    const rootEncode = step.encodes.final.root;\n    const fDatum = Object.keys(rootEncode).reduce((fDatum, key) => {\n      fDatum[key] = rootEncode[key].value;\n      return fDatum;\n    }, {});\n    root = root.data([fDatum]).transition();\n    fetchAttributes(\n      root,\n      [\"background\", \"fill\", \"stroke\"],\n      {},\n      step.signals.final,\n      rootEncode\n    );\n\n    root\n      .duration(step.duration)\n      .delay(step.delay)\n      .ease(easeFn);\n\n    // update frame\n  });\n}\n\nexport { viewInterpolate };\n","import {attachStates} from \"./changeFetcher\";\n\nexport function autoScaleOrder(extendedSchedule, resolves, rawInfo) {\n  const mainTimeline = extendedSchedule.getTimeline(\":main\");\n\n  let extendedTimeline = attachStates(mainTimeline, rawInfo);\n  const scaleOrderResovles = resolves.filter(r => r.autoScaleOrder),\n    scheduleAlternator = extendedSchedule.getTimelineAlternator(scaleOrderResovles);\n\n  while (!validateScaleOrder(scaleOrderResovles, extendedTimeline)) {\n    const altTimeline = scheduleAlternator();\n    if (!altTimeline) {\n      extendedTimeline = attachStates(mainTimeline, rawInfo);\n      break;\n    }\n    extendedTimeline = attachStates(altTimeline, rawInfo);\n  }\n  return extendedTimeline;\n}\n\nfunction validateScaleOrder(resolves, timeline) {\n  let valid = true;\n  resolves.forEach(resolve => {\n    resolve.autoScaleOrder.forEach(compName => {\n      const foundTrack = timeline.find(track => track.compName === compName);\n      if (foundTrack && foundTrack.scaleOrderValid === false) {\n        valid = false;\n      }\n    });\n  });\n  return valid;\n}","import * as vega from \"vega\";\nimport { Animation } from \"./animation\";\nimport { parse } from \"./parser\";\nimport { attachChanges } from \"./changeFetcher\";\nimport { default as Actuator } from \"./actuator\";\nimport { autoScaleOrder } from \"./resolver\";\n\n\nfunction attachAnimTemplates(schedule) {\n  schedule.forEach(track => {\n    track.steps = track.steps.map(step => {\n      const template = Actuator(step);\n      if (!template) {\n        console.error(\n          `There is no such animation template for ${step.compType}.`\n        );\n      }\n\n      step.template = template;\n      return step;\n    });\n  });\n  return schedule;\n}\n\nclass Gemini {\n  static async animate(startVisSpec, endVisSpec, spec) {\n\n    const eView = await new vega.View(vega.parse(endVisSpec), {\n      renderer: \"svg\"\n    }).runAsync();\n\n    const sView = await new vega.View(vega.parse(startVisSpec), {\n      renderer: \"svg\"\n    }).runAsync();\n\n    const rawInfo = {\n      sVis: { view: sView, spec: startVisSpec },\n      eVis: { view: eView, spec: endVisSpec }\n    };\n\n    const { schedule, resolves } = parse(spec, rawInfo);\n    schedule.tracks = attachChanges(rawInfo, schedule.tracks);\n    const finalTimeline = autoScaleOrder(schedule, resolves, rawInfo);\n\n    return new Animation(attachAnimTemplates(finalTimeline), rawInfo, spec);\n  }\n}\n\nexport {\n  Gemini,\n  attachAnimTemplates as attachAnimTemplate\n};\n","import { copy } from \"../util/util\";\n\nconst MIN_POS_DELTA = 10;\nconst CHANNEL_TO_ATTRS = [\n  { channel: \"x\", attrs: [\"x\", \"x2\", \"xc\", \"width\"] },\n  { channel: \"y\", attrs: [\"y\", \"y2\", \"yc\", \"height\"] },\n  { channel: \"color\", attrs: [\"stroke\", \"fill\"] },\n  { channel: \"shape\", attrs: [\"shape\"] },\n  { channel: \"size\", attrs: [\"size\"] },\n  { channel: \"opacity\", attrs: [\"opacity\"] },\n  { channel: \"text\", attrs: [\"text\"] },\n  { channel: \"others\", attrs: [\"tooltip\", \"define\", \"strokeWidth\"] }\n];\nconst CHANNELS = [\"x\", \"y\", \"color\", \"shape\", \"size\", \"opacity\", \"text\"];\n\nconst CHANNEL_TO_ATTRS_OBJ = {\n  x: [\"x\", \"x2\", \"xc\", \"width\"],\n  y: [\"y\", \"y2\", \"yc\", \"height\"],\n  color: [\"stroke\", \"fill\"],\n  shape: [\"shape\"],\n  size: [\"size\"],\n  opacity: [\"opacity\"],\n  text: [\"text\"],\n  others: [\"tooltip\", \"define\", \"strokeWidth\"]\n};\n\nfunction getSubEncodeByChannel(encode, channel) {\n  const subEncode = {};\n  if (channel === \"others\") {\n    const otherEncode = copy(encode);\n    CHANNEL_TO_ATTRS.reduce((channelRelatedAttrs, ch2Attrs) => {\n      return (channelRelatedAttrs = channelRelatedAttrs.concat(ch2Attrs.attrs));\n    }, []).forEach(attr => {\n      delete otherEncode[attr];\n    });\n\n    return otherEncode;\n  }\n\n  CHANNEL_TO_ATTRS_OBJ[channel]\n    // .filter(attr => encode[attr])\n    .forEach(attr => {\n      subEncode[attr] = encode[attr];\n    });\n  return subEncode;\n}\nfunction getCoreAttr(subEncode, channel, marktype){\n  if (!subEncode) {\n    return;\n  }\n  if (channel === \"color\") {\n    let coreAttr = [\"line\", \"rule\", \"symbol\"].indexOf(marktype) >= 0\n      ? subEncode.stroke\n      : subEncode.fill;\n\n    if (\n      coreAttr === \"symbol\" &&\n        subEncode.fill &&\n        subEncode.fill.value !== \"transparent\"\n    ) {\n      coreAttr = subEncode.fill;\n    }\n\n    return coreAttr;\n  }\n  if (channel===\"x\") {\n    return subEncode.x  || subEncode.xc;\n  } else if (channel===\"y\") {\n    return subEncode.y  || subEncode.yc;\n  }\n  return subEncode[channel];\n}\n\nexport { CHANNELS, CHANNEL_TO_ATTRS_OBJ, MIN_POS_DELTA, getSubEncodeByChannel, getCoreAttr };\n","import { getComponents, getChanges, getViewChange } from \"../changeFetcher/change\";\nimport { copy, deepEqual, isNumber, get } from \"../util/util\";\nimport { findComp } from \"../actuator/util\";\nimport { computeHasFacet } from \"../changeFetcher/state/util\";\nimport { CHANNELS, getSubEncodeByChannel, MIN_POS_DELTA,getCoreAttr } from \"./util\";\nimport { getMarkData, unpackData } from \"../util/vgDataHelper\";\n\n\nexport function detectDiffs(rawInfo, userInput = {}) {\n  // 0) compare signals\n  const signalDiffs = detectSignalDiffs(rawInfo);\n\n  const matches = getChanges(\n    getComponents(rawInfo.sVis.spec),\n    getComponents(rawInfo.eVis.spec)\n  );\n  const scaleDiffs = matches\n    .filter(match => match.compType === \"scale\")\n    .reduce((scaleDiffs, match) => {\n      scaleDiffs[match.compName] = match;\n      scaleDiffs[match.compName].meta = detectScaleDiffs(match, rawInfo, userInput.scales);\n\n      return scaleDiffs;\n    }, {});\n\n  const compDiffs = matches\n    .filter(match => {\n      return (\n        [\"root\", \"pathgroup\"].indexOf(match.compName) < 0 &&\n        match.compType !== \"scale\"\n      );\n    }).map(match => {\n      switch (match.compType) {\n      case \"mark\":\n        match.meta = detectMarkDiffs(match, rawInfo, scaleDiffs);\n        break;\n      case \"axis\":\n        match.meta = detectAxisDiffs(match, rawInfo, scaleDiffs);\n        break;\n      case \"legend\":\n        match.meta = detectLegendDiffs(match, rawInfo, scaleDiffs);\n        break;\n      default:\n        break;\n      }\n\n      return match;\n    });\n  const viewDiffs = detectViewDiff(rawInfo);\n\n  // 1) should return the components\n  return {\n    compDiffs,\n    scaleDiffs,\n    signalDiffs,\n    viewDiffs\n  };\n}\nfunction appendCompScaleDiff(usedScales, scaleDiffs) {\n  let compScaleDiffDetails = {}; let compScaleDiff = false;\n\n  usedScales.forEach(scaleName => {\n    compScaleDiffDetails[scaleName] = scaleDiffs[scaleName].meta;\n    compScaleDiff = compScaleDiff || scaleDiffs[scaleName].meta;\n  }, {});\n\n  return compScaleDiff ? compScaleDiffDetails : false;\n}\nfunction detectMarkDiffs(match, rawInfo, scaleDiffs) {\n  let markDiffs = { view: { deltaW: 0, deltaH: 0 } };\n  if (!match.initial) {\n    markDiffs.add = true;\n    markDiffs.view = { deltaW: MIN_POS_DELTA, deltaH: MIN_POS_DELTA };\n  } else if (!match.final) {\n    markDiffs.remove = true;\n    markDiffs.view = { deltaW: MIN_POS_DELTA, deltaH: MIN_POS_DELTA };\n  }\n\n  // marktype\n  markDiffs.marktype = !match.initial || !match.final || (match.initial.type !== match.final.type);\n\n  // compare the encodes per channel\n  const enAttrs_i = Object.keys(get(match, \"initial\", \"encode\", \"update\") || {});\n  let enAttrs_f = Object.keys(get(match, \"final\", \"encode\", \"update\") || {});\n  markDiffs.usedEnAttrs = enAttrs_i.concat(enAttrs_f).unique();\n\n  markDiffs.encode = CHANNELS.reduce((encodeDiffs, channel) => {\n    const subEncode_i = getSubEncodeByChannel(\n      get(match, \"initial\", \"encode\", \"update\") || {},\n      channel\n    );\n    let subEncode_f = getSubEncodeByChannel(\n      get(match, \"final\", \"encode\", \"update\") || {},\n      channel\n    );\n\n    encodeDiffs[channel] = !deepEqual(subEncode_i, subEncode_f);\n\n    // ignoreable encode diffs (d (opacity) > 0.5 )\n    if (\n      channel === \"opacity\" &&\n      (get(subEncode_i, \"opacity\", \"value\") ||\n        get(subEncode_i, \"opacity\") === undefined) &&\n      (get(subEncode_f, \"opacity\", \"value\") ||\n        get(subEncode_f, \"opacity\") === undefined)\n    ) {\n      const opacityVal_i = get(subEncode_i, \"opacity\", \"value\") || 1.0;\n      let opacityVal_f = get(subEncode_f, \"opacity\", \"value\") || 1.0;\n      if (Math.abs(opacityVal_i - opacityVal_f) < 0.5) {\n        encodeDiffs.opacity = false;\n      }\n    }\n\n    //\n    if (markDiffs.marktype && encodeDiffs[channel]) {\n      const marktype_i = get(match, \"initial\", \"type\"),\n        marktype_f = get(match, \"final\", \"type\");\n      let coreEnAttr_i = getCoreAttr(subEncode_i, channel, marktype_i);\n      let coreEnAttr_f = getCoreAttr(subEncode_f, channel, marktype_f);\n\n      if (deepEqual(coreEnAttr_i, coreEnAttr_f)) {\n        encodeDiffs[channel] = \"byMarktypeChange\";\n      }\n    }\n\n    //\n    return encodeDiffs;\n  }, {});\n\n\n\n  // find the used scales\n  const usedScales = [];\n  [\"update\"].forEach(set => {\n    const encode_i = match.initial && match.initial.encode[set];\n    let encode_f = match.final && match.final.encode[set];\n    [encode_i, encode_f].forEach(encode => {\n      Object.keys(encode || {}).map(attr => {\n        if (encode[attr].scale) {\n          usedScales.push(encode[attr].scale);\n        }\n      });\n    });\n  });\n  markDiffs.usedScales = usedScales.unique();\n  markDiffs.scale = appendCompScaleDiff(markDiffs.usedScales, scaleDiffs);\n  markDiffs.scNames = Object.keys(markDiffs.scale);\n  markDiffs.view = {\n    deltaW: markDiffs.scale.x\n      ? markDiffs.scale.x.rangeDelta\n      : markDiffs.view.deltaW,\n    deltaH: markDiffs.scale.y\n      ? markDiffs.scale.y.rangeDelta\n      : markDiffs.view.deltaH\n  };\n  if (markDiffs.scale.y && markDiffs.scale.y.add) {\n    markDiffs.view.deltaH = MIN_POS_DELTA;\n  } else if (markDiffs.scale.y && markDiffs.scale.y.remove) {\n    markDiffs.view.deltaH = -MIN_POS_DELTA;\n  }\n\n  if (markDiffs.scale.x && markDiffs.scale.x.add) {\n    markDiffs.view.deltaW = MIN_POS_DELTA;\n  } else if (markDiffs.scale.x && markDiffs.scale.x.remove) {\n    markDiffs.view.deltaW = -MIN_POS_DELTA;\n  }\n\n  // Get data and compare\n  // get dataComp name\n  // let iDataCompName = computeHasFacet(match.initial) ? match.initial.parent.from.facet.data : match.initial.from.data,\n  //   fDataCompName = computeHasFacet(match.final) ? match.final.parent.from.facet.data : match.final.from.data;\n\n  // markDiffs.data = isDiffDataComp(\n  //   findDataComp(rawInfo.sVis.spec, iDataCompName),\n  //   findDataComp(rawInfo.eVis.spec, fDataCompName),\n  //   rawInfo\n  // );\n  // if (markDiffs.data || true) {\n  let iData = match.initial\n    ? getMarkData(rawInfo.sVis.view, match.initial, match.compName)\n    : [];\n  let fData = match.final\n    ? getMarkData(rawInfo.eVis.view, match.final, match.compName)\n    : [];\n\n  if (computeHasFacet(match.initial) && computeHasFacet(match.final)) {\n    markDiffs.data = isDiffData(unpackData(iData), unpackData(fData));\n  }\n  if (!markDiffs.data) {\n\n    iData = computeHasFacet(match.initial) ? unpackData(iData) : iData;\n    fData = computeHasFacet(match.final) ? unpackData(fData) : fData;\n\n    markDiffs.data = isDiffData(iData, fData);\n  }\n\n  // }\n\n  return markDiffs;\n}\n\nfunction detectScaleDiffs(match, rawInfo, userInputScales = {}) {\n  if (!match.initial) {\n    return {add: true};\n  } if (!match.final) {\n    return {remove: true};\n  }\n  let scaleDiff = deepEqual(match.initial, match.final) ? false : {};\n\n  let rangeVals_i = rawInfo.sVis.view.scale(match.initial.name).range(),\n    rangeVals_f = rawInfo.eVis.view.scale(match.final.name).range();\n  let rangeDelta = 0;\n  if (!deepEqual(rangeVals_i, rangeVals_f)){\n    if ((rangeVals_i.length === 2 && isNumber(rangeVals_i[0]) && isNumber(rangeVals_i[1]))\n      && (rangeVals_f.length === 2 && isNumber(rangeVals_f[0]) && isNumber(rangeVals_f[1]))) {\n      rangeDelta = Math.abs(rangeVals_f[0]-rangeVals_f[1]) - Math.abs(rangeVals_i[0]-rangeVals_i[1]);\n    }\n  }\n\n  let domainVals_i = rawInfo.sVis.view.scale(match.initial.name).domain(),\n    domainVals_f = rawInfo.eVis.view.scale(match.final.name).domain();\n\n  if (!scaleDiff && deepEqual(domainVals_i, domainVals_f) && (rangeDelta === 0)) {\n    return false;\n  }\n  scaleDiff = {\n    rangeDelta: rangeDelta,\n    domainValueDiff: !deepEqual(domainVals_i, domainVals_f)\n  };\n\n  let userInputDomainDimensionDiff = get(userInputScales[match.initial.name], \"domainDimension\");\n  scaleDiff.domainSpaceDiff = userInputDomainDimensionDiff === \"diff\" ? true : (\n    userInputDomainDimensionDiff === \"same\" ? false :\n      !deepEqual(match.initial.domain, match.final.domain)\n  );\n\n\n  if (([\"band\", \"point\", \"ordinal\"].indexOf(match.initial.type) >= 0) &&\n    ([\"band\", \"point\", \"ordinal\"].indexOf(match.final.type) >= 0)) {\n    scaleDiff.stayDiscrete = true;\n  }\n  return scaleDiff;\n}\n\nfunction detectLegendDiffs(match, rawInfo, scaleDiffs) {\n  const legendDiffs = {\n    usedScales: [],\n    view: { deltaW: 0, deltaH: 0, x: 0, y: 0 }\n  };\n  if (!match.initial) {\n    legendDiffs.add = true;\n    legendDiffs.view = {\n      deltaW: MIN_POS_DELTA,\n      deltaH: MIN_POS_DELTA,\n      x: MIN_POS_DELTA,\n      y: MIN_POS_DELTA\n    };\n  } else if (!match.final) {\n    legendDiffs.remove = true;\n    legendDiffs.view = {\n      deltaW: -MIN_POS_DELTA,\n      deltaH: -MIN_POS_DELTA,\n      x: -MIN_POS_DELTA,\n      y: -MIN_POS_DELTA\n    };\n  }\n\n  const legend_i = copy(match.initial || {}); let legend_f = copy(match.final || {});\n\n  // 1) scale diff\n  [\n    \"fill\",\n    \"opacity\",\n    \"shape\",\n    \"size\",\n    \"stroke\",\n    \"strokeDash\",\n    \"strokeWidth\"\n  ].forEach(scale => {\n    if (match.initial && match.initial[scale]) {\n      legendDiffs.usedScales.push(match.initial[scale]);\n    }\n    if (match.final && match.final[scale]) {\n      legendDiffs.usedScales.push(match.final[scale]);\n    }\n\n    delete legend_i[scale];\n    delete legend_f[scale];\n  }, false);\n  legendDiffs.usedScales = legendDiffs.usedScales.unique();\n  legendDiffs.scale = appendCompScaleDiff(legendDiffs.usedScales, scaleDiffs);\n  legendDiffs.scNames = Object.keys(legendDiffs.scale);\n  // 2) encode diff\n  legendDiffs.encode = !deepEqual(legend_i, legend_f);\n\n  // 3) Pos Diff\n  if (match.initial && match.final) {\n    const legendGDatum = {\n      initial: findComp(\n        rawInfo.sVis.view.scenegraph().root,\n        match.compName,\n        \"legend\"\n      )[0].items[0],\n      final: findComp(\n        rawInfo.eVis.view.scenegraph().root,\n        match.compName,\n        \"legend\"\n      )[0].items[0]\n    };\n\n    legendDiffs.view.x = legendGDatum.final.x - legendGDatum.initial.x;\n    legendDiffs.view.y = legendGDatum.final.y - legendGDatum.initial.y;\n  }\n\n  return legendDiffs;\n}\n\nfunction detectAxisDiffs(match, rawInfo, scaleDiffs) {\n  const axisDiffs = {\n    view: { deltaW: 0, deltaH: 0, x: 0, y: 0 }\n  };\n  if (!match.initial) {\n    axisDiffs.add = true;\n    axisDiffs.view = {\n      deltaW: MIN_POS_DELTA,\n      deltaH: MIN_POS_DELTA,\n      x: MIN_POS_DELTA,\n      y: MIN_POS_DELTA\n    };\n  } else if (!match.final) {\n    axisDiffs.remove = true;\n    axisDiffs.view = {\n      deltaW: -MIN_POS_DELTA,\n      deltaH: -MIN_POS_DELTA,\n      x: -MIN_POS_DELTA,\n      y: -MIN_POS_DELTA\n    };\n  }\n  // 1) scale diff\n  axisDiffs.usedScales = [];\n  if (match.initial) {\n    axisDiffs.usedScales.push(match.initial.scale);\n  } else if (match.final) {\n    axisDiffs.usedScales.push(match.final.scale);\n  }\n\n  axisDiffs.scale = appendCompScaleDiff(axisDiffs.usedScales, scaleDiffs);\n  axisDiffs.scNames = Object.keys(axisDiffs.scale);\n  if (match.final && match.initial) {\n    axisDiffs.view = {\n      deltaW: axisDiffs.scale.x ? axisDiffs.scale.x.rangeDelta : 0,\n      deltaH: axisDiffs.scale.y ? axisDiffs.scale.y.rangeDelta : 0\n    };\n    if (match.initial.scale === match.final.scale) {\n      if (!!match.initial.grid !== !!match.final.grid) {\n        if (match.final.scale === \"x\") {\n          axisDiffs.view.deltaH = match.initial.grid\n            ? -MIN_POS_DELTA\n            : MIN_POS_DELTA;\n        } else if (match.final.scale === \"y\") {\n          axisDiffs.view.deltaW = match.initial.grid\n            ? -MIN_POS_DELTA\n            : MIN_POS_DELTA;\n        }\n      } else if (!!match.initial.grid && !!match.final.grid) {\n        let delta =\n          get(scaleDiffs, match.initial.gridScale, \"meta\", \"rangeDelta\") || 0;\n        if (match.final.orient === \"left\" || match.final.orient === \"right\") {\n          axisDiffs.view.deltaW = delta;\n        } else {\n          axisDiffs.view.deltaH = delta;\n        }\n      }\n    }\n  }\n\n  // 2) encode diff\n  const axis_i = copy(match.initial) || {}; let axis_f = copy(match.final || {});\n  delete axis_i.scale;\n  delete axis_f.scale;\n  axisDiffs.encode = !deepEqual(axis_i, axis_f);\n\n  // 3) Pos Diff\n  if (match.initial && match.final) {\n    const axisGDatum = {\n      initial: findComp(\n        rawInfo.sVis.view.scenegraph().root,\n        match.compName,\n        \"axis\"\n      )[0].items[0],\n      final: findComp(\n        rawInfo.eVis.view.scenegraph().root,\n        match.compName,\n        \"axis\"\n      )[0].items[0]\n    };\n\n    axisDiffs.view.x = axisGDatum.final.x - axisGDatum.initial.x;\n    axisDiffs.view.y = axisGDatum.final.y - axisGDatum.initial.y;\n  }\n\n  return axisDiffs;\n}\nfunction detectViewDiff(rawInfo) {\n  const viewDiffs = getViewChange(rawInfo);\n  const paddingDiff = viewDiffs.final.padding - viewDiffs.initial.padding;\n  viewDiffs.deltaW = viewDiffs.final.viewWidth - viewDiffs.initial.viewWidth + paddingDiff;\n  viewDiffs.deltaH = viewDiffs.final.viewHeight - viewDiffs.initial.viewHeight + paddingDiff;\n  viewDiffs.width = {};\n  viewDiffs.height = {};\n  if (Math.abs(viewDiffs.deltaW) > MIN_POS_DELTA/2) {\n    viewDiffs.width[viewDiffs.deltaW > 0 ? \"increase\" : \"decrease\"] = true;\n  }\n  if (Math.abs(viewDiffs.deltaH) > MIN_POS_DELTA/2) {\n    viewDiffs.height[viewDiffs.deltaH > 0 ? \"increase\" : \"decrease\"] = true;\n  }\n  viewDiffs.scNames = [];\n\n  return viewDiffs;\n}\n\nfunction detectSignalDiffs(rawInfo) {\n  const signalDiffs = {\n    initial: rawInfo.sVis.view._runtime.signals,\n    final: rawInfo.eVis.view._runtime.signals,\n    meta: {\n      update: [],\n      exit: [],\n      enter: [],\n      same: []\n    }\n  };\n  Object.keys(signalDiffs.initial)\n    .concat(Object.keys(signalDiffs.final))\n    .unique()\n    .forEach(sgName => {\n      let sg_f = signalDiffs.final[sgName];\n      let sg_i = signalDiffs.initial[sgName];\n      if (!sg_f) {\n        signalDiffs.meta.exit.push(sgName);\n      } else if (!sg_i) {\n        signalDiffs.meta.enter.push(sgName);\n      } else if (!deepEqual(sg_f.value, sg_i.value)) {\n        signalDiffs.meta.update.push(sgName);\n      } else {\n        signalDiffs.meta.same.push(sgName);\n      }\n    });\n  return signalDiffs;\n}\n\nexport function isDiffData(iData, fData) {\n  const diff = { column: false, row: false };\n\n  let iFields = iData[0] ? Object.keys(iData[0].datum) : [];\n  let fFields = fData[0] ? Object.keys(fData[0].datum) : [];\n  let sharedFields = [];\n  if (!deepEqual(iFields, fFields)) {\n    if (iFields.containAll(fFields)) {\n      diff.column = \"removed\";\n      sharedFields = fFields;\n    } else if (fFields.containAll(iFields)) {\n      diff.column = \"added\";\n      sharedFields = iFields;\n    } else {\n      diff.column = \"changed\";\n      sharedFields = iFields.filter(f => fFields.indexOf(f) >= 0);\n    }\n  } else {\n    sharedFields = iFields;\n  }\n\n  if (sharedFields.length > 0) {\n    const mappedIData = iData.map(d =>\n      sharedFields.map(f => d.datum[f]).join(\",\")\n    );\n    const mappedFData = fData.map(d =>\n      sharedFields.map(f => d.datum[f]).join(\",\")\n    );\n    diff.row = !deepEqual(mappedIData, mappedFData);\n  } else {\n    diff.row = iData.length !== fData.length;\n  }\n\n  if (!diff.column && !diff.row) {\n    return false;\n  }\n  diff.sharedFields = sharedFields;\n  return diff;\n}\n\n// function isDiffDataComp(iDataComp, fDataComp, rawInfo) {\n//   if (iDataComp.source || fDataComp.source) {\n//     let newIDataComp = iDataComp,\n//       newFDataComp = fDataComp;\n//     if (iDataComp.source && typeof(iDataComp.source) === \"string\") {\n//       newIDataComp = findDataComp(rawInfo.sVis.spec, iDataComp.source);\n//       newIDataComp.transform = (newIDataComp.transform || []).concat(iDataComp.transform);\n//     }\n//     if (fDataComp.source && typeof(fDataComp.source) === \"string\") {\n//       newFDataComp = findDataComp(rawInfo.eVis.spec, fDataComp.source);\n//       newFDataComp.transform = (newFDataComp.transform || []).concat(fDataComp.transform);\n//     }\n\n//     return isDiffDataComp(newIDataComp, newFDataComp, rawInfo)\n//   }\n\n//   let _i = copy(iDataComp), _f = copy(fDataComp);\n//   delete _i.name;\n//   // delete _i.values;\n//   delete _f.name;\n//   // delete _f.values;\n//   if (_i.values && _f.values) {\n//     if (_i.values.length !== _f.values.length) {\n//       return true\n//     }\n//     if ( JSON.stringify(_i.values.sort()) !== JSON.stringify(_f.values.sort())){\n//       return true\n//     }\n\n//   }\n//   delete _i.values;\n//   delete _f.values;\n//   return !deepEqual(_i, _f);\n//   //compare all except for \"name\".  (\"values\" may take a lot of times...)\n// }\n\n// function findDataComp(spec, compName) {\n//   return spec.data.find(comp => comp.name === compName);\n// }\n","import { getMarkData, unpackData } from \"../util/vgDataHelper\";\nimport { get } from \"../util/util\";\nimport { computeHasFacet } from \"../changeFetcher/state/util\";\nimport { getSubEncodeByChannel } from \"./util\";\n\nfunction applyMarkDiffs(\n  markDiff,\n  applyingDiffs,\n  rawInfo,\n  extraDiffsByMarktypeChange = []\n) {\n\n  const markCompSummary = new MarkSummary(markDiff, rawInfo);\n\n  applyingDiffs.forEach(diff => {\n    markCompSummary.applyDiff(diff, extraDiffsByMarktypeChange);\n  });\n  return markCompSummary;\n}\n\n\nclass MarkSummary {\n  constructor(markDiff, rawInfo) {\n    const vegaView = rawInfo.sVis.view;\n    let data = getMarkData(\n      vegaView,\n      markDiff.initial,\n      markDiff.compName,\n\n    );\n    let hasFacet = markDiff.initial ? computeHasFacet(markDiff.initial) : undefined;\n\n    data = hasFacet ? unpackData(data) : data;\n    this.markDiff = markDiff;\n    this.rawInfo = rawInfo;\n    this.isEmpty = markDiff.add;\n    this.marktype = get(markDiff, \"initial\", \"type\");\n    this.encode = get(markDiff, \"initial\", \"encode\", \"update\") || {};\n\n    this.data = {\n      hasFacet,\n      fields: data[0] ? Object.keys(data[0].datum) : [],\n      values: data\n    };\n\n    this.scales = markDiff.meta.usedScales.reduce((scales, scName) => {\n      const scale_i = vegaView._runtime.scales[scName];\n      if (scale_i) {\n        scales[scName] = scale_i.value;\n      }\n      return scales;\n    }, {});\n\n    this.style = get(markDiff, \"initial\", \"style\");\n  }\n\n  applyDiff(diff, extraDiffsByMarktypeChange) {\n\n    if (diff === \"add\") {\n      this.isEmpty = true;\n    }\n    if (diff === \"remove\") {\n      this.isEmpty = false;\n    }\n    if (diff === \"marktype\") {\n      this.marktype = get(this.markDiff, \"final\", \"type\");\n      extraDiffsByMarktypeChange.forEach(extraDiff => {\n        this.applyDiff(extraDiff);\n      });\n    } else if (diff === \"data\") {\n      this.data = {\n        hasFacet: this.markDiff.final ? computeHasFacet(this.markDiff.final) : undefined,\n      };\n      let data = getMarkData(\n        this.rawInfo.eVis.view,\n        this.markDiff.final,\n        this.markDiff.compName\n      );\n      data = this.data.hasFacet ? unpackData(data) : data;\n      this.data.fields = data[0] ? Object.keys(data[0].datum) : [];\n      this.data.values = data;\n    } else if (diff.indexOf(\"encode.\") >= 0) {\n      const channel = diff.replace(\"encode.\", \"\");\n      this.encode = Object.assign(\n        {},\n        this.encode,\n        this.markDiff.final ? getSubEncodeByChannel(this.markDiff.final.encode.update, channel) : {}\n      );\n    } else if (diff.indexOf(\"scale.\") >= 0) {\n      const scName = diff.replace(\"scale.\", \"\");\n      const scale_f = this.rawInfo.eVis.view._runtime.scales[scName];\n      if (scale_f) {\n        this.scales[scName] = scale_f.value;\n      } else {\n        delete this.scales[scName];\n      }\n    } else if (diff === \"style\") {\n      this.style = get(this.markDiff, \"final\", \"style\");\n    }\n    return this;\n  }\n\n}\n\n\nexport { applyMarkDiffs };\n// Todo\n// Make Test\n","function checkMarkComp(markCompSummary) {\n  const { encode } = markCompSummary;\n  const { marktype } = markCompSummary;\n  const { data } = markCompSummary;\n  const { scales } = markCompSummary;\n\n  if (markCompSummary.isEmpty) {\n    return { result: true };\n  }\n\n  // encode - marktype\n  if (marktype === \"rect\") {\n    const isXEncodeValid = containAnyAttrSet(\n      [\n        [\"x\", \"x2\"],\n        [\"x\", \"width\"],\n        [\"xc\", \"width\"]\n      ],\n      encode\n    );\n    const isYEncodeValid = containAnyAttrSet(\n      [\n        [\"y\", \"y2\"],\n        [\"y\", \"height\"],\n        [\"yc\", \"height\"]\n      ],\n      encode\n    );\n    if (!isXEncodeValid || !isYEncodeValid) {\n      return { result: false, reasons: [\"encode\", \"marktype\"] };\n    }\n  } else if (marktype === \"area\") {\n    const isValid =\n      encode.orient && encode.orient.value === \"horizontal\"\n        ? containAnyAttrSet(\n          [\n            [\"x\", \"x2\", \"y\"],\n            [\"x\", \"y\", \"width\"]\n          ],\n          encode\n        )\n        : containAnyAttrSet(\n          [\n            [\"x\", \"y2\", \"y\"],\n            [\"x\", \"y\", \"height\"]\n          ],\n          encode\n        );\n\n    if (!isValid) {\n      return { result: false, reasons: [\"encode\", \"marktype\"] };\n    }\n  } else if (marktype === \"line\") {\n    const isInValid = containAnyAttrSet(\n      [ [\"x2\", \"x\"], [\"y2\", \"y\"], [\"y\", \"height\"], [\"yc\", \"height\"], [\"x\", \"width\"], [\"xc\", \"width\"] ],\n      encode\n    );\n    if (isInValid) {\n      return { result: false, reasons: [\"encode\", \"marktype\"] };\n    }\n  } else if (marktype === \"text\") {\n    if (!encode.text) {\n      return { result: false, reasons: [\"encode\", \"marktype\"] };\n    }\n  } else if (marktype === \"rule\") {\n    if (\n      !containAnyAttrSet(\n        [\n          [\"x\", \"x2\", \"y\"],\n          [\"y\", \"y2\", \"x\"]\n        ],\n        encode\n      )\n    ) {\n      return { result: false, reasons: [\"encode\", \"marktype\"] };\n    }\n  } else if (!marktype) {\n    return { result: false, reasons: [\"marktype\"] };\n  }\n\n  // encode - data, encode - data - scale, encode - scale\n  const attrs = Object.keys(encode);\n  let valid = true;\n  Object.keys(scales || {}).forEach(scName => {\n    if (!attrs.find(attr => encode[attr] && encode[attr].scale === scName)) {\n      valid = false;\n    }\n  });\n  if (!valid) {\n    return { reasons: [\"encode\", \"scale\"], result: false };\n  }\n\n  for (let i = 0; i < attrs.length; i++) {\n    const enAttr = encode[attrs[i]];\n    if (enAttr && enAttr.scale) {\n      if (!scales[enAttr.scale]) {\n        return { reasons: [\"encode\", \"scale\"], result: false };\n      }\n      if (enAttr.band && scales[enAttr.scale].type !== \"band\") {\n        return { reasons: [\"encode\", \"scale\"], result: false };\n      }\n    }\n    if (enAttr && enAttr.field) {\n      if (data.fields.indexOf(enAttr.field) < 0) {\n        return { result: false, reasons: [\"encode\", \"data\"] };\n      }\n      if (enAttr.scale) {\n        const foundScale = scales[enAttr.scale];\n        const vals = data.values.map(d => d.datum[enAttr.field]);\n        const scaleDomain = foundScale.domain();\n        let valid = true;\n\n        if ([\"band\", \"ordinal\", \"point\"].indexOf(foundScale.type) >= 0) {\n          // for discrete scales\n          valid =\n            valid &&\n            vals.reduce(\n              (acc, v) => (acc = acc && scaleDomain.indexOf(v) >= 0),\n              true\n            );\n        } else if (foundScale.type === \"linear\") {\n          const max = Math.max(...vals);\n          const min = Math.min(...vals);\n          valid = valid && scaleDomain[0] <= min && scaleDomain[1] >= max;\n        } else if (foundScale.type === \"time\") {\n          const max = Math.max(...vals);\n          const min = Math.min(...vals);\n          valid = valid && scaleDomain[0] <= min && scaleDomain[1] >= max;\n        }\n\n        if (!valid) {\n          return { reasons: [\"encode\", \"data\", \"scale\"], result: false };\n        }\n      }\n    }\n  }\n  return { result: true };\n}\n\nfunction containAnyAttrSet(possibleAttrSets, encode) {\n  return possibleAttrSets.reduce((valid, attrs) => {\n    const hasAttrs = attrs.reduce(\n      (hasAttrs, attr) => hasAttrs && encode[attr],\n      true\n    );\n    return valid || hasAttrs;\n  }, false);\n}\n\n// function checkViewAxisConstraint(pseudoTl) {\n//   let yAxisViewChange, markViewChanges = [], xAxisViewChange;\n//   pseudoTl.concat.forEach((stage, i) => {\n//     stage.sync.forEach(pseudoStep => {\n//       let deltaW = get(pseudoStep, \"diff\", \"meta\", \"view\", \"deltaW\"),\n//         deltaH = get(pseudoStep, \"diff\", \"meta\", \"view\", \"deltaH\");\n\n//       if (pseudoStep.diff.compType === \"axis\" && pseudoStep.diff.compName === \"x\" && !xAxisViewChange) {\n//         xAxisViewChange = {\n//           widthChange: deltaW > 0 ? \"inc\" : (deltaW < 0 ? \"dec\" : false),\n//           orient: pseudoStep.diff.initial.orient,\n//           when: i\n//         }\n//       }\n//       if (pseudoStep.diff.compType === \"axis\" && pseudoStep.diff.compName === \"y\" && !yAxisViewChange) {\n//         yAxisViewChange = {\n//           heightChange: deltaH > 0 ? \"inc\" : (deltaH < 0 ? \"dec\" : false),\n//           orient: pseudoStep.diff.initial.orient,\n//           when: i\n//         }\n//       }\n//       if (pseudoStep.diff.compType === \"mark\" ) {\n//         markViewChanges.push({\n//           widthChange: deltaW > 0 ? \"inc\" : (deltaW < 0 ? \"dec\" : false),\n//           heightChange: deltaH > 0 ? \"inc\" : (deltaH < 0 ? \"dec\" : false),\n//           when: i\n//         })\n//       }\n//     })\n//   })\n//   if (xAxisViewChange.orient === \"bottom\") {\n//     if (xAxisViewChange.heightChange === \"inc\") {\n//       if (xAxisViewChange.when > yAxisViewChange.when) {\n//         return false\n//       } else if (xAxisViewChange.when > Math.min(...markViewChanges.map(c => c.when))) {\n//         return false\n//       }\n//     } else if (xAxisViewChange.heightChange === \"dec\") {\n//       if (xAxisViewChange.when < yAxisViewChange.when) {\n//         return false\n//       } else if (xAxisViewChange.when < Math.max(...markViewChanges.map(c => c.when))) {\n//         return false\n//       }\n//     }\n//   } else if (yAxisViewChange.orient === \"right\" &&\n//     yAxisViewChange.heightChange === \"inc\") {\n//     console.error(\"TODO\");\n//   }\n//   return true;\n// }\n\nexport {\n  checkMarkComp\n  // checkViewAxisConstraint as checkViewAxisConstraint\n};\n","import { get, deepEqual } from \"../util/util\";\nimport { MIN_POS_DELTA } from \"./util\";\n\nfunction validate(pseudoTimeline, stageN) {\n  return (\n    checkViewAxisConstraint(pseudoTimeline) &&\n    checkViewLegendConstraint(pseudoTimeline) &&\n    checkUnempty(pseudoTimeline) &&\n    pseudoTimeline.concat.length === stageN &&\n    checkMarkConstraint(pseudoTimeline)\n  );\n}\nfunction checkUnempty(pseudoTl) {\n  return !pseudoTl.concat.find(stage => stage.sync.length === 0);\n}\n\nfunction checkViewAxisConstraint(pseudoTl) {\n  let yAxisViewChange, markViewChanges = [], xAxisViewChange;\n  pseudoTl.concat.forEach((stage, i) => {\n    stage.sync.forEach(pseudoStep => {\n      let deltaW = get(pseudoStep, \"diff\", \"meta\", \"view\", \"x\"),\n        deltaH = get(pseudoStep, \"diff\", \"meta\", \"view\", \"y\");\n\n      if (pseudoStep.diff.compType === \"axis\" && pseudoStep.diff.compName === \"x\" && !xAxisViewChange) {\n        xAxisViewChange = {\n          width: deltaW >= MIN_POS_DELTA ? \"inc\" : (deltaW <= -MIN_POS_DELTA ? \"dec\" : false),\n          height: deltaH >= MIN_POS_DELTA ? \"inc\" : (deltaH <= -MIN_POS_DELTA ? \"dec\" : false),\n          orient: get(pseudoStep, \"diff\", \"initial\", \"orient\") || get(pseudoStep, \"diff\", \"final\", \"orient\"),\n          when: i\n        };\n      }\n      if (pseudoStep.diff.compType === \"axis\" && pseudoStep.diff.compName === \"y\" && !yAxisViewChange) {\n        yAxisViewChange = {\n          width: deltaW >= MIN_POS_DELTA ? \"inc\" : (deltaW <= -MIN_POS_DELTA ? \"dec\" : false),\n          height: deltaH >= MIN_POS_DELTA ? \"inc\" : (deltaH <= -MIN_POS_DELTA ? \"dec\" : false),\n          orient: get(pseudoStep, \"diff\", \"initial\", \"orient\") || get(pseudoStep, \"diff\", \"final\", \"orient\"),\n          when: i\n        };\n      }\n\n      if (pseudoStep.diff.compType === \"mark\" ) {\n        markViewChanges.push({\n          width: deltaW >= MIN_POS_DELTA ? \"inc\" : (deltaW <= -MIN_POS_DELTA ? \"dec\" : false),\n          height: deltaH >= MIN_POS_DELTA ? \"inc\" : (deltaH <= -MIN_POS_DELTA ? \"dec\" : false),\n          when: i\n        });\n      }\n    });\n  });\n\n  for (const condition of [[xAxisViewChange, yAxisViewChange, \"bottom\", \"height\"], [yAxisViewChange, xAxisViewChange, \"right\", \"width\"]]) {\n    let [axis, otherAxis, orient, side] = condition;\n\n    if (get(axis, \"orient\") === orient) {\n      if (axis[side] === \"inc\") {\n        if (axis.when > get(otherAxis, \"when\")) {\n          return false;\n        } if ((markViewChanges.length > 0) &&\n          (axis.when > Math.min(...markViewChanges.map(c => c.when)))) {\n          return false;\n        }\n      } else if (axis[side] === \"dec\") {\n        if (axis.when < get(otherAxis, \"when\")) {\n          return false;\n        } else if ((markViewChanges.length > 0) &&\n          (axis.when < Math.max(...markViewChanges.map(c => c.when)))) {\n          return false;\n        }\n      }\n    }\n  }\n\n  return true;\n}\n\nfunction checkViewLegendConstraint(pseudoTl) {\n  const viewChanges = {\n    marks: [],\n    legends: []\n  };\n\n  pseudoTl.concat.forEach((stage, i) => {\n    stage.sync.forEach(pseudoStep => {\n      const delta = {\n        x: get(pseudoStep, \"diff\", \"meta\", \"view\", \"x\"),\n        y: get(pseudoStep, \"diff\", \"meta\", \"view\", \"y\"),\n        width: get(pseudoStep, \"diff\", \"meta\", \"view\", \"deltaW\"),\n        height: get(pseudoStep, \"diff\", \"meta\", \"view\", \"deltaH\")\n      };\n\n      if ([\"legend\", \"mark\"].indexOf(pseudoStep.diff.compType) >= 0) {\n        const vc = {\n          x:\n            delta.x >= MIN_POS_DELTA\n              ? \"inc\"\n              : delta.x <= -MIN_POS_DELTA\n                ? \"dec\"\n                : false,\n          y:\n            delta.y >= MIN_POS_DELTA\n              ? \"inc\"\n              : delta.y <= -MIN_POS_DELTA\n                ? \"dec\"\n                : false,\n          width:\n            delta.width >= MIN_POS_DELTA\n              ? \"inc\"\n              : delta.width <= -MIN_POS_DELTA\n                ? \"dec\"\n                : false,\n          height:\n            delta.height >= MIN_POS_DELTA\n              ? \"inc\"\n              : delta.height <= -MIN_POS_DELTA\n                ? \"dec\"\n                : false,\n          when: i\n        };\n        if (vc.x || vc.y || vc.width || vc.height) {\n          if (pseudoStep.diff.compType === \"legend\") {\n            vc.orient =\n              get(pseudoStep, \"diff\", \"initial\", \"orient\") ||\n              get(pseudoStep, \"diff\", \"final\", \"orient\") ||\n              \"right\";\n            viewChanges.legends.push(vc);\n          } else {\n            viewChanges.marks.push(vc);\n          }\n        }\n      }\n    });\n  });\n  if (viewChanges.marks.length === 0 || viewChanges.legends.length === 0) {\n    return true;\n  }\n\n  for (const markViewChange of viewChanges.marks) {\n    const rightLegendVCs = viewChanges.legends.filter(\n      vc => vc.orient === \"right\"\n    );\n    if (rightLegendVCs.length > 0) {\n      if (markViewChange.width === \"inc\") {\n        if (\n          markViewChange.when <\n          Math.min(\n            ...rightLegendVCs.filter(vc => vc.x === \"inc\").map(c => c.when)\n          )\n        ) {\n          return false;\n        }\n      } else if (markViewChange.width === \"dec\") {\n        if (\n          markViewChange.when >\n          Math.max(\n            ...rightLegendVCs.filter(vc => vc.x === \"dec\").map(c => c.when)\n          )\n        ) {\n          return false;\n        }\n      }\n    }\n    const bottomLegendVCs = viewChanges.legends.filter(\n      vc => vc.orient === \"bottom\"\n    );\n    if (bottomLegendVCs.length > 0) {\n      if (markViewChange.height === \"inc\") {\n        if (\n          markViewChange.when <\n          Math.min(\n            ...bottomLegendVCs.filter(vc => vc.y === \"inc\").map(c => c.when)\n          )\n        ) {\n          return false;\n        }\n      } else if (markViewChange.height === \"dec\") {\n        if (\n          markViewChange.when >\n          Math.max(\n            ...bottomLegendVCs.filter(vc => vc.y === \"dec\").map(c => c.when)\n          )\n        ) {\n          return false;\n        }\n      }\n    }\n  }\n\n  return true;\n}\n\nfunction checkMarkConstraint(pseudoTl) {\n  for (const stage of pseudoTl.concat) {\n    const markPseduoSteps = stage.sync.filter(\n      pseudoStep => pseudoStep.diff.compType === \"mark\"\n    );\n    for (let i = 0; i < markPseduoSteps.length; i++) {\n      const pseudoStep = markPseduoSteps[i];\n      if (\n        (\n          deepEqual(pseudoStep.factorSets.current, [\"data\"]) ||\n          deepEqual(pseudoStep.factorSets.current, [\"data\", \"marktype\"])\n        ) &&\n        pseudoStep.diff.meta.data.row === false\n      ) {\n        return false;\n      }\n      /*\n      if pseudoStep.factorSets.current has \"data\"\n       && pseudoStep.diff.meta.data.row === false\n       && pseudoStep.diff.initial.encode.\n      */\n    }\n  }\n  return true;\n}\n\nexport { checkViewAxisConstraint, validate, checkUnempty };\n","import { applyMarkDiffs } from \"./diffApplier\";\nimport { checkMarkComp } from \"./markCompChecker\";\nimport { validate } from \"./pseudoTimelineValidator\";\nimport { copy, enumArraysByItems } from \"../util/util\";\nimport { MIN_POS_DELTA } from \"./util\";\n\n// Enuemerate a set of steps (<stageN) by splitting the diffs.\nfunction enumeratePseudoTimelines(diffs, stageN, rawInfo, timing) {\n  // Assume: Axes and legends cannot be splitted\n  // Assume: There is only one mark component. (no add/remove of the mark components)\n\n  // 0. find the mark components.\n  const markDiffs = diffs.compDiffs.filter(\n    diff => diff.compType === \"mark\"\n  );\n\n  const enumedMarksPusedoSteps = markDiffs.map(markDiff => {\n    // 1. find valid splitting factors of the mark components.\n    const { allFactors, extraFactorsByMarktype } = findAllFactors(markDiff);\n\n    // 2. enumerate by assigning a value among [0, ..., stageN -1] on each factor\n    const skippingCondition = new SkippingConditions();\n    const enumed = [];\n\n    for (let i = 0; i < Math.pow(stageN, allFactors.length); i++) {\n      const factorAssignment = getFactorAssignment(i, allFactors.length, stageN);\n\n      let valid = true;\n      const factorSets = [];\n      for (let j = 0; j < stageN - 1; j++) {\n        const applyingFactors = allFactors.filter((factor, factorId) => {\n          return factorAssignment[factorId] >= stageN - j - 1;\n        });\n\n        if (skippingCondition.check(applyingFactors)) {\n          valid = false;\n          break;\n        }\n\n        const markCompSummary = applyMarkDiffs(\n          markDiff,\n          applyingFactors,\n          rawInfo,\n          extraFactorsByMarktype\n        );\n        // 3. Check if the intermediate mark components are valid. If not, exclude the enumerated steps.\n        const { reasons } = checkMarkComp(markCompSummary);\n\n        if (reasons) {\n          // register a new skipping condition\n          const newSkippingCondition = allFactors\n            .filter(factor =>\n              reasons.find(reason => factor.indexOf(reason) >= 0)\n            )\n            .map(factor => {\n              return {factor, include: applyingFactors.indexOf(factor) >= 0};\n            });\n          skippingCondition.register(newSkippingCondition);\n\n          valid = false;\n          break;\n        } else if (\n          !factorSets.find(\n            appFctrs => appFctrs.toString() === applyingFactors.toString()\n          )\n        ) {\n          factorSets.push(applyingFactors);\n        }\n      }\n\n      if (valid) {\n        factorSets.push(allFactors);\n        if (\n          !enumed.find(\n            fctrSets => fctrSets.toString() === factorSets.toString()\n          )\n        ) {\n          enumed.push(factorSets);\n        }\n      }\n    }\n\n    return enumed.map(factorSets => {\n      let prevFactorSet;\n      return factorSets.map(factorSet => {\n        let newPseudoStep = {\n          diff: markDiff,\n          factorSets: {\n            current: prevFactorSet\n              ? factorSet.exclude(prevFactorSet)\n              : factorSet,\n            applied: factorSet,\n            all: allFactors,\n            extraByMarktype: extraFactorsByMarktype\n          }\n        };\n        prevFactorSet = factorSet;\n        return newPseudoStep;\n      });\n    });\n\n  });\n\n  const axespseudoSteps = getAxisPseudoSteps(diffs);\n\n  const legendspseudoSteps = getLegendPseudoSteps(diffs);\n\n  let pseudoTimelines;\n  if (enumedMarksPusedoSteps.length === 1) {\n    pseudoTimelines = enumArraysByItems(\n      enumedMarksPusedoSteps[0],\n      legendspseudoSteps.concat(axespseudoSteps),\n      enumTlByStep\n    ).map(pseudoTl => {\n      return {\n        concat: pseudoTl.map(stage => {\n          return { sync: Array.isArray(stage) ? stage : [stage] };\n        })\n      };\n    });\n  } else {\n    console.error(\n      \"Currently, Gemini Recommendation only supports a single mark without adding or removing.\"\n    );\n    console.error(\"TODO: cross join the pseudo timelines of each mark.\");\n  }\n\n  return (\n    pseudoTimelines\n      .map(pseudoTl => {\n        pseudoTl.concat = pseudoTl.concat.map(stage => {\n          let currSync = stage.sync;\n\n          // filter empty mark pStep\n          currSync = currSync.filter(pStep => {\n            return (pStep.diff.compType !== \"mark\") ||\n              (\n                !(\n                  (pStep.factorSets.applied.length === 0) ||\n                  (pStep.factorSets.current.length === 0)\n                ) &&\n                !(\n                  (pStep.factorSets.all.indexOf(\"add\") >= 0) &&\n                  (pStep.factorSets.applied.indexOf(\"add\") < 0)\n                ) &&\n                !(\n                  (pStep.factorSets.all.indexOf(\"remove\") >= 0) &&\n                  (pStep.factorSets.applied.length !== pStep.factorSets.current.length)\n                )\n              );\n\n          });\n\n\n\n          return { sync: currSync };\n        });\n        return pseudoTl;\n      })\n      .filter(pseudoTl => validate(pseudoTl, stageN))\n      // .map((pseudoTl, i) => appendGuideMoves(pseudoTl, axespseudoSteps, legendspseudoSteps))\n      .map(pseudoTl => appendViewDiff(pseudoTl, diffs.viewDiffs))\n      .map(pseudoTl => appendGridChanges(pseudoTl))\n      .map(pseudoTl => appendTiming(pseudoTl, timing))\n  );\n}\n\nfunction appendTiming(pseudoTl, timing = {}) {\n  const totalDuration = timing.totalDuration || 2000;\n  pseudoTl.concat.forEach(stage => {\n    for (const pseudoStep of stage.sync) {\n      pseudoStep.timing = {\n        duration: { ratio: Math.floor(100 / pseudoTl.concat.length) / 100 }\n      };\n\n    }\n  });\n  pseudoTl.totalDuration = totalDuration;\n  return pseudoTl;\n}\nfunction getLegendPseudoSteps(diffs) {\n  return diffs.compDiffs\n    .filter(\n      diff =>\n        diff.compType === \"legend\" &&\n        (diff.meta.scale ||\n          diff.meta.encode ||\n          diff.meta.add ||\n          diff.meta.remove ||\n          Math.abs(diff.meta.view.x) - MIN_POS_DELTA > 0 ||\n          Math.abs(diff.meta.view.y) - MIN_POS_DELTA > 0 ||\n          Math.abs(diff.meta.view.deltaH) - MIN_POS_DELTA > 0 ||\n          Math.abs(diff.meta.view.deltaW) - MIN_POS_DELTA > 0)\n    )\n    .reduce((steps, diff) => {\n      let factors = [];\n      if (diff.meta.add) {\n        factors = [`add.${diff.meta.usedScales.sort().join(\"_\")}`];\n      } else if (diff.meta.remove) {\n        factors = [`remove.${diff.meta.usedScales.sort().join(\"_\")}`];\n      } else {\n        if (diff.meta.scale) {\n          factors = factors.concat(Object.keys(diff.meta.scale).map(scName => `scale.${scName}`));\n        }\n        if (diff.meta.encode) {\n          factors.push(\"encode\");\n        }\n        if (diff.meta.view.x !== 0 || diff.meta.view.y !== 0) {\n          factors.push(\"encode.position\");\n        }\n      }\n\n      // return steps.concat(\n      //   factors.map(fctr => {\n      //     return { diff: diff, factorSets: {current: [fctr],  all: factors} }\n      //   })\n      // );\n      return steps.concat({ diff, factorSets: {current: factors,  all: factors} });\n    }, []);\n}\nfunction getAxisPseudoSteps(diffs) {\n  return diffs.compDiffs\n    .filter(\n      diff =>\n        diff.compType === \"axis\" &&\n        (diff.meta.scale ||\n          diff.meta.encode ||\n          diff.meta.add ||\n          diff.meta.remove ||\n          Math.abs(diff.meta.view.x) - MIN_POS_DELTA > 0 ||\n          Math.abs(diff.meta.view.y) - MIN_POS_DELTA > 0 ||\n          Math.abs(diff.meta.view.deltaH) - MIN_POS_DELTA > 0 ||\n          Math.abs(diff.meta.view.deltaW) - MIN_POS_DELTA > 0)\n    )\n    .filter(diff => {\n      if (diff.meta.scale[diff.meta.usedScales[0]]) {\n        const scaleDiff = diff.meta.scale[diff.meta.usedScales[0]];\n        return scaleDiff.rangeDelta === 0 &&\n          !scaleDiff.domainValueDiff &&\n          scaleDiff.stayDiscrete\n          ? false\n          : true;\n      }\n      return true;\n    })\n    .map(diff => {\n      let factors = [];\n      if (diff.meta.add) {\n        factors = [`add.${diff.compName}`];\n      } else if (diff.meta.remove) {\n        factors = [`remove.${diff.compName}`];\n      } else {\n        if (diff.meta.scale) {\n          factors = factors.concat(Object.keys(diff.meta.scale).map(scName => `scale.${scName}`));\n          factors.push(\"encode\");\n        }\n\n        if (diff.meta.view.x !== 0 || diff.meta.view.y !== 0) {\n          factors.push(\"encode.position\");\n        }\n      }\n      return { diff, factorSets: {current: factors, applied: factors, all: factors} };\n    });\n}\n\n\nfunction appendViewDiff(pseudoTl, viewDiffs) {\n  const done = {\n    increase: { width: false, height: false },\n    decrease: { width: false, height: false }\n  };\n  function appendDiff(stage, incOrDec) {\n    for (const which of [\"width\", \"height\"]) {\n      if (\n        viewDiffs[which][incOrDec] &&\n        needViewDiff(stage.sync, incOrDec, which) &&\n        !done[incOrDec][which]\n      ) {\n        const found = stage.sync.find(pStep => pStep.diff.compType === \"view\");\n        if (found) {\n          found.factorSets.current.push(which);\n        } else {\n          stage.sync.push({\n\n            diff: {\n              compName: viewDiffs.compName,\n              compType: viewDiffs.compType,\n              meta: viewDiffs\n            },\n            factorSets: { current: [which] }\n          });\n        }\n\n        done[incOrDec][which] = true;\n      }\n    }\n\n    return stage;\n  }\n  return {\n    concat: pseudoTl.concat\n      .map((stage, j) => appendDiff(stage, \"increase\", j))\n      .reverse()\n      .map(stage => appendDiff(stage, \"decrease\"))\n      .reverse()\n  };\n}\nfunction needViewDiff(pseudoSteps, incOrDec, which) {\n  for (const pseudoStep of pseudoSteps.filter(\n    step => [\"mark\", \"axis\", \"legend\"].indexOf(step.diff.compType) >= 0\n  )) {\n    let deltaProp = which === \"width\" ? \"x\" : \"y\";\n    if (pseudoStep.diff.compType === \"mark\") {\n      deltaProp = which === \"width\" ? \"deltaW\" : \"deltaH\";\n    } else if (pseudoStep.diff.compType === \"axis\") {\n      if (\n        [\"left\", \"top\"].indexOf(\n          (pseudoStep.diff.initial || pseudoStep.diff.final).orient\n        ) >= 0\n      ) {\n        deltaProp = which === \"width\" ? \"deltaW\" : \"deltaH\";\n      }\n    }\n    let hasViwRelatedScaleDiff = true;\n    if (pseudoStep.diff.compType === \"mark\") {\n      hasViwRelatedScaleDiff =\n        pseudoStep.factorSets.current.indexOf(\n          which === \"width\" ? \"scale.x\" : \"scale.y\"\n        ) >= 0;\n    }\n\n    if (\n      pseudoStep.diff.meta.view[deltaProp] >= MIN_POS_DELTA &&\n      incOrDec === \"increase\" &&\n      hasViwRelatedScaleDiff\n    ) {\n      return true;\n    }\n    if (\n      pseudoStep.diff.meta.view[deltaProp] <= -MIN_POS_DELTA &&\n      incOrDec === \"decrease\" &&\n      hasViwRelatedScaleDiff\n    ) {\n      return true;\n    }\n  }\n  return false;\n}\n\n// When the size of the mark view changes, grid lines should be extended.\nfunction appendGridChanges(pseudoTl) {\n  // Currently only one pStep is generated.\n  let xAxisPStep, yAxisPStep;\n  pseudoTl.concat.forEach(stage => {\n    xAxisPStep = xAxisPStep || stage.sync.find(aPStep =>\n      !aPStep.diff.meta.add &&\n      !aPStep.diff.meta.remove &&\n      aPStep.diff.compType === \"axis\" &&\n      aPStep.diff.meta.scNames[0] === \"x\");\n    yAxisPStep = yAxisPStep || stage.sync.find(aPStep =>\n      !aPStep.diff.meta.add &&\n      !aPStep.diff.meta.remove &&\n      aPStep.diff.compType === \"axis\" &&\n      aPStep.diff.meta.scNames[0] === \"y\");\n  });\n\n  if (!xAxisPStep && !yAxisPStep) {\n    return pseudoTl;\n  }\n  return {\n    ...pseudoTl,\n    concat: pseudoTl.concat.map(stage => {\n      let newStage = copy(stage);\n      // if there is any mark.view change\n      if ( stage.sync.find(pStep => [\"mark\", \"axis\"].indexOf(pStep.diff.compType) >= 0 && pStep.diff.meta.view.deltaH !== 0) ) {\n        if (xAxisPStep && !stage.sync.find(pStep => pStep.diff.compType === \"axis\" && pStep.diff.meta.scNames[0] === \"x\")) {\n\n          xAxisPStep.factorSets.all.push(\"encode.only.grid\");\n          let gridChangingAxisPStep = {\n            ...xAxisPStep,\n            factorSets: {\n              all: copy(xAxisPStep.factorSets.all),\n              applied: [\"encode.only.grid\"],\n              current: [\"encode.only.grid\"]\n            }\n          };\n          xAxisPStep.factorSets.applied.push(\"encode.only.grid\");\n          newStage.sync.push(gridChangingAxisPStep);\n        }\n      }\n\n      if ( stage.sync.find(pStep => [\"mark\", \"axis\"].indexOf(pStep.diff.compType) >= 0 && pStep.diff.meta.view.deltaW !== 0) ) {\n        if (yAxisPStep && !stage.sync.find(pStep => pStep.diff.compType === \"axis\" && pStep.diff.meta.scNames[0] === \"y\")) {\n          yAxisPStep.factorSets.all.push(\"encode.only.grid\");\n          let gridChangingAxisPStep = {\n            ...yAxisPStep,\n            factorSets: {\n              all: copy(yAxisPStep.factorSets.all),\n              applied: [\"encode.only.grid\"],\n              current: [\"encode.only.grid\"]\n            }\n          };\n          yAxisPStep.factorSets.applied.push(\"encode.only.grid\");\n          newStage.sync.push(gridChangingAxisPStep);\n        }\n      }\n\n      return newStage;\n    })\n  };\n\n}\nfunction enumTlByStep(Tl, step) {\n  const newTls = [];\n  for (let i = 0; i < Tl.length; i++) {\n    const newTl = copy(Tl);\n    if (!Array.isArray(newTl[i])) {\n      newTl[i] = [newTl[i]];\n    }\n    const found = newTl[i].find(stp => stp.diff.compName === step.diff.compName);\n    if (found) {\n      found.factorSets.current = found.factorSets.current.concat(\n        step.factorSets.current\n      );\n    } else {\n      newTl[i].push(step);\n    }\n\n    newTls.push(newTl);\n  }\n  return newTls;\n}\n\n// choose the factors having diffs between initial and final.\nfunction findAllFactors(markDiff) {\n  const allFactors = [];\n  let diffInfo = markDiff.meta;\n  let extraFactorsByMarktype = [];\n  if (diffInfo.add) {\n    allFactors.push(\"add\");\n  }\n\n  if (diffInfo.remove) {\n    allFactors.push(\"remove\");\n    return { allFactors, extraFactorsByMarktype };\n  }\n\n  if (diffInfo.marktype) {\n    allFactors.push(\"marktype\");\n    extraFactorsByMarktype.push(\"encode.others\");\n  }\n  if (diffInfo.data) {\n    if (diffInfo.data.row !== false || diffInfo.data.column !== \"removed\") {\n      allFactors.push(\"data\");\n    }\n  }\n  if (diffInfo.scale) {\n    Object.keys(diffInfo.scale).forEach(scName => {\n      const scaleDiff = diffInfo.scale[scName];\n      if (scaleDiff) {\n        allFactors.push(`scale.${scName}`);\n      }\n    });\n  }\n  Object.keys(diffInfo.encode).forEach(chName => {\n    const chDiff = diffInfo.encode[chName];\n    if (chDiff === true) {\n      allFactors.push(`encode.${chName}`);\n    } else if (chDiff === \"byMarktypeChange\") {\n      extraFactorsByMarktype.push(`encode.${chName}`);\n    }\n  });\n  return { allFactors, extraFactorsByMarktype };\n}\n\nfunction getFactorAssignment(i, factorLen, stageN) {\n  let quotient = i;\n  const assignment = new Array(factorLen);\n  for (let j = 0; j < factorLen; j++) {\n    assignment[j] = quotient % stageN;\n    quotient = Math.floor(quotient / stageN);\n  }\n  return assignment;\n}\n\nclass SkippingConditions {\n  constructor() {\n    this.registered = [];\n  }\n\n  register(condition) {\n    this.registered.push(condition);\n  }\n\n  check(factors) {\n    for (let i = 0; i < this.registered.length; i++) {\n      const condition = this.registered[i];\n      const result = condition.reduce((satisfying, condF) => {\n        return (satisfying =\n          satisfying && factors.indexOf(condF.factor) >= 0 === condF.include);\n      }, true);\n\n      if (result) {\n        return true;\n      }\n    }\n    return false;\n  }\n}\n\nexport { findAllFactors, SkippingConditions, enumeratePseudoTimelines };\n\n// legendspseudoSteps.map(pStep => pStep.diff.compName)\n//   .unique()\n//   .forEach(legendName => {\n//   let mergedLegendStep = mergePusedoSteps(currSync.filter(pStep => pStep.diff.compName === legendName))\n//   if (mergedLegendStep){\n//     currSync = currSync.filter(pStep => pStep.diff.compName !== legendName).concat([mergedLegendStep])\n//   }\n// });\n// function mergePusedoSteps(pSteps) {\n//   if (pSteps.length === 0) {\n//     return;\n//   }\n//   const merged = copy(pSteps[0]);\n//   merged.factorSets = {\n//     applied: pSteps.reduce((applied, pStep) => applied.concat(pStep.factorSets ? pStep.factorSets.applied : []), []),\n//     all: merged.factorSets ? merged.factorSets.all : [],\n//     extraByMarktype: merged.factorSets ? merged.factorSets.extraByMarktype : []\n//   }\n\n//   return merged;\n// }\n\n// function appendGuideMoves(pseudoTl, axespseudoSteps, legendspseudoSteps) {\n//   let bottomAxisPStep = axespseudoSteps.find(pStep =>\n//     (pStep.diff.initial && pStep.diff.initial.orient === \"bottom\") &&\n//     (pStep.diff.final && pStep.diff.final.orient === \"bottom\")\n//   );\n//   let rightLegendPStep = legendspseudoSteps.find(pStep =>\n//     (pStep.diff.initial && pStep.diff.initial.orient === \"right\") &&\n//     (pStep.diff.final && pStep.diff.final.orient === \"right\")\n//   );\n//   let bottomAxisMoved = false;\n//   pseudoTl.concat.forEach(stage => {\n//     let markPseudoSteps = stage.sync.filter(pStep => pStep.diff.compType === \"mark\");\n//     let widthChange = !!markPseudoSteps.find(mPseudoStep =>\n//       mPseudoStep.factorSets.current.indexOf(\"scale.x\") >= 0 && mPseudoStep.diff.meta.view.deltaW !== 0\n//     );\n\n//     if (bottomAxisPStep) {\n//       let thisbottomAxisPStep = stage.sync.find(pStep => pStep.diff.compName === bottomAxisPStep.diff.compName );\n//       if (bottomAxisMoved && thisbottomAxisPStep) {\n//         thisbottomAxisPStep.factorSets.current = thisbottomAxisPStep.factorSets.current.filter(fctr => fctr !== \"encode.position\");\n//       }\n\n//       if ((markPseudoSteps.length > 0)) {\n//         let heightChange = !!markPseudoSteps.find(mPseudoStep =>\n//           mPseudoStep.factorSets.current.indexOf(\"scale.y\") >= 0 && mPseudoStep.diff.meta.view.deltaH !== 0\n//         );\n//         if (heightChange) {\n//           // If marks height change, the bottom axis should move\n//           if (!thisbottomAxisPStep && !bottomAxisMoved) {\n//             // add axisPStep only changing axisG\n//             stage.sync.push({\n//               diff: bottomAxisPStep.diff,\n//               factorSets: {\n//                 current: [\"encode.position\"],\n//                 applied: [\"encode.position\"],\n//                 all: bottomAxisPStep.factorSets.all\n//               }\n//             })\n//           }\n//           bottomAxisMoved = true;\n//         } else {\n//           // If marks height does not change, the bottom axis should not move\n//           if (thisbottomAxisPStep && !bottomAxisMoved) {\n//             // bottomAxisPStep should not move\n//             thisbottomAxisPStep.factorSets.current = thisbottomAxisPStep.factorSets.current.filter(fctr => fctr !== \"encode.position\")\n\n//           }\n//           bottomAxisMoved = false;\n//         }\n//       } else {\n//         if (thisbottomAxisPStep) {\n//           bottomAxisMoved = true;\n//         }\n//       }\n//     }\n\n//   })\n\n//   return pseudoTl;\n//   // If marks width change, the right axis should move\n//   // If marks width change, the right legend should move\n\n//   // If marks width does nont change, the right axis should  not move\n//   // If marks width does not change, the right legend should not move\n// }","import { get } from \"../util/util\";\n\nexport function PERCEPTION_CAP(duration) {\n  // if (duration < 0) {\n  //   console.error(\"Duration cannot be negative!\");\n  // } else if (duration <= 0) {\n  //   return 0.3\n  // } else if (duration <= 667) {\n  //   return 0.5\n  // } else if (duration <= 1000) {\n  //   return 0.8\n  // } else if (duration <= 2000) {\n  //   return 1.0\n  // } else\n  //   return 1.5\n  // }\n  // return 1.00 / (1 + Math.exp(-(duration-1250)/180)) + 0.4\n  // return 1.00 / (1 + Math.exp(-(duration-1250)/180)) + 0.35\n  return 1.4 / (1 + Math.exp(-(duration - 1200) / 300));\n}\n\n// Tuning for the mturk study\n// // Stimulus 1\n// stage1-rank1 > stage3-rank1, stage2-rank2, stage2-rank3\n// stage2-rank1 > stage3-rank1, stage2-rank2, stage2-rank3\n\n// // Stimulus 2\n// s1R1 > *\n\n// // Stimulus 3\n// stage1-rank1 > *\n// stage2-rank1 > stage2-rank2, stage3-rank1\n\n// // Stimulus 4\n// stage1-rank1 > stage2-rank3\n\nconst sameDomain = (pseudoStep, foundFactor) => {\n  return (\n    get(\n      pseudoStep,\n      \"diff\",\n      \"meta\",\n      \"scale\",\n      foundFactor.split(\".\")[1],\n      \"domainSpaceDiff\"\n    ) === false\n  );\n};\nconst diffDomain = (pseudoStep, foundFactor) => {\n  return (\n    get(\n      pseudoStep,\n      \"diff\",\n      \"meta\",\n      \"scale\",\n      foundFactor.split(\".\")[1],\n      \"domainSpaceDiff\"\n    ) === true\n  );\n};\nconst noFactors = factors => {\n  return function(pseudoStep) {\n    for (const fctr of factors) {\n      if (pseudoStep.factorSets.current.indexOf(fctr) >= 0) {\n        return false;\n      }\n    }\n    return true;\n  };\n};\nexport const PERCEPTION_COST = {\n  mark: [\n    { factor: \"marktype\", cost: 0.3 },\n    { factor: \"data\", cost: 0.5 },\n    { factor: \"scale.y\", cost: 0.4, with: [sameDomain] },\n    { factor: \"scale.x\", cost: 0.4, with: [sameDomain] },\n    { factor: \"scale.color\", cost: 0.4, with: [sameDomain] },\n    { factor: \"scale.shape\", cost: 0.4, with: [sameDomain] },\n    { factor: \"scale.size\", cost: 0.4, with: [sameDomain] },\n    { factor: \"scale.y\", cost: 0.65, without: [sameDomain] },\n    { factor: \"scale.x\", cost: 0.65, without: [sameDomain] },\n    { factor: \"scale.color\", cost: 0.65, without: [sameDomain] },\n    { factor: \"scale.shape\", cost: 0.65, without: [sameDomain] },\n    { factor: \"scale.size\", cost: 0.65, without: [sameDomain] },\n    { factor: \"encode.x\", cost: 0.3 },\n    { factor: \"encode.y\", cost: 0.3 },\n    { factor: \"encode.color\", cost: 0.3 },\n    { factor: \"encode.shape\", cost: 0.3 },\n    { factor: \"encode.size\", cost: 0.3 },\n    { factor: \"encode.opacity\", cost: 0.2 }\n  ],\n  axis: [\n    // { factor: \"scale.*\", cost: 0.7 },\n    // { factor: \"add.*\", cost: 1 },\n    // { factor: \"remove.*\", cost: 1 },\n    { factor: \"encode\", cost: 0.3 },\n    { factor: \"scale\", cost: 0.5, with: [sameDomain] },\n    { factor: \"add\", cost: 0.7 },\n    { factor: \"remove\", cost: 0.7 },\n    { factor: \"scale\", cost: 1, without: [sameDomain] }\n  ],\n  legend: [\n    // { factor: \"scale.*\", cost: 0.7 },\n    // { factor: \"add.*\", cost: 1 },\n    // { factor: \"remove.*\", cost: 1 },\n    { factor: \"encode\", cost: 0.3 },\n    { factor: \"scale\", cost: 0.5, with: [sameDomain] },\n    { factor: \"add\", cost: 0.7 },\n    { factor: \"remove\", cost: 0.7 },\n    { factor: \"scale\", cost: 1, without: [sameDomain] }\n  ]\n};\n\nexport const PENALTY_COMBOS = [\n  {\n    chunks: [\n      [\n        {\n          compType: \"mark\",\n          factor: \"scale.y\",\n          with: [diffDomain, noFactors([\"encode.y\"])]\n        }\n      ]\n    ],\n    cost: 1.0\n  },\n  {\n    chunks: [\n      [\n        {\n          compType: \"mark\",\n          factor: \"scale.x\",\n          with: [diffDomain, noFactors([\"encode.x\"])]\n        }\n      ]\n    ],\n    cost: 1.0\n  },\n  {\n    chunks: [\n      [\n        {\n          compType: \"mark\",\n          factor: \"scale.size\",\n          with: [diffDomain, noFactors([\"encode.size\"])]\n        }\n      ]\n    ],\n    cost: 1.0\n  },\n  {\n    chunks: [\n      [\n        {\n          compType: \"mark\",\n          factor: \"scale.color\",\n          with: [diffDomain, noFactors([\"encode.color\"])]\n        }\n      ]\n    ],\n    cost: 1.0\n  }\n];\n\nexport const DISCOUNT_COMBOS = [\n  {\n    chunks: [\n      [\n        { compType: \"mark\", factor: \"scale.y\", with: [sameDomain] },\n        { compType: \"mark\", factor: \"scale.x\", with: [sameDomain] }\n      ]\n    ],\n    cost: -0.2\n  },\n  {\n    chunks: [\n      [\n        { compType: \"mark\", factor: \"scale.size\" },\n        { compType: \"mark\", factor: \"scale.shape\" }\n      ],\n      [\n        { compType: \"mark\", factor: \"scale.color\" },\n        { compType: \"mark\", factor: \"scale.shape\" }\n      ],\n      [\n        { compType: \"mark\", factor: \"scale.color\" },\n        { compType: \"mark\", factor: \"scale.size\" }\n      ],\n      [\n        { compType: \"mark\", factor: \"scale.size\" },\n        { compType: \"mark\", factor: \"scale.opacity\" }\n      ],\n      [\n        { compType: \"mark\", factor: \"scale.opacity\" },\n        { compType: \"mark\", factor: \"scale.shape\" }\n      ],\n      [\n        { compType: \"mark\", factor: \"scale.color\" },\n        { compType: \"mark\", factor: \"scale.opacity\" }\n      ],\n      [\n        { compType: \"mark\", factor: \"scale.color\" },\n        { compType: \"mark\", factor: \"scale.size\" },\n        { compType: \"mark\", factor: \"scale.shape\" }\n      ],\n      [\n        { compType: \"mark\", factor: \"scale.size\" },\n        { compType: \"mark\", factor: \"scale.shape\" },\n        { compType: \"mark\", factor: \"scale.opacity\" }\n      ],\n      [\n        { compType: \"mark\", factor: \"scale.color\" },\n        { compType: \"mark\", factor: \"scale.shape\" },\n        { compType: \"mark\", factor: \"scale.opacity\" }\n      ],\n      [\n        { compType: \"mark\", factor: \"scale.color\" },\n        { compType: \"mark\", factor: \"scale.size\" },\n        { compType: \"mark\", factor: \"scale.opacity\" }\n      ],\n      [\n        { compType: \"mark\", factor: \"scale.color\" },\n        { compType: \"mark\", factor: \"scale.size\" },\n        { compType: \"mark\", factor: \"scale.opacity\" },\n        { compType: \"mark\", factor: \"scale.shape\" }\n      ]\n    ],\n    cost: -0.1\n  },\n  {\n    chunks: [\n      [\n        { compType: \"mark\", factor: \"scale.y\", with: [sameDomain] },\n        { compType: \"axis\", factor: \"scale.y\", with: [sameDomain] }\n      ]\n    ],\n    cost: -0.5\n  },\n  {\n    chunks: [\n      [\n        { compType: \"mark\", factor: \"scale.y\", with: [diffDomain] },\n        { compType: \"axis\", factor: \"scale.y\", with: [diffDomain] }\n      ]\n    ],\n    cost: -1\n  },\n  {\n    chunks: [\n      [\n        { compType: \"mark\", factor: \"encode.y\" },\n        { compType: \"axis\", factor: \"add.y\" }\n      ],\n      [\n        { compType: \"mark\", factor: \"encode.y\" },\n        { compType: \"axis\", factor: \"remove.y\" }\n      ]\n    ],\n    cost: -0.7\n  },\n  {\n    chunks: [\n      [\n        { compType: \"mark\", factor: \"scale.x\", with: [sameDomain] },\n        { compType: \"axis\", factor: \"scale.x\", with: [sameDomain] }\n      ]\n    ],\n    cost: -0.5\n  },\n  {\n    chunks: [\n      [\n        { compType: \"mark\", factor: \"scale.x\", with: [diffDomain] },\n        { compType: \"axis\", factor: \"scale.x\", with: [diffDomain] }\n      ]\n    ],\n    cost: -1\n  },\n  {\n    chunks: [\n      [\n        { compType: \"mark\", factor: \"encode.x\" },\n        { compType: \"axis\", factor: \"add.x\" }\n      ],\n      [\n        { compType: \"mark\", factor: \"encode.x\" },\n        { compType: \"axis\", factor: \"remove.x\" }\n      ]\n    ],\n    cost: -0.7\n  },\n  {\n    chunks: [\n      [\n        { compType: \"mark\", factor: \"scale.color\" },\n        { compType: \"legend\", contain: \"color\" }\n      ]\n    ],\n    cost: -0.5\n  },\n  {\n    chunks: [\n      [\n        { compType: \"mark\", factor: \"scale.size\" },\n        { compType: \"legend\", contain: \"size\" }\n      ]\n    ],\n    cost: -0.5\n  },\n  {\n    chunks: [\n      [\n        { compType: \"mark\", factor: \"scale.shape\" },\n        { compType: \"legend\", contain: \"shape\" }\n      ]\n    ],\n    cost: -0.5\n  }\n];\n","import { roundUp, variance, mean } from \"../util/util\";\nimport * as DG from \"./designGuidelines\";\n\nfunction evaluate(pseudoTimeline) {\n  const stageCosts = [];\n  const cappedStageCosts = [];\n  const N = pseudoTimeline.concat.length;\n  const cost = pseudoTimeline.concat.reduce((cost, stage, i) => {\n    const totalCost = stage.sync.reduce((sum, pseudoStep) => {\n      pseudoStep.meta = { cost: getCost(pseudoStep) };\n      return sum + getCost(pseudoStep);\n    }, 0);\n    const comboCost = getComboCost(stage.sync);\n    const dur = pseudoTimeline.totalDuration / pseudoTimeline.concat.length;\n    const cap = DG.PERCEPTION_CAP(dur) * Math.pow(0.99, N - 1 - i);\n    stage.meta = {\n      totalCost: roundUp(totalCost),\n      comboCost: roundUp(comboCost),\n      cap,\n      cost: roundUp(Math.max(totalCost + comboCost - cap, 0))\n    };\n    stageCosts.push(Math.max(totalCost + comboCost));\n    cappedStageCosts.push(Math.max(totalCost + comboCost - cap, 0));\n    return cost + Math.max(totalCost + comboCost - cap, 0);\n  }, 0);\n\n  return {\n    cost: roundUp(cost),\n    tiebreaker: mean(stageCosts),\n    tiebreaker2: variance(cappedStageCosts)\n  };\n}\n\nfunction getComboCost(pseudoSteps) {\n  const check = (piece, factorSet) => {\n    return factorSet.find(\n      fctr => fctr === piece.factor || fctr.indexOf(piece.contain) >= 0\n    );\n  };\n\n  return DG.DISCOUNT_COMBOS.concat(DG.PENALTY_COMBOS).reduce(\n    (totalDiscount, combo) => {\n      for (const chunk of combo.chunks) {\n        const isChunk = chunk.reduce((isChunk, piece) => {\n          const found = pseudoSteps.find(pStep => {\n            return (\n              pStep.diff.compType === piece.compType &&\n              check(piece, pStep.factorSets.current)\n            );\n          });\n          if (!found) {\n            return false;\n          }\n\n          if (piece.with) {\n            isChunk = piece.with.reduce((isChunk, subCondition) => {\n              return isChunk && subCondition(found, piece.factor);\n            }, isChunk);\n          }\n\n          return isChunk && !!found;\n        }, true);\n        if (isChunk) {\n          totalDiscount += combo.cost;\n          break;\n        }\n      }\n      return totalDiscount;\n    },\n    0\n  );\n}\n\nfunction getCost(pseudoStep) {\n  // Todo\n  if (\n    pseudoStep.diff.compType === \"view\" ||\n    pseudoStep.diff.compType === \"pause\"\n  ) {\n    return 0;\n  }\n  let stepCost = 0;\n  for (const condition of DG.PERCEPTION_COST[pseudoStep.diff.compType]) {\n    const foundFactor = pseudoStep.factorSets.current.find(\n      fctr => fctr.indexOf(condition.factor) >= 0\n    );\n    let with_without = true;\n    if (foundFactor && condition.with) {\n      with_without = condition.with.reduce((sat, subCondition) => {\n        return sat && subCondition(pseudoStep, foundFactor);\n      }, true);\n    } else if (foundFactor && condition.without) {\n      with_without = condition.without.reduce((sat, subCondition) => {\n        return sat && !subCondition(pseudoStep, foundFactor);\n      }, true);\n    }\n\n    stepCost += foundFactor && with_without ? condition.cost : 0;\n  }\n  return stepCost;\n}\n\nexport { getComboCost, getCost, evaluate };\n","import { CHANNEL_TO_ATTRS_OBJ } from \"./util\";\nimport { copy, get, isEmpty } from \"../util/util\";\n\nfunction generateTimeline(pseudoTimeline, userInput, includeMeta) {\n  // Assume: pseudoTimeline = {concat: [ {sync: [...] }, {sync: [...]}, ...]}\n  // Assume: userInput= {marks: {...}, axes: {...}, legends: {...}, scales: {...}}\n  let defaultOpt = {\n    timing: {\n      duration: {\n        ratio: Math.floor(100 / pseudoTimeline.concat.length) / 100\n      }\n    }\n  };\n  if (userInput.global) {\n    defaultOpt = Object.assign(defaultOpt, userInput.global);\n  }\n  let opt;\n\n  const newConcat = pseudoTimeline.concat.map(syncBlock => {\n    return {\n      sync: syncBlock.sync.map(pseudoStep => {\n        let step;\n        switch (pseudoStep.diff.compType) {\n        case \"mark\":\n          opt = Object.assign(\n            {},\n            defaultOpt,\n            get(userInput, \"marks\", pseudoStep.diff.compName) || {}\n          );\n          step = generateMarkCompStep(pseudoStep, opt);\n          break;\n        case \"axis\":\n          opt = Object.assign(\n            {},\n            defaultOpt,\n            get(userInput, \"axes\", pseudoStep.diff.compName) || {}\n          );\n          step = generateAxisCompStep(pseudoStep, opt);\n          break;\n        case \"legend\":\n          opt = Object.assign(\n            {},\n            defaultOpt,\n            get(userInput, \"legends\", pseudoStep.diff.compName) || {}\n          );\n          step = generateLegendCompStep(pseudoStep, opt);\n          break;\n        case \"view\":\n          step = generateViewCompStep(pseudoStep, opt);\n          break;\n        }\n        if (includeMeta) {\n          step.meta = pseudoStep.meta;\n        }\n\n        return step;\n      }),\n      ...(includeMeta ? { meta: syncBlock.meta } : {})\n    };\n  });\n  return { concat: newConcat };\n}\n\nfunction generateViewCompStep(pseudoViewStep, opt) {\n  return {\n    component: \"view\",\n    change: {\n      signal: pseudoViewStep.factorSets.current\n    },\n    timing: pseudoViewStep.timing || copy(opt.timing)\n  };\n}\n\nfunction generateAxisCompStep(pseudoStep, opt) {\n  const scaleDomainDimension = get(opt, \"change\", \"scale\", \"domainDimension\");\n  const { factorSets } = pseudoStep;\n  const step = {\n    component: { axis: pseudoStep.diff.compName },\n    change: {},\n    timing: pseudoStep.timing || copy(opt.timing)\n  };\n  if (scaleDomainDimension !== undefined) {\n    step.change = { scale: { domainDimension: scaleDomainDimension } };\n  }\n  if (\n    factorSets.all.indexOf(\"scale.y\") >= 0 &&\n    factorSets.applied.indexOf(\"scale.y\") < 0\n  ) {\n    step.change.scale = false;\n  } else if (\n    factorSets.all.indexOf(\"scale.x\") >= 0 &&\n    factorSets.applied.indexOf(\"scale.x\") < 0\n  ) {\n    step.change.scale = false;\n  }\n  if (\n    factorSets.applied.indexOf(\"encode\") < 0 &&\n    factorSets.all.indexOf(\"encode\") >= 0\n  ) {\n    step.change.encode = false;\n  }\n\n  if (\n    step.change.encode === false &&\n    factorSets.applied.indexOf(\"encode.only.grid\") >= 0\n  ) {\n    step.change.encode = {\n      grid: true,\n      axis: false,\n      labels: false,\n      title: false,\n      ticks: false,\n      domain: false\n    };\n  }\n\n  if (\n    ( (step.change.encode === false) ||\n      (get(step, \"change\", \"encode\", \"axis\") === false) ) &&\n    factorSets.applied.indexOf(\"encode.position\") >= 0\n  ) {\n    if (step.change.encode) {\n      step.change.encode.axis = false;\n    } else {\n      step.change.encode = {axis: false};\n    }\n  }\n\n  if (isEmpty(step.change)) {\n    delete step.change;\n  }\n\n  return step;\n}\n\nfunction generateLegendCompStep(pseudoStep, opt) {\n  const step = {\n    component: { legend: pseudoStep.diff.compName },\n    timing: pseudoStep.timing || copy(opt.timing)\n  };\n  // const factorSets = pseudoStep.factorSets;\n  // if (factorSets && factorSets.current && factorSets.current.length > 0) {\n  //   step.change = {\n  //     scale: factorSets.current.map(fct => fct.replace(\"scale.\", \"\"))\n  //   };\n  // }\n  // if (factorSets.current.indexOf(\"encode.position\") < 0 && factorSets.all.indexOf(\"encode.position\") >= 0) {\n  //   step.change = {\n  //     ...(step.change || {}),\n  //     encode: { legend: false }\n  //   };\n  // }\n  return step;\n}\n\nfunction generateMarkCompStep(pseudoStep, opt) {\n  const markCompDiff = pseudoStep.diff;\n  const { factorSets } = pseudoStep;\n  const step = {\n    component: { mark: markCompDiff.compName },\n    change: getBlankChange(factorSets.all),\n    timing: pseudoStep.timing || copy(opt.timing)\n  };\n  if (factorSets.applied.indexOf(\"remove\") >= 0) {\n    delete step.change;\n    return step;\n  }\n  // change.scale\n  const scaleFactros = factorSets.applied.filter(\n    fctr => fctr.indexOf(\"scale\") >= 0\n  );\n  if (scaleFactros.length > 0) {\n    step.change.scale = scaleFactros.map(fctr => fctr.replace(\"scale.\", \"\"));\n  }\n\n  // change.data\n  if (factorSets.applied.indexOf(\"data\") >= 0) {\n    step.change.data = get(opt, \"change\", \"data\") || true;\n  }\n\n  // Todo: For encode factors not in the factorSet, then it should not specify anything.\n  // change.encode\n  const encodeFactors = factorSets.applied.filter(\n    fctr => fctr.indexOf(\"encode\") >= 0\n  );\n  const encodeChange = getBlankEncodeChange(\n    factorSets.all.concat(factorSets.extraByMarktype)\n  );\n\n  if (encodeFactors.length > 0) {\n    encodeFactors.forEach(fctr => {\n      const channel = fctr.replace(\"encode.\", \"\");\n      const attrs = CHANNEL_TO_ATTRS_OBJ[channel];\n      attrs.forEach(attr => {\n        delete encodeChange.update[attr];\n        delete encodeChange.exit[attr];\n        delete encodeChange.enter[attr];\n      });\n    });\n  }\n  step.change.encode = encodeChange;\n\n  // change.marktype\n  if (factorSets.applied.indexOf(\"marktype\") >= 0) {\n    step.change.marktype = true;\n\n    factorSets.extraByMarktype.forEach(fctr => {\n      const channel = fctr.replace(\"encode.\", \"\");\n      const attrs = CHANNEL_TO_ATTRS_OBJ[channel];\n      attrs.forEach(attr => {\n        delete step.change.encode.update[attr];\n        delete step.change.encode.exit[attr];\n        delete step.change.encode.enter[attr];\n      });\n    });\n  }\n\n  [\"update\", \"enter\", \"exit\"].forEach(dataSet => {\n    if (!isEmpty(get(step, \"change\", \"encode\", dataSet))) {\n      step.change.encode[dataSet] = Object.keys(step.change.encode[dataSet])\n        .filter(attr => markCompDiff.meta.usedEnAttrs.indexOf(attr) >= 0)\n        .reduce((acc, attr) => {\n          acc[attr] = step.change.encode[dataSet][attr];\n          return acc;\n        }, {});\n    }\n\n    if (isEmpty(get(step, \"change\", \"encode\", dataSet))) {\n      step.change.encode[dataSet] = true;\n    }\n  });\n\n  return step;\n}\n\n// It provides a change.encode that does not change any attribute.\n// The blankEncodeChanges are to be assigned by encode factors.\nfunction getBlankEncodeChange(relatedFactors) {\n  const blankEncode = relatedFactors\n    .filter(fctr => fctr.indexOf(\"encode\") >= 0)\n    .map(fctr => CHANNEL_TO_ATTRS_OBJ[fctr.replace(\"encode.\", \"\")])\n    .reduce((blankEncode, attrs) => {\n      attrs.forEach(attr => {\n        blankEncode[attr] = false;\n      });\n      return blankEncode;\n    }, {});\n\n  const blankExitEncode = copy(blankEncode);\n  delete blankExitEncode.opacity;\n\n  return {\n    update: copy(blankEncode),\n    enter: blankExitEncode,\n    exit: blankExitEncode\n  };\n}\nfunction getBlankChange(allFactors) {\n  return [\"scale\", \"signal\", \"data\", \"encode\", \"marktype\"].reduce(\n    (change, factor) => {\n      if (allFactors.find(f => f.indexOf(factor) >= 0)) {\n        change[factor] = false;\n      }\n      return change;\n    },\n    {}\n  );\n}\nexport { generateTimeline, generateMarkCompStep };\n","import * as vega from \"vega\";\nimport { detectDiffs } from \"./diffDetector\";\nimport { enumeratePseudoTimelines } from \"./pseudoTimelineEnumerator\";\nimport { evaluate } from \"./pseudoTimelineEvaluator\";\nimport { generateTimeline } from \"./timelineGenerator\";\nimport { copy } from \"../util/util\";\n\nexport default async function(\n  sSpec,\n  eSpec,\n  opt = { marks: {}, axes: {}, legends: {}, scales: {} }\n) {\n  const userInput = opt;\n  const stageN = Number(opt.stageN) || 2;\n  const { includeMeta } = opt;\n  const timing = { totalDuration: userInput.totalDuration || 2000 };\n\n  userInput.axes = userInput.axes || {};\n  for (const scaleName in userInput.scales || {}) {\n    userInput.axes[scaleName] = userInput.axes[scaleName] || {};\n    userInput.axes[scaleName].change = userInput.axes[scaleName].change || {};\n    userInput.axes[scaleName].change.scale =\n      userInput.axes[scaleName].change.scale || {};\n    if (userInput.axes[scaleName].change.scale !== false) {\n      userInput.axes[scaleName].change.scale.domainDimension =\n        userInput.scales[scaleName].domainDimension;\n    }\n  }\n  const eView = await new vega.View(vega.parse(eSpec), {\n    renderer: \"svg\"\n  }).runAsync();\n\n  const sView = await new vega.View(vega.parse(sSpec), {\n    renderer: \"svg\"\n  }).runAsync();\n\n\n  const rawInfo = {\n    sVis: { spec: copy(sSpec), view: sView },\n    eVis: { spec: copy(eSpec), view: eView }\n  };\n\n  const detected = detectDiffs(rawInfo, userInput);\n  // for (let i = 1; i <= maxStageN; i++) {\n  //   pseudoTls = pseudoTls.concat(enumeratePseudoTimelines(detected, i, rawInfo));\n  // }\n  let pseudoTls = enumeratePseudoTimelines(detected, stageN, rawInfo, timing);\n  pseudoTls = pseudoTls\n    .map(pseudoTl => {\n      pseudoTl.eval = evaluate(pseudoTl);\n      return pseudoTl;\n    })\n    .sort((a, b) => compareCost(a.eval, b.eval));\n\n  return pseudoTls.map(pseudoTl => {\n    const meta = includeMeta ? pseudoTl.eval : undefined;\n    return {\n      spec: {\n        timeline: generateTimeline(pseudoTl, userInput, includeMeta),\n        totalDuration: timing.totalDuration,\n        meta\n      },\n      pseudoTimeline: pseudoTl\n    };\n  });\n}\nexport function compareCost(a, b) {\n  if (a.cost === b.cost) {\n    if (a.tiebreaker === b.tiebreaker) {\n      return a.tiebreaker2 - b.tiebreaker2;\n    }\n    return a.tiebreaker - b.tiebreaker;\n  }\n  return a.cost - b.cost;\n}\n","import * as d3 from \"d3\";\nimport * as vegaLite from \"vega-lite\";\n\nexport default function vl2vg4gemini(vlSpec) {\n  let vgSpec = vegaLite.compile(vlSpec).spec;\n  vgSpec.axes = mergeDuplicatedAxes(vgSpec.axes);\n  appendNamesOnGuides(vgSpec);\n  return vgSpec;\n}\n\n\nfunction appendNamesOnGuides(vgSpec){\n  if (vgSpec.axes) {\n    vgSpec.axes.forEach(axis => {\n      if (!axis.encode) {\n        axis.encode = {axis: {name: axis.scale}};\n      } else {\n        axis.encode.axis = { ...axis.encode.axis, name: axis.scale };\n      }\n    });\n  }\n  if (vgSpec.legends) {\n    vgSpec.legends.forEach((legend, i) => {\n      if (!legend.encode) {\n        legend.encode = {legend: {name: `legend${i}`}};\n      } else {\n        legend.encode.legend = Object.assign({}, legend.encode.legend, {name: `legend${i}`});\n      }\n    });\n  }\n}\n\n\nfunction mergeDuplicatedAxes(vegaAxes) {\n  if (!vegaAxes || vegaAxes.length <= 0) {\n    return [];\n  }\n  let axesScales = vegaAxes.filter(a => a.grid).map(a => a.scale);\n\n  return d3.nest()\n    .key(axis => axis.scale)\n    .rollup(axes => {\n      let axisWithGrid = axes.find(a => a.grid);\n      let axisWithoutGrid = { ...axes.find(a => !a.grid) };\n\n      if (axisWithGrid) {\n        axisWithoutGrid.grid = true;\n        if (axisWithGrid.gridScale) {\n          axisWithoutGrid.gridScale = axisWithGrid.gridScale;\n        }\n        axisWithoutGrid.zindex = 0;\n      }\n      return axisWithoutGrid;\n    }).entries(vegaAxes)\n    .map(d => d.value)\n    .sort((a,b) => (axesScales.indexOf(a.scale) - axesScales.indexOf(b.scale)));\n}\n\n","import { Gemini } from \"./gemini.js\";\nimport { default as recommend, compareCost } from \"./recommender\";\nimport { default as vl2vg4gemini } from \"./util/vl2vg4gemini\";\n\nconst { animate } = Gemini;\nexport { animate, recommend, compareCost, vl2vg4gemini };\n","function asJSON(str) {\n  let obj;\n  try {\n    obj = JSON.parse(str);\n  } catch(e) {\n    return false\n  }\n  return obj;\n}\nfunction objEqual(a,b) {\n  return JSON.stringify(a) === JSON.stringify(b)\n}\nexport {\n  asJSON,\n  objEqual\n}","function getUserInput(recomParameters) {\n  const dataJoinKey = recomParameters.dataJoinKey === \"\" ? undefined : recomParameters.dataJoinKey.split(\";\").map(key => key.trim())\n\n  const xDomainChange = recomParameters.xScaleDomainDimension === \"default\" ? undefined : recomParameters.xScaleDomainDimension;\n  const yDomainChange = recomParameters.yScaleDomainDimension === \"default\" ? undefined : recomParameters.yScaleDomainDimension;\n\n  return {\n    marks: { marks: { change: { data: dataJoinKey } } },\n    scales: {\n      x: xDomainChange ? { domainDimension: xDomainChange } : {},\n      y: yDomainChange ? { domainDimension: yDomainChange } : {}\n    },\n    stageN: recomParameters.stageN,\n    includeMeta: false, //Todo\n    totalDuration: recomParameters.duration || 2000\n  }\n}\n\nfunction setUserInput(userInput) {\n  let newParams = {\n    xScaleDomainDimension: \"default\",\n    yScaleDomainDimension: \"default\"\n  };\n  if (userInput && userInput.marks && userInput.marks.marks && userInput.marks.marks.change) {\n    newParams.dataJoinKey = (userInput.marks.marks.change.data || []).join(\";\");\n  }\n\n  if (userInput && userInput.scales && userInput.scales.x && userInput.scales.x.domainDimension) {\n    newParams.xScaleDomainDimension = userInput.scales.x.domainDimension;\n  }\n\n  if (userInput && userInput.scales && userInput.scales.y && userInput.scales.y.domainDimension) {\n    newParams.yScaleDomainDimension = userInput.scales.y.domainDimension;\n  }\n\n  this.setState({recomParameters: {...this.state.recomParameters, ...newParams}});\n}\n\n\n\nexport {\n  setUserInput as setUserInput,\n  getUserInput as getUserInput\n}","import * as d3 from 'd3';\nimport * as stringify from \"json-stringify-pretty-compact\";\nimport * as gemini from \"./gemini\";\nimport {default as vegaEmbed} from 'vega-embed';\nimport {setUserInput} from './recomControl';\n\nfunction copy(obj) {\n  return JSON.parse(JSON.stringify(obj));\n}\n\nasync function loadExamples(exampleList){\n  const loadedExamples = []\n  for (let i = 0; i < exampleList.length; i++) {\n    const example = await d3.json(exampleList[i]);\n    example.value = exampleList[i];\n    loadedExamples.push(example)\n  }\n\n  return loadedExamples;\n}\n\nasync function setupExample(exampleURL, editor, sVisEditor, eVisEditor){\n  if (!editor || !sVisEditor || !eVisEditor){\n    return;\n  }\n\n  //load the example setupExample\n  let example = exampleURL;\n  if (typeof(exampleURL)===\"string\") {\n    example = await d3.json(exampleURL);\n  }\n  if (example.sSpecURL) {\n    example.sSpec = await d3.json(example.sSpecURL);\n  }\n  if (example.eSpecURL) {\n    example.eSpec = await d3.json(example.eSpecURL);\n  }\n  if (example.data) {\n    example.sSpec.data.find(dataObj => dataObj.name === \"source_0\").values = copy(example.data);\n    example.eSpec.data.find(dataObj => dataObj.name === \"source_0\").values = copy(example.data);\n  }\n\n\n\n  editor.setValue(stringify(example.gemSpecs[0], null, 2));\n  sVisEditor.setValue(stringify(example.sSpec, null, 2));\n  eVisEditor.setValue(stringify(example.eSpec, null, 2));\n\n  await vegaEmbed( `#sView`, example.sSpec, {renderer: \"svg\", actions: false});\n  await vegaEmbed( `#eView`, example.eSpec, {renderer: \"svg\", actions: false});\n\n  let recoms = []\n  if (!example.noRecom) {\n    if (example.userInput) {\n      setUserInput.bind(this, example.userInput)();\n    }\n    recoms = await gemini.recommend(example.sSpec, example.eSpec, example.userInput);\n  }\n\n  this.setState({\n    gemSpecs: example.gemSpecs,\n    currExample: example,\n    recoms: recoms,\n    selectedSpecIndex: 0\n  });\n\n  return example;\n}\n\nexport {\n  loadExamples,\n  setupExample\n}","import React, { Component } from  'react';\nimport { asJSON } from '../js/util';\nimport MonacoEditor from 'react-monaco-editor';\nimport * as stringify from \"json-stringify-pretty-compact\";\nimport * as d3 from 'd3';\nimport * as gemini from '../js/gemini';\nimport './css/CodeCol.css'\nimport {\n  Col, Tab, Tabs, Button\n} from 'react-bootstrap'\n\n\n\nclass CodeCol extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      recomModalShow: false,\n      currTab: \"gemini-tab\"\n    }\n  }\n  async editorWillMount(monaco) {\n    let schema = await d3.json(`${process.env.PUBLIC_URL}/schema.json`);\n    monaco.languages.json.jsonDefaults.setDiagnosticsOptions({\n        validate: true,\n        schemas: [{\n            uri: `${process.env.PUBLIC_URL}/schema.json`,\n            fileMatch: ['*'],\n            schema\n        }]\n    });\n  }\n\n  genEditorDidMount(editorId) {\n    let attachEditorRefs = this.props.attachEditorRefs;\n    return function(editor, monaco){\n      editor.layout();\n\n      let editorRef = {};\n      editorRef[editorId] = editor.getModel();\n      attachEditorRefs(editorRef)\n    }\n  }\n  genChangeHandler(specType) {\n    return (newValue, e) => {\n      this.props.onSpecChange(specType, newValue)\n    }\n  }\n\n  onTabChange(tabKey, e) {\n    const TABKEY_TO_EDITORREF = {\n      \"gemini-tab\":\"geminiEditor\",\n      \"start-tab\":\"sVisEditor\",\n      \"end-tab\": \"eVisEditor\"\n    };\n\n    this.setState({currTab: tabKey}, () => {\n      if (TABKEY_TO_EDITORREF[tabKey]) {\n        this.refs[TABKEY_TO_EDITORREF[tabKey]].editor.layout();\n      }\n    })\n  }\n\n  genToVegaBtnClickHandler(specType) {\n    let spec = asJSON(specType === \"sSpec\" ? this.props.sSpecText : this.props.eSpecText);\n    return () => {\n      if (spec) {\n        this.props.onSpecChange(specType, stringify(gemini.vl2vg4gemini(spec)));\n      }\n    }\n  }\n  render() {\n    const options = {\n      lineNumbersMinChars: 4,\n      minimap: {enabled: false},\n      scrollBeyondLastLine: false,\n      selectOnLineNumbers: true,\n      indentSize: 2,\n      tabSize:2,\n      wordWrap: 'wordWrapColumn',\n      wordWrapColumn: 100,\n      wordWrapMinified: true,\n      wrappingIndent: \"indent\",\n      language: 'json'\n    };\n    const sSpec = asJSON(this.props.sSpecText),\n      eSpec = asJSON(this.props.eSpecText);\n    const allowToVegaButton = {\n      sSpec: sSpec && sSpec.$schema && sSpec.$schema.indexOf(\"https://vega.github.io/schema/vega-lite\") >= 0,\n      eSpec: eSpec && eSpec.$schema && eSpec.$schema.indexOf(\"https://vega.github.io/schema/vega-lite\") >= 0\n    }\n    return <Col className=\"mt-3\" id=\"code-col\" xs={6}>\n      <Tabs transition={false}  onSelect={this.onTabChange.bind(this)} activeKey={this.state.currTab}>\n        <Tab eventKey=\"gemini-tab\" title=\"Gemini\">\n\n          <MonacoEditor\n            ref=\"geminiEditor\"\n            language=\"json\"\n            theme=\"vs-light\"\n            options={options}\n            value={this.props.gemSpecText}\n            onChange={this.genChangeHandler(\"gemSpec\")}\n            editorDidMount={this.genEditorDidMount(\"editor\")}\n            editorWillMount={this.editorWillMount}\n          />\n\n        </Tab>\n        <Tab eventKey=\"start-tab\" title=\"Start Vis\">\n          <Button\n            size=\"sm\" variant=\"secondary\" className=\"vl2vgBtn\" id =\"sViewVgBtn\"\n            disabled={!allowToVegaButton.sSpec}\n            onClick={this.genToVegaBtnClickHandler(\"sSpec\").bind(this)}\n          >To Vega\n          </Button>\n          <MonacoEditor\n            ref=\"sVisEditor\"\n            language=\"json\"\n            theme=\"vs-light\"\n            options={options}\n            value={this.props.sSpecText}\n            onChange={this.genChangeHandler(\"sSpec\")}\n            editorDidMount={this.genEditorDidMount(\"sVisEditor\")}\n          />\n        </Tab>\n        <Tab eventKey=\"end-tab\" title=\"End Vis\">\n          <Button\n            size=\"sm\" variant=\"secondary\" className=\"vl2vgBtn\" id =\"eViewVgBtn\"\n            disabled={!allowToVegaButton.eSpec}\n            onClick={this.genToVegaBtnClickHandler(\"eSpec\").bind(this)}\n          >To Vega\n          </Button>\n          <MonacoEditor\n            ref=\"eVisEditor\"\n            language=\"json\"\n            theme=\"vs-light\"\n            options={options}\n            value={this.props.eSpecText}\n            onChange={this.genChangeHandler(\"eSpec\")}\n            editorDidMount={this.genEditorDidMount(\"eVisEditor\")}\n          />\n        </Tab>\n        <Tab eventKey=\"notice-tab\" title=\"Notice\" className=\"p-3\">\n\n\n\n          <h5>\n            Things that you need to know to play with this\n          </h5>\n          <ul>\n            <li>The start/end visualizations should be Vega specifications having unique names on marks/axes/legend components.</li>\n            <li>You can use Vega-Lite specs and compile though \"To Vega\" button on the top-right corner of the Start/End Vis editors. The buttons compile the VL specs into vega specs with placing names on the axes (\"x\", \"y\") and legends (\"legend0\", \"legend1\", ...).</li>\n\n            <li>Currently, Gemini only supports the single-view chart having at most one y-axis and x-axis.</li>\n            <li>The recommendation feature only supports the dimension-specification VL charts.</li>\n          </ul>\n        </Tab>\n      </Tabs>\n    </Col>\n  }\n\n\n}\n\nexport default CodeCol;\n","import {default as vegaEmbed} from 'vega-embed';\n\nexport async function drawVis(targetElmQuery, spec) {\n  try {\n    let messageBox = document.querySelector(targetElmQuery).querySelector(\".vegaEmbed-error\")\n    if (messageBox) {\n      messageBox.remove();\n    }\n    await vegaEmbed( targetElmQuery, spec, {renderer: \"svg\", actions: false});\n  } catch (error) {\n    let targetElm = document.querySelector(targetElmQuery);\n    targetElm.innerHTML = \"\";\n    let messageBox = document.createElement(\"div\");\n    messageBox.classList.add(\"text-danger\", \"vegaEmbed-error\");\n    messageBox.innerHTML = error.message;\n    targetElm.append(messageBox);\n  }\n}","import * as gemini from \"../js/gemini\";\nimport { drawVis } from \"./util\";\nimport React, { Component } from  'react';\nimport { Button, Card } from 'react-bootstrap'\nimport { debounce } from \"vega\";\nclass AnimContainer extends Component {\n  constructor(props){\n    super(props);\n    this.state = {\n      status: \"ready\"\n    }\n    this.updateAnimViewWithDebounce = debounce(700, this.updateAnimView.bind(this));\n  }\n\n\n  render() {\n    let buttonDescription = \"Error!\",\n      controlBtnVariant=\"danger\",\n      controlBtnDisabled=true\n    if (this.state.status === \"ready\") {\n      buttonDescription = \"Play\";\n      controlBtnVariant = \"primary\";\n      controlBtnDisabled = false;\n    } else if (this.state.status === \"in progress\") {\n      buttonDescription = \"Playing...\";\n      controlBtnVariant = \"primary\";\n      controlBtnDisabled = true;\n    } else if (this.state.status === \"done\") {\n      buttonDescription = \"Reset\";\n      controlBtnVariant = \"secondary\";\n      controlBtnDisabled = false;\n    }\n    return <div>\n      <div className=\"text-center\" style={{height: this.props.height || 350}}>\n\n        <Button\n          variant={controlBtnVariant}\n          size=\"sm\"\n          className=\"controlBtn\"\n          id={`${this.props.id}ControlBtn`}\n          data-target-id={`${this.props.id}Anim`}\n          onClick={this.onControlBtnClick.bind(this)}\n          disabled={controlBtnDisabled}\n        >\n          { buttonDescription }\n        </Button>{\n          this.state.hasBuffer ? \"*\" : \"\"\n        }\n        <br/>\n        <div style={{overflow: \"scroll\"}}>\n          <div id={`${this.props.id}Anim`} className=\"mt-3\"></div>\n          <div id={`${this.props.id}AnimBuffer`} className=\"mt-3 d-none\"></div>\n        </div>\n      </div>\n\n\n      {\n        this.props.showMetaInfo ?\n\n        <p className=\"card-text\" style={{whiteSpace: \"pre-line\" }}>\n          {\n          `Complexity: ${this.props.meta.cost}\n          Stage: ${this.props.meta.stageN}`\n          }\n        </p>\n        : \"\"\n      }\n    </div>\n  }\n\n  async componentDidUpdate(prevProps) {\n    if ((prevProps.sSpec !== this.props.sSpec) || (prevProps.eSpec !== this.props.eSpec) || (prevProps.gemSpec !== this.props.gemSpec)) {\n      this.updateAnimViewWithDebounce()\n    }\n  }\n  async updateAnimView() {\n    // When updating the vis while playing,\n    if (this.state.status === \"in progress\") {\n      await drawVis(`#${this.props.id}AnimBuffer`, this.props.sSpec);\n      this.setState({hasBuffer: true});\n    } else {\n      this.setState({status: \"ready\"});\n      await drawVis(`#${this.props.id}Anim`, this.props.sSpec);\n    }\n  }\n  async componentDidMount(){\n    this.setState({status: \"ready\"});\n    await drawVis(`#${this.props.id}Anim`, this.props.sSpec);\n  }\n\n\n  async onControlBtnClick(event) {\n    let targetElm = event.target;\n    if (this.state.status === \"ready\") {\n      // targetElm.setAttribute(\"disabled\", true)\n      this.setState({status: \"in progress\"});\n      await this.play.bind(targetElm)(\n        this.props.gemSpec,\n        this.props.sSpec,\n        this.props.eSpec,\n        ((anim) => {\n          if (this.props.onEnd) {\n            this.props.onEnd(anim);\n          }\n\n          return true;\n        }),\n      );\n\n      // targetElm.removeAttribute(\"disabled\");\n      if (this.state.hasBuffer) {\n        const animDivElm = document.getElementById(this.props.id+\"Anim\");\n        const bufferDivElm = document.getElementById(this.props.id+\"AnimBuffer\");\n        animDivElm.innerHTML = bufferDivElm.innerHTML;\n        bufferDivElm.innerHTML = \"\";\n        this.setState({hasBuffer: false, status: \"ready\"});\n      } else {\n        this.setState({status: \"done\"});\n      }\n\n    } else if (this.state.status === \"done\") {\n      await this.reset.bind(targetElm)(this.props.sSpec);\n      this.setState({status: \"ready\"});\n    }\n  }\n  async play(gemSpec, sSpec, eSpec, onEnd){\n    const targetElm = `#${this.dataset.targetId}`;\n    const anim = await gemini.animate(sSpec, eSpec, gemSpec);\n    // await drawVis(targetElm, sSpec)\n    console.log(\"Start!\");\n    await anim.play(targetElm)\n    console.log(\"Done!\");\n    if (onEnd) {\n      onEnd(anim);\n    }\n    return true;\n  }\n\n  async reset(sSpec){\n    const targetElm = `#${this.dataset.targetId}`;\n    await drawVis( `${targetElm}`, sSpec);\n  }\n}\n\nexport default AnimContainer;\n\n\n","import React, { Component } from  'react';\nimport AnimContainer from './AnimContainer'\nimport { debounce } from 'vega';\nimport { drawVis } from \"./util\";\nimport {\n  Row, Col\n} from 'react-bootstrap'\n\n\n\nclass VisCol extends Component {\n  constructor(props){\n    super(props);\n    this.debouncedUpdateSVis = debounce(700, this.updateSVis.bind(this));\n    this.debouncedUpdateEVis = debounce(700, this.updateEVis.bind(this));\n  }\n\n  render() {\n    return <Col xs={6}>\n      <Row>\n        <Col>\n        <AnimContainer\n          sSpec={this.props.sSpec || {}}\n          eSpec={this.props.eSpec || {}}\n          gemSpec={this.props.gemSpec || {}}\n          showMetaInfo={false}\n          id=\"animView\"\n        />\n        </Col>\n      </Row>\n      <Row className=\"mt-3\">\n        <Col xs={6}>\n          <h6>Start Vis</h6>\n          <div id=\"sView\"></div>\n        </Col>\n        <Col xs={6}>\n          <h6>End Vis</h6>\n          <div id=\"eView\"></div>\n        </Col>\n      </Row>\n    </Col>\n  }\n\n  async componentDidUpdate(prevProps){\n    if (prevProps.sSpec !== this.props.sSpec) {\n      this.debouncedUpdateSVis();\n    }\n    if (prevProps.eSpec !== this.props.eSpec) {\n      this.debouncedUpdateEVis();\n    }\n\n  }\n  async updateSVis() {\n    await drawVis( `#sView`, this.props.sSpec);\n  }\n  async updateEVis() {\n    await drawVis( `#eView`, this.props.eSpec);\n  }\n\n\n}\n\nexport default VisCol;\n","import React, { Component } from  'react';\nimport stringHash from 'string-hash';\nimport * as stringify from \"json-stringify-pretty-compact\";\nimport {\n  Modal, Row, InputGroup, Form, Button, Card, Col\n} from 'react-bootstrap'\nimport './css/RecomModal.css';\nimport { debounce } from 'vega';\nimport AnimContainer from './AnimContainer';\n\n\nclass RecomModal extends Component {\n  constructor(props){\n    super(props);\n\n    this.debouncedUpdateDuration = debounce(700, this.updateRecomParam.bind(this));\n    this.debouncedUpdateDataJoinKey = debounce(700, this.updateRecomParam.bind(this));\n  }\n\n  render() {\n    return<Modal\n    size=\"lg\"\n    show={this.props.modalShow}\n    onHide={this.props.onHide}\n    aria-labelledby=\"example-modal-sizes-title-lg\"\n    id=\"recom-modal\"\n    >\n    <Modal.Header closeButton>\n      <Modal.Title id=\"example-modal-sizes-title-lg\">\n        Recommendations\n      </Modal.Title>\n    </Modal.Header>\n    <Modal.Body>\n      <div className=\"mb-3 d-inline-flex felx-row\">\n\n\n          <InputGroup size=\"sm\" className=\"mr-2\" style={{\"maxWidth\": 155}}>\n            <InputGroup.Prepend>\n              <InputGroup.Text htmlFor=\"stageNSelect\">\n                # of Stages\n              </InputGroup.Text>\n            </InputGroup.Prepend>\n\n            <Form.Control\n              as=\"select\"\n              value={this.props.recomParameters.stageN}\n              id=\"stageNSelect\"\n              onChange={this.onChangeStageN.bind(this)}\n              style={{\"maxWidth\": 55}}\n            >\n              <option value=\"1\">1</option>\n              <option value=\"2\">2</option>\n              <option value=\"3\">3</option>\n            </Form.Control>\n          </InputGroup>\n\n\n          <InputGroup size=\"sm\" className=\"mr-2\" style={{\"maxWidth\": 150}}>\n            <InputGroup.Prepend>\n              <InputGroup.Text htmlFor=\"duration\">\n                Duration\n              </InputGroup.Text>\n            </InputGroup.Prepend>\n\n            <Form.Control\n              id=\"duration\"\n              placeholder=\"Milliseconds\"\n              aria-label=\"duration\"\n              aria-describedby=\"duration\"\n              type=\"number\"\n              min={0}\n              defaultValue={this.props.recomParameters.duration}\n              onChange={this.onChangeDuration.bind(this)}\n            ></Form.Control>\n          </InputGroup>\n\n\n\n          <InputGroup size=\"sm\" className=\"mr-2\">\n            <InputGroup.Prepend>\n              <InputGroup.Text htmlFor=\"dataJoinKey\">\n                Data Join By\n              </InputGroup.Text>\n            </InputGroup.Prepend>\n\n            <Form.Control\n              id=\"dataJoinKey\"\n              placeholder='e.g., \"name; year\"'\n              aria-label=\"dataJoinKey\"\n              aria-describedby=\"dataJoinKey\"\n              type=\"text\"\n              defaultValue={this.props.recomParameters.dataJoinKey}\n              onChange={this.onChangeDataJoinKey.bind(this)}\n            ></Form.Control>\n          </InputGroup>\n\n          <InputGroup size=\"sm\" className=\"mr-2\" >\n            <InputGroup.Prepend>\n              <InputGroup.Text htmlFor=\"x-domain-dimension\">\n                X Domain Dimension\n              </InputGroup.Text>\n            </InputGroup.Prepend>\n\n            <Form.Control\n              as=\"select\"\n              value={this.props.recomParameters.xScaleDomainDimension || \"default\"}\n              id=\"x-domain-dimension\"\n              onChange={this.onChangeXScaleDomainDimension.bind(this)}\n              style={{\"minWidth\": 70}}\n            >\n              <option value=\"default\">Default</option>\n              <option value=\"diff\">Change</option>\n              <option value=\"same\">UnChange</option>\n            </Form.Control>\n          </InputGroup>\n{/*\n          <InputGroup size=\"sm\" className=\"mr-2\">\n            <InputGroup.Prepend>\n              <InputGroup.Text htmlFor=\"x-domain-dimension\">\n                X Keeps Domain Dimension\n              </InputGroup.Text>\n            </InputGroup.Prepend>\n            <div className=\"form-control\" style={{\"maxWidth\": 35}}>\n              <Form.Check\n                id=\"x-domain-dimension\"\n                placeholder='e.g., \"name; year\"'\n                aria-label=\"X-Axis Keeps Domain Dimension\"\n                aria-describedby=\"x-domain-dimension\"\n                type=\"checkbox\"\n                checked={this.props.recomParameters.xScaleDomainDimension === \"same\"}\n                onChange={this.onChangeXScaleDomainDimension.bind(this)}\n              ></Form.Check>\n            </div>\n          </InputGroup> */}\n\n          <InputGroup size=\"sm\" className=\"mr-2\" >\n            <InputGroup.Prepend>\n              <InputGroup.Text htmlFor=\"y-domain-dimension\">\n                Y Domain Dimension\n              </InputGroup.Text>\n            </InputGroup.Prepend>\n\n            <Form.Control\n              as=\"select\"\n              value={this.props.recomParameters.yScaleDomainDimension || \"default\"}\n              id=\"y-domain-dimension\"\n              onChange={this.onChangeYScaleDomainDimension.bind(this)}\n              style={{\"minWidth\": 70}}\n            >\n              <option value=\"default\">Default</option>\n              <option value=\"diff\">Change</option>\n              <option value=\"same\">UnChange</option>\n            </Form.Control>\n          </InputGroup>\n          {/* <InputGroup size=\"sm\" className=\"mr-2\">\n            <InputGroup.Prepend>\n              <InputGroup.Text htmlFor=\"y-domain-dimension\">\n                Y Keeps Domain Dimension\n              </InputGroup.Text>\n            </InputGroup.Prepend>\n            <div className=\"form-control\" style={{\"maxWidth\": 35}}>\n              <Form.Check\n                id=\"y-domain-dimension\"\n                placeholder='e.g., \"name; year\"'\n                aria-label=\"Y-Axis Keeps Domain Dimension\"\n                aria-describedby=\"y-domain-dimension\"\n                type=\"checkbox\"\n                onChange={this.onChangeYScaleDomainDimension.bind(this)}\n                checked={this.props.recomParameters.yScaleDomainDimension === \"same\"}\n              />\n            </div>\n          </InputGroup> */}\n\n      </div>\n      <Row id=\"recommendations\">\n        {\n          this.props.recoms.length === 0\n          ? <Col>\n            There is no recommendation with the given parameters.\n          </Col>\n          : this.props.recoms.map((recom, i) => {\n            return <Col md={4} key={`recom${i}Card-${stringHash(JSON.stringify(this.props.recomParameters))}`}>\n              <Card>\n                <Card.Body>\n                  <AnimContainer\n                    sSpec={this.props.sSpec}\n                    eSpec={this.props.eSpec}\n                    gemSpec={recom.spec}\n                    showMetaInfo={true}\n                    meta={{cost: recom.pseudoTimeline.eval.cost, stageN: recom.spec.timeline.concat.length}}\n                    id={`recom${i}`}\n                  />\n                  <Button\n                    variant=\"primary\" size=\"sm\"\n                    onClick={this.getCustomizeBtnClickHandler(recom.spec)}\n                  >\n                    Customize\n                  </Button>\n                </Card.Body>\n              </Card>\n            </Col>\n\n          })\n        }\n      </Row>\n    </Modal.Body>\n    <Modal.Footer>\n      <Button variant=\"secondary\" size=\"sm\" onClick={this.props.onHide}>Close</Button>\n    </Modal.Footer>\n  </Modal>\n\n  }\n  componentDidUpdate() {\n    let dataJoinInputElm = document.getElementById(\"dataJoinKey\"),\n      durationElm = document.getElementById(\"duration\");\n\n    if (dataJoinInputElm && dataJoinInputElm.value !== this.props.recomParameters.dataJoinKey) {\n      dataJoinInputElm.value = this.props.recomParameters.dataJoinKey;\n    }\n    if (durationElm && (durationElm.value * 1.0) !== this.props.recomParameters.duration) {\n      durationElm.value = this.props.recomParameters.duration;\n    }\n  }\n  updateRecomParam(param) {\n    this.props.updateRecomParameters(param)\n  }\n\n  onChangeStageN(event) {\n    this.props.updateRecomParameters({stageN: event.target.value})\n  }\n\n  onChangeDuration(event) {\n    let duration = event.target.value*1.0;\n    this.debouncedUpdateDuration.bind(this)({duration: duration})\n  }\n\n  onChangeDataJoinKey(event) {\n    let dataJoinKey = event.target.value;\n    this.debouncedUpdateDataJoinKey.bind(this)({dataJoinKey: dataJoinKey})\n  }\n\n  onChangeXScaleDomainDimension(event) {\n    this.props.updateRecomParameters({xScaleDomainDimension: event.target.value})\n  }\n\n  onChangeYScaleDomainDimension(event) {\n    this.props.updateRecomParameters({yScaleDomainDimension: event.target.value})\n  }\n  getCustomizeBtnClickHandler(spec) {\n    return (event) => {\n      this.props.setValueOnEditor(stringify(spec, null, 2));\n      this.props.onHide()\n    }\n  }\n\n}\n\nexport default RecomModal;\n","import React, { Component } from  'react';\n\n\nclass ExampleSelect extends Component {\n  constructor(props){\n    super(props);\n  }\n\n\n  render() {\n    return <select\n        id=\"example-select\"\n        className=\"custom-select custom-select-sm mr-1\"\n        style={{maxWidth: \"300px\"}}\n        onChange={this.onChange.bind(this)}\n      >\n        <option value=\"\">Select the example</option>\n        {\n          this.props.examples.map((example, i) => {\n            return <option key={i} value={example.value}>{example.title}</option>\n          })\n        }\n      </select>\n  }\n\n  onChange(event) {\n    let editor = this.props.editor,\n      sVisEditor = this.props.sVisEditor,\n      eVisEditor = this.props.eVisEditor,\n      setupExample = this.props.setupExample;\n    let val = event.target.value;\n    if (val !== \"\") {\n\n      setupExample(\n        this.props.examples.find(eg => eg.value === val),\n        editor, sVisEditor, eVisEditor,\n        this.props.recomParameters\n      )\n    }\n  }\n\n\n}\n\nexport default ExampleSelect;\n","import React, { Component } from  'react';\nimport * as stringify from \"json-stringify-pretty-compact\";\n\nclass GeminiSpecSelect extends Component {\n\n  render() {\n\n    return <select\n        id=\"gemspec-select\"\n        className=\"custom-select custom-select-sm mr-1\"\n        value={this.props.selectedSpecIndex}\n        style={{maxWidth: \"300px\"}}\n        onChange={this.onChange.bind(this)}\n      >\n          {\n            this.props.gemSpecs.map((gemSpec, i) => {\n              return <option key={i} value={i}>\n                {gemSpec.meta && gemSpec.meta.name ? gemSpec.meta.name : i.toString()}\n                </option>\n            })\n          }\n      </select>\n  }\n\n  async onChange(event) {\n    let value = event.target.value;\n    let selectedGemSpecs = this.props.gemSpecs[value];\n    let gemSpecJSON = stringify(selectedGemSpecs, null, 2);\n    this.props.onSpecChange(\"gemSpec\", gemSpecJSON);\n    this.props.updateSelectedSpecIndex(value);\n  }\n}\n\nexport default GeminiSpecSelect;\n\n\n","import React from 'react';\nimport * as gemini from \"./js/gemini\";\nimport { asJSON, objEqual } from './js/util';\nimport './App.css';\nimport {loadExamples, setupExample} from './js/init';\nimport {CodeCol, VisCol, RecomModal, ExampleSelect, GeminiSpecSelect} from './components'\nimport {getUserInput} from './js/recomControl'\n\nimport {\n  Container,\n  Row,\n  Col,\n  Button\n} from 'react-bootstrap'\n\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      recom: {\n        sSpec: {},\n        eSpec: {}\n      },\n      sVisEditor: undefined,\n      eVisEditor: undefined,\n      editor: undefined,\n      recomModalShow: false,\n      currExample: undefined,\n      selectedSpecIndex: 0,\n      examples: [],\n      recoms: [],\n      recomParameters: {\n        duration: 2000,\n        dataJoinKey: \"\",\n        stageN: 2,\n        xScaleDomainDimension: \"default\",\n        yScaleDomainDimension: \"default\"\n      }\n    }\n  }\n  exampleList = [\n    `${process.env.REACT_APP_EXAMPLE_PATH}/stimuli/1.json`,\n    `${process.env.REACT_APP_EXAMPLE_PATH}/stimuli/2.json`,\n    `${process.env.REACT_APP_EXAMPLE_PATH}/stimuli/3.json`,\n    `${process.env.REACT_APP_EXAMPLE_PATH}/stimuli/4.json`,\n    `${process.env.REACT_APP_EXAMPLE_PATH}/unstackingBars.json`,\n    `${process.env.REACT_APP_EXAMPLE_PATH}/sortWithFilter.json`,\n    `${process.env.REACT_APP_EXAMPLE_PATH}/line.json`,\n    `${process.env.REACT_APP_EXAMPLE_PATH}/r2d3.json`,\n    `${process.env.REACT_APP_EXAMPLE_PATH}/r2d3-v2.json`,\n    `${process.env.REACT_APP_EXAMPLE_PATH}/democracy.json`,\n    `${process.env.REACT_APP_EXAMPLE_PATH}/scatterPlot.json`,\n    `${process.env.REACT_APP_EXAMPLE_PATH}/introducing-bars.json`,\n    `${process.env.REACT_APP_EXAMPLE_PATH}/addYAxis.json`,\n    `${process.env.REACT_APP_EXAMPLE_PATH}/removeYAxis.json`,\n    `${process.env.REACT_APP_EXAMPLE_PATH}/addLayer.json`,\n    `${process.env.REACT_APP_EXAMPLE_PATH}/removeLayer.json`,\n    `${process.env.REACT_APP_EXAMPLE_PATH}/autoScaleOrder-A.json`,\n    `${process.env.REACT_APP_EXAMPLE_PATH}/autoScaleOrder-B.json`,\n    `${process.env.REACT_APP_EXAMPLE_PATH}/autoScaleOrder-Line.json`,\n    `${process.env.REACT_APP_EXAMPLE_PATH}/staggering.json`,\n    `${process.env.REACT_APP_EXAMPLE_PATH}/enumerator2.json`,\n    `${process.env.REACT_APP_EXAMPLE_PATH}/budget.json`,\n    `${process.env.REACT_APP_EXAMPLE_PATH}/aggregate.json`,\n    `${process.env.REACT_APP_EXAMPLE_PATH}/disaggregate.json`,\n    `${process.env.REACT_APP_EXAMPLE_PATH}/reaggregate.json`,\n    `${process.env.REACT_APP_EXAMPLE_PATH}/barToPoint.json`,\n    `${process.env.REACT_APP_EXAMPLE_PATH}/nbaAllstar.json`,\n    `${process.env.REACT_APP_EXAMPLE_PATH}/areaToLine.json`,\n  ]\n  async updateRecomParameters(paramChange) {\n    let newParams = {...this.state.recomParameters, ...paramChange};\n    let sSpec = asJSON(this.state.sSpecText) || {},\n      eSpec = asJSON(this.state.eSpecText) || {};\n    let newRecoms = await gemini.recommend(\n      sSpec,\n      eSpec,\n      getUserInput(newParams)\n    );\n    this.setState({\n      recomParameters: newParams,\n      recoms: newRecoms,\n      recom: {sSpec, eSpec}\n    })\n  }\n  onSpecChange(specType, newSpecText) {\n    if (newSpecText !== this.state[specType+\"Text\"]) {\n      let newSpecState = {};\n      newSpecState[specType+\"Text\"] = newSpecText;\n      this.setState(newSpecState);\n    }\n  }\n  onRecomHide() {\n    this.setState({recomModalShow: false});\n  }\n  async showRecom() {\n    let sSpec = asJSON(this.state.sSpecText) || {},\n      eSpec = asJSON(this.state.eSpecText) || {};\n    if (\n      (!objEqual(this.state.recom.sSpec, sSpec))\n      || (!objEqual(this.state.recom.eSpec, eSpec))\n    ) {\n      let recoms = await gemini.recommend(\n        sSpec,\n        eSpec,\n        getUserInput(this.state.recomParameters)\n      );\n\n      this.setState({\n        recoms: recoms,\n        recom: {sSpec, eSpec},\n        recomModalShow: true\n      });\n    } else {\n      this.setState({ recomModalShow: true });\n    }\n  }\n\n  render() {\n    const noRecom = this.state.currExample ? this.state.currExample.noRecom : false;\n    return <div>\n      <RecomModal\n        modalShow={this.state.recomModalShow}\n        onHide={this.onRecomHide.bind(this)}\n        recomParameters={this.state.recomParameters}\n        recoms={this.state.recoms}\n        sSpec={this.state.recom.sSpec}\n        eSpec={this.state.recom.eSpec}\n        updateRecomParameters={this.updateRecomParameters.bind(this)}\n        setValueOnEditor={this.setValueOnEditor.bind(this)}\n      />\n\n      <Container fluid>\n        <Row className=\"mt-1\">\n          <Col>\n            <span >Example : </span>\n            <ExampleSelect\n              examples={this.state.examples}\n              setupExample = {setupExample.bind(this)}\n              editor={this.state.editor}\n              sVisEditor={this.state.sVisEditor}\n              eVisEditor={this.state.eVisEditor}\n              recomParameters={this.state.recomParameters}\n            />\n\n\n            <GeminiSpecSelect\n              gemSpecs={this.state.gemSpecs || []}\n              selectedSpecIndex={this.state.selectedSpecIndex}\n              updateSelectedSpecIndex={(i) => { this.setState({selectedSpecIndex: i})}}\n              onSpecChange={this.onSpecChange.bind(this)}\n            />\n\n            <Button\n              id=\"recomBtn\"\n              size=\"sm\"\n              variant=\"primary\"\n              onClick={this.showRecom.bind(this)}\n              disabled={noRecom}\n            >\n              Recommendation\n            </Button>\n            <small id=\"noRecomLabel\" className={`text-secondary ${noRecom ? \"\" : \"d-none\"}`}>\n              This example does not support the recommendation currently.\n            </small>\n          </Col>\n        </Row>\n        <Row id=\"main\">\n\n          <CodeCol\n            attachEditorRefs={this.attachEditorRefs.bind(this)}\n            sSpecText={this.state.sSpecText}\n            eSpecText={this.state.eSpecText}\n            gemSpecText={this.state.gemSpecText}\n            onSpecChange={this.onSpecChange.bind(this)}\n          />\n          <VisCol\n            gemSpec={asJSON(this.state.gemSpecText) || {}}\n            sSpec={asJSON(this.state.sSpecText) || {}}\n            eSpec={asJSON(this.state.eSpecText) || {}}\n          />\n\n        </Row>\n      </Container>\n    </div>\n  }\n\n  async componentDidMount() {\n    let loadedExamples = await loadExamples(this.exampleList)\n\n\n    window.addEventListener(\"message\", (event) => {\n      const whitelist = [\n        \"http://localhost\"\n      ]\n\n\n      if (whitelist.find(origin => event.origin.indexOf(origin)>=0) && (typeof(event.data) === \"string\")) {\n        let parsed = asJSON(event.data);\n        if (parsed && parsed.sSpec && parsed.eSpec) {\n          window.opener.postMessage(\"ack\", \"*\");\n          setupExample.bind(this)(parsed, this.state.editor, this.state.sVisEditor, this.state.eVisEditor);\n        }\n      }\n\n    })\n\n    this.setState({examples: loadedExamples});\n  }\n\n  attachEditorRefs(ref) {\n    this.setState(ref);\n  }\n  setValueOnEditor(str){\n    if (this.state.editor) {\n      this.state.editor.setValue(str)\n    }\n  }\n\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\nimport 'bootstrap/dist/css/bootstrap.css';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}