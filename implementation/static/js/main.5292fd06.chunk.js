/*! For license information please see main.5292fd06.chunk.js.LICENSE.txt */
(this["webpackJsonpgemini-editor"]=this["webpackJsonpgemini-editor"]||[]).push([[0],{193:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return qi})),a.d(t,"b",(function(){return Vi})),a.d(t,"c",(function(){return Ui}));var r=a(35),n=a(12),i=a(53),o=a(3),s=a(21),u=a.n(s),l=a(37),c=a(15),f=a(16),d=a(98),p=a(38),m=a(419),h=function(){function e(t,a,r){Object(c.a)(this,e),this.schedule=t,this.moments=this.schedule.moments,this.status="ready",this.spec=r,this.logs=[],this._queue=[],this.rawInfo=a}return Object(f.a)(e,[{key:"log",value:function(e,t,a){return"string"===typeof t&&"number"===typeof e&&this.logs.push({timestamp:e,message:t,info:a}),this.logs}},{key:"play",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var a,r,n,i,o,s=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.status="playing",a=this.moments,r=new Date,this._start(a[0].starting,t),this.log(new Date-r,"0-th moment"),n=u.a.mark((function e(n){var i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a[n],e.next=3,s._end(i).then((function(){var e=Math.max(i.time-(new Date-r),0);return new Promise((function(t){return setTimeout((function(){return t()}),e)}))}));case 3:if(s._start(i.starting,t),s.log(new Date-r,"".concat(n,"-th moment")),n!==a.length-1){e.next=8;break}return s.status="ready",e.abrupt("return",{v:void 0});case 8:case"end":return e.stop()}}),e)})),i=1;case 7:if(!(i<a.length)){e.next=15;break}return e.delegateYield(n(i),"t0",9);case 9:if("object"!==typeof(o=e.t0)){e.next=12;break}return e.abrupt("return",o.v);case 12:i++,e.next=7;break;case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_start",value:function(e,t){var a=this;e.forEach((function(e){a._queue.push({sTime:e.sTime,eTime:e.eTime,step:e,result:e.template(a.rawInfo,e,t)})}))}},{key:"_end",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var a,r,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=t.time,r=this._queue.filter((function(e){return e.eTime===a})),n=0;case 3:if(!(n<r.length)){e.next=9;break}return e.next=6,r[n].result;case 6:n++,e.next=3;break;case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function v(e){return null===e?"__null__":e.toString()}function y(e,t){if(e===t)return!0;if(E(e)&&E(t))return Number(e)===Number(t);if("object"===typeof e&&void 0!==e&&"object"===typeof t&&void 0!==t){var a=Object.keys(e),r=Object.keys(t);if(a.length!==r.length)return!1;for(var n=0;n<a.length;n++){var i=a[n];if(!Object.prototype.hasOwnProperty.call(t,i)||!y(e[i],t[i]))return!1}return!0}return!1}function g(e){if(void 0!==e)return JSON.parse(JSON.stringify(e))}function b(e){return Object.keys(e).reduce((function(t,a){return t[a]=e[a],t}),{})}function x(e){return e.reduce((function(e,t){return e=e.concat(t)}),[])}function E(e){return void 0!==e&&"function"===typeof e.getMonth}function w(e,t){for(var a=[],r=0;r<e.length;r++){var n=g(e);Array.isArray(n[r])?n[r].push(t):n[r]=[n[r],t],a.push(n)}return a}function k(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];return a.reduce((function(e,t){return A(e)||A(e[t])?void 0:e[t]}),e)}function A(e){return null===e||void 0===e}function D(e){return"number"===typeof e&&!isNaN(e)}function O(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return Math.round(Math.pow(10,t)*e)/Math.pow(10,t)}function j(e){var t=S(e);return e.reduce((function(e,a){return e+Math.pow(a-t,2)}),0)/e.length}function S(e){return e.reduce((function(e,t){return e+t}),0)/e.length}function P(e){return"object"===typeof e&&0===Object.keys(e).length}function F(e,t){var a=function e(t){var a=[];t.sync?t.sync.forEach((function(t){a=a.concat(e(t))})):t.concat&&t.concat.forEach((function(t){a=a.concat(e(t))}));t.resolve&&a.push(t.resolve);return a}(e);return a.forEach((function(e){e.alterIds=t.filter((function(t){return t.alterId&&t.alterId.split(":")[0]===e.alterName})).map((function(e){return e.alterId})).unique();var a=e.alterIds.findIndex((function(e){return e.indexOf(":main")>=0})),r=e.alterIds.splice(a,1);e.alterIds=r.concat(e.alterIds)})),a}Array.prototype.contains=function(e,t){t=t||function(e){return e};for(var a=0;a<this.length;a++)if(t(this[a])===t(e))return!0;return!1},Array.prototype.containAll=function(e,t){t=t||function(e){return e};for(var a=0;a<e.length;a++)if(!this.contains(e[a],t))return!1;return!0},Array.prototype.unique=function(e){for(var t=[],a=0;a<this.length;a++)t.contains(this[a],e)||t.push(this[a]);return t},Array.prototype.sample=function(e){for(var t=this.slice(),a=[],r=0;r<e;r++)a.push(t.splice([Math.floor(Math.random()*t.length)],1)[0]);return a},Array.prototype.shuffle=function(){for(var e=this.length;e;e--){var t=Math.floor(Math.random()*e),a=[this[t],this[e-1]];this[e-1]=a[0],this[t]=a[1]}return this},Array.prototype.clone=function(){return JSON.parse(JSON.stringify(this))},Array.prototype.exclude=function(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e},r=this.slice(),n=Object(o.a)(e);try{var i=function(){var e=t.value,n=r.findIndex((function(t){return a(t)===a(e)}));n>=0&&r.splice(n,1)};for(n.s();!(t=n.n()).done;)i()}catch(s){n.e(s)}finally{n.f()}return r};var C=function(){function e(t){Object(c.a)(this,e);var a=t.map((function(e,t){return Object(i.a)({},e,{stepId:t})}));this.tracks=a.map((function(e){return{name:e.trackName=e.compName?"".concat(e.compType,".").concat(e.compName):e.compType,compType:e.compType,compName:e.compName}})).unique((function(e){return e.name})).map((function(e){return Object(i.a)({},e,{steps:a.filter((function(t){return t.trackName===e.name}))})}))}return Object(f.a)(e,[{key:"getTimeline",value:function(e){return this.tracks.map((function(t){return Object.assign({},t,{steps:t.steps.filter((function(t){return void 0===t.alterId||t.alterId.indexOf(e)>=0}))})}))}},{key:"getTimelineAlternator",value:function(e){var t=this,a=0,r=e.reduce((function(e,t,a){return e.push(t.alterIds.length*e[a]),e}),[1]),n=r[r.length-1];return r=r.slice(0,r.length-1).sort((function(e,t){return t-e})),function(){return a+=1,0===(a%=n)?(console.warn("Gemini cannot find the order to resolve."),!1):r.reduce((function(t,a,r){var n=Math.floor(t.remainder/a);t.remainder-=n*a;var i=e[r].alterIds[n];return t.tracks=t.tracks.map((function(e){var t=e.steps.filter((function(e){return void 0===e.alterId||(e.alterId.split(":")[0]!==i.split(":")[0]||e.alterId.split(":")[1]===i.split(":")[1])}));return Object.assign({},e,{steps:t})})),t}),{tracks:t.tracks,remainder:a}).tracks}}}]),e}();function B(e){var t,a=[],r=e.tracks,n=e.alterId,i=Object(o.a)(r);try{for(i.s();!(t=i.n()).done;)for(var s=t.value,u=s.steps.sort((function(e,t){return e.sTime-t.sTime})),l=0;l<u.length-1;l++)u[l].eTime>u[l+1].sTime&&a.push({alterId:n,conflictedSteps:[u[l],u[l+1]],compName:s.compName,compType:s.compType})}catch(c){i.e(c)}finally{i.f()}return a}"undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof e||"undefined"!==typeof self&&self;function T(e,t){return e(t={exports:{}},t.exports),t.exports}function _(e){return e&&e.default||e}var N,I=T((function(e,t){!function(e){function t(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];if(t.length>1){t[0]=t[0].slice(0,-1);for(var r=t.length-1,n=1;n<r;++n)t[n]=t[n].slice(1,-1);return t[r]=t[r].slice(1),t.join("")}return t[0]}function a(e){return"(?:"+e+")"}function r(e){return void 0===e?"undefined":null===e?"null":Object.prototype.toString.call(e).split(" ").pop().split("]").shift().toLowerCase()}function n(e){return e.toUpperCase()}function i(e){var r=t("[0-9]","[A-Fa-f]"),n=a(a("%[EFef]"+r+"%"+r+r+"%"+r+r)+"|"+a("%[89A-Fa-f]"+r+"%"+r+r)+"|"+a("%"+r+r)),i="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",o=t("[\\:\\/\\?\\#\\[\\]\\@]",i),s=e?"[\\uE000-\\uF8FF]":"[]",u=t("[A-Za-z]","[0-9]","[\\-\\.\\_\\~]",e?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]"),l=(a("[A-Za-z]"+t("[A-Za-z]","[0-9]","[\\+\\-\\.]")+"*"),a(a(n+"|"+t(u,i,"[\\:]"))+"*"),a(a("25[0-5]")+"|"+a("2[0-4][0-9]")+"|"+a("1[0-9][0-9]")+"|"+a("0?[1-9][0-9]")+"|0?0?[0-9]")),c=a(l+"\\."+l+"\\."+l+"\\."+l),f=a(r+"{1,4}"),d=a(a(f+"\\:"+f)+"|"+c),p=a(a(f+"\\:")+"{6}"+d),m=a("\\:\\:"+a(f+"\\:")+"{5}"+d),h=a(a(f)+"?\\:\\:"+a(f+"\\:")+"{4}"+d),v=a(a(a(f+"\\:")+"{0,1}"+f)+"?\\:\\:"+a(f+"\\:")+"{3}"+d),y=a(a(a(f+"\\:")+"{0,2}"+f)+"?\\:\\:"+a(f+"\\:")+"{2}"+d),g=a(a(a(f+"\\:")+"{0,3}"+f)+"?\\:\\:"+f+"\\:"+d),b=a(a(a(f+"\\:")+"{0,4}"+f)+"?\\:\\:"+d),x=a(a(a(f+"\\:")+"{0,5}"+f)+"?\\:\\:"+f),E=a(a(a(f+"\\:")+"{0,6}"+f)+"?\\:\\:"),w=a([p,m,h,v,y,g,b,x,E].join("|")),k=a(a(u+"|"+n)+"+"),A=(a("[vV]"+r+"+\\."+t(u,i,"[\\:]")+"+"),a(a(n+"|"+t(u,i))+"*"),a(n+"|"+t(u,i,"[\\:\\@]")));return a(a(n+"|"+t(u,i,"[\\@]"))+"+"),a(a(A+"|"+t("[\\/\\?]",s))+"*"),{NOT_SCHEME:new RegExp(t("[^]","[A-Za-z]","[0-9]","[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(t("[^\\%\\:]",u,i),"g"),NOT_HOST:new RegExp(t("[^\\%\\[\\]\\:]",u,i),"g"),NOT_PATH:new RegExp(t("[^\\%\\/\\:\\@]",u,i),"g"),NOT_PATH_NOSCHEME:new RegExp(t("[^\\%\\/\\@]",u,i),"g"),NOT_QUERY:new RegExp(t("[^\\%]",u,i,"[\\:\\@\\/\\?]",s),"g"),NOT_FRAGMENT:new RegExp(t("[^\\%]",u,i,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(t("[^]",u,i),"g"),UNRESERVED:new RegExp(u,"g"),OTHER_CHARS:new RegExp(t("[^\\%]",u,o),"g"),PCT_ENCODED:new RegExp(n,"g"),IPV4ADDRESS:new RegExp("^("+c+")$"),IPV6ADDRESS:new RegExp("^\\[?("+w+")"+a(a("\\%25|\\%(?!"+r+"{2})")+"("+k+")")+"?\\]?$")}}var o=i(!1),s=i(!0),u=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var a=[],r=!0,n=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(a.push(o.value),!t||a.length!==t);r=!0);}catch(u){n=!0,i=u}finally{try{!r&&s.return&&s.return()}finally{if(n)throw i}}return a}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},l=2147483647,c=/^xn--/,f=/[^\0-\x7E]/,d=/[\x2E\u3002\uFF0E\uFF61]/g,p={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},m=Math.floor,h=String.fromCharCode;function v(e){throw new RangeError(p[e])}function y(e,t){var a=e.split("@"),r="";a.length>1&&(r=a[0]+"@",e=a[1]);var n=function(e,t){for(var a=[],r=e.length;r--;)a[r]=t(e[r]);return a}((e=e.replace(d,".")).split("."),t).join(".");return r+n}function g(e){for(var t=[],a=0,r=e.length;a<r;){var n=e.charCodeAt(a++);if(n>=55296&&n<=56319&&a<r){var i=e.charCodeAt(a++);56320==(64512&i)?t.push(((1023&n)<<10)+(1023&i)+65536):(t.push(n),a--)}else t.push(n)}return t}var b=function(e,t){return e+22+75*(e<26)-((0!=t)<<5)},x=function(e,t,a){var r=0;for(e=a?m(e/700):e>>1,e+=m(e/t);e>455;r+=36)e=m(e/35);return m(r+36*e/(e+38))},E=function(e){var t,a=[],r=e.length,n=0,i=128,o=72,s=e.lastIndexOf("-");s<0&&(s=0);for(var u=0;u<s;++u)e.charCodeAt(u)>=128&&v("not-basic"),a.push(e.charCodeAt(u));for(var c=s>0?s+1:0;c<r;){for(var f=n,d=1,p=36;;p+=36){c>=r&&v("invalid-input");var h=(t=e.charCodeAt(c++))-48<10?t-22:t-65<26?t-65:t-97<26?t-97:36;(h>=36||h>m((l-n)/d))&&v("overflow"),n+=h*d;var y=p<=o?1:p>=o+26?26:p-o;if(h<y)break;var g=36-y;d>m(l/g)&&v("overflow"),d*=g}var b=a.length+1;o=x(n-f,b,0==f),m(n/b)>l-i&&v("overflow"),i+=m(n/b),n%=b,a.splice(n++,0,i)}return String.fromCodePoint.apply(String,a)},w=function(e){var t=[],a=(e=g(e)).length,r=128,n=0,i=72,o=!0,s=!1,u=void 0;try{for(var c,f=e[Symbol.iterator]();!(o=(c=f.next()).done);o=!0){var d=c.value;d<128&&t.push(h(d))}}catch(V){s=!0,u=V}finally{try{!o&&f.return&&f.return()}finally{if(s)throw u}}var p=t.length,y=p;for(p&&t.push("-");y<a;){var E=l,w=!0,k=!1,A=void 0;try{for(var D,O=e[Symbol.iterator]();!(w=(D=O.next()).done);w=!0){var j=D.value;j>=r&&j<E&&(E=j)}}catch(V){k=!0,A=V}finally{try{!w&&O.return&&O.return()}finally{if(k)throw A}}var S=y+1;E-r>m((l-n)/S)&&v("overflow"),n+=(E-r)*S,r=E;var P=!0,F=!1,C=void 0;try{for(var B,T=e[Symbol.iterator]();!(P=(B=T.next()).done);P=!0){var _=B.value;if(_<r&&++n>l&&v("overflow"),_==r){for(var N=n,I=36;;I+=36){var M=I<=i?1:I>=i+26?26:I-i;if(N<M)break;var R=N-M,$=36-M;t.push(h(b(M+R%$,0))),N=m(R/$)}t.push(h(b(N,0))),i=x(n,S,y==p),n=0,++y}}}catch(V){F=!0,C=V}finally{try{!P&&T.return&&T.return()}finally{if(F)throw C}}++n,++r}return t.join("")},k=function(e){return y(e,(function(e){return f.test(e)?"xn--"+w(e):e}))},A=function(e){return y(e,(function(e){return c.test(e)?E(e.slice(4).toLowerCase()):e}))},D={};function O(e){var t=e.charCodeAt(0);return t<16?"%0"+t.toString(16).toUpperCase():t<128?"%"+t.toString(16).toUpperCase():t<2048?"%"+(t>>6|192).toString(16).toUpperCase()+"%"+(63&t|128).toString(16).toUpperCase():"%"+(t>>12|224).toString(16).toUpperCase()+"%"+(t>>6&63|128).toString(16).toUpperCase()+"%"+(63&t|128).toString(16).toUpperCase()}function j(e){for(var t="",a=0,r=e.length;a<r;){var n=parseInt(e.substr(a+1,2),16);if(n<128)t+=String.fromCharCode(n),a+=3;else if(n>=194&&n<224){if(r-a>=6){var i=parseInt(e.substr(a+4,2),16);t+=String.fromCharCode((31&n)<<6|63&i)}else t+=e.substr(a,6);a+=6}else if(n>=224){if(r-a>=9){var o=parseInt(e.substr(a+4,2),16),s=parseInt(e.substr(a+7,2),16);t+=String.fromCharCode((15&n)<<12|(63&o)<<6|63&s)}else t+=e.substr(a,9);a+=9}else t+=e.substr(a,3),a+=3}return t}function S(e,t){function a(e){var a=j(e);return a.match(t.UNRESERVED)?a:e}return e.scheme&&(e.scheme=String(e.scheme).replace(t.PCT_ENCODED,a).toLowerCase().replace(t.NOT_SCHEME,"")),void 0!==e.userinfo&&(e.userinfo=String(e.userinfo).replace(t.PCT_ENCODED,a).replace(t.NOT_USERINFO,O).replace(t.PCT_ENCODED,n)),void 0!==e.host&&(e.host=String(e.host).replace(t.PCT_ENCODED,a).toLowerCase().replace(t.NOT_HOST,O).replace(t.PCT_ENCODED,n)),void 0!==e.path&&(e.path=String(e.path).replace(t.PCT_ENCODED,a).replace(e.scheme?t.NOT_PATH:t.NOT_PATH_NOSCHEME,O).replace(t.PCT_ENCODED,n)),void 0!==e.query&&(e.query=String(e.query).replace(t.PCT_ENCODED,a).replace(t.NOT_QUERY,O).replace(t.PCT_ENCODED,n)),void 0!==e.fragment&&(e.fragment=String(e.fragment).replace(t.PCT_ENCODED,a).replace(t.NOT_FRAGMENT,O).replace(t.PCT_ENCODED,n)),e}function P(e){return e.replace(/^0*(.*)/,"$1")||"0"}function F(e,t){var a=e.match(t.IPV4ADDRESS)||[],r=u(a,2)[1];return r?r.split(".").map(P).join("."):e}function C(e,t){var a=e.match(t.IPV6ADDRESS)||[],r=u(a,3),n=r[1],i=r[2];if(n){for(var o=n.toLowerCase().split("::").reverse(),s=u(o,2),l=s[0],c=s[1],f=c?c.split(":").map(P):[],d=l.split(":").map(P),p=t.IPV4ADDRESS.test(d[d.length-1]),m=p?7:8,h=d.length-m,v=Array(m),y=0;y<m;++y)v[y]=f[y]||d[h+y]||"";p&&(v[m-1]=F(v[m-1],t));var g=v.reduce((function(e,t,a){if(!t||"0"===t){var r=e[e.length-1];r&&r.index+r.length===a?r.length++:e.push({index:a,length:1})}return e}),[]).sort((function(e,t){return t.length-e.length}))[0],b=void 0;if(g&&g.length>1){var x=v.slice(0,g.index),E=v.slice(g.index+g.length);b=x.join(":")+"::"+E.join(":")}else b=v.join(":");return i&&(b+="%"+i),b}return e}var B=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,T=void 0==="".match(/(){0}/)[1];function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a={},r=!1!==t.iri?s:o;"suffix"===t.reference&&(e=(t.scheme?t.scheme+":":"")+"//"+e);var n=e.match(B);if(n){T?(a.scheme=n[1],a.userinfo=n[3],a.host=n[4],a.port=parseInt(n[5],10),a.path=n[6]||"",a.query=n[7],a.fragment=n[8],isNaN(a.port)&&(a.port=n[5])):(a.scheme=n[1]||void 0,a.userinfo=-1!==e.indexOf("@")?n[3]:void 0,a.host=-1!==e.indexOf("//")?n[4]:void 0,a.port=parseInt(n[5],10),a.path=n[6]||"",a.query=-1!==e.indexOf("?")?n[7]:void 0,a.fragment=-1!==e.indexOf("#")?n[8]:void 0,isNaN(a.port)&&(a.port=e.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?n[4]:void 0)),a.host&&(a.host=C(F(a.host,r),r)),void 0!==a.scheme||void 0!==a.userinfo||void 0!==a.host||void 0!==a.port||a.path||void 0!==a.query?void 0===a.scheme?a.reference="relative":void 0===a.fragment?a.reference="absolute":a.reference="uri":a.reference="same-document",t.reference&&"suffix"!==t.reference&&t.reference!==a.reference&&(a.error=a.error||"URI is not a "+t.reference+" reference.");var i=D[(t.scheme||a.scheme||"").toLowerCase()];if(t.unicodeSupport||i&&i.unicodeSupport)S(a,r);else{if(a.host&&(t.domainHost||i&&i.domainHost))try{a.host=k(a.host.replace(r.PCT_ENCODED,j).toLowerCase())}catch(u){a.error=a.error||"Host's domain name can not be converted to ASCII via punycode: "+u}S(a,o)}i&&i.parse&&i.parse(a,t)}else a.error=a.error||"URI can not be parsed.";return a}function N(e,t){var a=!1!==t.iri?s:o,r=[];return void 0!==e.userinfo&&(r.push(e.userinfo),r.push("@")),void 0!==e.host&&r.push(C(F(String(e.host),a),a).replace(a.IPV6ADDRESS,(function(e,t,a){return"["+t+(a?"%25"+a:"")+"]"}))),"number"===typeof e.port&&(r.push(":"),r.push(e.port.toString(10))),r.length?r.join(""):void 0}var I=/^\.\.?\//,M=/^\/\.(\/|$)/,R=/^\/\.\.(\/|$)/,$=/^\/?(?:.|\n)*?(?=\/|$)/;function V(e){for(var t=[];e.length;)if(e.match(I))e=e.replace(I,"");else if(e.match(M))e=e.replace(M,"/");else if(e.match(R))e=e.replace(R,"/"),t.pop();else if("."===e||".."===e)e="";else{var a=e.match($);if(!a)throw new Error("Unexpected dot segment condition");var r=a[0];e=e.slice(r.length),t.push(r)}return t.join("")}function z(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.iri?s:o,r=[],n=D[(t.scheme||e.scheme||"").toLowerCase()];if(n&&n.serialize&&n.serialize(e,t),e.host)if(a.IPV6ADDRESS.test(e.host));else if(t.domainHost||n&&n.domainHost)try{e.host=t.iri?A(e.host):k(e.host.replace(a.PCT_ENCODED,j).toLowerCase())}catch(l){e.error=e.error||"Host's domain name can not be converted to "+(t.iri?"Unicode":"ASCII")+" via punycode: "+l}S(e,a),"suffix"!==t.reference&&e.scheme&&(r.push(e.scheme),r.push(":"));var i=N(e,t);if(void 0!==i&&("suffix"!==t.reference&&r.push("//"),r.push(i),e.path&&"/"!==e.path.charAt(0)&&r.push("/")),void 0!==e.path){var u=e.path;t.absolutePath||n&&n.absolutePath||(u=V(u)),void 0===i&&(u=u.replace(/^\/\//,"/%2F")),r.push(u)}return void 0!==e.query&&(r.push("?"),r.push(e.query)),void 0!==e.fragment&&(r.push("#"),r.push(e.fragment)),r.join("")}function L(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments[3],n={};return r||(e=_(z(e,a),a),t=_(z(t,a),a)),!(a=a||{}).tolerant&&t.scheme?(n.scheme=t.scheme,n.userinfo=t.userinfo,n.host=t.host,n.port=t.port,n.path=V(t.path||""),n.query=t.query):(void 0!==t.userinfo||void 0!==t.host||void 0!==t.port?(n.userinfo=t.userinfo,n.host=t.host,n.port=t.port,n.path=V(t.path||""),n.query=t.query):(t.path?("/"===t.path.charAt(0)?n.path=V(t.path):(void 0===e.userinfo&&void 0===e.host&&void 0===e.port||e.path?e.path?n.path=e.path.slice(0,e.path.lastIndexOf("/")+1)+t.path:n.path=t.path:n.path="/"+t.path,n.path=V(n.path)),n.query=t.query):(n.path=e.path,void 0!==t.query?n.query=t.query:n.query=e.query),n.userinfo=e.userinfo,n.host=e.host,n.port=e.port),n.scheme=e.scheme),n.fragment=t.fragment,n}function U(e,t){return e&&e.toString().replace(t&&t.iri?s.PCT_ENCODED:o.PCT_ENCODED,j)}var q={scheme:"http",domainHost:!0,parse:function(e,t){return e.host||(e.error=e.error||"HTTP URIs must have a host."),e},serialize:function(e,t){return e.port!==("https"!==String(e.scheme).toLowerCase()?80:443)&&""!==e.port||(e.port=void 0),e.path||(e.path="/"),e}},H={scheme:"https",domainHost:q.domainHost,parse:q.parse,serialize:q.serialize},K={},W="[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",Q="[0-9A-Fa-f]",J=a(a("%[EFef]"+Q+"%"+Q+Q+"%"+Q+Q)+"|"+a("%[89A-Fa-f]"+Q+"%"+Q+Q)+"|"+a("%"+Q+Q)),Z=t("[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",'[\\"\\\\]'),G=new RegExp(W,"g"),Y=new RegExp(J,"g"),X=new RegExp(t("[^]","[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]","[\\.]",'[\\"]',Z),"g"),ee=new RegExp(t("[^]",W,"[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]"),"g"),te=ee;function ae(e){var t=j(e);return t.match(G)?t:e}var re={scheme:"mailto",parse:function(e,t){var a=e,r=a.to=a.path?a.path.split(","):[];if(a.path=void 0,a.query){for(var n=!1,i={},o=a.query.split("&"),s=0,u=o.length;s<u;++s){var l=o[s].split("=");switch(l[0]){case"to":for(var c=l[1].split(","),f=0,d=c.length;f<d;++f)r.push(c[f]);break;case"subject":a.subject=U(l[1],t);break;case"body":a.body=U(l[1],t);break;default:n=!0,i[U(l[0],t)]=U(l[1],t)}}n&&(a.headers=i)}a.query=void 0;for(var p=0,m=r.length;p<m;++p){var h=r[p].split("@");if(h[0]=U(h[0]),t.unicodeSupport)h[1]=U(h[1],t).toLowerCase();else try{h[1]=k(U(h[1],t).toLowerCase())}catch(v){a.error=a.error||"Email address's domain name can not be converted to ASCII via punycode: "+v}r[p]=h.join("@")}return a},serialize:function(e,t){var a,r=e,i=void 0!==(a=e.to)&&null!==a?a instanceof Array?a:"number"!==typeof a.length||a.split||a.setInterval||a.call?[a]:Array.prototype.slice.call(a):[];if(i){for(var o=0,s=i.length;o<s;++o){var u=String(i[o]),l=u.lastIndexOf("@"),c=u.slice(0,l).replace(Y,ae).replace(Y,n).replace(X,O),f=u.slice(l+1);try{f=t.iri?A(f):k(U(f,t).toLowerCase())}catch(h){r.error=r.error||"Email address's domain name can not be converted to "+(t.iri?"Unicode":"ASCII")+" via punycode: "+h}i[o]=c+"@"+f}r.path=i.join(",")}var d=e.headers=e.headers||{};e.subject&&(d.subject=e.subject),e.body&&(d.body=e.body);var p=[];for(var m in d)d[m]!==K[m]&&p.push(m.replace(Y,ae).replace(Y,n).replace(ee,O)+"="+d[m].replace(Y,ae).replace(Y,n).replace(te,O));return p.length&&(r.query=p.join("&")),r}},ne=/^([^\:]+)\:(.*)/,ie={scheme:"urn",parse:function(e,t){var a=e.path&&e.path.match(ne),r=e;if(a){var n=t.scheme||r.scheme||"urn",i=a[1].toLowerCase(),o=a[2],s=n+":"+(t.nid||i),u=D[s];r.nid=i,r.nss=o,r.path=void 0,u&&(r=u.parse(r,t))}else r.error=r.error||"URN can not be parsed.";return r},serialize:function(e,t){var a=t.scheme||e.scheme||"urn",r=e.nid,n=a+":"+(t.nid||r),i=D[n];i&&(e=i.serialize(e,t));var o=e,s=e.nss;return o.path=(r||t.nid)+":"+s,o}},oe=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,se={scheme:"urn:uuid",parse:function(e,t){var a=e;return a.uuid=a.nss,a.nss=void 0,t.tolerant||a.uuid&&a.uuid.match(oe)||(a.error=a.error||"UUID is not valid."),a},serialize:function(e,t){var a=e;return a.nss=(e.uuid||"").toLowerCase(),a}};D[q.scheme]=q,D[H.scheme]=H,D[re.scheme]=re,D[ie.scheme]=ie,D[se.scheme]=se,e.SCHEMES=D,e.pctEncChar=O,e.pctDecChars=j,e.parse=_,e.removeDotSegments=V,e.serialize=z,e.resolveComponents=L,e.resolve=function(e,t,a){var r=function(e,t){var a=e;if(t)for(var r in t)a[r]=t[r];return a}({scheme:"null"},a);return z(L(_(e,r),_(t,r),r,!0),r)},e.normalize=function(e,t){return"string"===typeof e?e=z(_(e,t),t):"object"===r(e)&&(e=_(z(e,t),t)),e},e.equal=function(e,t,a){return"string"===typeof e?e=z(_(e,a),a):"object"===r(e)&&(e=z(e,a)),"string"===typeof t?t=z(_(t,a),a):"object"===r(t)&&(t=z(t,a)),e===t},e.escapeComponent=function(e,t){return e&&e.toString().replace(t&&t.iri?s.ESCAPE:o.ESCAPE,O)},e.unescapeComponent=U,Object.defineProperty(e,"__esModule",{value:!0})}(t)}));(N=I)&&N.__esModule&&Object.prototype.hasOwnProperty.call(N,"default")&&N.default;var M=function e(t,a){if(t===a)return!0;if(t&&a&&"object"==typeof t&&"object"==typeof a){if(t.constructor!==a.constructor)return!1;var r,n,i;if(Array.isArray(t)){if((r=t.length)!=a.length)return!1;for(n=r;0!==n--;)if(!e(t[n],a[n]))return!1;return!0}if(t.constructor===RegExp)return t.source===a.source&&t.flags===a.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===a.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===a.toString();if((r=(i=Object.keys(t)).length)!==Object.keys(a).length)return!1;for(n=r;0!==n--;)if(!Object.prototype.hasOwnProperty.call(a,i[n]))return!1;for(n=r;0!==n--;){var o=i[n];if(!e(t[o],a[o]))return!1}return!0}return t!==t&&a!==a},R={copy:function(e,t){for(var a in t=t||{},e)t[a]=e[a];return t},checkDataType:$,checkDataTypes:function(e,t){switch(e.length){case 1:return $(e[0],t,!0);default:var a="",r=z(e);for(var n in r.array&&r.object&&(a=r.null?"(":"(!"+t+" || ",a+="typeof "+t+' !== "object")',delete r.null,delete r.array,delete r.object),r.number&&delete r.integer,r)a+=(a?" && ":"")+$(n,t,!0);return a}},coerceToTypes:function(e,t){if(Array.isArray(t)){for(var a=[],r=0;r<t.length;r++){var n=t[r];(V[n]||"array"===e&&"array"===n)&&(a[a.length]=n)}if(a.length)return a}else{if(V[t])return[t];if("array"===e&&"array"===t)return["array"]}},toHash:z,getProperty:q,escapeQuotes:H,equal:M,ucs2length:function(e){for(var t,a=0,r=e.length,n=0;n<r;)a++,(t=e.charCodeAt(n++))>=55296&&t<=56319&&n<r&&56320==(64512&(t=e.charCodeAt(n)))&&n++;return a},varOccurences:function(e,t){t+="[^0-9]";var a=e.match(new RegExp(t,"g"));return a?a.length:0},varReplace:function(e,t,a){return t+="([^0-9])",a=a.replace(/\$/g,"$$$$"),e.replace(new RegExp(t,"g"),a+"$1")},cleanUpCode:function(e){return e.replace(K,"").replace(W,"").replace(Q,"if (!($1))")},finalCleanUpCode:function(e,t){var a=e.match(J);a&&2==a.length&&(e=t?e.replace(G,"").replace(Y,"return data;"):e.replace(Z,"").replace("return errors === 0;","validate.errors = null; return true;"));return(a=e.match(X))&&3===a.length?e.replace(ee,""):e},schemaHasRules:function(e,t){if("boolean"==typeof e)return!e;for(var a in e)if(t[a])return!0},schemaHasRulesExcept:function(e,t,a){if("boolean"==typeof e)return!e&&"not"!=a;for(var r in e)if(r!=a&&t[r])return!0},schemaUnknownRules:function(e,t){if("boolean"==typeof e)return;for(var a in e)if(!t[a])return a},toQuotedString:te,getPathExpr:function(e,t,a,r){return ne(e,a?"'/' + "+t+(r?"":".replace(/~/g, '~0').replace(/\\//g, '~1')"):r?"'[' + "+t+" + ']'":"'[\\'' + "+t+" + '\\']'")},getPath:function(e,t,a){var r=te(a?"/"+ie(t):q(t));return ne(e,r)},getData:function(e,t,a){var r,n,i,o;if(""===e)return"rootData";if("/"==e[0]){if(!ae.test(e))throw new Error("Invalid JSON-pointer: "+e);n=e,i="rootData"}else{if(!(o=e.match(re)))throw new Error("Invalid JSON-pointer: "+e);if(r=+o[1],"#"==(n=o[2])){if(r>=t)throw new Error("Cannot access property/index "+r+" levels up, current level is "+t);return a[t-r]}if(r>t)throw new Error("Cannot access data "+r+" levels up, current level is "+t);if(i="data"+(t-r||""),!n)return i}for(var s=i,u=n.split("/"),l=0;l<u.length;l++){var c=u[l];c&&(i+=q(oe(c)),s+=" && "+i)}return s},unescapeFragment:function(e){return oe(decodeURIComponent(e))},unescapeJsonPointer:oe,escapeFragment:function(e){return encodeURIComponent(ie(e))},escapeJsonPointer:ie};function $(e,t,a){var r=a?" !== ":" === ",n=a?" || ":" && ",i=a?"!":"",o=a?"":"!";switch(e){case"null":return t+r+"null";case"array":return i+"Array.isArray("+t+")";case"object":return"("+i+t+n+"typeof "+t+r+'"object"'+n+o+"Array.isArray("+t+"))";case"integer":return"(typeof "+t+r+'"number"'+n+o+"("+t+" % 1)"+n+t+r+t+")";default:return"typeof "+t+r+'"'+e+'"'}}var V=z(["string","number","integer","boolean","null"]);function z(e){for(var t={},a=0;a<e.length;a++)t[e[a]]=!0;return t}var L=/^[a-z$_][a-z$_0-9]*$/i,U=/'|\\/g;function q(e){return"number"==typeof e?"["+e+"]":L.test(e)?"."+e:"['"+H(e)+"']"}function H(e){return e.replace(U,"\\$&").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\f/g,"\\f").replace(/\t/g,"\\t")}var K=/else\s*{\s*}/g,W=/if\s*\([^)]+\)\s*\{\s*\}(?!\s*else)/g,Q=/if\s*\(([^)]+)\)\s*\{\s*\}\s*else(?!\s*if)/g;var J=/[^v.]errors/g,Z=/var errors = 0;|var vErrors = null;|validate.errors = vErrors;/g,G=/var errors = 0;|var vErrors = null;/g,Y=/if \(errors === 0\) return data;\s*else throw new ValidationError\(vErrors\);/,X=/[^A-Za-z_$]rootData[^A-Za-z0-9_$]/g,ee=/if \(rootData === undefined\) rootData = data;/;function te(e){return"'"+H(e)+"'"}var ae=/^\/(?:[^~]|~0|~1)*$/,re=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function ne(e,t){return'""'==e?t:(e+" + "+t).replace(/' \+ '/g,"")}function ie(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}function oe(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}var se=function(e){R.copy(e,this)};var ue=T((function(e){var t=e.exports=function(e,a,r){"function"==typeof a&&(r=a,a={}),function e(a,r,n,i,o,s,u,l,c,f){if(i&&"object"==typeof i&&!Array.isArray(i)){for(var d in r(i,o,s,u,l,c,f),i){var p=i[d];if(Array.isArray(p)){if(d in t.arrayKeywords)for(var m=0;m<p.length;m++)e(a,r,n,p[m],o+"/"+d+"/"+m,s,o,d,i,m)}else if(d in t.propsKeywords){if(p&&"object"==typeof p)for(var h in p)e(a,r,n,p[h],o+"/"+d+"/"+h.replace(/~/g,"~0").replace(/\//g,"~1"),s,o,d,i,h)}else(d in t.keywords||a.allKeys&&!(d in t.skipKeywords))&&e(a,r,n,p,o+"/"+d,s,o,d,i)}n(i,o,s,u,l,c,f)}}(a,"function"==typeof(r=a.cb||r)?r:r.pre||function(){},r.post||function(){},e,"",e)};t.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0},t.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},t.propsKeywords={definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},t.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0}})),le=ce;function ce(e,t,a){var r=this._refs[a];if("string"==typeof r){if(!this._refs[r])return ce.call(this,e,t,r);r=this._refs[r]}if((r=r||this._schemas[a])instanceof se)return ve(r.schema,this._opts.inlineRefs)?r.schema:r.validate||this._compile(r);var n,i,o,s=fe.call(this,t,a);return s&&(n=s.schema,t=s.root,o=s.baseId),n instanceof se?i=n.validate||e.call(this,n.schema,t,void 0,o):void 0!==n&&(i=ve(n,this._opts.inlineRefs)?n:e.call(this,n,t,void 0,o)),i}function fe(e,t){var a=I.parse(t),r=ge(a),n=ye(this._getId(e.schema));if(0===Object.keys(e.schema).length||r!==n){var i=xe(r),o=this._refs[i];if("string"==typeof o)return de.call(this,e,o,a);if(o instanceof se)o.validate||this._compile(o),e=o;else{if(!((o=this._schemas[i])instanceof se))return;if(o.validate||this._compile(o),i==xe(t))return{schema:o,root:e,baseId:n};e=o}if(!e.schema)return;n=ye(this._getId(e.schema))}return me.call(this,a,n,e.schema,e)}function de(e,t,a){var r=fe.call(this,e,t);if(r){var n=r.schema,i=r.baseId;e=r.root;var o=this._getId(n);return o&&(i=Ee(i,o)),me.call(this,a,i,n,e)}}ce.normalizeId=xe,ce.fullPath=ye,ce.url=Ee,ce.ids=function(e){var t=xe(this._getId(e)),a={"":t},r={"":ye(t,!1)},n={},i=this;return ue(e,{allKeys:!0},(function(e,t,o,s,u,l,c){if(""!==t){var f=i._getId(e),d=a[s],p=r[s]+"/"+u;if(void 0!==c&&(p+="/"+("number"==typeof c?c:R.escapeFragment(c))),"string"==typeof f){f=d=xe(d?I.resolve(d,f):f);var m=i._refs[f];if("string"==typeof m&&(m=i._refs[m]),m&&m.schema){if(!M(e,m.schema))throw new Error('id "'+f+'" resolves to more than one schema')}else if(f!=xe(p))if("#"==f[0]){if(n[f]&&!M(e,n[f]))throw new Error('id "'+f+'" resolves to more than one schema');n[f]=e}else i._refs[f]=p}a[t]=d,r[t]=p}})),n},ce.inlineRef=ve,ce.schema=fe;var pe=R.toHash(["properties","patternProperties","enum","dependencies","definitions"]);function me(e,t,a,r){if(e.fragment=e.fragment||"","/"==e.fragment.slice(0,1)){for(var n=e.fragment.split("/"),i=1;i<n.length;i++){var o=n[i];if(o){if(void 0===(a=a[o=R.unescapeFragment(o)]))break;var s;if(!pe[o]&&((s=this._getId(a))&&(t=Ee(t,s)),a.$ref)){var u=Ee(t,a.$ref),l=fe.call(this,r,u);l&&(a=l.schema,r=l.root,t=l.baseId)}}}return void 0!==a&&a!==r.schema?{schema:a,root:r,baseId:t}:void 0}}var he=R.toHash(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum"]);function ve(e,t){return!1!==t&&(void 0===t||!0===t?function e(t){var a;if(Array.isArray(t)){for(var r=0;r<t.length;r++)if("object"==typeof(a=t[r])&&!e(a))return!1}else for(var n in t){if("$ref"==n)return!1;if("object"==typeof(a=t[n])&&!e(a))return!1}return!0}(e):t?function e(t){var a,r=0;if(Array.isArray(t)){for(var n=0;n<t.length;n++)if("object"==typeof(a=t[n])&&(r+=e(a)),r==1/0)return 1/0}else for(var i in t){if("$ref"==i)return 1/0;if(he[i])r++;else if("object"==typeof(a=t[i])&&(r+=e(a)+1),r==1/0)return 1/0}return r}(e)<=t:void 0)}function ye(e,t){return!1!==t&&(e=xe(e)),ge(I.parse(e))}function ge(e){return I.serialize(e).split("#")[0]+"#"}var be=/#\/?$/;function xe(e){return e?e.replace(be,""):""}function Ee(e,t){return t=xe(t),I.resolve(e,t)}var we={Validation:Ae((function(e){this.message="validation failed",this.errors=e,this.ajv=this.validation=!0})),MissingRef:Ae(ke)};function ke(e,t,a){this.message=a||ke.message(e,t),this.missingRef=le.url(e,t),this.missingSchema=le.normalizeId(le.fullPath(this.missingRef))}function Ae(e){return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}ke.message=function(e,t){return"can't resolve reference "+t+" from id "+e};var De=function(e,t){t||(t={}),"function"===typeof t&&(t={cmp:t});var a,r="boolean"===typeof t.cycles&&t.cycles,n=t.cmp&&(a=t.cmp,function(e){return function(t,r){var n={key:t,value:e[t]},i={key:r,value:e[r]};return a(n,i)}}),i=[];return function e(t){if(t&&t.toJSON&&"function"===typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!==typeof t)return JSON.stringify(t);var a,o;if(Array.isArray(t)){for(o="[",a=0;a<t.length;a++)a&&(o+=","),o+=e(t[a])||"null";return o+"]"}if(null===t)return"null";if(-1!==i.indexOf(t)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var s=i.push(t)-1,u=Object.keys(t).sort(n&&n(t));for(o="",a=0;a<u.length;a++){var l=u[a],c=e(t[l]);c&&(o&&(o+=","),o+=JSON.stringify(l)+":"+c)}return i.splice(s,1),"{"+o+"}"}}(e)},Oe=function(e,t,a){var r="",n=!0===e.schema.$async,i=e.util.schemaHasRulesExcept(e.schema,e.RULES.all,"$ref"),o=e.self._getId(e.schema);if(e.opts.strictKeywords){var s=e.util.schemaUnknownRules(e.schema,e.RULES.keywords);if(s){var u="unknown keyword: "+s;if("log"!==e.opts.strictKeywords)throw new Error(u);e.logger.warn(u)}}if(e.isTop&&(r+=" var validate = ",n&&(e.async=!0,r+="async "),r+="function(data, dataPath, parentData, parentDataProperty, rootData) { 'use strict'; ",o&&(e.opts.sourceCode||e.opts.processCode)&&(r+=" /*# sourceURL="+o+" */ ")),"boolean"==typeof e.schema||!i&&!e.schema.$ref){var l=e.level,c=e.dataLevel,f=e.schema["false schema"],d=e.schemaPath+e.util.getProperty("false schema"),p=e.errSchemaPath+"/false schema",m=!e.opts.allErrors,h="data"+(c||""),v="valid"+l;if(!1===e.schema){e.isTop?m=!0:r+=" var "+v+" = false; ",(G=G||[]).push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'false schema' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: {} ",!1!==e.opts.messages&&(r+=" , message: 'boolean schema is false' "),e.opts.verbose&&(r+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),r+=" } "):r+=" {} ";var y=r;r=G.pop(),!e.compositeRule&&m?e.async?r+=" throw new ValidationError(["+y+"]); ":r+=" validate.errors = ["+y+"]; return false; ":r+=" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else e.isTop?r+=n?" return data; ":" validate.errors = null; return true; ":r+=" var "+v+" = true; ";return e.isTop&&(r+=" }; return validate; "),r}if(e.isTop){var g=e.isTop;l=e.level=0,c=e.dataLevel=0,h="data";if(e.rootId=e.resolve.fullPath(e.self._getId(e.root.schema)),e.baseId=e.baseId||e.rootId,delete e.isTop,e.dataPathArr=[void 0],void 0!==e.schema.default&&e.opts.useDefaults&&e.opts.strictDefaults){var b="default is ignored in the schema root";if("log"!==e.opts.strictDefaults)throw new Error(b);e.logger.warn(b)}r+=" var vErrors = null; ",r+=" var errors = 0;     ",r+=" if (rootData === undefined) rootData = data; "}else{l=e.level,h="data"+((c=e.dataLevel)||"");if(o&&(e.baseId=e.resolve.url(e.baseId,o)),n&&!e.async)throw new Error("async schema in sync schema");r+=" var errs_"+l+" = errors;"}v="valid"+l,m=!e.opts.allErrors;var x="",E="",w=e.schema.type,k=Array.isArray(w);if(w&&e.opts.nullable&&!0===e.schema.nullable&&(k?-1==w.indexOf("null")&&(w=w.concat("null")):"null"!=w&&(w=[w,"null"],k=!0)),k&&1==w.length&&(w=w[0],k=!1),e.schema.$ref&&i){if("fail"==e.opts.extendRefs)throw new Error('$ref: validation keywords used in schema at path "'+e.errSchemaPath+'" (see option extendRefs)');!0!==e.opts.extendRefs&&(i=!1,e.logger.warn('$ref: keywords ignored in schema at path "'+e.errSchemaPath+'"'))}if(e.schema.$comment&&e.opts.$comment&&(r+=" "+e.RULES.all.$comment.code(e,"$comment")),w){if(e.opts.coerceTypes)var A=e.util.coerceToTypes(e.opts.coerceTypes,w);var D=e.RULES.types[w];if(A||k||!0===D||D&&!Y(D)){d=e.schemaPath+".type",p=e.errSchemaPath+"/type",d=e.schemaPath+".type",p=e.errSchemaPath+"/type";var O=k?"checkDataTypes":"checkDataType";if(r+=" if ("+e.util[O](w,h,!0)+") { ",A){var j="dataType"+l,S="coerced"+l;r+=" var "+j+" = typeof "+h+"; ","array"==e.opts.coerceTypes&&(r+=" if ("+j+" == 'object' && Array.isArray("+h+")) "+j+" = 'array'; "),r+=" var "+S+" = undefined; ";var P="",F=A;if(F)for(var C,B=-1,T=F.length-1;B<T;)C=F[B+=1],B&&(r+=" if ("+S+" === undefined) { ",P+="}"),"array"==e.opts.coerceTypes&&"array"!=C&&(r+=" if ("+j+" == 'array' && "+h+".length == 1) { "+S+" = "+h+" = "+h+"[0]; "+j+" = typeof "+h+";  } "),"string"==C?r+=" if ("+j+" == 'number' || "+j+" == 'boolean') "+S+" = '' + "+h+"; else if ("+h+" === null) "+S+" = ''; ":"number"==C||"integer"==C?(r+=" if ("+j+" == 'boolean' || "+h+" === null || ("+j+" == 'string' && "+h+" && "+h+" == +"+h+" ","integer"==C&&(r+=" && !("+h+" % 1)"),r+=")) "+S+" = +"+h+"; "):"boolean"==C?r+=" if ("+h+" === 'false' || "+h+" === 0 || "+h+" === null) "+S+" = false; else if ("+h+" === 'true' || "+h+" === 1) "+S+" = true; ":"null"==C?r+=" if ("+h+" === '' || "+h+" === 0 || "+h+" === false) "+S+" = null; ":"array"==e.opts.coerceTypes&&"array"==C&&(r+=" if ("+j+" == 'string' || "+j+" == 'number' || "+j+" == 'boolean' || "+h+" == null) "+S+" = ["+h+"]; ");r+=" "+P+" if ("+S+" === undefined) {   ",(G=G||[]).push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'type' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: { type: '",r+=k?""+w.join(","):""+w,r+="' } ",!1!==e.opts.messages&&(r+=" , message: 'should be ",r+=k?""+w.join(","):""+w,r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+d+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),r+=" } "):r+=" {} ";y=r;r=G.pop(),!e.compositeRule&&m?e.async?r+=" throw new ValidationError(["+y+"]); ":r+=" validate.errors = ["+y+"]; return false; ":r+=" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } else {  ";var _=c?"data"+(c-1||""):"parentData";r+=" "+h+" = "+S+"; ",c||(r+="if ("+_+" !== undefined)"),r+=" "+_+"["+(c?e.dataPathArr[c]:"parentDataProperty")+"] = "+S+"; } "}else{(G=G||[]).push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'type' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: { type: '",r+=k?""+w.join(","):""+w,r+="' } ",!1!==e.opts.messages&&(r+=" , message: 'should be ",r+=k?""+w.join(","):""+w,r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+d+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),r+=" } "):r+=" {} ";y=r;r=G.pop(),!e.compositeRule&&m?e.async?r+=" throw new ValidationError(["+y+"]); ":r+=" validate.errors = ["+y+"]; return false; ":r+=" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}r+=" } "}}if(e.schema.$ref&&!i)r+=" "+e.RULES.all.$ref.code(e,"$ref")+" ",m&&(r+=" } if (errors === ",r+=g?"0":"errs_"+l,r+=") { ",E+="}");else{var N=e.RULES;if(N)for(var I=-1,M=N.length-1;I<M;)if(Y(D=N[I+=1])){if(D.type&&(r+=" if ("+e.util.checkDataType(D.type,h)+") { "),e.opts.useDefaults)if("object"==D.type&&e.schema.properties){f=e.schema.properties;var R=Object.keys(f);if(R)for(var $,V=-1,z=R.length-1;V<z;){if(void 0!==(q=f[$=R[V+=1]]).default){var L=h+e.util.getProperty($);if(e.compositeRule){if(e.opts.strictDefaults){b="default is ignored for: "+L;if("log"!==e.opts.strictDefaults)throw new Error(b);e.logger.warn(b)}}else r+=" if ("+L+" === undefined ","empty"==e.opts.useDefaults&&(r+=" || "+L+" === null || "+L+" === '' "),r+=" ) "+L+" = ","shared"==e.opts.useDefaults?r+=" "+e.useDefault(q.default)+" ":r+=" "+JSON.stringify(q.default)+" ",r+="; "}}}else if("array"==D.type&&Array.isArray(e.schema.items)){var U=e.schema.items;if(U){B=-1;for(var q,H=U.length-1;B<H;)if(void 0!==(q=U[B+=1]).default){L=h+"["+B+"]";if(e.compositeRule){if(e.opts.strictDefaults){b="default is ignored for: "+L;if("log"!==e.opts.strictDefaults)throw new Error(b);e.logger.warn(b)}}else r+=" if ("+L+" === undefined ","empty"==e.opts.useDefaults&&(r+=" || "+L+" === null || "+L+" === '' "),r+=" ) "+L+" = ","shared"==e.opts.useDefaults?r+=" "+e.useDefault(q.default)+" ":r+=" "+JSON.stringify(q.default)+" ",r+="; "}}}var K=D.rules;if(K)for(var W,Q=-1,J=K.length-1;Q<J;)if(X(W=K[Q+=1])){var Z=W.code(e,W.keyword,D.type);Z&&(r+=" "+Z+" ",m&&(x+="}"))}if(m&&(r+=" "+x+" ",x=""),D.type&&(r+=" } ",w&&w===D.type&&!A)){r+=" else { ";var G;d=e.schemaPath+".type",p=e.errSchemaPath+"/type";(G=G||[]).push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'type' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: { type: '",r+=k?""+w.join(","):""+w,r+="' } ",!1!==e.opts.messages&&(r+=" , message: 'should be ",r+=k?""+w.join(","):""+w,r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+d+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),r+=" } "):r+=" {} ";y=r;r=G.pop(),!e.compositeRule&&m?e.async?r+=" throw new ValidationError(["+y+"]); ":r+=" validate.errors = ["+y+"]; return false; ":r+=" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } "}m&&(r+=" if (errors === ",r+=g?"0":"errs_"+l,r+=") { ",E+="}")}}function Y(e){for(var t=e.rules,a=0;a<t.length;a++)if(X(t[a]))return!0}function X(t){return void 0!==e.schema[t.keyword]||t.implements&&function(t){for(var a=t.implements,r=0;r<a.length;r++)if(void 0!==e.schema[a[r]])return!0}(t)}return m&&(r+=" "+E+" "),g?(n?(r+=" if (errors === 0) return data;           ",r+=" else throw new ValidationError(vErrors); "):(r+=" validate.errors = vErrors; ",r+=" return errors === 0;       "),r+=" }; return validate;"):r+=" var "+v+" = errors === errs_"+l+";",r=e.util.cleanUpCode(r),g&&(r=e.util.finalCleanUpCode(r,n)),r},je=R.ucs2length,Se=we.Validation,Pe=function e(t,a,r,n){var i=this,o=this._opts,s=[void 0],u={},l=[],c={},f=[],d={},p=[];a=a||{schema:t,refVal:s,refs:u};var m=Fe.call(this,t,a,n),h=this._compilations[m.index];if(m.compiling)return h.callValidate=function e(){var t=h.validate,a=t.apply(this,arguments);return e.errors=t.errors,a};var v=this._formats,y=this.RULES;try{var g=x(t,a,r,n);h.validate=g;var b=h.callValidate;return b&&(b.schema=g.schema,b.errors=null,b.refs=g.refs,b.refVal=g.refVal,b.root=g.root,b.$async=g.$async,o.sourceCode&&(b.source=g.source)),g}finally{Ce.call(this,t,a,n)}function x(t,r,n,c){var d=!r||r&&r.schema==t;if(r.schema!=a.schema)return e.call(i,t,r,n,c);var m,h=!0===t.$async,g=Oe({isTop:!0,schema:t,isRoot:d,baseId:c,root:r,schemaPath:"",errSchemaPath:"#",errorPath:'""',MissingRefError:we.MissingRef,RULES:y,validate:Oe,util:R,resolve:le,resolveRef:E,usePattern:A,useDefault:D,useCustomRule:O,opts:o,formats:v,logger:i.logger,self:i});g=Me(s,Ne)+Me(l,Te)+Me(f,_e)+Me(p,Ie)+g,o.processCode&&(g=o.processCode(g));try{m=new Function("self","RULES","formats","root","refVal","defaults","customRules","equal","ucs2length","ValidationError",g)(i,y,v,a,s,f,p,M,je,Se),s[0]=m}catch(b){throw i.logger.error("Error compiling schema, function code:",g),b}return m.schema=t,m.errors=null,m.refs=u,m.refVal=s,m.root=d?m:r,h&&(m.$async=!0),!0===o.sourceCode&&(m.source={code:g,patterns:l,defaults:f}),m}function E(t,n,l){n=le.url(t,n);var c,f,d=u[n];if(void 0!==d)return k(c=s[d],f="refVal["+d+"]");if(!l&&a.refs){var p=a.refs[n];if(void 0!==p)return k(c=a.refVal[p],f=w(n,c))}f=w(n);var m=le.call(i,x,a,n);if(void 0===m){var h=r&&r[n];h&&(m=le.inlineRef(h,o.inlineRefs)?h:e.call(i,h,a,r,t))}if(void 0!==m)return function(e,t){var a=u[e];s[a]=t}(n,m),k(m,f);!function(e){delete u[e]}(n)}function w(e,t){var a=s.length;return s[a]=t,u[e]=a,"refVal"+a}function k(e,t){return"object"==typeof e||"boolean"==typeof e?{code:t,schema:e,inline:!0}:{code:t,$async:e&&!!e.$async}}function A(e){var t=c[e];return void 0===t&&(t=c[e]=l.length,l[t]=e),"pattern"+t}function D(e){switch(typeof e){case"boolean":case"number":return""+e;case"string":return R.toQuotedString(e);case"object":if(null===e)return"null";var t=De(e),a=d[t];return void 0===a&&(a=d[t]=f.length,f[a]=e),"default"+a}}function O(e,t,a,r){if(!1!==i._opts.validateSchema){var n=e.definition.dependencies;if(n&&!n.every((function(e){return Object.prototype.hasOwnProperty.call(a,e)})))throw new Error("parent schema must have all required keywords: "+n.join(","));var s=e.definition.validateSchema;if(s)if(!s(t)){var u="keyword schema is invalid: "+i.errorsText(s.errors);if("log"!=i._opts.validateSchema)throw new Error(u);i.logger.error(u)}}var l,c=e.definition.compile,f=e.definition.inline,d=e.definition.macro;if(c)l=c.call(i,t,a,r);else if(d)l=d.call(i,t,a,r),!1!==o.validateSchema&&i.validateSchema(l,!0);else if(f)l=f.call(i,r,e.keyword,t,a);else if(!(l=e.definition.validate))return;if(void 0===l)throw new Error('custom keyword "'+e.keyword+'"failed to compile');var m=p.length;return p[m]=l,{code:"customRule"+m,validate:l}}};function Fe(e,t,a){var r=Be.call(this,e,t,a);return r>=0?{index:r,compiling:!0}:(r=this._compilations.length,this._compilations[r]={schema:e,root:t,baseId:a},{index:r,compiling:!1})}function Ce(e,t,a){var r=Be.call(this,e,t,a);r>=0&&this._compilations.splice(r,1)}function Be(e,t,a){for(var r=0;r<this._compilations.length;r++){var n=this._compilations[r];if(n.schema==e&&n.root==t&&n.baseId==a)return r}return-1}function Te(e,t){return"var pattern"+e+" = new RegExp("+R.toQuotedString(t[e])+");"}function _e(e){return"var default"+e+" = defaults["+e+"];"}function Ne(e,t){return void 0===t[e]?"":"var refVal"+e+" = refVal["+e+"];"}function Ie(e){return"var customRule"+e+" = customRules["+e+"];"}function Me(e,t){if(!e.length)return"";for(var a="",r=0;r<e.length;r++)a+=t(r,e);return a}var Re=T((function(e){var t=e.exports=function(){this._cache={}};t.prototype.put=function(e,t){this._cache[e]=t},t.prototype.get=function(e){return this._cache[e]},t.prototype.del=function(e){delete this._cache[e]},t.prototype.clear=function(){this._cache={}}})),$e=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,Ve=[0,31,28,31,30,31,30,31,31,30,31,30,31],ze=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,Le=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,Ue=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,qe=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,He=/^(?:(?:http[s\u017F]?|ftp):\/\/)(?:(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+(?::(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?@)?(?:(?!10(?:\.[0-9]{1,3}){3})(?!127(?:\.[0-9]{1,3}){3})(?!169\.254(?:\.[0-9]{1,3}){2})(?!192\.168(?:\.[0-9]{1,3}){2})(?!172\.(?:1[6-9]|2[0-9]|3[01])(?:\.[0-9]{1,3}){2})(?:[1-9][0-9]?|1[0-9][0-9]|2[01][0-9]|22[0-3])(?:\.(?:1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])){2}(?:\.(?:[1-9][0-9]?|1[0-9][0-9]|2[0-4][0-9]|25[0-4]))|(?:(?:(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-?)*(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)(?:\.(?:(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-?)*(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)*(?:\.(?:(?:[KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]){2,})))(?::[0-9]{2,5})?(?:\/(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?$/i,Ke=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,We=/^(?:\/(?:[^~/]|~0|~1)*)*$/,Qe=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,Je=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,Ze=Ge;function Ge(e){return e="full"==e?"full":"fast",R.copy(Ge[e])}function Ye(e){var t=e.match($e);if(!t)return!1;var a=+t[1],r=+t[2],n=+t[3];return r>=1&&r<=12&&n>=1&&n<=(2==r&&function(e){return e%4===0&&(e%100!==0||e%400===0)}(a)?29:Ve[r])}function Xe(e,t){var a=e.match(ze);if(!a)return!1;var r=a[1],n=a[2],i=a[3],o=a[5];return(r<=23&&n<=59&&i<=59||23==r&&59==n&&60==i)&&(!t||o)}Ge.fast={date:/^\d\d\d\d-[0-1]\d-[0-3]\d$/,time:/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,"date-time":/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,uri:/^(?:[a-z][a-z0-9+-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,"uri-template":qe,url:He,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,hostname:Le,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:rt,uuid:Ke,"json-pointer":We,"json-pointer-uri-fragment":Qe,"relative-json-pointer":Je},Ge.full={date:Ye,time:Xe,"date-time":function(e){var t=e.split(et);return 2==t.length&&Ye(t[0])&&Xe(t[1],!0)},uri:function(e){return tt.test(e)&&Ue.test(e)},"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":qe,url:He,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:Le,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:rt,uuid:Ke,"json-pointer":We,"json-pointer-uri-fragment":Qe,"relative-json-pointer":Je};var et=/t|\s/i;var tt=/\/|:/;var at=/[^\\]\\Z/;function rt(e){if(at.test(e))return!1;try{return new RegExp(e),!0}catch(t){return!1}}var nt=function(e,t,a){var r,n=" ",i=e.level,o=e.dataLevel,s=e.schema[t],u=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,f="data"+(o||""),d=e.opts.$data&&s&&s.$data;d?(n+=" var schema"+i+" = "+e.util.getData(s.$data,o,e.dataPathArr)+"; ",r="schema"+i):r=s;var p="maximum"==t,m=p?"exclusiveMaximum":"exclusiveMinimum",h=e.schema[m],v=e.opts.$data&&h&&h.$data,y=p?"<":">",g=p?">":"<",b=void 0;if(v){var x=e.util.getData(h.$data,o,e.dataPathArr),E="exclusive"+i,w="exclType"+i,k="exclIsNumber"+i,A="' + "+(j="op"+i)+" + '";n+=" var schemaExcl"+i+" = "+x+"; ",n+=" var "+E+"; var "+w+" = typeof "+(x="schemaExcl"+i)+"; if ("+w+" != 'boolean' && "+w+" != 'undefined' && "+w+" != 'number') { ";var D;b=m;(D=D||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: '"+(b||"_exclusiveLimit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: '"+m+" should be boolean' "),e.opts.verbose&&(n+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),n+=" } "):n+=" {} ";var O=n;n=D.pop(),!e.compositeRule&&c?e.async?n+=" throw new ValidationError(["+O+"]); ":n+=" validate.errors = ["+O+"]; return false; ":n+=" var err = "+O+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } else if ( ",d&&(n+=" ("+r+" !== undefined && typeof "+r+" != 'number') || "),n+=" "+w+" == 'number' ? ( ("+E+" = "+r+" === undefined || "+x+" "+y+"= "+r+") ? "+f+" "+g+"= "+x+" : "+f+" "+g+" "+r+" ) : ( ("+E+" = "+x+" === true) ? "+f+" "+g+"= "+r+" : "+f+" "+g+" "+r+" ) || "+f+" !== "+f+") { var op"+i+" = "+E+" ? '"+y+"' : '"+y+"='; ",void 0===s&&(b=m,l=e.errSchemaPath+"/"+m,r=x,d=v)}else{A=y;if((k="number"==typeof h)&&d){var j="'"+A+"'";n+=" if ( ",d&&(n+=" ("+r+" !== undefined && typeof "+r+" != 'number') || "),n+=" ( "+r+" === undefined || "+h+" "+y+"= "+r+" ? "+f+" "+g+"= "+h+" : "+f+" "+g+" "+r+" ) || "+f+" !== "+f+") { "}else{k&&void 0===s?(E=!0,b=m,l=e.errSchemaPath+"/"+m,r=h,g+="="):(k&&(r=Math[p?"min":"max"](h,s)),h===(!k||r)?(E=!0,b=m,l=e.errSchemaPath+"/"+m,g+="="):(E=!1,A+="="));j="'"+A+"'";n+=" if ( ",d&&(n+=" ("+r+" !== undefined && typeof "+r+" != 'number') || "),n+=" "+f+" "+g+" "+r+" || "+f+" !== "+f+") { "}}b=b||t,(D=D||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: '"+(b||"_limit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { comparison: "+j+", limit: "+r+", exclusive: "+E+" } ",!1!==e.opts.messages&&(n+=" , message: 'should be "+A+" ",n+=d?"' + "+r:r+"'"),e.opts.verbose&&(n+=" , schema:  ",n+=d?"validate.schema"+u:""+s,n+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),n+=" } "):n+=" {} ";O=n;return n=D.pop(),!e.compositeRule&&c?e.async?n+=" throw new ValidationError(["+O+"]); ":n+=" validate.errors = ["+O+"]; return false; ":n+=" var err = "+O+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } ",c&&(n+=" else { "),n},it=function(e,t,a){var r,n=" ",i=e.level,o=e.dataLevel,s=e.schema[t],u=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,f="data"+(o||""),d=e.opts.$data&&s&&s.$data;d?(n+=" var schema"+i+" = "+e.util.getData(s.$data,o,e.dataPathArr)+"; ",r="schema"+i):r=s,n+="if ( ",d&&(n+=" ("+r+" !== undefined && typeof "+r+" != 'number') || "),n+=" "+f+".length "+("maxItems"==t?">":"<")+" "+r+") { ";var p=t,m=m||[];m.push(n),n="",!1!==e.createErrors?(n+=" { keyword: '"+(p||"_limitItems")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { limit: "+r+" } ",!1!==e.opts.messages&&(n+=" , message: 'should NOT have ",n+="maxItems"==t?"more":"fewer",n+=" than ",n+=d?"' + "+r+" + '":""+s,n+=" items' "),e.opts.verbose&&(n+=" , schema:  ",n+=d?"validate.schema"+u:""+s,n+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),n+=" } "):n+=" {} ";var h=n;return n=m.pop(),!e.compositeRule&&c?e.async?n+=" throw new ValidationError(["+h+"]); ":n+=" validate.errors = ["+h+"]; return false; ":n+=" var err = "+h+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+="} ",c&&(n+=" else { "),n},ot=function(e,t,a){var r,n=" ",i=e.level,o=e.dataLevel,s=e.schema[t],u=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,f="data"+(o||""),d=e.opts.$data&&s&&s.$data;d?(n+=" var schema"+i+" = "+e.util.getData(s.$data,o,e.dataPathArr)+"; ",r="schema"+i):r=s;var p="maxLength"==t?">":"<";n+="if ( ",d&&(n+=" ("+r+" !== undefined && typeof "+r+" != 'number') || "),!1===e.opts.unicode?n+=" "+f+".length ":n+=" ucs2length("+f+") ",n+=" "+p+" "+r+") { ";var m=t,h=h||[];h.push(n),n="",!1!==e.createErrors?(n+=" { keyword: '"+(m||"_limitLength")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { limit: "+r+" } ",!1!==e.opts.messages&&(n+=" , message: 'should NOT be ",n+="maxLength"==t?"longer":"shorter",n+=" than ",n+=d?"' + "+r+" + '":""+s,n+=" characters' "),e.opts.verbose&&(n+=" , schema:  ",n+=d?"validate.schema"+u:""+s,n+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),n+=" } "):n+=" {} ";var v=n;return n=h.pop(),!e.compositeRule&&c?e.async?n+=" throw new ValidationError(["+v+"]); ":n+=" validate.errors = ["+v+"]; return false; ":n+=" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+="} ",c&&(n+=" else { "),n},st=function(e,t,a){var r,n=" ",i=e.level,o=e.dataLevel,s=e.schema[t],u=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,f="data"+(o||""),d=e.opts.$data&&s&&s.$data;d?(n+=" var schema"+i+" = "+e.util.getData(s.$data,o,e.dataPathArr)+"; ",r="schema"+i):r=s,n+="if ( ",d&&(n+=" ("+r+" !== undefined && typeof "+r+" != 'number') || "),n+=" Object.keys("+f+").length "+("maxProperties"==t?">":"<")+" "+r+") { ";var p=t,m=m||[];m.push(n),n="",!1!==e.createErrors?(n+=" { keyword: '"+(p||"_limitProperties")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { limit: "+r+" } ",!1!==e.opts.messages&&(n+=" , message: 'should NOT have ",n+="maxProperties"==t?"more":"fewer",n+=" than ",n+=d?"' + "+r+" + '":""+s,n+=" properties' "),e.opts.verbose&&(n+=" , schema:  ",n+=d?"validate.schema"+u:""+s,n+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),n+=" } "):n+=" {} ";var h=n;return n=m.pop(),!e.compositeRule&&c?e.async?n+=" throw new ValidationError(["+h+"]); ":n+=" validate.errors = ["+h+"]; return false; ":n+=" var err = "+h+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+="} ",c&&(n+=" else { "),n},ut={$ref:function(e,t,a){var r,n,i=" ",o=e.level,s=e.dataLevel,u=e.schema[t],l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,f="data"+(s||""),d="valid"+o;if("#"==u||"#/"==u)e.isRoot?(r=e.async,n="validate"):(r=!0===e.root.schema.$async,n="root.refVal[0]");else{var p=e.resolveRef(e.baseId,u,e.isRoot);if(void 0===p){var m=e.MissingRefError.message(e.baseId,u);if("fail"==e.opts.missingRefs){e.logger.error(m),(g=g||[]).push(i),i="",!1!==e.createErrors?(i+=" { keyword: '$ref' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { ref: '"+e.util.escapeQuotes(u)+"' } ",!1!==e.opts.messages&&(i+=" , message: 'can\\'t resolve reference "+e.util.escapeQuotes(u)+"' "),e.opts.verbose&&(i+=" , schema: "+e.util.toQuotedString(u)+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),i+=" } "):i+=" {} ";var h=i;i=g.pop(),!e.compositeRule&&c?e.async?i+=" throw new ValidationError(["+h+"]); ":i+=" validate.errors = ["+h+"]; return false; ":i+=" var err = "+h+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",c&&(i+=" if (false) { ")}else{if("ignore"!=e.opts.missingRefs)throw new e.MissingRefError(e.baseId,u,m);e.logger.warn(m),c&&(i+=" if (true) { ")}}else if(p.inline){var v=e.util.copy(e);v.level++;var y="valid"+v.level;v.schema=p.schema,v.schemaPath="",v.errSchemaPath=u,i+=" "+e.validate(v).replace(/validate\.schema/g,p.code)+" ",c&&(i+=" if ("+y+") { ")}else r=!0===p.$async||e.async&&!1!==p.$async,n=p.code}if(n){var g;(g=g||[]).push(i),i="",e.opts.passContext?i+=" "+n+".call(this, ":i+=" "+n+"( ",i+=" "+f+", (dataPath || '')",'""'!=e.errorPath&&(i+=" + "+e.errorPath);var b=i+=" , "+(s?"data"+(s-1||""):"parentData")+" , "+(s?e.dataPathArr[s]:"parentDataProperty")+", rootData)  ";if(i=g.pop(),r){if(!e.async)throw new Error("async schema referenced by sync schema");c&&(i+=" var "+d+"; "),i+=" try { await "+b+"; ",c&&(i+=" "+d+" = true; "),i+=" } catch (e) { if (!(e instanceof ValidationError)) throw e; if (vErrors === null) vErrors = e.errors; else vErrors = vErrors.concat(e.errors); errors = vErrors.length; ",c&&(i+=" "+d+" = false; "),i+=" } ",c&&(i+=" if ("+d+") { ")}else i+=" if (!"+b+") { if (vErrors === null) vErrors = "+n+".errors; else vErrors = vErrors.concat("+n+".errors); errors = vErrors.length; } ",c&&(i+=" else { ")}return i},allOf:function(e,t,a){var r=" ",n=e.schema[t],i=e.schemaPath+e.util.getProperty(t),o=e.errSchemaPath+"/"+t,s=!e.opts.allErrors,u=e.util.copy(e),l="";u.level++;var c="valid"+u.level,f=u.baseId,d=!0,p=n;if(p)for(var m,h=-1,v=p.length-1;h<v;)m=p[h+=1],(e.opts.strictKeywords?"object"==typeof m&&Object.keys(m).length>0:e.util.schemaHasRules(m,e.RULES.all))&&(d=!1,u.schema=m,u.schemaPath=i+"["+h+"]",u.errSchemaPath=o+"/"+h,r+="  "+e.validate(u)+" ",u.baseId=f,s&&(r+=" if ("+c+") { ",l+="}"));return s&&(r+=d?" if (true) { ":" "+l.slice(0,-1)+" "),r=e.util.cleanUpCode(r)},anyOf:function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,o=e.schema[t],s=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(i||""),f="valid"+n,d="errs__"+n,p=e.util.copy(e),m="";p.level++;var h="valid"+p.level;if(o.every((function(t){return e.opts.strictKeywords?"object"==typeof t&&Object.keys(t).length>0:e.util.schemaHasRules(t,e.RULES.all)}))){var v=p.baseId;r+=" var "+d+" = errors; var "+f+" = false;  ";var y=e.compositeRule;e.compositeRule=p.compositeRule=!0;var g=o;if(g)for(var b,x=-1,E=g.length-1;x<E;)b=g[x+=1],p.schema=b,p.schemaPath=s+"["+x+"]",p.errSchemaPath=u+"/"+x,r+="  "+e.validate(p)+" ",p.baseId=v,r+=" "+f+" = "+f+" || "+h+"; if (!"+f+") { ",m+="}";e.compositeRule=p.compositeRule=y,r+=" "+m+" if (!"+f+") {   var err =   ",!1!==e.createErrors?(r+=" { keyword: 'anyOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: {} ",!1!==e.opts.messages&&(r+=" , message: 'should match some schema in anyOf' "),e.opts.verbose&&(r+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&l&&(e.async?r+=" throw new ValidationError(vErrors); ":r+=" validate.errors = vErrors; return false; "),r+=" } else {  errors = "+d+"; if (vErrors !== null) { if ("+d+") vErrors.length = "+d+"; else vErrors = null; } ",e.opts.allErrors&&(r+=" } "),r=e.util.cleanUpCode(r)}else l&&(r+=" if (true) { ");return r},$comment:function(e,t,a){var r=" ",n=e.schema[t],i=e.errSchemaPath+"/"+t,o=(e.opts.allErrors,e.util.toQuotedString(n));return!0===e.opts.$comment?r+=" console.log("+o+");":"function"==typeof e.opts.$comment&&(r+=" self._opts.$comment("+o+", "+e.util.toQuotedString(i)+", validate.root.schema);"),r},const:function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,o=e.schema[t],s=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(i||""),f="valid"+n,d=e.opts.$data&&o&&o.$data;d&&(r+=" var schema"+n+" = "+e.util.getData(o.$data,i,e.dataPathArr)+"; "),d||(r+=" var schema"+n+" = validate.schema"+s+";"),r+="var "+f+" = equal("+c+", schema"+n+"); if (!"+f+") {   ";var p=p||[];p.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'const' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { allowedValue: schema"+n+" } ",!1!==e.opts.messages&&(r+=" , message: 'should be equal to constant' "),e.opts.verbose&&(r+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var m=r;return r=p.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+m+"]); ":r+=" validate.errors = ["+m+"]; return false; ":r+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" }",l&&(r+=" else { "),r},contains:function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,o=e.schema[t],s=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(i||""),f="valid"+n,d="errs__"+n,p=e.util.copy(e);p.level++;var m="valid"+p.level,h="i"+n,v=p.dataLevel=e.dataLevel+1,y="data"+v,g=e.baseId,b=e.opts.strictKeywords?"object"==typeof o&&Object.keys(o).length>0:e.util.schemaHasRules(o,e.RULES.all);if(r+="var "+d+" = errors;var "+f+";",b){var x=e.compositeRule;e.compositeRule=p.compositeRule=!0,p.schema=o,p.schemaPath=s,p.errSchemaPath=u,r+=" var "+m+" = false; for (var "+h+" = 0; "+h+" < "+c+".length; "+h+"++) { ",p.errorPath=e.util.getPathExpr(e.errorPath,h,e.opts.jsonPointers,!0);var E=c+"["+h+"]";p.dataPathArr[v]=h;var w=e.validate(p);p.baseId=g,e.util.varOccurences(w,y)<2?r+=" "+e.util.varReplace(w,y,E)+" ":r+=" var "+y+" = "+E+"; "+w+" ",r+=" if ("+m+") break; }  ",e.compositeRule=p.compositeRule=x,r+="  if (!"+m+") {"}else r+=" if ("+c+".length == 0) {";var k=k||[];k.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'contains' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: {} ",!1!==e.opts.messages&&(r+=" , message: 'should contain a valid item' "),e.opts.verbose&&(r+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var A=r;return r=k.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+A+"]); ":r+=" validate.errors = ["+A+"]; return false; ":r+=" var err = "+A+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } else { ",b&&(r+="  errors = "+d+"; if (vErrors !== null) { if ("+d+") vErrors.length = "+d+"; else vErrors = null; } "),e.opts.allErrors&&(r+=" } "),r=e.util.cleanUpCode(r)},dependencies:function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,o=e.schema[t],s=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(i||""),f="errs__"+n,d=e.util.copy(e),p="";d.level++;var m="valid"+d.level,h={},v={},y=e.opts.ownProperties;for(E in o){var g=o[E],b=Array.isArray(g)?v:h;b[E]=g}r+="var "+f+" = errors;";var x=e.errorPath;for(var E in r+="var missing"+n+";",v)if((b=v[E]).length){if(r+=" if ( "+c+e.util.getProperty(E)+" !== undefined ",y&&(r+=" && Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(E)+"') "),l){r+=" && ( ";var w=b;if(w)for(var k=-1,A=w.length-1;k<A;){F=w[k+=1],k&&(r+=" || "),r+=" ( ( "+(_=c+(T=e.util.getProperty(F)))+" === undefined ",y&&(r+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(F)+"') "),r+=") && (missing"+n+" = "+e.util.toQuotedString(e.opts.jsonPointers?F:T)+") ) "}r+=")) {  ";var D="missing"+n,O="' + "+D+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(x,D,!0):x+" + "+D);var j=j||[];j.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { property: '"+e.util.escapeQuotes(E)+"', missingProperty: '"+O+"', depsCount: "+b.length+", deps: '"+e.util.escapeQuotes(1==b.length?b[0]:b.join(", "))+"' } ",!1!==e.opts.messages&&(r+=" , message: 'should have ",1==b.length?r+="property "+e.util.escapeQuotes(b[0]):r+="properties "+e.util.escapeQuotes(b.join(", ")),r+=" when property "+e.util.escapeQuotes(E)+" is present' "),e.opts.verbose&&(r+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var S=r;r=j.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+S+"]); ":r+=" validate.errors = ["+S+"]; return false; ":r+=" var err = "+S+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else{r+=" ) { ";var P=b;if(P)for(var F,C=-1,B=P.length-1;C<B;){F=P[C+=1];var T=e.util.getProperty(F),_=(O=e.util.escapeQuotes(F),c+T);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(x,F,e.opts.jsonPointers)),r+=" if ( "+_+" === undefined ",y&&(r+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(F)+"') "),r+=") {  var err =   ",!1!==e.createErrors?(r+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { property: '"+e.util.escapeQuotes(E)+"', missingProperty: '"+O+"', depsCount: "+b.length+", deps: '"+e.util.escapeQuotes(1==b.length?b[0]:b.join(", "))+"' } ",!1!==e.opts.messages&&(r+=" , message: 'should have ",1==b.length?r+="property "+e.util.escapeQuotes(b[0]):r+="properties "+e.util.escapeQuotes(b.join(", ")),r+=" when property "+e.util.escapeQuotes(E)+" is present' "),e.opts.verbose&&(r+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}r+=" }   ",l&&(p+="}",r+=" else { ")}e.errorPath=x;var N=d.baseId;for(var E in h){g=h[E];(e.opts.strictKeywords?"object"==typeof g&&Object.keys(g).length>0:e.util.schemaHasRules(g,e.RULES.all))&&(r+=" "+m+" = true; if ( "+c+e.util.getProperty(E)+" !== undefined ",y&&(r+=" && Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(E)+"') "),r+=") { ",d.schema=g,d.schemaPath=s+e.util.getProperty(E),d.errSchemaPath=u+"/"+e.util.escapeFragment(E),r+="  "+e.validate(d)+" ",d.baseId=N,r+=" }  ",l&&(r+=" if ("+m+") { ",p+="}"))}return l&&(r+="   "+p+" if ("+f+" == errors) {"),r=e.util.cleanUpCode(r)},enum:function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,o=e.schema[t],s=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(i||""),f="valid"+n,d=e.opts.$data&&o&&o.$data;d&&(r+=" var schema"+n+" = "+e.util.getData(o.$data,i,e.dataPathArr)+"; ");var p="i"+n,m="schema"+n;d||(r+=" var "+m+" = validate.schema"+s+";"),r+="var "+f+";",d&&(r+=" if (schema"+n+" === undefined) "+f+" = true; else if (!Array.isArray(schema"+n+")) "+f+" = false; else {"),r+=f+" = false;for (var "+p+"=0; "+p+"<"+m+".length; "+p+"++) if (equal("+c+", "+m+"["+p+"])) { "+f+" = true; break; }",d&&(r+="  }  "),r+=" if (!"+f+") {   ";var h=h||[];h.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'enum' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { allowedValues: schema"+n+" } ",!1!==e.opts.messages&&(r+=" , message: 'should be equal to one of the allowed values' "),e.opts.verbose&&(r+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var v=r;return r=h.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+v+"]); ":r+=" validate.errors = ["+v+"]; return false; ":r+=" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" }",l&&(r+=" else { "),r},format:function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,o=e.schema[t],s=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(i||"");if(!1===e.opts.format)return l&&(r+=" if (true) { "),r;var f,d=e.opts.$data&&o&&o.$data;d?(r+=" var schema"+n+" = "+e.util.getData(o.$data,i,e.dataPathArr)+"; ",f="schema"+n):f=o;var p=e.opts.unknownFormats,m=Array.isArray(p);if(d){r+=" var "+(h="format"+n)+" = formats["+f+"]; var "+(v="isObject"+n)+" = typeof "+h+" == 'object' && !("+h+" instanceof RegExp) && "+h+".validate; var "+(y="formatType"+n)+" = "+v+" && "+h+".type || 'string'; if ("+v+") { ",e.async&&(r+=" var async"+n+" = "+h+".async; "),r+=" "+h+" = "+h+".validate; } if (  ",d&&(r+=" ("+f+" !== undefined && typeof "+f+" != 'string') || "),r+=" (","ignore"!=p&&(r+=" ("+f+" && !"+h+" ",m&&(r+=" && self._opts.unknownFormats.indexOf("+f+") == -1 "),r+=") || "),r+=" ("+h+" && "+y+" == '"+a+"' && !(typeof "+h+" == 'function' ? ",e.async?r+=" (async"+n+" ? await "+h+"("+c+") : "+h+"("+c+")) ":r+=" "+h+"("+c+") ",r+=" : "+h+".test("+c+"))))) {"}else{var h;if(!(h=e.formats[o])){if("ignore"==p)return e.logger.warn('unknown format "'+o+'" ignored in schema at path "'+e.errSchemaPath+'"'),l&&(r+=" if (true) { "),r;if(m&&p.indexOf(o)>=0)return l&&(r+=" if (true) { "),r;throw new Error('unknown format "'+o+'" is used in schema at path "'+e.errSchemaPath+'"')}var v,y=(v="object"==typeof h&&!(h instanceof RegExp)&&h.validate)&&h.type||"string";if(v){var g=!0===h.async;h=h.validate}if(y!=a)return l&&(r+=" if (true) { "),r;if(g){if(!e.async)throw new Error("async format in sync schema");r+=" if (!(await "+(b="formats"+e.util.getProperty(o)+".validate")+"("+c+"))) { "}else{r+=" if (! ";var b="formats"+e.util.getProperty(o);v&&(b+=".validate"),r+="function"==typeof h?" "+b+"("+c+") ":" "+b+".test("+c+") ",r+=") { "}}var x=x||[];x.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'format' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { format:  ",r+=d?""+f:""+e.util.toQuotedString(o),r+="  } ",!1!==e.opts.messages&&(r+=" , message: 'should match format \"",r+=d?"' + "+f+" + '":""+e.util.escapeQuotes(o),r+="\"' "),e.opts.verbose&&(r+=" , schema:  ",r+=d?"validate.schema"+s:""+e.util.toQuotedString(o),r+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var E=r;return r=x.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+E+"]); ":r+=" validate.errors = ["+E+"]; return false; ":r+=" var err = "+E+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } ",l&&(r+=" else { "),r},if:function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,o=e.schema[t],s=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(i||""),f="valid"+n,d="errs__"+n,p=e.util.copy(e);p.level++;var m="valid"+p.level,h=e.schema.then,v=e.schema.else,y=void 0!==h&&(e.opts.strictKeywords?"object"==typeof h&&Object.keys(h).length>0:e.util.schemaHasRules(h,e.RULES.all)),g=void 0!==v&&(e.opts.strictKeywords?"object"==typeof v&&Object.keys(v).length>0:e.util.schemaHasRules(v,e.RULES.all)),b=p.baseId;if(y||g){var x;p.createErrors=!1,p.schema=o,p.schemaPath=s,p.errSchemaPath=u,r+=" var "+d+" = errors; var "+f+" = true;  ";var E=e.compositeRule;e.compositeRule=p.compositeRule=!0,r+="  "+e.validate(p)+" ",p.baseId=b,p.createErrors=!0,r+="  errors = "+d+"; if (vErrors !== null) { if ("+d+") vErrors.length = "+d+"; else vErrors = null; }  ",e.compositeRule=p.compositeRule=E,y?(r+=" if ("+m+") {  ",p.schema=e.schema.then,p.schemaPath=e.schemaPath+".then",p.errSchemaPath=e.errSchemaPath+"/then",r+="  "+e.validate(p)+" ",p.baseId=b,r+=" "+f+" = "+m+"; ",y&&g?r+=" var "+(x="ifClause"+n)+" = 'then'; ":x="'then'",r+=" } ",g&&(r+=" else { ")):r+=" if (!"+m+") { ",g&&(p.schema=e.schema.else,p.schemaPath=e.schemaPath+".else",p.errSchemaPath=e.errSchemaPath+"/else",r+="  "+e.validate(p)+" ",p.baseId=b,r+=" "+f+" = "+m+"; ",y&&g?r+=" var "+(x="ifClause"+n)+" = 'else'; ":x="'else'",r+=" } "),r+=" if (!"+f+") {   var err =   ",!1!==e.createErrors?(r+=" { keyword: 'if' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { failingKeyword: "+x+" } ",!1!==e.opts.messages&&(r+=" , message: 'should match \"' + "+x+" + '\" schema' "),e.opts.verbose&&(r+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&l&&(e.async?r+=" throw new ValidationError(vErrors); ":r+=" validate.errors = vErrors; return false; "),r+=" }   ",l&&(r+=" else { "),r=e.util.cleanUpCode(r)}else l&&(r+=" if (true) { ");return r},items:function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,o=e.schema[t],s=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(i||""),f="valid"+n,d="errs__"+n,p=e.util.copy(e),m="";p.level++;var h="valid"+p.level,v="i"+n,y=p.dataLevel=e.dataLevel+1,g="data"+y,b=e.baseId;if(r+="var "+d+" = errors;var "+f+";",Array.isArray(o)){var x=e.schema.additionalItems;if(!1===x){r+=" "+f+" = "+c+".length <= "+o.length+"; ";var E=u;u=e.errSchemaPath+"/additionalItems",r+="  if (!"+f+") {   ";var w=w||[];w.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'additionalItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { limit: "+o.length+" } ",!1!==e.opts.messages&&(r+=" , message: 'should NOT have more than "+o.length+" items' "),e.opts.verbose&&(r+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var k=r;r=w.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+k+"]); ":r+=" validate.errors = ["+k+"]; return false; ":r+=" var err = "+k+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } ",u=E,l&&(m+="}",r+=" else { ")}var A=o;if(A)for(var D,O=-1,j=A.length-1;O<j;)if(D=A[O+=1],e.opts.strictKeywords?"object"==typeof D&&Object.keys(D).length>0:e.util.schemaHasRules(D,e.RULES.all)){r+=" "+h+" = true; if ("+c+".length > "+O+") { ";var S=c+"["+O+"]";p.schema=D,p.schemaPath=s+"["+O+"]",p.errSchemaPath=u+"/"+O,p.errorPath=e.util.getPathExpr(e.errorPath,O,e.opts.jsonPointers,!0),p.dataPathArr[y]=O;var P=e.validate(p);p.baseId=b,e.util.varOccurences(P,g)<2?r+=" "+e.util.varReplace(P,g,S)+" ":r+=" var "+g+" = "+S+"; "+P+" ",r+=" }  ",l&&(r+=" if ("+h+") { ",m+="}")}if("object"==typeof x&&(e.opts.strictKeywords?"object"==typeof x&&Object.keys(x).length>0:e.util.schemaHasRules(x,e.RULES.all))){p.schema=x,p.schemaPath=e.schemaPath+".additionalItems",p.errSchemaPath=e.errSchemaPath+"/additionalItems",r+=" "+h+" = true; if ("+c+".length > "+o.length+") {  for (var "+v+" = "+o.length+"; "+v+" < "+c+".length; "+v+"++) { ",p.errorPath=e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers,!0);S=c+"["+v+"]";p.dataPathArr[y]=v;P=e.validate(p);p.baseId=b,e.util.varOccurences(P,g)<2?r+=" "+e.util.varReplace(P,g,S)+" ":r+=" var "+g+" = "+S+"; "+P+" ",l&&(r+=" if (!"+h+") break; "),r+=" } }  ",l&&(r+=" if ("+h+") { ",m+="}")}}else if(e.opts.strictKeywords?"object"==typeof o&&Object.keys(o).length>0:e.util.schemaHasRules(o,e.RULES.all)){p.schema=o,p.schemaPath=s,p.errSchemaPath=u,r+="  for (var "+v+" = 0; "+v+" < "+c+".length; "+v+"++) { ",p.errorPath=e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers,!0);S=c+"["+v+"]";p.dataPathArr[y]=v;P=e.validate(p);p.baseId=b,e.util.varOccurences(P,g)<2?r+=" "+e.util.varReplace(P,g,S)+" ":r+=" var "+g+" = "+S+"; "+P+" ",l&&(r+=" if (!"+h+") break; "),r+=" }"}return l&&(r+=" "+m+" if ("+d+" == errors) {"),r=e.util.cleanUpCode(r)},maximum:nt,minimum:nt,maxItems:it,minItems:it,maxLength:ot,minLength:ot,maxProperties:st,minProperties:st,multipleOf:function(e,t,a){var r,n=" ",i=e.level,o=e.dataLevel,s=e.schema[t],u=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,f="data"+(o||""),d=e.opts.$data&&s&&s.$data;d?(n+=" var schema"+i+" = "+e.util.getData(s.$data,o,e.dataPathArr)+"; ",r="schema"+i):r=s,n+="var division"+i+";if (",d&&(n+=" "+r+" !== undefined && ( typeof "+r+" != 'number' || "),n+=" (division"+i+" = "+f+" / "+r+", ",e.opts.multipleOfPrecision?n+=" Math.abs(Math.round(division"+i+") - division"+i+") > 1e-"+e.opts.multipleOfPrecision+" ":n+=" division"+i+" !== parseInt(division"+i+") ",n+=" ) ",d&&(n+="  )  "),n+=" ) {   ";var p=p||[];p.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'multipleOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { multipleOf: "+r+" } ",!1!==e.opts.messages&&(n+=" , message: 'should be multiple of ",n+=d?"' + "+r:r+"'"),e.opts.verbose&&(n+=" , schema:  ",n+=d?"validate.schema"+u:""+s,n+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),n+=" } "):n+=" {} ";var m=n;return n=p.pop(),!e.compositeRule&&c?e.async?n+=" throw new ValidationError(["+m+"]); ":n+=" validate.errors = ["+m+"]; return false; ":n+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+="} ",c&&(n+=" else { "),n},not:function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,o=e.schema[t],s=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(i||""),f="errs__"+n,d=e.util.copy(e);d.level++;var p="valid"+d.level;if(e.opts.strictKeywords?"object"==typeof o&&Object.keys(o).length>0:e.util.schemaHasRules(o,e.RULES.all)){d.schema=o,d.schemaPath=s,d.errSchemaPath=u,r+=" var "+f+" = errors;  ";var m,h=e.compositeRule;e.compositeRule=d.compositeRule=!0,d.createErrors=!1,d.opts.allErrors&&(m=d.opts.allErrors,d.opts.allErrors=!1),r+=" "+e.validate(d)+" ",d.createErrors=!0,m&&(d.opts.allErrors=m),e.compositeRule=d.compositeRule=h,r+=" if ("+p+") {   ";var v=v||[];v.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: {} ",!1!==e.opts.messages&&(r+=" , message: 'should NOT be valid' "),e.opts.verbose&&(r+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var y=r;r=v.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+y+"]); ":r+=" validate.errors = ["+y+"]; return false; ":r+=" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } else {  errors = "+f+"; if (vErrors !== null) { if ("+f+") vErrors.length = "+f+"; else vErrors = null; } ",e.opts.allErrors&&(r+=" } ")}else r+="  var err =   ",!1!==e.createErrors?(r+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: {} ",!1!==e.opts.messages&&(r+=" , message: 'should NOT be valid' "),e.opts.verbose&&(r+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l&&(r+=" if (false) { ");return r},oneOf:function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,o=e.schema[t],s=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(i||""),f="valid"+n,d="errs__"+n,p=e.util.copy(e),m="";p.level++;var h="valid"+p.level,v=p.baseId,y="prevValid"+n,g="passingSchemas"+n;r+="var "+d+" = errors , "+y+" = false , "+f+" = false , "+g+" = null; ";var b=e.compositeRule;e.compositeRule=p.compositeRule=!0;var x=o;if(x)for(var E,w=-1,k=x.length-1;w<k;)E=x[w+=1],(e.opts.strictKeywords?"object"==typeof E&&Object.keys(E).length>0:e.util.schemaHasRules(E,e.RULES.all))?(p.schema=E,p.schemaPath=s+"["+w+"]",p.errSchemaPath=u+"/"+w,r+="  "+e.validate(p)+" ",p.baseId=v):r+=" var "+h+" = true; ",w&&(r+=" if ("+h+" && "+y+") { "+f+" = false; "+g+" = ["+g+", "+w+"]; } else { ",m+="}"),r+=" if ("+h+") { "+f+" = "+y+" = true; "+g+" = "+w+"; }";return e.compositeRule=p.compositeRule=b,r+=m+"if (!"+f+") {   var err =   ",!1!==e.createErrors?(r+=" { keyword: 'oneOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { passingSchemas: "+g+" } ",!1!==e.opts.messages&&(r+=" , message: 'should match exactly one schema in oneOf' "),e.opts.verbose&&(r+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&l&&(e.async?r+=" throw new ValidationError(vErrors); ":r+=" validate.errors = vErrors; return false; "),r+="} else {  errors = "+d+"; if (vErrors !== null) { if ("+d+") vErrors.length = "+d+"; else vErrors = null; }",e.opts.allErrors&&(r+=" } "),r},pattern:function(e,t,a){var r,n=" ",i=e.level,o=e.dataLevel,s=e.schema[t],u=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,f="data"+(o||""),d=e.opts.$data&&s&&s.$data;d?(n+=" var schema"+i+" = "+e.util.getData(s.$data,o,e.dataPathArr)+"; ",r="schema"+i):r=s,n+="if ( ",d&&(n+=" ("+r+" !== undefined && typeof "+r+" != 'string') || "),n+=" !"+(d?"(new RegExp("+r+"))":e.usePattern(s))+".test("+f+") ) {   ";var p=p||[];p.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'pattern' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { pattern:  ",n+=d?""+r:""+e.util.toQuotedString(s),n+="  } ",!1!==e.opts.messages&&(n+=" , message: 'should match pattern \"",n+=d?"' + "+r+" + '":""+e.util.escapeQuotes(s),n+="\"' "),e.opts.verbose&&(n+=" , schema:  ",n+=d?"validate.schema"+u:""+e.util.toQuotedString(s),n+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),n+=" } "):n+=" {} ";var m=n;return n=p.pop(),!e.compositeRule&&c?e.async?n+=" throw new ValidationError(["+m+"]); ":n+=" validate.errors = ["+m+"]; return false; ":n+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+="} ",c&&(n+=" else { "),n},properties:function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,o=e.schema[t],s=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(i||""),f="errs__"+n,d=e.util.copy(e),p="";d.level++;var m="valid"+d.level,h="key"+n,v="idx"+n,y=d.dataLevel=e.dataLevel+1,g="data"+y,b="dataProperties"+n,x=Object.keys(o||{}),E=e.schema.patternProperties||{},w=Object.keys(E),k=e.schema.additionalProperties,A=x.length||w.length,D=!1===k,O="object"==typeof k&&Object.keys(k).length,j=e.opts.removeAdditional,S=D||O||j,P=e.opts.ownProperties,F=e.baseId,C=e.schema.required;if(C&&(!e.opts.$data||!C.$data)&&C.length<e.opts.loopRequired)var B=e.util.toHash(C);if(r+="var "+f+" = errors;var "+m+" = true;",P&&(r+=" var "+b+" = undefined;"),S){if(r+=P?" "+b+" = "+b+" || Object.keys("+c+"); for (var "+v+"=0; "+v+"<"+b+".length; "+v+"++) { var "+h+" = "+b+"["+v+"]; ":" for (var "+h+" in "+c+") { ",A){if(r+=" var isAdditional"+n+" = !(false ",x.length)if(x.length>8)r+=" || validate.schema"+s+".hasOwnProperty("+h+") ";else{var T=x;if(T)for(var _=-1,N=T.length-1;_<N;)Q=T[_+=1],r+=" || "+h+" == "+e.util.toQuotedString(Q)+" "}if(w.length){var I=w;if(I)for(var M=-1,R=I.length-1;M<R;)ne=I[M+=1],r+=" || "+e.usePattern(ne)+".test("+h+") "}r+=" ); if (isAdditional"+n+") { "}if("all"==j)r+=" delete "+c+"["+h+"]; ";else{var $=e.errorPath,V="' + "+h+" + '";if(e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(e.errorPath,h,e.opts.jsonPointers)),D)if(j)r+=" delete "+c+"["+h+"]; ";else{r+=" "+m+" = false; ";var z=u;u=e.errSchemaPath+"/additionalProperties",(te=te||[]).push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'additionalProperties' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { additionalProperty: '"+V+"' } ",!1!==e.opts.messages&&(r+=" , message: '",e.opts._errorDataPathProperty?r+="is an invalid additional property":r+="should NOT have additional properties",r+="' "),e.opts.verbose&&(r+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var L=r;r=te.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+L+"]); ":r+=" validate.errors = ["+L+"]; return false; ":r+=" var err = "+L+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",u=z,l&&(r+=" break; ")}else if(O)if("failing"==j){r+=" var "+f+" = errors;  ";var U=e.compositeRule;e.compositeRule=d.compositeRule=!0,d.schema=k,d.schemaPath=e.schemaPath+".additionalProperties",d.errSchemaPath=e.errSchemaPath+"/additionalProperties",d.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,h,e.opts.jsonPointers);var q=c+"["+h+"]";d.dataPathArr[y]=h;var H=e.validate(d);d.baseId=F,e.util.varOccurences(H,g)<2?r+=" "+e.util.varReplace(H,g,q)+" ":r+=" var "+g+" = "+q+"; "+H+" ",r+=" if (!"+m+") { errors = "+f+"; if (validate.errors !== null) { if (errors) validate.errors.length = errors; else validate.errors = null; } delete "+c+"["+h+"]; }  ",e.compositeRule=d.compositeRule=U}else{d.schema=k,d.schemaPath=e.schemaPath+".additionalProperties",d.errSchemaPath=e.errSchemaPath+"/additionalProperties",d.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,h,e.opts.jsonPointers);q=c+"["+h+"]";d.dataPathArr[y]=h;H=e.validate(d);d.baseId=F,e.util.varOccurences(H,g)<2?r+=" "+e.util.varReplace(H,g,q)+" ":r+=" var "+g+" = "+q+"; "+H+" ",l&&(r+=" if (!"+m+") break; ")}e.errorPath=$}A&&(r+=" } "),r+=" }  ",l&&(r+=" if ("+m+") { ",p+="}")}var K=e.opts.useDefaults&&!e.compositeRule;if(x.length){var W=x;if(W)for(var Q,J=-1,Z=W.length-1;J<Z;){var G=o[Q=W[J+=1]];if(e.opts.strictKeywords?"object"==typeof G&&Object.keys(G).length>0:e.util.schemaHasRules(G,e.RULES.all)){var Y=e.util.getProperty(Q),X=(q=c+Y,K&&void 0!==G.default);d.schema=G,d.schemaPath=s+Y,d.errSchemaPath=u+"/"+e.util.escapeFragment(Q),d.errorPath=e.util.getPath(e.errorPath,Q,e.opts.jsonPointers),d.dataPathArr[y]=e.util.toQuotedString(Q);H=e.validate(d);if(d.baseId=F,e.util.varOccurences(H,g)<2){H=e.util.varReplace(H,g,q);var ee=q}else{ee=g;r+=" var "+g+" = "+q+"; "}if(X)r+=" "+H+" ";else{if(B&&B[Q]){r+=" if ( "+ee+" === undefined ",P&&(r+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(Q)+"') "),r+=") { "+m+" = false; ";$=e.errorPath,z=u;var te,ae=e.util.escapeQuotes(Q);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath($,Q,e.opts.jsonPointers)),u=e.errSchemaPath+"/required",(te=te||[]).push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { missingProperty: '"+ae+"' } ",!1!==e.opts.messages&&(r+=" , message: '",e.opts._errorDataPathProperty?r+="is a required property":r+="should have required property \\'"+ae+"\\'",r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";L=r;r=te.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+L+"]); ":r+=" validate.errors = ["+L+"]; return false; ":r+=" var err = "+L+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",u=z,e.errorPath=$,r+=" } else { "}else l?(r+=" if ( "+ee+" === undefined ",P&&(r+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(Q)+"') "),r+=") { "+m+" = true; } else { "):(r+=" if ("+ee+" !== undefined ",P&&(r+=" &&   Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(Q)+"') "),r+=" ) { ");r+=" "+H+" } "}}l&&(r+=" if ("+m+") { ",p+="}")}}if(w.length){var re=w;if(re)for(var ne,ie=-1,oe=re.length-1;ie<oe;){G=E[ne=re[ie+=1]];if(e.opts.strictKeywords?"object"==typeof G&&Object.keys(G).length>0:e.util.schemaHasRules(G,e.RULES.all)){d.schema=G,d.schemaPath=e.schemaPath+".patternProperties"+e.util.getProperty(ne),d.errSchemaPath=e.errSchemaPath+"/patternProperties/"+e.util.escapeFragment(ne),r+=P?" "+b+" = "+b+" || Object.keys("+c+"); for (var "+v+"=0; "+v+"<"+b+".length; "+v+"++) { var "+h+" = "+b+"["+v+"]; ":" for (var "+h+" in "+c+") { ",r+=" if ("+e.usePattern(ne)+".test("+h+")) { ",d.errorPath=e.util.getPathExpr(e.errorPath,h,e.opts.jsonPointers);q=c+"["+h+"]";d.dataPathArr[y]=h;H=e.validate(d);d.baseId=F,e.util.varOccurences(H,g)<2?r+=" "+e.util.varReplace(H,g,q)+" ":r+=" var "+g+" = "+q+"; "+H+" ",l&&(r+=" if (!"+m+") break; "),r+=" } ",l&&(r+=" else "+m+" = true; "),r+=" }  ",l&&(r+=" if ("+m+") { ",p+="}")}}}return l&&(r+=" "+p+" if ("+f+" == errors) {"),r=e.util.cleanUpCode(r)},propertyNames:function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,o=e.schema[t],s=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(i||""),f="errs__"+n,d=e.util.copy(e);d.level++;var p="valid"+d.level;if(r+="var "+f+" = errors;",e.opts.strictKeywords?"object"==typeof o&&Object.keys(o).length>0:e.util.schemaHasRules(o,e.RULES.all)){d.schema=o,d.schemaPath=s,d.errSchemaPath=u;var m="key"+n,h="idx"+n,v="i"+n,y="' + "+m+" + '",g="data"+(d.dataLevel=e.dataLevel+1),b="dataProperties"+n,x=e.opts.ownProperties,E=e.baseId;x&&(r+=" var "+b+" = undefined; "),r+=x?" "+b+" = "+b+" || Object.keys("+c+"); for (var "+h+"=0; "+h+"<"+b+".length; "+h+"++) { var "+m+" = "+b+"["+h+"]; ":" for (var "+m+" in "+c+") { ",r+=" var startErrs"+n+" = errors; ";var w=m,k=e.compositeRule;e.compositeRule=d.compositeRule=!0;var A=e.validate(d);d.baseId=E,e.util.varOccurences(A,g)<2?r+=" "+e.util.varReplace(A,g,w)+" ":r+=" var "+g+" = "+w+"; "+A+" ",e.compositeRule=d.compositeRule=k,r+=" if (!"+p+") { for (var "+v+"=startErrs"+n+"; "+v+"<errors; "+v+"++) { vErrors["+v+"].propertyName = "+m+"; }   var err =   ",!1!==e.createErrors?(r+=" { keyword: 'propertyNames' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { propertyName: '"+y+"' } ",!1!==e.opts.messages&&(r+=" , message: 'property name \\'"+y+"\\' is invalid' "),e.opts.verbose&&(r+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&l&&(e.async?r+=" throw new ValidationError(vErrors); ":r+=" validate.errors = vErrors; return false; "),l&&(r+=" break; "),r+=" } }"}return l&&(r+="  if ("+f+" == errors) {"),r=e.util.cleanUpCode(r)},required:function(e,t,a){var r=" ",n=e.level,i=e.dataLevel,o=e.schema[t],s=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,l=!e.opts.allErrors,c="data"+(i||""),f="valid"+n,d=e.opts.$data&&o&&o.$data;d&&(r+=" var schema"+n+" = "+e.util.getData(o.$data,i,e.dataPathArr)+"; ");var p="schema"+n;if(!d)if(o.length<e.opts.loopRequired&&e.schema.properties&&Object.keys(e.schema.properties).length){var m=[],h=o;if(h)for(var v,y=-1,g=h.length-1;y<g;){v=h[y+=1];var b=e.schema.properties[v];b&&(e.opts.strictKeywords?"object"==typeof b&&Object.keys(b).length>0:e.util.schemaHasRules(b,e.RULES.all))||(m[m.length]=v)}}else m=o;if(d||m.length){var x=e.errorPath,E=d||m.length>=e.opts.loopRequired,w=e.opts.ownProperties;if(l)if(r+=" var missing"+n+"; ",E){d||(r+=" var "+p+" = validate.schema"+s+"; ");var k="' + "+(P="schema"+n+"["+(O="i"+n)+"]")+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(x,P,e.opts.jsonPointers)),r+=" var "+f+" = true; ",d&&(r+=" if (schema"+n+" === undefined) "+f+" = true; else if (!Array.isArray(schema"+n+")) "+f+" = false; else {"),r+=" for (var "+O+" = 0; "+O+" < "+p+".length; "+O+"++) { "+f+" = "+c+"["+p+"["+O+"]] !== undefined ",w&&(r+=" &&   Object.prototype.hasOwnProperty.call("+c+", "+p+"["+O+"]) "),r+="; if (!"+f+") break; } ",d&&(r+="  }  "),r+="  if (!"+f+") {   ",(S=S||[]).push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { missingProperty: '"+k+"' } ",!1!==e.opts.messages&&(r+=" , message: '",e.opts._errorDataPathProperty?r+="is a required property":r+="should have required property \\'"+k+"\\'",r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var A=r;r=S.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+A+"]); ":r+=" validate.errors = ["+A+"]; return false; ":r+=" var err = "+A+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } else { "}else{r+=" if ( ";var D=m;if(D)for(var O=-1,j=D.length-1;O<j;){C=D[O+=1],O&&(r+=" || "),r+=" ( ( "+(N=c+(_=e.util.getProperty(C)))+" === undefined ",w&&(r+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(C)+"') "),r+=") && (missing"+n+" = "+e.util.toQuotedString(e.opts.jsonPointers?C:_)+") ) "}r+=") {  ";var S;k="' + "+(P="missing"+n)+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(x,P,!0):x+" + "+P),(S=S||[]).push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { missingProperty: '"+k+"' } ",!1!==e.opts.messages&&(r+=" , message: '",e.opts._errorDataPathProperty?r+="is a required property":r+="should have required property \\'"+k+"\\'",r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";A=r;r=S.pop(),!e.compositeRule&&l?e.async?r+=" throw new ValidationError(["+A+"]); ":r+=" validate.errors = ["+A+"]; return false; ":r+=" var err = "+A+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } else { "}else if(E){d||(r+=" var "+p+" = validate.schema"+s+"; ");var P;k="' + "+(P="schema"+n+"["+(O="i"+n)+"]")+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(x,P,e.opts.jsonPointers)),d&&(r+=" if ("+p+" && !Array.isArray("+p+")) {  var err =   ",!1!==e.createErrors?(r+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { missingProperty: '"+k+"' } ",!1!==e.opts.messages&&(r+=" , message: '",e.opts._errorDataPathProperty?r+="is a required property":r+="should have required property \\'"+k+"\\'",r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } else if ("+p+" !== undefined) { "),r+=" for (var "+O+" = 0; "+O+" < "+p+".length; "+O+"++) { if ("+c+"["+p+"["+O+"]] === undefined ",w&&(r+=" || ! Object.prototype.hasOwnProperty.call("+c+", "+p+"["+O+"]) "),r+=") {  var err =   ",!1!==e.createErrors?(r+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { missingProperty: '"+k+"' } ",!1!==e.opts.messages&&(r+=" , message: '",e.opts._errorDataPathProperty?r+="is a required property":r+="should have required property \\'"+k+"\\'",r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } } ",d&&(r+="  }  ")}else{var F=m;if(F)for(var C,B=-1,T=F.length-1;B<T;){C=F[B+=1];var _=e.util.getProperty(C),N=(k=e.util.escapeQuotes(C),c+_);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(x,C,e.opts.jsonPointers)),r+=" if ( "+N+" === undefined ",w&&(r+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(C)+"') "),r+=") {  var err =   ",!1!==e.createErrors?(r+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { missingProperty: '"+k+"' } ",!1!==e.opts.messages&&(r+=" , message: '",e.opts._errorDataPathProperty?r+="is a required property":r+="should have required property \\'"+k+"\\'",r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}e.errorPath=x}else l&&(r+=" if (true) {");return r},uniqueItems:function(e,t,a){var r,n=" ",i=e.level,o=e.dataLevel,s=e.schema[t],u=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,f="data"+(o||""),d="valid"+i,p=e.opts.$data&&s&&s.$data;if(p?(n+=" var schema"+i+" = "+e.util.getData(s.$data,o,e.dataPathArr)+"; ",r="schema"+i):r=s,(s||p)&&!1!==e.opts.uniqueItems){p&&(n+=" var "+d+"; if ("+r+" === false || "+r+" === undefined) "+d+" = true; else if (typeof "+r+" != 'boolean') "+d+" = false; else { "),n+=" var i = "+f+".length , "+d+" = true , j; if (i > 1) { ";var m=e.schema.items&&e.schema.items.type,h=Array.isArray(m);if(!m||"object"==m||"array"==m||h&&(m.indexOf("object")>=0||m.indexOf("array")>=0))n+=" outer: for (;i--;) { for (j = i; j--;) { if (equal("+f+"[i], "+f+"[j])) { "+d+" = false; break outer; } } } ";else{n+=" var itemIndices = {}, item; for (;i--;) { var item = "+f+"[i]; ";var v="checkDataType"+(h?"s":"");n+=" if ("+e.util[v](m,"item",!0)+") continue; ",h&&(n+=" if (typeof item == 'string') item = '\"' + item; "),n+=" if (typeof itemIndices[item] == 'number') { "+d+" = false; j = itemIndices[item]; break; } itemIndices[item] = i; } "}n+=" } ",p&&(n+="  }  "),n+=" if (!"+d+") {   ";var y=y||[];y.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'uniqueItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { i: i, j: j } ",!1!==e.opts.messages&&(n+=" , message: 'should NOT have duplicate items (items ## ' + j + ' and ' + i + ' are identical)' "),e.opts.verbose&&(n+=" , schema:  ",n+=p?"validate.schema"+u:""+s,n+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+f+" "),n+=" } "):n+=" {} ";var g=n;n=y.pop(),!e.compositeRule&&c?e.async?n+=" throw new ValidationError(["+g+"]); ":n+=" validate.errors = ["+g+"]; return false; ":n+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } ",c&&(n+=" else { ")}else c&&(n+=" if (true) { ");return n},validate:Oe},lt=R.toHash,ct=["multipleOf","maximum","exclusiveMaximum","minimum","exclusiveMinimum","maxLength","minLength","pattern","additionalItems","maxItems","minItems","uniqueItems","maxProperties","minProperties","required","additionalProperties","enum","format","const"],ft=function(e,t){for(var a=0;a<t.length;a++){e=JSON.parse(JSON.stringify(e));var r,n=t[a].split("/"),i=e;for(r=1;r<n.length;r++)i=i[n[r]];for(r=0;r<ct.length;r++){var o=ct[r],s=i[o];s&&(i[o]={anyOf:[s,{$ref:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/data.json#"}]})}}return e},dt=we.MissingRef,pt=function e(t,a,r){var n=this;if("function"!=typeof this._opts.loadSchema)throw new Error("options.loadSchema should be a function");"function"==typeof a&&(r=a,a=void 0);var i=o(t).then((function(){var e=n._addSchema(t,void 0,a);return e.validate||function e(t){try{return n._compile(t)}catch(i){if(i instanceof dt)return r(i);throw i}function r(r){var i=r.missingSchema;if(l(i))throw new Error("Schema "+i+" is loaded but "+r.missingRef+" cannot be resolved");var s=n._loadingSchemas[i];return s||(s=n._loadingSchemas[i]=n._opts.loadSchema(i)).then(u,u),s.then((function(e){if(!l(i))return o(e).then((function(){l(i)||n.addSchema(e,i,void 0,a)}))})).then((function(){return e(t)}));function u(){delete n._loadingSchemas[i]}function l(e){return n._refs[e]||n._schemas[e]}}}(e)}));r&&i.then((function(e){r(null,e)}),r);return i;function o(t){var a=t.$schema;return a&&!n.getSchema(a)?e.call(n,{$ref:a},!0):Promise.resolve()}};var mt=function(e,t,a){var r,n,i=" ",o=e.level,s=e.dataLevel,u=e.schema[t],l=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,f=!e.opts.allErrors,d="data"+(s||""),p="valid"+o,m="errs__"+o,h=e.opts.$data&&u&&u.$data;h?(i+=" var schema"+o+" = "+e.util.getData(u.$data,s,e.dataPathArr)+"; ",n="schema"+o):n=u;var v,y,g,b,x,E="definition"+o,w=this.definition,k="";if(h&&w.$data){x="keywordValidate"+o;var A=w.validateSchema;i+=" var "+E+" = RULES.custom['"+t+"'].definition; var "+x+" = "+E+".validate;"}else{if(!(b=e.useCustomRule(this,u,e.schema,e)))return;n="validate.schema"+l,x=b.code,v=w.compile,y=w.inline,g=w.macro}var D=x+".errors",O="i"+o,j="ruleErr"+o,S=w.async;if(S&&!e.async)throw new Error("async keyword in sync schema");if(y||g||(i+=D+" = null;"),i+="var "+m+" = errors;var "+p+";",h&&w.$data&&(k+="}",i+=" if ("+n+" === undefined) { "+p+" = true; } else { ",A&&(k+="}",i+=" "+p+" = "+E+".validateSchema("+n+"); if ("+p+") { ")),y)w.statements?i+=" "+b.validate+" ":i+=" "+p+" = "+b.validate+"; ";else if(g){var P=e.util.copy(e);k="";P.level++;var F="valid"+P.level;P.schema=b.validate,P.schemaPath="";var C=e.compositeRule;e.compositeRule=P.compositeRule=!0;var B=e.validate(P).replace(/validate\.schema/g,x);e.compositeRule=P.compositeRule=C,i+=" "+B}else{(I=I||[]).push(i),i="",i+="  "+x+".call( ",e.opts.passContext?i+="this":i+="self",v||!1===w.schema?i+=" , "+d+" ":i+=" , "+n+" , "+d+" , validate.schema"+e.schemaPath+" ",i+=" , (dataPath || '')",'""'!=e.errorPath&&(i+=" + "+e.errorPath);var T=s?"data"+(s-1||""):"parentData",_=s?e.dataPathArr[s]:"parentDataProperty",N=i+=" , "+T+" , "+_+" , rootData )  ";i=I.pop(),!1===w.errors?(i+=" "+p+" = ",S&&(i+="await "),i+=N+"; "):i+=S?" var "+(D="customErrors"+o)+" = null; try { "+p+" = await "+N+"; } catch (e) { "+p+" = false; if (e instanceof ValidationError) "+D+" = e.errors; else throw e; } ":" "+D+" = null; "+p+" = "+N+"; "}if(w.modifying&&(i+=" if ("+T+") "+d+" = "+T+"["+_+"];"),i+=""+k,w.valid)f&&(i+=" if (true) { ");else{var I;i+=" if ( ",void 0===w.valid?(i+=" !",i+=g?""+F:""+p):i+=" "+!w.valid+" ",i+=") { ",r=this.keyword,(I=I||[]).push(i),i="",(I=I||[]).push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(r||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { keyword: '"+this.keyword+"' } ",!1!==e.opts.messages&&(i+=" , message: 'should pass \""+this.keyword+"\" keyword validation' "),e.opts.verbose&&(i+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),i+=" } "):i+=" {} ";var M=i;i=I.pop(),!e.compositeRule&&f?e.async?i+=" throw new ValidationError(["+M+"]); ":i+=" validate.errors = ["+M+"]; return false; ":i+=" var err = "+M+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";var R=i;i=I.pop(),y?w.errors?"full"!=w.errors&&(i+="  for (var "+O+"="+m+"; "+O+"<errors; "+O+"++) { var "+j+" = vErrors["+O+"]; if ("+j+".dataPath === undefined) "+j+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+j+".schemaPath === undefined) { "+j+'.schemaPath = "'+c+'"; } ',e.opts.verbose&&(i+=" "+j+".schema = "+n+"; "+j+".data = "+d+"; "),i+=" } "):!1===w.errors?i+=" "+R+" ":(i+=" if ("+m+" == errors) { "+R+" } else {  for (var "+O+"="+m+"; "+O+"<errors; "+O+"++) { var "+j+" = vErrors["+O+"]; if ("+j+".dataPath === undefined) "+j+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+j+".schemaPath === undefined) { "+j+'.schemaPath = "'+c+'"; } ',e.opts.verbose&&(i+=" "+j+".schema = "+n+"; "+j+".data = "+d+"; "),i+=" } } "):g?(i+="   var err =   ",!1!==e.createErrors?(i+=" { keyword: '"+(r||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { keyword: '"+this.keyword+"' } ",!1!==e.opts.messages&&(i+=" , message: 'should pass \""+this.keyword+"\" keyword validation' "),e.opts.verbose&&(i+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&f&&(e.async?i+=" throw new ValidationError(vErrors); ":i+=" validate.errors = vErrors; return false; ")):!1===w.errors?i+=" "+R+" ":(i+=" if (Array.isArray("+D+")) { if (vErrors === null) vErrors = "+D+"; else vErrors = vErrors.concat("+D+"); errors = vErrors.length;  for (var "+O+"="+m+"; "+O+"<errors; "+O+"++) { var "+j+" = vErrors["+O+"]; if ("+j+".dataPath === undefined) "+j+".dataPath = (dataPath || '') + "+e.errorPath+";  "+j+'.schemaPath = "'+c+'";  ',e.opts.verbose&&(i+=" "+j+".schema = "+n+"; "+j+".data = "+d+"; "),i+=" } } else { "+R+" } "),i+=" } ",f&&(i+=" else { ")}return i},ht="http://json-schema.org/draft-07/schema#",vt="http://json-schema.org/draft-07/schema#",yt="Core schema meta-schema",gt={schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},bt=["object","boolean"],xt={$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},Et={$schema:ht,$id:vt,title:yt,definitions:gt,type:bt,properties:xt,default:!0},wt=_(Object.freeze({__proto__:null,$schema:ht,$id:vt,title:yt,definitions:gt,type:bt,properties:xt,default:Et})),kt={$id:"https://github.com/epoberezkin/ajv/blob/master/lib/definition_schema.js",definitions:{simpleTypes:wt.definitions.simpleTypes},type:"object",dependencies:{schema:["validate"],$data:["validate"],statements:["inline"],valid:{not:{required:["macro"]}}},properties:{type:wt.properties.type,schema:{type:"boolean"},statements:{type:"boolean"},dependencies:{type:"array",items:{type:"string"}},metaSchema:{type:"object"},modifying:{type:"boolean"},valid:{type:"boolean"},$data:{type:"boolean"},async:{type:"boolean"},errors:{anyOf:[{type:"boolean"},{const:"full"}]}}},At=/^[a-z_$][a-z0-9_$-]*$/i,Dt=function(e,t){var a=this.RULES;if(a.keywords[e])throw new Error("Keyword "+e+" is already defined");if(!At.test(e))throw new Error("Keyword "+e+" is not a valid identifier");if(t){this.validateKeyword(t,!0);var r=t.type;if(Array.isArray(r))for(var n=0;n<r.length;n++)o(e,r[n],t);else o(e,r,t);var i=t.metaSchema;i&&(t.$data&&this._opts.$data&&(i={anyOf:[i,{$ref:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/data.json#"}]}),t.validateSchema=this.compile(i,!0))}function o(e,t,r){for(var n,i=0;i<a.length;i++){var o=a[i];if(o.type==t){n=o;break}}n||(n={type:t,rules:[]},a.push(n));var s={keyword:e,definition:r,custom:!0,code:mt,implements:r.implements};n.rules.push(s),a.custom[e]=s}return a.keywords[e]=a.all[e]=!0,this},Ot=function(e){var t=this.RULES.custom[e];return t?t.definition:this.RULES.keywords[e]||!1},jt=function(e){var t=this.RULES;delete t.keywords[e],delete t.all[e],delete t.custom[e];for(var a=0;a<t.length;a++)for(var r=t[a].rules,n=0;n<r.length;n++)if(r[n].keyword==e){r.splice(n,1);break}return this},St=function e(t,a){e.errors=null;var r=this._validateKeyword=this._validateKeyword||this.compile(kt,!0);if(r(t))return!0;if(e.errors=r.errors,a)throw new Error("custom keyword definition is invalid: "+this.errorsText(r.errors));return!1};var Pt="http://json-schema.org/draft-07/schema#",Ft="https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/data.json#",Ct="Meta-schema for $data reference (JSON Schema extension proposal)",Bt=["$data"],Tt={$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},_t={$schema:Pt,$id:Ft,description:Ct,type:"object",required:Bt,properties:Tt,additionalProperties:!1},Nt=_(Object.freeze({__proto__:null,$schema:Pt,$id:Ft,description:Ct,type:"object",required:Bt,properties:Tt,additionalProperties:!1,default:_t})),It=Vt;Vt.prototype.validate=function(e,t){var a;if("string"==typeof e){if(!(a=this.getSchema(e)))throw new Error('no schema with key or ref "'+e+'"')}else{var r=this._addSchema(e);a=r.validate||this._compile(r)}var n=a(t);!0!==a.$async&&(this.errors=a.errors);return n},Vt.prototype.compile=function(e,t){var a=this._addSchema(e,void 0,t);return a.validate||this._compile(a)},Vt.prototype.addSchema=function(e,t,a,r){if(Array.isArray(e)){for(var n=0;n<e.length;n++)this.addSchema(e[n],void 0,a,r);return this}var i=this._getId(e);if(void 0!==i&&"string"!=typeof i)throw new Error("schema id must be string");return Kt(this,t=le.normalizeId(t||i)),this._schemas[t]=this._addSchema(e,a,r,!0),this},Vt.prototype.addMetaSchema=function(e,t,a){return this.addSchema(e,t,a,!0),this},Vt.prototype.validateSchema=function(e,t){var a=e.$schema;if(void 0!==a&&"string"!=typeof a)throw new Error("$schema must be a string");if(!(a=a||this._opts.defaultMeta||function(e){var t=e._opts.meta;return e._opts.defaultMeta="object"==typeof t?e._getId(t)||t:e.getSchema(Mt)?Mt:void 0,e._opts.defaultMeta}(this)))return this.logger.warn("meta-schema not available"),this.errors=null,!0;var r=this.validate(a,e);if(!r&&t){var n="schema is invalid: "+this.errorsText();if("log"!=this._opts.validateSchema)throw new Error(n);this.logger.error(n)}return r},Vt.prototype.getSchema=function(e){var t=zt(this,e);switch(typeof t){case"object":return t.validate||this._compile(t);case"string":return this.getSchema(t);case"undefined":return function(e,t){var a=le.schema.call(e,{schema:{}},t);if(a){var r=a.schema,n=a.root,i=a.baseId,o=Pe.call(e,r,n,void 0,i);return e._fragments[t]=new se({ref:t,fragment:!0,schema:r,root:n,baseId:i,validate:o}),o}}(this,e)}},Vt.prototype.removeSchema=function(e){if(e instanceof RegExp)return Lt(this,this._schemas,e),Lt(this,this._refs,e),this;switch(typeof e){case"undefined":return Lt(this,this._schemas),Lt(this,this._refs),this._cache.clear(),this;case"string":var t=zt(this,e);return t&&this._cache.del(t.cacheKey),delete this._schemas[e],delete this._refs[e],this;case"object":var a=this._opts.serialize,r=a?a(e):e;this._cache.del(r);var n=this._getId(e);n&&(n=le.normalizeId(n),delete this._schemas[n],delete this._refs[n])}return this},Vt.prototype.addFormat=function(e,t){"string"==typeof t&&(t=new RegExp(t));return this._formats[e]=t,this},Vt.prototype.errorsText=function(e,t){if(!(e=e||this.errors))return"No errors";for(var a=void 0===(t=t||{}).separator?", ":t.separator,r=void 0===t.dataVar?"data":t.dataVar,n="",i=0;i<e.length;i++){var o=e[i];o&&(n+=r+o.dataPath+" "+o.message+a)}return n.slice(0,-a.length)},Vt.prototype._addSchema=function(e,t,a,r){if("object"!=typeof e&&"boolean"!=typeof e)throw new Error("schema should be object or boolean");var n=this._opts.serialize,i=n?n(e):e,o=this._cache.get(i);if(o)return o;r=r||!1!==this._opts.addUsedSchema;var s=le.normalizeId(this._getId(e));s&&r&&Kt(this,s);var u,l=!1!==this._opts.validateSchema&&!t;l&&!(u=s&&s==le.normalizeId(e.$schema))&&this.validateSchema(e,!0);var c=le.ids.call(this,e),f=new se({id:s,schema:e,localRefs:c,cacheKey:i,meta:a});"#"!=s[0]&&r&&(this._refs[s]=f);this._cache.put(i,f),l&&u&&this.validateSchema(e,!0);return f},Vt.prototype._compile=function(e,t){if(e.compiling)return e.validate=n,n.schema=e.schema,n.errors=null,n.root=t||n,!0===e.schema.$async&&(n.$async=!0),n;var a,r;e.compiling=!0,e.meta&&(a=this._opts,this._opts=this._metaOpts);try{r=Pe.call(this,e.schema,t,e.localRefs)}catch(i){throw delete e.validate,i}finally{e.compiling=!1,e.meta&&(this._opts=a)}return e.validate=r,e.refs=r.refs,e.refVal=r.refVal,e.root=r.root,r;function n(){var t=e.validate,a=t.apply(this,arguments);return n.errors=t.errors,a}},Vt.prototype.compileAsync=pt,Vt.prototype.addKeyword=Dt,Vt.prototype.getKeyword=Ot,Vt.prototype.removeKeyword=jt,Vt.prototype.validateKeyword=St,Vt.ValidationError=we.Validation,Vt.MissingRefError=we.MissingRef,Vt.$dataMetaSchema=ft;var Mt="http://json-schema.org/draft-07/schema",Rt=["removeAdditional","useDefaults","coerceTypes","strictDefaults"],$t=["/properties"];function Vt(e){if(!(this instanceof Vt))return new Vt(e);e=this._opts=R.copy(e)||{},function(e){var t=e._opts.logger;if(!1===t)e.logger={log:Wt,warn:Wt,error:Wt};else{if(void 0===t&&(t=console),!("object"==typeof t&&t.log&&t.warn&&t.error))throw new Error("logger must implement log, warn and error methods");e.logger=t}}(this),this._schemas={},this._refs={},this._fragments={},this._formats=Ze(e.format),this._cache=e.cache||new Re,this._loadingSchemas={},this._compilations=[],this.RULES=function(){var e=[{type:"number",rules:[{maximum:["exclusiveMaximum"]},{minimum:["exclusiveMinimum"]},"multipleOf","format"]},{type:"string",rules:["maxLength","minLength","pattern","format"]},{type:"array",rules:["maxItems","minItems","items","contains","uniqueItems"]},{type:"object",rules:["maxProperties","minProperties","required","dependencies","propertyNames",{properties:["additionalProperties","patternProperties"]}]},{rules:["$ref","const","enum","not","anyOf","oneOf","allOf","if"]}],t=["type","$comment"];return e.all=lt(t),e.types=lt(["number","integer","string","array","object","boolean","null"]),e.forEach((function(a){a.rules=a.rules.map((function(a){var r;if("object"==typeof a){var n=Object.keys(a)[0];r=a[n],a=n,r.forEach((function(a){t.push(a),e.all[a]=!0}))}return t.push(a),e.all[a]={keyword:a,code:ut[a],implements:r}})),e.all.$comment={keyword:"$comment",code:ut.$comment},a.type&&(e.types[a.type]=a)})),e.keywords=lt(t.concat(["$schema","$id","id","$data","$async","title","description","default","definitions","examples","readOnly","writeOnly","contentMediaType","contentEncoding","additionalItems","then","else"])),e.custom={},e}(),this._getId=function(e){switch(e.schemaId){case"auto":return Ht;case"id":return Ut;default:return qt}}(e),e.loopRequired=e.loopRequired||1/0,"property"==e.errorDataPath&&(e._errorDataPathProperty=!0),void 0===e.serialize&&(e.serialize=De),this._metaOpts=function(e){for(var t=R.copy(e._opts),a=0;a<Rt.length;a++)delete t[Rt[a]];return t}(this),e.formats&&function(e){for(var t in e._opts.formats){var a=e._opts.formats[t];e.addFormat(t,a)}}(this),e.keywords&&function(e){for(var t in e._opts.keywords){var a=e._opts.keywords[t];e.addKeyword(t,a)}}(this),function(e){var t;e._opts.$data&&(t=Nt,e.addMetaSchema(t,t.$id,!0));if(!1===e._opts.meta)return;var a=wt;e._opts.$data&&(a=ft(a,$t));e.addMetaSchema(a,Mt,!0),e._refs["http://json-schema.org/schema"]=Mt}(this),"object"==typeof e.meta&&this.addMetaSchema(e.meta),e.nullable&&this.addKeyword("nullable",{metaSchema:{type:"boolean"}}),function(e){var t=e._opts.schemas;if(!t)return;if(Array.isArray(t))e.addSchema(t);else for(var a in t)e.addSchema(t[a],a)}(this)}function zt(e,t){return t=le.normalizeId(t),e._schemas[t]||e._refs[t]||e._fragments[t]}function Lt(e,t,a){for(var r in t){var n=t[r];n.meta||a&&!a.test(r)||(e._cache.del(n.cacheKey),delete t[r])}}function Ut(e){return e.$id&&this.logger.warn("schema $id ignored",e.$id),e.id}function qt(e){return e.id&&this.logger.warn("schema id ignored",e.id),e.$id}function Ht(e){if(e.$id&&e.id&&e.$id!=e.id)throw new Error("schema $id is different from id");return e.$id||e.id}function Kt(e,t){if(e._schemas[t]||e._refs[t])throw new Error('schema with key or id "'+t+'" already exists')}function Wt(){}var Qt,Jt,Zt,Gt,Yt;function Xt(e){this.type=e}Xt.prototype.visit=function(e){var t,a,r;if(e(this))return 1;for(a=0,r=(t=function(e){switch(e.type){case"ArrayExpression":return e.elements;case"BinaryExpression":case"LogicalExpression":return[e.left,e.right];case"CallExpression":var t=e.arguments.slice();return t.unshift(e.callee),t;case"ConditionalExpression":return[e.test,e.consequent,e.alternate];case"MemberExpression":return[e.object,e.property];case"ObjectExpression":return e.properties;case"Property":return[e.key,e.value];case"UnaryExpression":return[e.argument];case"Identifier":case"Literal":case"RawCode":default:return[]}}(this)).length;a<r;++a)if(t[a].visit(e))return 1};(Qt={})[1]="Boolean",Qt[2]="<end>",Qt[3]="Identifier",Qt[4]="Keyword",Qt[5]="Null",Qt[6]="Numeric",Qt[7]="Punctuator",Qt[8]="String",Qt[9]="RegularExpression";var ea="ILLEGAL",ta=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),aa=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function ra(e,t){if(!e)throw new Error("ASSERT: "+t)}function na(e){return e>=48&&e<=57}function ia(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function oa(e){return"01234567".indexOf(e)>=0}function sa(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function ua(e){return 10===e||13===e||8232===e||8233===e}function la(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&ta.test(String.fromCharCode(e))}function ca(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&aa.test(String.fromCharCode(e))}var fa={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function da(){for(var e;Zt<Gt&&(sa(e=Jt.charCodeAt(Zt))||ua(e));)++Zt}function pa(e){var t,a,r,n=0;for(a="u"===e?4:2,t=0;t<a;++t)Zt<Gt&&ia(Jt[Zt])?(r=Jt[Zt++],n=16*n+"0123456789abcdef".indexOf(r.toLowerCase())):Pa({},"Unexpected token %0",ea);return String.fromCharCode(n)}function ma(){var e,t,a,r;for(t=0,"}"===(e=Jt[Zt])&&Pa({},"Unexpected token %0",ea);Zt<Gt&&ia(e=Jt[Zt++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||"}"!==e)&&Pa({},"Unexpected token %0",ea),t<=65535?String.fromCharCode(t):(a=55296+(t-65536>>10),r=56320+(t-65536&1023),String.fromCharCode(a,r))}function ha(){var e,t;for(e=Jt.charCodeAt(Zt++),t=String.fromCharCode(e),92===e&&(117!==Jt.charCodeAt(Zt)&&Pa({},"Unexpected token %0",ea),++Zt,(e=pa("u"))&&"\\"!==e&&la(e.charCodeAt(0))||Pa({},"Unexpected token %0",ea),t=e);Zt<Gt&&ca(e=Jt.charCodeAt(Zt));)++Zt,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==Jt.charCodeAt(Zt)&&Pa({},"Unexpected token %0",ea),++Zt,(e=pa("u"))&&"\\"!==e&&ca(e.charCodeAt(0))||Pa({},"Unexpected token %0",ea),t+=e);return t}function va(){var e,t;return e=Zt,{type:1===(t=92===Jt.charCodeAt(Zt)?ha():function(){var e,t;for(e=Zt++;Zt<Gt;){if(92===(t=Jt.charCodeAt(Zt)))return Zt=e,ha();if(!ca(t))break;++Zt}return Jt.slice(e,Zt)}()).length?3:fa.hasOwnProperty(t)?4:"null"===t?5:"true"===t||"false"===t?1:3,value:t,start:e,end:Zt}}function ya(){var e,t,a,r,n=Zt,i=Jt.charCodeAt(Zt),o=Jt[Zt];switch(i){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++Zt,{type:7,value:String.fromCharCode(i),start:n,end:Zt};default:if(61===(e=Jt.charCodeAt(Zt+1)))switch(i){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return Zt+=2,{type:7,value:String.fromCharCode(i)+String.fromCharCode(e),start:n,end:Zt};case 33:case 61:return Zt+=2,61===Jt.charCodeAt(Zt)&&++Zt,{type:7,value:Jt.slice(n,Zt),start:n,end:Zt}}}return">>>="===(r=Jt.substr(Zt,4))?{type:7,value:r,start:n,end:Zt+=4}:">>>"===(a=r.substr(0,3))||"<<="===a||">>="===a?{type:7,value:a,start:n,end:Zt+=3}:o===(t=a.substr(0,2))[1]&&"+-<>&|".indexOf(o)>=0||"=>"===t?{type:7,value:t,start:n,end:Zt+=2}:"<>=!+-*%&|^/".indexOf(o)>=0?{type:7,value:o,start:n,end:++Zt}:void Pa({},"Unexpected token %0",ea)}function ga(){var e,t,a;if(ra(na((a=Jt[Zt]).charCodeAt(0))||"."===a,"Numeric literal must start with a decimal digit or a decimal point"),t=Zt,e="","."!==a){if(e=Jt[Zt++],a=Jt[Zt],"0"===e){if("x"===a||"X"===a)return++Zt,function(e){for(var t="";Zt<Gt&&ia(Jt[Zt]);)t+=Jt[Zt++];return 0===t.length&&Pa({},"Unexpected token %0",ea),la(Jt.charCodeAt(Zt))&&Pa({},"Unexpected token %0",ea),{type:6,value:parseInt("0x"+t,16),start:e,end:Zt}}(t);if(oa(a))return function(e){for(var t="0"+Jt[Zt++];Zt<Gt&&oa(Jt[Zt]);)t+=Jt[Zt++];return(la(Jt.charCodeAt(Zt))||na(Jt.charCodeAt(Zt)))&&Pa({},"Unexpected token %0",ea),{type:6,value:parseInt(t,8),octal:!0,start:e,end:Zt}}(t);a&&na(a.charCodeAt(0))&&Pa({},"Unexpected token %0",ea)}for(;na(Jt.charCodeAt(Zt));)e+=Jt[Zt++];a=Jt[Zt]}if("."===a){for(e+=Jt[Zt++];na(Jt.charCodeAt(Zt));)e+=Jt[Zt++];a=Jt[Zt]}if("e"===a||"E"===a)if(e+=Jt[Zt++],"+"!==(a=Jt[Zt])&&"-"!==a||(e+=Jt[Zt++]),na(Jt.charCodeAt(Zt)))for(;na(Jt.charCodeAt(Zt));)e+=Jt[Zt++];else Pa({},"Unexpected token %0",ea);return la(Jt.charCodeAt(Zt))&&Pa({},"Unexpected token %0",ea),{type:6,value:parseFloat(e),start:t,end:Zt}}function ba(){var e,t,a,r;return Yt=null,da(),e=Zt,t=function(){var e,t,a,r;for(ra("/"===(e=Jt[Zt]),"Regular expression literal must start with a slash"),t=Jt[Zt++],a=!1,r=!1;Zt<Gt;)if(t+=e=Jt[Zt++],"\\"===e)ua((e=Jt[Zt++]).charCodeAt(0))&&Pa({},"Invalid regular expression: missing /"),t+=e;else if(ua(e.charCodeAt(0)))Pa({},"Invalid regular expression: missing /");else if(a)"]"===e&&(a=!1);else{if("/"===e){r=!0;break}"["===e&&(a=!0)}return r||Pa({},"Invalid regular expression: missing /"),{value:t.substr(1,t.length-2),literal:t}}(),a=function(){var e,t,a;for(t="",a="";Zt<Gt&&ca((e=Jt[Zt]).charCodeAt(0));)++Zt,"\\"===e&&Zt<Gt?Pa({},"Unexpected token %0",ea):(a+=e,t+=e);return a.search(/[^gimuy]/g)>=0&&Pa({},"Invalid regular expression",a),{value:a,literal:t}}(),r=function(e,t){var a=e;t.indexOf("u")>=0&&(a=a.replace(/\\u\{([0-9a-fA-F]+)\}/g,(function(e,t){if(parseInt(t,16)<=1114111)return"x";Pa({},"Invalid regular expression")})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(a)}catch(r){Pa({},"Invalid regular expression")}try{return new RegExp(e,t)}catch(n){return null}}(t.value,a.value),{literal:t.literal+a.literal,value:r,regex:{pattern:t.value,flags:a.value},start:e,end:Zt}}function xa(){var e;return da(),Zt>=Gt?{type:2,start:Zt,end:Zt}:la(e=Jt.charCodeAt(Zt))?va():40===e||41===e||59===e?ya():39===e||34===e?function(){var e,t,a,r,n="",i=!1;for(ra("'"===(e=Jt[Zt])||'"'===e,"String literal must starts with a quote"),t=Zt,++Zt;Zt<Gt;){if((a=Jt[Zt++])===e){e="";break}if("\\"===a)if((a=Jt[Zt++])&&ua(a.charCodeAt(0)))"\r"===a&&"\n"===Jt[Zt]&&++Zt;else switch(a){case"u":case"x":"{"===Jt[Zt]?(++Zt,n+=ma()):n+=pa(a);break;case"n":n+="\n";break;case"r":n+="\r";break;case"t":n+="\t";break;case"b":n+="\b";break;case"f":n+="\f";break;case"v":n+="\v";break;default:oa(a)?(0!==(r="01234567".indexOf(a))&&(i=!0),Zt<Gt&&oa(Jt[Zt])&&(i=!0,r=8*r+"01234567".indexOf(Jt[Zt++]),"0123".indexOf(a)>=0&&Zt<Gt&&oa(Jt[Zt])&&(r=8*r+"01234567".indexOf(Jt[Zt++]))),n+=String.fromCharCode(r)):n+=a}else{if(ua(a.charCodeAt(0)))break;n+=a}}return""!==e&&Pa({},"Unexpected token %0",ea),{type:8,value:n,octal:i,start:t,end:Zt}}():46===e?na(Jt.charCodeAt(Zt+1))?ga():ya():na(e)?ga():ya()}function Ea(){var e;return Zt=(e=Yt).end,Yt=xa(),Zt=e.end,e}function wa(){var e;e=Zt,Yt=xa(),Zt=e}function ka(e,t,a){var r=new Xt("||"===e||"&&"===e?"LogicalExpression":"BinaryExpression");return r.operator=e,r.left=t,r.right=a,r}function Aa(e,t){var a=new Xt("CallExpression");return a.callee=e,a.arguments=t,a}function Da(e){var t=new Xt("Identifier");return t.name=e,t}function Oa(e){var t=new Xt("Literal");return t.value=e.value,t.raw=Jt.slice(e.start,e.end),e.regex&&("//"===t.raw&&(t.raw="/(?:)/"),t.regex=e.regex),t}function ja(e,t,a){var r=new Xt("MemberExpression");return r.computed="["===e,r.object=t,r.property=a,r.computed||(a.member=!0),r}function Sa(e,t,a){var r=new Xt("Property");return r.key=t,r.value=a,r.kind=e,r}function Pa(e,t){var a,r=Array.prototype.slice.call(arguments,2),n=t.replace(/%(\d)/g,(function(e,t){return ra(t<r.length,"Message reference must be in range"),r[t]}));throw(a=new Error(n)).index=Zt,a.description=n,a}function Fa(e){2===e.type&&Pa(e,"Unexpected end of input"),6===e.type&&Pa(e,"Unexpected number"),8===e.type&&Pa(e,"Unexpected string"),3===e.type&&Pa(e,"Unexpected identifier"),4===e.type&&Pa(e,"Unexpected reserved word"),Pa(e,"Unexpected token %0",e.value)}function Ca(e){var t=Ea();7===t.type&&t.value===e||Fa(t)}function Ba(e){return 7===Yt.type&&Yt.value===e}function Ta(e){return 4===Yt.type&&Yt.value===e}function _a(){var e=[];for(Zt=Yt.start,Ca("[");!Ba("]");)Ba(",")?(Ea(),e.push(null)):(e.push(Ka()),Ba("]")||Ca(","));return Ea(),function(e){var t=new Xt("ArrayExpression");return t.elements=e,t}(e)}function Na(){var e;return Zt=Yt.start,8===(e=Ea()).type||6===e.type?(e.octal&&Pa(e,"Octal literals are not allowed in strict mode."),Oa(e)):Da(e.value)}function Ia(){var e,t,a;return Zt=Yt.start,3===(e=Yt).type?(a=Na(),Ca(":"),Sa("init",a,Ka())):2!==e.type&&7!==e.type?(t=Na(),Ca(":"),Sa("init",t,Ka())):void Fa(e)}function Ma(){var e,t,a=[],r={},n=String;for(Zt=Yt.start,Ca("{");!Ba("}");)t="$"+("Identifier"===(e=Ia()).key.type?e.key.name:n(e.key.value)),Object.prototype.hasOwnProperty.call(r,t)?Pa({},"Duplicate data property in object literal not allowed in strict mode"):r[t]=!0,a.push(e),Ba("}")||Ca(",");return Ca("}"),function(e){var t=new Xt("ObjectExpression");return t.properties=e,t}(a)}var Ra={if:1,this:1};function $a(){var e,t,a;if(Ba("("))return function(){var e;return Ca("("),e=Wa(),Ca(")"),e}();if(Ba("["))return _a();if(Ba("{"))return Ma();if(e=Yt.type,Zt=Yt.start,3===e||Ra[Yt.value])a=Da(Ea().value);else if(8===e||6===e)Yt.octal&&Pa(Yt,"Octal literals are not allowed in strict mode."),a=Oa(Ea());else{if(4===e)throw new Error("Disabled.");1===e?((t=Ea()).value="true"===t.value,a=Oa(t)):5===e?((t=Ea()).value=null,a=Oa(t)):Ba("/")||Ba("/=")?(a=Oa(ba()),wa()):Fa(Ea())}return a}function Va(){var e=[];if(Ca("("),!Ba(")"))for(;Zt<Gt&&(e.push(Ka()),!Ba(")"));)Ca(",");return Ca(")"),e}function za(){return Ca("."),function(){var e;return Zt=Yt.start,function(e){return 3===e.type||4===e.type||1===e.type||5===e.type}(e=Ea())||Fa(e),Da(e.value)}()}function La(){var e;return Ca("["),e=Wa(),Ca("]"),e}function Ua(){var e=function(){var e;for(e=$a();;)if(Ba("."))e=ja(".",e,za());else if(Ba("("))e=Aa(e,Va());else{if(!Ba("["))break;e=ja("[",e,La())}return e}();if(7===Yt.type&&(Ba("++")||Ba("--")))throw new Error("Disabled.");return e}function qa(){var e,t;if(7!==Yt.type&&4!==Yt.type)t=Ua();else{if(Ba("++")||Ba("--"))throw new Error("Disabled.");if(Ba("+")||Ba("-")||Ba("~")||Ba("!"))e=Ea(),t=qa(),t=function(e,t){var a=new Xt("UnaryExpression");return a.operator=e,a.argument=t,a.prefix=!0,a}(e.value,t);else{if(Ta("delete")||Ta("void")||Ta("typeof"))throw new Error("Disabled.");t=Ua()}}return t}function Ha(e){var t=0;if(7!==e.type&&4!==e.type)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function Ka(){var e,t;return e=function(){var e,t,a,r,n,i,o,s,u,l;if(e=Yt,u=qa(),0===(n=Ha(r=Yt)))return u;for(r.prec=n,Ea(),t=[e,Yt],i=[u,r,o=qa()];(n=Ha(Yt))>0;){for(;i.length>2&&n<=i[i.length-2].prec;)o=i.pop(),s=i.pop().value,u=i.pop(),t.pop(),a=ka(s,u,o),i.push(a);(r=Ea()).prec=n,i.push(r),t.push(Yt),a=qa(),i.push(a)}for(a=i[l=i.length-1],t.pop();l>1;)t.pop(),a=ka(i[l-1].value,i[l-2],a),l-=2;return a}(),Ba("?")&&(Ea(),t=Ka(),Ca(":"),e=function(e,t,a){var r=new Xt("ConditionalExpression");return r.test=e,r.consequent=t,r.alternate=a,r}(e,t,Ka())),e}function Wa(){var e=Ka();if(Ba(","))throw new Error("Disabled.");return e}function Qa(e){Zt=0,Gt=(Jt=e).length,Yt=null,wa();var t=Wa();if(2!==Yt.type)throw new Error("Unexpect token after expression.");return t}var Ja={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function Za(e,t,a){return e.fields=t||[],e.fname=a,e}function Ga(e){throw Error(e)}var Ya=Array.isArray;function Xa(e){return"string"===typeof e}function er(e){return Ya(e)?"["+e.map(er)+"]":(t=e)===Object(t)||Xa(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e;var t}var tr=[];(function(e,t){var a=function(e){var t,a,r,n=[],i=null,o=0,s=e.length,u="";function l(){n.push(u+e.substring(t,a)),u="",t=a+1}for(e+="",t=a=0;a<s;++a)if("\\"===(r=e[a]))u+=e.substring(t,a),t=++a;else if(r===i)l(),i=null,o=-1;else{if(i)continue;t===o&&'"'===r||t===o&&"'"===r?(t=a+1,i=r):"."!==r||o?"["===r?(a>t&&l(),o=t=a+1):"]"===r&&(o||Ga("Access path missing open bracket: "+e),o>0&&l(),o=0,t=a+1):a>t?l():t=a+1}return o&&Ga("Access path missing closing bracket: "+e),i&&Ga("Access path missing closing quote: "+e),a>t&&(a++,l()),n}(e),r="return _["+a.map(er).join("][")+"];";Za(Function("_",r),[e=1===a.length?a[0]:e],t||e)})("id"),Za((function(e){return e}),tr,"identity"),Za((function(){return 0}),tr,"zero"),Za((function(){return 1}),tr,"one"),Za((function(){return!0}),tr,"true"),Za((function(){return!1}),tr,"false");function ar(e){return"function"===typeof e}var rr=Object.prototype.hasOwnProperty;function nr(e,t){return rr.call(e,t)}function ir(e){for(var t={},a=0,r=e.length;a<r;++a)t[e[a]]=!0;return t}function or(e){function t(t,a,r){return function(n){return function(t,a,r,n){var i=e(a[0]);return r&&(i=r+"("+i+")",0===r.lastIndexOf("new ",0)&&(i="("+i+")")),i+"."+t+(n<0?"":0===n?"()":"("+a.slice(1).map(e).join(",")+")")}(t,n,a,r)}}var a="new Date";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(t){t.length<3&&Ga("Missing arguments to clamp function."),t.length>3&&Ga("Too many arguments to clamp function.");var a=t.map(e);return"Math.max("+a[1]+", Math.min("+a[2]+","+a[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:a,date:t("getDate",a,0),day:t("getDay",a,0),year:t("getFullYear",a,0),month:t("getMonth",a,0),hours:t("getHours",a,0),minutes:t("getMinutes",a,0),seconds:t("getSeconds",a,0),milliseconds:t("getMilliseconds",a,0),time:t("getTime",a,0),timezoneoffset:t("getTimezoneOffset",a,0),utcdate:t("getUTCDate",a,0),utcday:t("getUTCDay",a,0),utcyear:t("getUTCFullYear",a,0),utcmonth:t("getUTCMonth",a,0),utchours:t("getUTCHours",a,0),utcminutes:t("getUTCMinutes",a,0),utcseconds:t("getUTCSeconds",a,0),utcmilliseconds:t("getUTCMilliseconds",a,0),length:t("length",null,-1),join:t("join",null),indexof:t("indexOf",null),lastindexof:t("lastIndexOf",null),slice:t("slice",null),reverse:function(t){return"("+e(t[0])+").slice().reverse()"},parseFloat:"parseFloat",parseInt:"parseInt",upper:t("toUpperCase","String",0),lower:t("toLowerCase","String",0),substring:t("substring","String"),split:t("split","String"),replace:t("replace","String"),trim:t("trim","String",0),regexp:"RegExp",test:t("test","RegExp"),if:function(t){t.length<3&&Ga("Missing arguments to if function."),t.length>3&&Ga("Too many arguments to if function.");var a=t.map(e);return"("+a[0]+"?"+a[1]+":"+a[2]+")"}}}function sr(e){var t=(e=e||{}).whitelist?ir(e.whitelist):{},a=e.blacklist?ir(e.blacklist):{},r=e.constants||Ja,n=(e.functions||or)(f),i=e.globalvar,o=e.fieldvar,s={},u={},l=0,c=ar(i)?i:function(e){return i+'["'+e+'"]'};function f(e){if(Xa(e))return e;var t=d[e.type];return null==t&&Ga("Unsupported type: "+e.type),t(e)}var d={Literal:function(e){return e.raw},Identifier:function(e){var n=e.name;return l>0?n:nr(a,n)?Ga("Illegal identifier: "+n):nr(r,n)?r[n]:nr(t,n)?n:(s[n]=1,c(n))},MemberExpression:function(e){var t=!e.computed,a=f(e.object);t&&(l+=1);var r=f(e.property);return a===o&&(u[function(e){var t=e&&e.length-1;return t&&('"'===e[0]&&'"'===e[t]||"'"===e[0]&&"'"===e[t])?e.slice(1,-1):e}(r)]=1),t&&(l-=1),a+(t?"."+r:"["+r+"]")},CallExpression:function(e){"Identifier"!==e.callee.type&&Ga("Illegal callee type: "+e.callee.type);var t=e.callee.name,a=e.arguments,r=nr(n,t)&&n[t];return r||Ga("Unrecognized function: "+t),ar(r)?r(a):r+"("+a.map(f).join(",")+")"},ArrayExpression:function(e){return"["+e.elements.map(f).join(",")+"]"},BinaryExpression:function(e){return"("+f(e.left)+e.operator+f(e.right)+")"},UnaryExpression:function(e){return"("+e.operator+f(e.argument)+")"},ConditionalExpression:function(e){return"("+f(e.test)+"?"+f(e.consequent)+":"+f(e.alternate)+")"},LogicalExpression:function(e){return"("+f(e.left)+e.operator+f(e.right)+")"},ObjectExpression:function(e){return"{"+e.properties.map(f).join(",")+"}"},Property:function(e){l+=1;var t=f(e.key);return l-=1,t+":"+f(e.value)}};function p(e){var t={code:f(e),globals:Object.keys(s),fields:Object.keys(u)};return s={},u={},t}return p.functions=n,p.constants=r,p}var ur={fill:"#000",font:"sans-serif",fontSize:11,opacity:1,baseline:"alphabetic"},lr={none:{},rect:{opacity:1},gradient:{opacity:1},group:{opacity:1},tick:{opacity:1},grid:{opacity:1},domain:{opacity:1},symbol:{opacity:1,stroke:"transparent"},line:{opacity:1,fill:"none"},area:{opacity:1,strokeWidth:"0px"},trail:{opacity:1,strokeWidth:"0px"},rule:{opacity:1},text:ur,title:ur},cr="cubic",fr={description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:"#4c78a8"},area:{fill:"#4c78a8"},image:null,line:{stroke:"#4c78a8",strokeWidth:2},path:{stroke:"#4c78a8"},rect:{fill:"#4c78a8"},rule:{stroke:"#000"},shape:{stroke:"#4c78a8"},symbol:{fill:"#4c78a8",size:64},text:{fill:"#000",font:"sans-serif",fontSize:11},trail:{fill:"#4c78a8",size:2},style:{"guide-label":{fill:"#000",font:"sans-serif",fontSize:10},"guide-title":{fill:"#000",font:"sans-serif",fontSize:11,fontWeight:"bold"},"group-title":{fill:"#000",font:"sans-serif",fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:"#000",font:"sans-serif",fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:"#ddd"}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:"#888",grid:!1,gridWidth:1,gridColor:"#ddd",labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:"#888",tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:"#ddd",gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:"#888",titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}};function dr(e){return Object.keys(e).reduce((function(t,a){return t[a]={value:e[a]},t}),{})}var pr=Object.keys(fr.style).reduce((function(e,t){return e[t]=dr(fr.style[t]),e}),{}),mr={enter:{opacity:{value:0}},exit:{opacity:{value:0}},update:{}};function hr(e){if(!e)return{};var t=e.scale;return"left"===e.orient||"right"===e.orient?{y:{scale:t,field:"value",band:.5}}:{x:{scale:t,field:"value",band:.5}}}function vr(e){return"left"===e?270:"right"===e?90:0}function yr(e){return"top"===e?"bottom":"bottom"===e?"top":"middle"}function gr(e,t){if("x2"===e){if("right"===t)return fr.axis.tickSize;if("left"===t)return-fr.axis.tickSize}else if("y2"===e){if("bottom"===t)return fr.axis.tickSize;if("top"===t)return-fr.axis.tickSize}return 0}function br(e){return e&&e.labelAlign?e.labelAlign:e&&"right"===e.orient?"left":e&&"left"===e.orient?"right":"center"}function xr(e){return e&&e.labelAlign?e.labelAlign:e&&"right"===e.orient?"left":e&&"left"===e.orient?"right":"center"}function Er(e,t){return("top"===e||"bottom"===e)&&["band","point"].indexOf(t)>=0?270:0}function wr(e,t){if("dx"===e){if("right"===t)return 7;if("left"===t)return-7}else if("dy"===e){if("bottom"===t)return 7;if("top"===t)return-7}return 0}var kr=["fill","opacity","shape","size","stroke","strokeDash","strokeWidth"],Ar={title:function(){var e={fontSize:{value:fr.style["guide-title"].fontSize},fontWeight:{value:"bold"}};return{update:e,enter:Object(i.a)({},e,{opacity:{value:0}}),exit:Object(i.a)({},e,{opacity:{value:0}})}},labels:function(e){if(!e)return g(mr);var t=Object(i.a)({},function(e){var t=e?e.gradientLength:void 0;t=isNaN(t)?fr.legend.gradientLength:t;var a=e?e.gradientThickness:void 0;a=isNaN(a)?fr.legend.gradientThickness:a;var r=e?e.gradientLabelOffset:void 0;return r=isNaN(r)?fr.legend.gradientLabelOffset:r,"symbol"===e.type?{x:{value:0},y:{value:0},dx:{value:16},dy:{value:6}}:"vertical"===e.direction?{x:{value:0},y:{signal:"(1-datum.perc) * clamp(height, 64, ".concat(t,")")},dx:{value:a+r}}:{x:{signal:"(datum.perc) * clamp(width, 64, ".concat(t,")")},y:{value:0},dy:{value:a+r}}}(e),{text:{field:"label"},fontSize:{value:fr.style["guide-label"].fontSize},align:{value:xr(e)},baseline:{value:e.baseline||yr(e.orient)},angle:{value:e.labelAngle||Er(e.orient,e.scaleType)}});return{enter:Object(i.a)({},t,{opacity:{value:0}}),exit:Object(i.a)({},t,{opacity:{value:0}}),update:t}},symbols:function(e){var t={y:{value:6},x:{value:6},shape:{value:fr.legend.symbolType},size:{value:fr.legend.symbolSize},strokeWidth:{value:fr.legend.symbolStrokeWidth}};return e&&(e.fill||(t.stroke={value:fr.legend.symbolBaseStrokeColor},t.fill={value:fr.legend.symbolBaseFillColor}),kr.forEach((function(a){"shape"===a&&(t[a]={value:e.symbolType}),e[a]&&(t[a]={scale:e[a],field:"value"})}))),{update:t,enter:Object.assign({},t,{opacity:{value:0}}),exit:Object.assign({},t,{opacity:{value:0}})}},gradient:function(e){if(!e)return g(mr);var t=e.gradientLength||{signal:"clamp(".concat("vertical"===e.direction?"height":"width",", 64, ").concat(fr.legend.gradientLength,")")},a=e.gradientThickness||fr.legend.gradientThickness;"number"===typeof t&&(t={signal:"clamp(".concat("vertical"===e.direction?"height":"width",", 64, ").concat(t,")")});var r={x:{value:0},y:{value:0},width:"vertical"===e.direction?{value:a}:t,height:"vertical"===e.direction?t:{value:a}};return{update:r,enter:Object.assign({},r,{opacity:{value:0}}),exit:Object.assign({},r,{opacity:{value:0}})}},entries:function(){return g(mr)},legend:function(){return g(mr)},pairs:function(e){var t={y:{signal:"datum.index * 13"}};return e&&"horizontal"===e.direction&&(t={x:{signal:"datum.index * 50"}}),{update:t,enter:Object.assign({},t,{opacity:{value:0}}),exit:Object.assign({},t,{opacity:{value:0}})}},bands:function(e){var t=Object(i.a)({},function(e){var t=e?e.gradientLength:void 0,a=e?e.gradientThickness:void 0;return t=t||fr.legend.gradientLength,a=a||fr.legend.gradientThickness,e&&"horizontal"===e.direction?{x:{signal:"(1-datum.perc)",mult:t},x2:{signal:"(1-datum.perc2)",mult:t},y:{value:0},height:{value:a}}:{y:{signal:"(1-datum.perc)",mult:t},y2:{signal:"(1-datum.perc2)",mult:t},x:{value:0},width:{value:a}}}(e),{fill:{value:fr.legend.symbolBaseFillColor}});return e&&(e.fill||e.stroke)&&(t.fill={scale:e.fill||e.stroke,field:"value"}),{update:t,enter:Object(i.a)({},t,{opacity:{value:0}}),exit:Object(i.a)({},t,{opacity:{value:0}})}}},Dr={mark:{enter:{opacity:{value:0}},exit:{opacity:{value:0}},line:{update:Object(i.a)({},dr(fr.line),{fill:{value:"none"}})},area:{update:dr(fr.area)},trail:{update:dr(fr.trail)},symbol:{update:dr(fr.symbol)},rect:{update:dr(fr.rect)},rule:{update:dr(fr.rule)},text:{update:dr(fr.text)}},axis:{axis:function(){return g(mr)},labels:function(e){var t=e?e.orient:void 0,a=e?e.scaleType:void 0,r=Object(i.a)({},hr(e),{text:{field:"label"},fontSize:{value:fr.style["guide-label"].fontSize},dx:{value:wr("dx",t)},dy:{value:wr("dy",t)},align:{value:br(e)},baseline:{value:e&&e.baseline?e.baseline:yr(t)},angle:{value:e&&D(e.labelAngle)?e.labelAngle:Er(t,a)}});return{enter:Object(i.a)({},r,{opacity:{value:0}}),exit:Object(i.a)({},r,{opacity:{value:0}}),update:r}},ticks:function(e){var t=e?e.orient:void 0,a=Object.assign({},hr(e),{x2:{value:gr("x2",t)},y2:{value:gr("y2",t)},strokeWidth:{value:fr.axis.tickWidth},stroke:{value:fr.axis.tickColor}});return{enter:Object(i.a)({},a,{opacity:{value:0}}),exit:Object(i.a)({},a,{opacity:{value:0}}),update:a}},grid:function(e){var t=e?e.orient:void 0,a=(e&&e.gridScale,Object.assign({},hr(e),function(e,t){return"bottom"===e||"top"===e?{y2:{signal:"height",mult:-1},y:{value:0},x2:{value:0}}:"right"===e||"left"===e?{x2:{signal:"width"},x:{value:0},y2:{value:0}}:void 0}(t),{strokeWidth:{value:fr.axis.gridWidth},stroke:{value:fr.axis.gridColor}}));return{enter:Object(i.a)({},a,{opacity:{value:0}}),exit:Object(i.a)({},a,{opacity:{value:0}}),update:a}},title:function(e){var t=e?e.orient:void 0,a=Object.assign({baseline:{value:yr(t)},align:{value:"center"},angle:{value:vr(t)},fontSize:{value:fr.style["guide-title"].fontSize},fontWeight:{value:"bold"}},function(e){return"top"===e?{x:{signal:"width",mult:.5},y:{value:-22}}:"bottom"===e?{x:{signal:"width",mult:.5},y:{value:22}}:"right"===e?{y:{signal:"height",mult:.5},x:{value:22}}:{y:{signal:"height",mult:.5},x:{value:-22}}}(t));return{enter:Object(i.a)({},a,{opacity:{value:0}}),exit:Object(i.a)({},a,{opacity:{value:0}}),update:a}},domain:function(e){var t,a=Object(i.a)({},e?"bottom"===(t=e.orient)||"top"===t?{y2:{value:0},x2:{signal:"width"},y:{value:0},x:{value:0}}:"right"===t||"left"===t?{y2:{signal:"height",mult:1},x2:{value:0},y:{value:0},x:{value:0}}:{y2:{value:0},x2:{value:0}}:{},{strokeWidth:{value:fr.axis.domainWidth},stroke:{value:fr.axis.domainColor}});return{enter:Object(i.a)({},a,{opacity:{value:0}}),exit:Object(i.a)({},a,{opacity:{value:0}}),update:a}}},legend:Ar};function Or(e){var t=e||cr;return p["ease".concat(t.slice(0,1).toUpperCase()+t.slice(1))]}function jr(e,t){for(var a,r=0;r<e.items.length;r++){var n=e.items[r];if(n.name===t)return e.items[r+1];n.items&&(a=jr(n,t))}return a}function Sr(e,t,a,r){return e.__gemini__[a.stepId]?e.__gemini__[a.stepId][r]:void 0}function Pr(e,t,a){var r=[];return e.items.forEach((function(e){e.items&&(r=r.concat(Pr(e,t,a))),e.role===a&&e.name===t&&r.push(e)})),r}function Fr(e){var t=(new d.a).initialize(document.createElement("div"),1,1).render(e).svg();return(new DOMParser).parseFromString(t,"image/svg+xml").documentElement}function Cr(e,t){var a=Object(d.g)(Object(d.h)(t.mark));a.items[0].fill=t.fill;var r=Fr(a).getElementsByTagName("defs")[0].firstElementChild,n=e.select("defs");return n.empty()&&(n=e.append("defs")),n.node().appendChild(r),"".concat(window.location.origin+window.location.pathname,"#").concat(r.id)}function Br(e){var t,a=e;"object"===typeof e&&(a=e.name,t=e.tweaks);var r=[];switch(a){case"text":r=r.concat([{type:"text",val:"text"},{type:"attr",val:"transform"},{type:"style",val:"opacity"},{type:"style",val:"font"},{type:"style",val:"fontSize"},{type:"style",val:"fill"}]);break;case"title":r=r.concat([{type:"text",val:"text"},{type:"attr",val:"transform"},{type:"style",val:"opacity"},{type:"style",val:"font"},{type:"style",val:"fontSize"},{type:"style",val:"fontWeight"},{type:"style",val:"fill"}]);break;case"tick":case"grid":case"domain":r=r.concat([{type:"attr",val:"transform"},{type:"attr",val:"x2"},{type:"attr",val:"y2"},{type:"style",val:"strokeWidth"},{type:"style",val:"stroke"},{type:"style",val:"opacity"}]);break;case"rect":r=r.concat([{type:"attrTween",val:"d"},{type:"attr",val:"transform"},{type:"style",val:"opacity"},{type:"style",val:"fill"},{type:"style",val:"strokeWidth"},{type:"style",val:"stroke"}]);break;case"gradient":r=r.concat([{type:"attr",val:"d"},{type:"style",val:"opacity"},{type:"style",val:"fill",defs:Cr},{type:"style",val:"strokeWidth"},{type:"style",val:"stroke"}]);break;case"rule":r=r.concat([{type:"attr",val:"transform"},{type:"attr",val:"x2"},{type:"attr",val:"y2"},{type:"style",val:"strokeWidth"},{type:"style",val:"stroke"},{type:"style",val:"opacity"}]);break;case"symbol":r=r.concat([{type:"attrTween",val:"d"},{type:"attr",val:"size"},{type:"attr",val:"transform"},{type:"style",val:"strokeWidth"},{type:"style",val:"stroke"},{type:"style",val:"opacity"},{type:"style",val:"fill"}]);break;case"group":r=r.concat([{type:"attr",val:"transform"},{type:"style",val:"opacity"}]);break;case"background":r=r.concat([{type:"attr",val:"d"}]);break;case"line":r=r.concat([{type:"attrTween",val:"d"},{type:"style",val:"strokeWidth"},{type:"style",val:"stroke"},{type:"style",val:"opacity"},{type:"style",val:"fill"}]);break;case"trail":case"area":r=r.concat([{type:"attrTween",val:"d"},{type:"style",val:"strokeWidth"},{type:"style",val:"stroke"},{type:"style",val:"opacity"},{type:"style",val:"fill"}]);break;case"legend-pair":r=r.concat([{type:"attr",val:"transform"}])}return e.excludes&&e.excludes.forEach((function(e){r=r.filter((function(t){return!(t.type===e.type&&t.val===e.val)}))})),r.length>0?(r.forEach((function(e){e.elmType=a,t&&t.filter((function(t){return t.type===e.type&&t.val===e.val})).forEach((function(t){e=Object.assign(e,t)}))})),r):"align"===a?[{type:"attr",val:"text-anchor",elmType:"none"}]:[{type:"style",val:a,elmType:"none"}]}function Tr(e,t,a){var r=Object.assign({},e);return t.forEach((function(e){r.initial[e]=a.initial(e),r.final[e]=a.final(e)})),r}function _r(e){return["area","line","trail"].indexOf(e)>=0}function Nr(e){return!!(e&&e.parent&&e.parent.from&&e.parent.from.facet&&e.parent.from.facet.data&&e.parent.from.facet.name===e.from.data)}function Ir(e){return Nr(e)?e.parent.from.facet:void 0}function Mr(e){return"line"===e||"area"===e||"trail"===e}function Rr(e,t){for(var a,r=0;r<e.length;r++){var n=e[r];if(n.name===t)return n;if(n.marks&&(a=Rr(n.marks,t)))break}return a}function $r(e,t){for(var a=0;a<e.data.length;a++)if(e.data[a].name===t)return e.data[a]}function Vr(e,t){for(var a=0;a<e.data.length;a++){var r=e.data[a];if(r.transform){var n=r.transform.find((function(e){return e.name===t}));if(n)return n}}}var zr=function(){function e(t,a,r){Object(c.a)(this,e),this.views=function(e,t,a){var r=g(t),n=Lr(e,a),i=Vr(r,e.filter);return n.map((function(e){return new d.b(Object(d.c)(Ur(r,i,e)),{renderer:"none"}).run()}))}(t,a,r),this.stopN=this.views.length,this.enumDef=t,this.currSpec=a,this.easeFn=Or(t.ease),this.delay=t.delay||0,this.staggering=t.staggering,this.rawInfo=r}return Object(f.a)(e,[{key:"_getScales",value:function(e){var t=this;return function(a){var r=t.views[e];return r._runtime.scales[a]?r._runtime.scales[a].value:void 0}}},{key:"getData",value:function(e){if(this.extractData&&this.getId)return this.extractData(this.views[e]);throw Error("Cannot return data without joining data.")}},{key:"getDatum",value:function(e,t){var a=this;if(this.extractData&&this.getId){var r=this.extractData(this.views[t]).find((function(t,r){return a.getId(t,r)===e}));return r&&r.datum?r.datum:r}throw Error("Cannot return data without joining data.")}},{key:"joinData",value:function(e,t){var a=this;this.extractData=e,this.getId=t;var r=this.extractData(this.views[0]).map(this.getId);this.joinDataInfo=this.views.slice(1).map((function(t){var n={update:[],enter:[],exit:[]},i=e(t).map(a.getId);return r.forEach((function(e){i.indexOf(e)>=0?n.update.push(e):n.exit.push(e)})),n.enter=i.filter((function(e){return r.indexOf(e)<0})),r=i,["update","enter","exit"].reduce((function(e,t){return Object.assign(e,n[t].reduce((function(e,a){return e[a]=t,e}),{}))}),{})})),this.allKeys=x(this.joinDataInfo.map(Object.keys)).unique(),this.set=function(e,t){return a.joinDataInfo[t][e]}}},{key:"getPropVal",value:function(e,t,a,r){var n=this,i=this.extractData(this.views[a]).find((function(e,t){return n.getId(e,t)===r})),o=this.set(r,a);if(!o)return["x2","y2"].indexOf(e.val)>=0?0:"";var s={initial:this._getScales(a),final:this._getScales(a+1)};return t[o].initial(e,s,i)}},{key:"interpolateAlongEnumMaker",value:function(e,t,a){var r=this;return function(n){return function(i){var o=Math.min(Math.floor(i*(r.stopN-1)),r.stopN-2),s=r.extractData(r.views[o]).find((function(e,t){return r.getId(e,t)===n})),u=r.extractData(r.views[o+1]).find((function(e,t){return r.getId(e,t)===n})),l=r.set(n,o);switch(l){case"enter":s=u;break;case"exit":u=s;break;case"update":break;default:return["x2","y2"].indexOf(e.val)>=0?0:""}var c={initial:r._getScales(o),final:r._getScales(o+1)};if("attrTween"===e.type)return t[l].custom.bind(a)(e,c,s,u)(i*(r.stopN-1)-o);var f=t[l].initial.bind(a)(e,c,s),d=t[l].final.bind(a)(e,c,u);return Object(p.interpolate)(f,d)(i*(r.stopN-1)-o)}}}}]),e}();function Lr(e,t){var a=e.values||[];if(0===a.length&&e.stepSize){for(var r=Qa(Vr(t.sVis.spec,e.filter).expr).right.value,n=Qa(Vr(t.eVis.spec,e.filter).expr).right.value,i=r;i<n;i+=e.stepSize)a.push(i);a.push(n)}return a}function Ur(e,t,a){var r=sr({whitelist:["datum","event","signals"],globalvar:"global"}),n=Qa(t.expr);n.right.value=a,n.right.raw=a.toString();var i=r(n).code;return t.expr=i,g(e)}function qr(e,t,a){if(e.sync)e.sync=e.sync.map((function(e){return qr(e,t,a)}));else if(e.concat&&(e.concat=e.concat.map((function(e){return qr(e,t,a)})),e.enumerator)){var r=a.find((function(t){return t.name===e.enumerator}));if(r){var n=Lr(r,t);return n.slice(1).reduce((function(t,a,i){var o=g(e);return o.concat.forEach((function(e){!function e(t,a,r){t.sync||t.concat?(t.sync||t.concat).forEach((function(t){e(t,a,r)})):Array.isArray(t.enumVals)?t.enumerated.push({def:a,val:r}):t.enumerated=[{def:a,val:r}]}(e,r,a)})),o.enumerated=g(r),o.enumerated.val=a,o.enumerated.N=n.length,o.enumerated.last=i===n.length-2,t.concat.push(o),t}),{concat:[]})}}return e}function Hr(e,t){!function(e){var t=(new It).compile({type:"object",properties:{timeline:{$ref:"#/defs/block"},totalDuration:{type:"number",minimum:0},staggerings:{type:"array",items:{$ref:"#/defs/staggering"}},enumerators:{type:"array",items:{$ref:"#/defs/enumerator"}},meta:{type:"object"}},additionalProperties:!1,defs:{enumerator:{type:"object",properties:{name:{type:"string"},filter:{type:"string"},stepSize:{type:"number"},values:{type:"array"}},additionalProperties:!1,oneOf:[{required:["name","filter","stepSize"]},{required:["name","filter","values"]}]},staggering:{type:"object",properties:{name:{type:"string"},by:{oneOf:[{type:"string"},{type:"object",properties:{initial:{type:"string"},final:{type:"string"}},additionalProperties:!1}]},overlap:{type:"number"},order:{type:"string",enum:["ascending","descending"]},staggering:{$ref:"#/defs/subStaggering"}},additionalProperties:!1,oneOf:[{required:["name","overlap","by"]}]},subStaggering:{type:"object",properties:{name:{type:"string"},by:{oneOf:[{type:"string"},{type:"object"}]},overlap:{type:"number"},order:{type:"string",enum:["ascending","descending"]},staggering:{$ref:"#/defs/subStaggering"}},additionalProperties:!1,oneOf:[{required:["overlap","by"]}]},block:{anyOf:[{$ref:"#/defs/sync"},{$ref:"#/defs/concat"},{$ref:"#/defs/markStep"},{$ref:"#/defs/axisStep"},{$ref:"#/defs/legendStep"},{$ref:"#/defs/pauseStep"},{$ref:"#/defs/viewStep"}]},concat:{type:"object",properties:{concat:{type:"array",items:{$ref:"#/defs/block"}},autoScaleOrder:{type:"array",items:{type:"string"}},enumerator:{type:"string"}},required:["concat"],additionalProperties:!1},sync:{type:"object",properties:{sync:{type:"array",items:{$ref:"#/defs/block"}},anchor:{type:"string",enum:["start","end"]}},required:["sync"],additionalProperties:!1},markStep:{type:"object",properties:{component:{type:"object",properties:{mark:{type:"string"}},additionalProperties:!1,required:["mark"]},change:{type:"object",properties:{data:{oneOf:[{type:"object",properties:{keys:{type:"array",items:{type:"string"}},enter:{type:"boolean"},exit:{type:"boolean"},update:{type:"boolean"}},additionalProperties:!1},{type:"array",items:{type:"string"}},{type:"boolean"}]},scale:{oneOf:[{type:"object",additionalProperties:{type:"object",properties:{data:{type:"boolean"}},additionalProperties:!1}},{type:"boolean"},{type:"array",items:{type:"string"}}]},signal:{oneOf:[{type:"array",items:{type:"string"}},{type:"boolean"}]},marktype:{type:"boolean"},encode:{$ref:"#/defs/encode"}},additionalProperties:!1},timing:{$ref:"#/defs/timing"},enumerator:{type:"string"}},required:["timing","component"],additionalProperties:!1},axisStep:{type:"object",properties:{component:{type:"object",properties:{axis:{type:"string"}},additionalProperties:!1,required:["axis"]},change:{type:"object",properties:{scale:{oneOf:[{type:"object",properties:{domainDimension:{type:"string",enum:["same","diff"]},data:{type:"boolean"}},additionalProperties:!1},{type:"boolean"}]},signal:{oneOf:[{type:"array",items:{type:"string"}},{type:"boolean"}]},marktype:{type:"boolean"},encode:{oneOf:[{type:"object",properties:{axis:{$ref:"#/defs/encode"},title:{$ref:"#/defs/encode"},ticks:{$ref:"#/defs/encode"},labels:{$ref:"#/defs/encode"},grid:{$ref:"#/defs/encode"},domain:{$ref:"#/defs/encode"}},additionalProperties:!1},{type:"boolean"}]}},additionalProperties:!1},timing:{$ref:"#/defs/timing"},enumerator:{type:"string"}},required:["timing","component"],additionalProperties:!1},legendStep:{type:"object",properties:{component:{type:"object",properties:{legend:{type:"string"}},additionalProperties:!1,required:["legend"]},change:{type:"object",properties:{scale:{oneOf:[{type:"object",properties:{domainDimension:{type:"string",enum:["same","diff"]}},additionalProperties:{type:"object",properties:{data:{type:"boolean"}},additionalProperties:!1}},{type:"boolean"},{type:"array",items:{type:"string"}}]},signal:{oneOf:[{type:"array",items:{type:"string"}},{type:"boolean"}]},encode:{oneOf:[{type:"object",properties:{symbols:{$ref:"#/defs/encode"},title:{$ref:"#/defs/encode"},labels:{$ref:"#/defs/encode"},entries:{$ref:"#/defs/encode"},gradient:{$ref:"#/defs/encode"},legend:{$ref:"#/defs/encode"}},additionalProperties:!1},{type:"boolean"}]}},additionalProperties:!1},timing:{$ref:"#/defs/timing"},enumerator:{type:"string"}},required:["timing","component"],additionalProperties:!1},pauseStep:{type:"object",properties:{component:{const:"pause"},timing:{$ref:"#/defs/timing"}},required:["timing","component"],additionalProperties:!1},viewStep:{type:"object",properties:{component:{const:"view"},change:{type:"object",properties:{signal:{oneOf:[{type:"array",items:{type:"string"}},{type:"boolean"}]},additionalProperties:!1}},timing:{$ref:"#/defs/timing"}},required:["timing","component"],additionalProperties:!1},timing:{type:"object",properties:{duration:{oneOf:[{type:"number",minimum:0},{type:"object",properties:{ratio:{type:"number",minimum:0}}}]},delay:{oneOf:[{type:"number"},{type:"object",properties:{ratio:{type:"number"}}}]},staggering:{type:"string"}}},encode:{oneOf:[{type:"object",properties:{update:{oneOf:[{type:"object"},{type:"boolean"}]},enter:{oneOf:[{type:"object"},{type:"boolean"}]},exit:{oneOf:[{type:"object"},{type:"boolean"}]}},additionalProperties:!1},{type:"boolean"}]}}});if(!t(e))throw new Error("Invalid Spec",t.errors)}(e);var a=g(e);a.timeline=qr(a.timeline,t,a.enumerators);var r=Kr(a.timeline,a.totalDuration),n=function e(t,a){var r=[],n=D(a.sTime)?"s":"e",i="s"===n?a.sTime:a.eTime;t.sync&&"start"===t.anchor?t.sync.forEach((function(a){r=r.concat(e(a,{sTime:"s"===n?i:i-t.duration}))})):t.sync&&"end"===t.anchor?t.sync.forEach((function(a){r=r.concat(e(a,{eTime:"e"===n?i:i+t.duration}))})):t.concat?("e"===n&&(i-=t.duration),t.alternates&&t.alternates.forEach((function(a,n){var o=i;a.forEach((function(a){var i=e(g(a),{sTime:o}).map((function(e){return e.alterId="".concat(e.alterId||"").concat(t.alterName,":").concat(n),e}));r=r.concat(i),o+=a.duration+a.delay}))})),t.concat.forEach((function(a){var n=e(a,{sTime:i}).map((function(e){return e.alterId=e.alterId||"".concat(t.alterName||"",":main"),g(e)}));r=r.concat(n),i+=a.duration+a.delay}))):("s"===n?(t.sTime=i,t.eTime=i+t.duration+t.delay):(t.eTime=i,t.sTime=i-t.duration-t.delay),r=r.concat([t]));return r}(r,{sTime:0});n.forEach((function(e){["axis","mark","legend"].indexOf(e.compType)>=0&&(e.timing=Zr(e.timing,a.staggerings))})),a.enumerators&&(a.enumerators=a.enumerators.map((function(e){return Zr(e,a.staggerings)})),n.forEach((function(e,t){["axis","mark","legend"].indexOf(e.compType)>=0&&(e=function(e,t){if(!t||t.length<=0||!e)return e;var a=t.find((function(t){return e.enumerator===t.name}));return Object.assign(e,{enumerator:a})}(e,a.enumerators))})));var o=new C(n),s=F(r,n),u=function(e,t){var a=[{alterId:":main",tracks:e.tracks}];t.length>0&&(a=t.reduce((function(e,t){return e.concat(t.alterIds)}),[]).map((function(t){return{tracks:e.tracks.map((function(e){return Object(i.a)({},e,{steps:e.steps.filter((function(e){return!e.alterId||t===e.alterId}))})})),alterId:t}})));var r=a.map(B),n=r.filter((function(e){return e.length>0})).map((function(e){return e.alterId}));if(n.length===a.length)throw r.length>1?new Error("All possible timelines have 1+ schedule conflict.",r):new Error("The timeline has 1+ schedule conflict.",r);return n.length>0&&(r.find((function(e){return e.find((function(e){return e.alterId.indexOf(":main")>=0}))}))?console.warn("The main timeline (specified timeline) has 1+ schedule conflict.",r):console.warn("Some possible timelines have 1+ schedule conflict.",r)),e.tracks=e.tracks.map((function(e){return Object(i.a)({},e,{steps:e.steps.filter((function(e){return n.indexOf(e.alterId)<0}))})})),t=t.map((function(e){return Object(i.a)({},e,{alterIds:e.alterIds.filter((function(e){return n.indexOf(e)<0}))})})),{conflictsPerAlterId:r}}(o,s);return{schedule:o,resolves:s,conflictsPerAlterId:u.conflictsPerAlterId}}function Kr(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(e.sync)return Jr(e,t,a);if(e.concat)return Wr(e,t,a);var r=(e.delay?D(e.timing.delay.ratio)?e.timing.delay.ratio*t:e.timing.delay:0)*a,n=(D(e.timing.duration.ratio)?e.timing.duration.ratio*t:e.timing.duration)*a,i="object"===typeof e.component?Object.keys(e.component)[0]:e.component,o="object"===typeof e.component?e.component[i]:void 0;return{duration:n,delay:r,timing:Object.assign({},e.timing,{duration:n,delay:r}),change:e.change,enumerated:e.enumerated,enumerator:e.enumerator,compType:i,compName:o}}function Wr(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=e.concat,n=0,i={},o=e.enumerated?1/e.enumerated.N:1,s=r.map((function(e){var r=Kr(e,t,a*o);return n=n+r.timing.duration+r.timing.delay,r}));if(e.autoScaleOrder){e.resolve={autoScaleOrder:e.autoScaleOrder,alterName:e.autoScaleOrder.join("-")+(e.enumerated?"_".concat(e.enumerated.val):"")};var u=Qr(r,e.resolve.autoScaleOrder);u.splice(0,1),u=u.map((function(e){return e.map((function(e){return Kr(e,t,a*o)}))})),i={alterName:e.resolve.alterName,alternates:u}}return Object.assign({delay:0,duration:n,timing:{delay:0,duration:n},concat:s,resolve:e.resolve,enumerated:e.enumerated},i)}function Qr(e,t){var a=[],r=[];return e.forEach((function(e,n){(function e(a){if(a.sync||a.concat)return(a.sync||a.concat).reduce((function(t,a){return t=t||e(a)}),!1);var r=Object.keys(a.component)[0];return t.indexOf(a.component[r])>=0})(e)&&(a.push(e),r.push(n))})),function e(t){return 2===t.length?[t,[t[1],t[0]]]:t.reduce((function(a,r,n){var i=g(t);return i.splice(n,1),a=a.concat(e(i).map((function(e){return[r].concat(e)})))}),[])}(a).map((function(t){return r.reduce((function(e,a,r){return e.splice(a,1,t[r]),e}),g(e))}))}function Jr(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=e.anchor||"start",n=0,i=e.sync.map((function(e){var r=Kr(e,t,a);return n=n>r.timing.duration+r.timing.delay?n:r.timing.duration+r.timing.delay,r}));return{delay:0,duration:n,timing:{delay:0,duration:n},anchor:r,sync:i}}function Zr(e,t){if(!t||t.length<=0||!e)return e;var a=t.find((function(t){return e.staggering===t.name}));return Object.assign(e,{staggering:a})}function Gr(e,t){if(!t)return[{datum:{},mark:{role:"group",marktype:"group"},items:[{items:e}]}];var a=t.groupby;return"string"===typeof a&&(a=[a]),Object(p.nest)().key((function(e){return a.map((function(t){return e.datum[t]})).join("@@_@@")})).entries(e).map((function(e){return{datum:a.reduce((function(t,a){return t[a]=e.values[0].datum[a],t}),{count:e.values.length}),mark:{role:"group",marktype:"group"},items:[{items:e.values}]}}))}function Yr(e){return"group"!==e[0].mark.marktype?e:e.reduce((function(e,t){return e.concat(t.items[0].items)}),[])}function Xr(e,t,a,r,n){var i=Nr(t)?t.parent.name:a,o=e._runtime.data[i]&&e._runtime.data[i].values.value||[];if(0===o.length)return o;var s=Mr(r||t.type),u=Nr(t);return s&&!u?Gr(o,n||(t.parent.from?t.parent.from.facet:void 0)):(!s&&u&&(o=Yr(o)),o)}function en(e){return"symbol"===e.type?{labels:[],symbols:[],pairs:[],title:[]}:"gradient"===e.type?{labels:[],gradient:[],bands:[],title:[]}:void 0}function tn(e,t,a){var r={title:[e._runtime.data[t].values.value[0].items.find((function(e){return"legend-title"===e.role})).items[0]]};if("symbol"===a.type)r=Object.assign(r,{labels:[],symbols:[],pairs:[]}),e._runtime.data[t].values.value[0].items.find((function(e){return"legend-entry"===e.role})).items[0].items[0].items.forEach((function(e){r.pairs.push(e),r.labels.push(e.items.find((function(e){return"legend-label"===e.role})).items[0]),r.symbols.push(e.items.find((function(e){return"legend-symbol"===e.role})).items[0])}));else if("gradient"===a.type){r=Object.assign(r,{labels:[],gradient:[],bands:[]});var n,i,o,s=e._runtime.data[t].values.value[0].items.find((function(e){return"legend-entry"===e.role})).items[0];(n=s.items.find((function(e){return"legend-label"===e.role})))&&(r.labels=r.labels.concat(n.items)),(i=s.items.find((function(e){return"legend-band"===e.role})))&&(r.bands=r.bands.concat(i.items)),(o=s.items.find((function(e){return"legend-gradient"===e.role})))&&r.gradient.push(o.items[0])}return r}function an(e,t){return["tick","label","grid"].reduce((function(a,r){var n=e._runtime.data[t].values.value[0].items.find((function(e){return e.role==="axis-".concat(r)}));return n=n&&n.items?n.items:[],a[r]=n,a}),{})}function rn(e){return Array.isArray(e)?function(t){return e.map((function(e){return t.datum[e]})).join("-")}:function(e,t){return v(t)}}function nn(e,t,a,r){var n={initial:[],final:[]},o=[],s=[],u=new Array(t.length);return u.fill(!1),e.forEach((function(e,o){var l=a(e,o),c=t.findIndex((function(e,t){return a(e,t)===l})),f=c>=0?t[c]:null;if(f){var d={animSet:"update",joinKey:l};cn(f,r,d),cn(e,r,d);var p=Object(i.a)({},f.datum,{},e.datum),m=Object(i.a)({},e.datum,{},f.datum);e.datum=p,f.datum=m,n.final.push(f),n.initial.push(e),u[c]=!0}else cn(e,r,{animSet:"exit",joinKey:l}),s.push(e)})),u.forEach((function(e,n){e||(cn(t[n],r,{animSet:"enter",joinKey:a(t[n],n)}),o.push(t[n]))})),{enter:o,update:n,exit:s}}function on(e,t,a,r){t.forEach((function(t,n){e.forEach((function(e,i){a(t,n)===a(e,i)&&r.fields.forEach((function(a,n){t.datum[r.as[n]]=e.datum[r.as[n]]}))}))}))}function sn(e,t,a){return e.__gemini__[t.stepId]?e.__gemini__[t.stepId][a]:void 0}function un(e,t){return function(a,r){return e(a,r)+t}}function ln(e,t){var a={};if(!e.initial||!e.final)return a;var r=t.sVis.spec,n=t.eVis.spec,i=function(e){return Nr(e)?e.parent.from.facet.data:e.from.data},o=n.data.find((function(t){return t.name===i(e.final)}));o.transform&&(a.final=o.transform.find((function(e){return"aggregate"===e.type})));var s=r.data.find((function(t){return t.name===i(e.initial)}));return s.transform&&(a.initial=s.transform.find((function(e){return"aggregate"===e.type}))),a}function cn(e,t,a){e.__gemini__=e.__gemini__||{},e.__gemini__[t.stepId]=e.__gemini__[t.stepId]||{},Object.assign(e.__gemini__[t.stepId],a)}function fn(e,t,a){var r=g(t),n=r.scales.find((function(e){return e.name===a}));if(n.domain.data){var i=r.data.findIndex((function(e){return e.name===n.domain.data}));i>=0&&r.data.splice(i,1,e.data.find((function(e){return e.name===n.domain.data})))}return new d.b(Object(d.c)(r),{renderer:"none"}).run()._runtime.scales[a].value}function dn(e,t,a){return Object.keys(e&&e[a]?e[a]:{}).filter((function(t){return!1===e[a][t]})).reduce((function(e,r){return e[r]=t[a][r],e}),{})}function pn(e,t,a){var r=Object.assign({},t),n=["x","x2","xc","width","y","y2","yc","height"],i={rect:[{replaceBy:["x","x2"]},{replaceBy:["x","width"]},{replaceBy:["xc","width"],remove:["x"]},{replaceBy:["y","y2"]},{replaceBy:["y","height"]},{replaceBy:["yc","height"],remove:["y"]}],area:[{replaceBy:["x","x2","y"],remove:"*"},{replaceBy:["x","width","y"],remove:"*"},{replaceBy:["xc","width","y"],remove:"*"},{replaceBy:["y","y2","x"],remove:"*"},{replaceBy:["y","height","x"],remove:"*"},{replaceBy:["yc","height","x"],remove:"*"},{replaceBy:["x","x2","yc"],remove:"*"},{replaceBy:["x","width","yc"],remove:"*"},{replaceBy:["xc","width","yc"],remove:"*"},{replaceBy:["y","y2","xc"],remove:"*"},{replaceBy:["y","height","xc"],remove:"*"},{replaceBy:["yc","height","xc"],remove:"*"}],default:[{replaceBy:["x"]},{replaceBy:["xc"],remove:["x"]},{replaceBy:["y"]},{replaceBy:["yc"],remove:["y"]}]};return(i[e]||i.default).forEach((function(e){if(e.replaceBy.reduce((function(e,t){return e&&a[t]}),!0)){e.replaceBy.forEach((function(e){r[e]=a[e]}));var t=e.remove||[];"*"===e.remove&&(t=n.filter((function(t){return e.replaceBy.indexOf(t)<0}))),t.forEach((function(e){delete r[e]}))}})),r}var mn=Object.freeze({__proto__:null,mark:function(e,t,a){var r=e.eVis.view,n=t.change,i=!n.initial&&!!n.final,o=!!n.initial&&!n.final,s=n.encode,u=!o&&(i||!1!==n.data),l=!i&&(o||!1!==n.data);n.data&&(u=!1!==n.data.enter&&u,l=!1!==n.data.exit&&l),i||o||n.initial.from.data===n.final.from.data||Nr(n.final)||Nr(n.initial)||console.error("Data source of this mark (".concat(n.compName,") has changed unexpectedly!"));var c={initial:a.aggregate,final:a.aggregate};n.data&&(c.final=ln(n,e).final);var f={initial:a.marktype,final:n.final?n.final.type:void 0};f.initial&&f.final&&f.initial!==f.final&&(console.log("mark transform change!"),!1===n.marktype&&(f.final=f.initial));var d={initial:a.hasFacet,final:a.hasFacet};(n.data||i||o)&&!1!==n.marktype&&(d.final=Nr(n.final));var p={initial:a.scale,final:b(a.scale)},m={initial:Object.assign({update:{}},g(a.encode)),final:Object.assign({update:{}},g(a.encode))},h={initial:a.signal},v=["width","height","padding"].reduce((function(e,t){return Array.isArray(n.signal)?(n.signal.indexOf(t)>=0&&(e[t]=r.signal(t)),e):(!1===n.signal||(e[t]=r.signal(t)),e)}),{});if(h.final=Object.assign({},h.initial,v),!1!==n.scale){var y=[];!0===n.scale||i?y=Object.keys(r._runtime.scales):Array.isArray(n.scale)?y=n.scale:"object"===typeof n.scale&&(y=Object.keys(n.scale)),y.forEach((function(t){n.scale[t]&&!1===n.scale[t].data?p.final[t]=fn(e.sVis.spec,e.eVis.spec,t):p.final[t]=r._runtime.scales[t]?r._runtime.scales[t].value:void 0;var a=Object.keys(m.final.update).find((function(e){return e.scale===t}));m.final.update[a]=n.final?g(n.final.encode.update[a]):void 0}))}if(!1===s)throw Error("Interpolating data requires to interpolate encode.");var x={initial:g(a.styleEncode),final:g(a.styleEncode)};n.marktype&&(x.final=n.final&&n.final.style&&pr[n.final.style]||{});var E=s?g(s.enter||{}):{};return delete E.initial,m.initial.enter=Object.assign({},a.encode.update,Dr.mark.enter,s&&s.enter?s.enter.initial:{}),!1===k(n,"encode","enter")?m.final.enter=m.initial.enter:m.final.enter=Object.assign({},Dr.mark[f.final||f.initial].update,x.final,g(k(n,"final","encode","update")||{}),s?E:{},dn(s,m.initial,"enter")),m.initial.exit=Object.assign({},a.encode.update),n.encode&&!1===n.encode.exit?m.final.exit=m.initial.exit:m.final.exit=Object.assign({},Dr.mark[f.initial||f.final].update,x.final,g(l?k(n,"final","encode","update")||k(n,"initial","encode","update"):k(n,"initial","encode","update")||k(n,"final","encode","update")),Dr.mark.exit,s?s.exit:{},dn(s,m.initial,"exit")),n.encode&&!1===n.encode.update?m.final.update=m.initial.update:m.final.update=Object.assign({},Dr.mark[f.final||f.initial].update,x.final,g(k(n,"final","encode","update")||{}),s?s.update:{},dn(s,m.initial,"update")),f.final!==f.initial&&(m.initial.intermediate=Object.assign({},pn(f.initial,m.initial.update,m.final.update),{opacity:{value:0}}),m.final.intermediate=Object.assign({},pn(f.final,m.final.update,m.initial.update),{opacity:{value:0}}),u&&(m.initial.enter=Object.assign({},pn(f.final,m.final.enter,m.initial.enter),{opacity:{value:0}},s&&s.enter?s.enter.initial:{})),l&&(m.final.exit=Object.assign({},pn(f.initial,m.initial.exit,m.final.exit),{opacity:{value:0}},s?s.exit:{},dn(s,m.initial,"exit")))),!c.initial&&c.final&&n.data?(m.final.exit=Object.assign(n.marktype?pn(f.initial,m.final.exit,m.final.update):m.final.update,{opacity:{value:0}},s?s.exit:{},dn(s,m.initial,"exit")),m.final.update=g(m.final.enter)):c.initial&&!c.final&&n.data&&(m.initial.enter=Object.assign({},n.marktype?pn(f.final,m.initial.enter,m.initial.update):m.initial.update,{opacity:{value:0}},s&&s.enter?s.enter.initial:{}),m.final.update=g(m.final.enter)),{encodes:m,scales:p,signals:h,marktypes:f,hasFacet:d,aggregates:c,styleEncodes:x}},axis:function(e,t,a){var r,n,i,o,s,u,l=t.change,c=a,f=e.eVis.view,d=!l.final,p=!l.initial;r=n=i=o=s=u=!0,!1===l.encode?r=n=i=o=s=u=!1:l.encode&&(r=!(!1===l.encode.ticks),n=!(!1===l.encode.labels),i=!(!1===l.encode.axis),o=!(!1===l.encode.title),u=!(!1===l.encode.grid),s=!(!1===l.encode.domain));var m={initial:l.initial?l.initial.scale:void 0,final:l.final?l.final.scale:void 0},h={initial:c.scale,final:b(c.scale)};!1!==l.scale&&(m.final?l.scale&&!1===l.scale.data?h.final[m.final]=fn(e.sVis.spec,e.eVis.spec,m.final):h.final[m.final]=f._runtime.scales[m.final]?f._runtime.scales[m.final].value:void 0:h.final={});var v=k(l,"scale","domainDimension");if("string"===typeof v&&(v="same"===v||"diff"!==v&&void 0),d||p)v=!1;else if(void 0===v)if(!1===l.scale)v=!0;else{var x={initial:e.sVis.spec.scales.find((function(e){return e.name===m.initial})),final:e.eVis.spec.scales.find((function(e){return e.name===m.final}))};v=y(x.initial.domain,x.final.domain)}var E={initial:c.signal},w=["width","height","padding"].reduce((function(e,t){return Array.isArray(l.signal)?(l.signal.indexOf(t)>=0&&(e[t]=f.signal(t)),e):(!1===l.signal||(e[t]=f.signal(t)),e)}),{});E.final=Object.assign({},E.initial,w);var A={},D={ticks:r,labels:n,title:o,axis:i,grid:u,domain:s},O=l.final?Pr(f.scenegraph().root,l.compName,"axis")[0].items[0]:void 0,j=O?{x:{value:O.x},y:{value:O.y}}:{};return Object.keys(D).forEach((function(e){var t=l.encode&&l.encode[e]?l.encode[e]:{};A[e]=function(e,t){var a={initial:g(c.encode[e]||{}),final:g(c.encode[e]||{})};if(!0!==D[e])return a;var r={initial:l.initial&&l.initial.encode&&l.initial.encode[e]?l.initial.encode[e].update:void 0,final:l.final&&l.final.encode&&l.final.encode[e]?l.final.encode[e].update:void 0};a.initial.enter=Object.assign({},Dr.axis[e](v?l.initial:l.final).update,v?r.initial:r.final||{},Dr.mark.enter,c.encode.enter,t&&t.enter?t.enter.initial:{}),t&&!1===t.enter?a.final.enter=a.initial.enter:a.final.enter=Object.assign({},Dr.axis[e](l.final).update,r.final?r.final:{},t?t.enter:{},dn(t,a.initial,"enter"));a.initial.exit=Object.assign({},Dr.axis[e](l.initial).update,r.initial?r.initial:{},c.encode.exit||c.encode.update),t&&!1===t.exit?a.final.exit=a.initial.exit:a.final.exit=Object.assign({},Dr.axis[e](v?l.final:l.initial).update,v?r.final:r.initial||{},Dr.mark.exit,t?t.exit:{},dn(t,a.initial,"exit"));a.initial.update=Object.assign({},Dr.axis[e](l.initial).update,r.initial||{},a.initial.update),t&&!1===t.update?a.final.update=a.initial.update:a.final.update=Object.assign({},"axis"===e?j:{},Dr.axis[e](l.final).update,r.final||{},t?t.update:{},dn(t,a.initial,"update"));return a}(e,t)})),{encodes:A,scales:h,signals:E,sameDomainDimension:v}},legend:function(e,t,a){var r,n,i,o,s,u,l=t.change,c=e.eVis.view;r=n=i=o=s=u=!0;var f=!a.isRemove&&!l.final,d=!a.isAdd&&!l.initial;!1===l.encode?r=n=i=o=s=u=!1:l.encode&&(r=!(!1===l.encode.title),n=!(!1===l.encode.symbols),i=!(!1===l.encode.labels),o=!(!1===l.encode.entries),s=!(!1===l.encode.gradient),u=!(!1===l.encode.legend));var p={initial:a.legendType,final:!1===l.scale?a.legendType:l.final?l.final.type:void 0},m={initial:[],final:[]};["fill","opacity","shape","size","stroke","strokeDash","strokeWidth"].forEach((function(e){l.initial&&l.initial[e]&&m.initial.push(l.initial[e]),l.final&&l.final[e]&&m.final.push(l.final[e])}));var h={initial:a.scale,final:b(a.scale)};if(!1!==l.scale){var v=[];Array.isArray(l.scale)?v=l.scale:!0===l.scale||d?v=m.final:"object"===typeof l.scale&&(v=m.final.filter((function(e){return!1!==l.scale[e]}))),v.forEach((function(t){l.scale[t]&&!1===l.scale[t].data?h.final[t]=fn(e.sVis.spec,e.eVis.spec,t):h.final[t]=c._runtime.scales[t]?c._runtime.scales[t].value:void 0}))}var g=k(l,"scale","domainDimension");if("string"===typeof g&&(g="same"===g||"diff"!==g&&void 0),void 0===g)if(!1===l.scale)g=!0;else if(f||d)g=!1;else{var x={initial:e.sVis.spec.scales.find((function(e){return e.name===m.initial[0]})),final:e.eVis.spec.scales.find((function(e){return e.name===m.final[0]}))};g=y(x.initial.domain,x.final.domain)}var E={initial:a.signal},w=["width","height","padding"].reduce((function(e,t){return Array.isArray(l.signal)?(l.signal.indexOf(t)>=0&&(e[t]=c.signal(t)),e):(!1===l.signal||(e[t]=c.signal(t)),e)}),{});E.final=Object.assign({},E.initial,w);var A={},D={gradient:s,bands:s,pairs:n||i,labels:i,title:r,legend:u,entries:o,symbols:n};return Object.keys(D).forEach((function(e){if(D[e]){var t=l.encode&&l.encode[e]?l.encode[e]:{};A[e]=function(e,t){var r={initial:Dr.legend[e](l.initial).update,final:Dr.legend[e](l.final).update},n=l,i={};["initial","final"].forEach((function(t){n[t]&&n[t].encode&&n[t].encode[e]&&(i[t]=n[t].encode[e].update)}));var o={initial:b(a.encode&&a.encode[e]?a.encode[e]:{update:r.initial}),final:b(a.encode&&a.encode[e]?a.encode[e]:{update:r.final})};o.initial.enter=Object.assign({},g?r.initial:r.final,g?i.initial:i.final,Dr.mark.enter,a.encode.enter,t&&t.enter?t.enter.initial:{}),t&&!1===t.enter?o.final.enter=o.initial.enter:o.final.enter=Object.assign({},r.final,i.final,t?t.enter:{},dn(t,o.initial,"enter"));o.initial.exit=Object.assign({},r.initial,i.initial,a.encode.exit||a.encode.update),t&&!1===t.exit?o.final.exit=o.initial.exit:o.final.exit=Object.assign({},g?r.final:r.initial,g?i.final:i.initial,Dr.mark.exit,t?t.exit:{},dn(t,o.initial,"exit"));o.initial.update=Object.assign({},r.initial,i.initial,o.initial.update),t&&!1===t.update?o.final.update=o.initial.update:o.final.update=Object.assign({},r.final,i.final,t?t.update:{},dn(t,o.initial,"update"));return o}(e,t)}})),{encodes:A,scales:h,signals:E,legendTypes:p,sameDomainDimension:g,isAdd:d,isRemove:f}},view:function(e,t,a){var r=t.change,n={initial:a.signal},o={initial:g(a.encode),final:g(a.encode)},s={},u=Array.isArray(r.signal)?r.signal:["width","height","padding"];u.forEach((function(t){s[t]=e.eVis.view.signal(t)})),n.final=Object(i.a)({},n.initial,{},s),!1!==t.change.signal&&(u.indexOf("height")>=0&&(o.final.svg.y={value:r.final.y+r.final.padding},o.final.svg.height={value:r.final.viewHeight+2*r.final.padding},o.final.root.height={value:n.final.height}),u.indexOf("width")>=0&&(o.final.svg.x={value:r.final.x+r.final.padding},o.final.svg.width={value:r.final.viewWidth+2*r.final.padding},o.final.root.width={value:n.final.width}));var l=e.eVis.view._runtime.data.root.values.value[0];return o.final.root.fill={value:l.fill},o.final.root.stroke={value:l.stroke},{signals:n,encodes:o}}});function hn(e,t){if(e.fill){var a=t._runtime.scales[e.fill].value;if(["sequential-linear","linear","log","pow","sqrt","symlog","bin-ordinal"].indexOf(a.type)>=0)return"bin-ordinal"===a.type?{type:"gradient",isBand:!0}:{type:"gradient"}}if(e.stroke){var r=t._runtime.scales[e.stroke].value;if(["sequential-linear","linear","log","pow","sqrt","symlog","bin-ordinal"].indexOf(r.type)>=0)return"bin-ordinal"===r.type?{type:"gradient",isBand:!0}:{type:"gradient"}}return{type:"symbol"}}function vn(e){return function e(t,a){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r&&(t.name="root");var n=a;if(t.axes&&(n=n.concat(t.axes.map((function(e){return Object(i.a)({},g(e),{compType:"axis"})})))),t.legends&&(n=n.concat(t.legends.map((function(e){return Object(i.a)({},g(e),{compType:"legend"})})))),t.scales&&(n=n.concat(t.scales.map((function(e){return Object(i.a)({},g(e),{compType:"scale"})})))),!r){var o=Object(i.a)({},g(t),{compType:"mark"});delete o.marks,n.push(o)}return t.marks&&(n=t.marks.reduce((function(a,r){var n=e(Object(i.a)({},r,{parent:t||"root"}),[]);return a.concat(n)}),n)),n}(e,[],!0)}function yn(e,t){var a={axis:function(e){return e.encode&&e.encode.axis?e.encode.axis.name:e.scale},legend:function(e){return e.encode&&e.encode.legend?e.encode.legend.name:e.scale},mark:function(e){return e.name},scale:function(e){return e.name}},r=[];return e.forEach((function(e){var n=a[e.compType],i=t.findIndex((function(t){return e.compType===t.compType&&n(e)===n(t)}));i>=0?r.push({compType:e.compType,compName:n(e),parent:e.parent,initial:e,final:t.splice(i,1)[0]}):r.push({compType:e.compType,compName:n(e),parent:e.parent,initial:e,final:null})})),r.concat(t.map((function(e){var t=a[e.compType];return{compType:e.compType,compName:t(e),parent:e.parent,initial:null,final:e}})))}function gn(e){return{compType:"view",compName:"global",initial:{viewWidth:e.sVis.view._viewWidth,viewHeight:e.sVis.view._viewHeight,width:e.sVis.view.width(),height:e.sVis.view.height(),x:e.sVis.view._origin[0],y:e.sVis.view._origin[1],padding:e.sVis.spec.padding},final:{viewWidth:e.eVis.view._viewWidth,viewHeight:e.eVis.view._viewHeight,width:e.eVis.view.width(),height:e.eVis.view.height(),x:e.eVis.view._origin[0],y:e.eVis.view._origin[1],padding:e.eVis.spec.padding}}}function bn(e,t){var a=yn(vn(e.sVis.spec),vn(e.eVis.spec));return a.push(gn(e)),t.forEach((function(t){t.steps=t.steps.map((function(t){if("pause"===t.compType)return t;var r=a.find((function(e){return e.compType===t.compType&&(e.compName===t.compName||"view"===t.compType)}));return r||console.error("cannot found the changes of ".concat(t.compName,".")),t.change=Object(i.a)({},t.change,{},r),t.change=Object(i.a)({},t.change,{},function(e,t){var a=g(e.change||{});return"mark"===e.compType?(a.data=void 0===a.data||a.data,!1===a.data.update&&!1===a.data.enter&&!1===a.data.exit&&(a.data=!1),a.marktype=void 0===a.marktype||a.marktype,a.scale=void 0===a.scale||a.scale,a.signal=void 0===a.signal||a.signal,a.encode=void 0===a.encode||a.encode):"axis"===e.compType||"legend"===e.compType?(a.signal=void 0===a.signal||a.signal,a.scale=void 0===a.scale?{}:a.scale,"legend"===e.compType&&(a.scale=void 0===a.scale||a.scale,a.signal=void 0===a.signal||a.signal,a.initial&&(a.initial=Object.assign(a.initial,hn(a.initial,t.sVis.view)),a.initial.direction=a.initial.direction||"vertical",a.initial.orient=a.initial.orient||"right"),a.final&&(a.final=Object.assign(a.final,hn(a.final,t.eVis.view)),a.final.direction=a.final.direction||"vertical",a.final.orient=a.final.orient||"right"))):"view"===e.compType&&(a.signal=void 0===a.signal||a.signal),a}(t,e)),t}))})),t}function xn(e,t){var a=function(e,t){var a=t.sVis.view,r=t.sVis.spec,n=vn(r),i={spec:g(r)};return e.reduce((function(e,r){var i={scale:{},signal:{width:a.signal("width"),height:a.signal("height"),padding:a.signal("padding")}};if("mark"===r.compType){var o=n.find((function(e){return e.name===r.compName}));if(o){i.marktype=o.type,i.hasFacet=Nr(o),i.styleEncode=o.style?pr[o.style]:{},i.encode=g(o.encode||{});var s=Object.assign({},Dr.mark[i.marktype].update,o.style?pr[o.style]:{});i.encode.update=Object.assign(s,i.encode.update),i.encode.exit=g(i.encode.update),i.encode.enter=Object.assign({},i.encode.update,Dr.mark.enter),n.filter((function(e){return"scale"===e.compType})).forEach((function(e){i.scale[e.name]=a.scale(e.name)}))}else i.encode={},i.styleEncode={};i.aggregate=ln(r.steps[0].change,t).initial}else if("axis"===r.compType){var u=n.find((function(e){return"axis"===e.compType&&e.encode.axis.name===r.compName}));r.steps[0].change.initial&&(i.scale[u.scale]=a.scale(u.scale)),i.encode=u?g(u.encode||{}):{};var l=u?Pr(a.scenegraph().root,r.compName,"axis")[0].items[0]:void 0;i.encode.axis=l?{update:{x:{value:l.x},y:{value:l.y}}}:{}}else if("legend"===r.compType){var c=n.find((function(e){return"legend"===e.compType&&e.encode.legend.name===r.compName}));i.legendType=void 0,r.steps[0].change.initial&&(i.legendType=r.steps[0].change.initial.type,["fill","opacity","shape","size","stroke","strokeDash","strokeWidth"].forEach((function(e){var t=r.steps[0].change.initial[e];t&&(i.scale[t]=a.scale(t))}))),i.encode=c?g(c.encode||{}):{}}else if("view"===r.compType){var f=a._runtime.data.root.values.value[0],d=r.steps[0].change.initial;i.encode={svg:{x:{value:d.x+d.padding},y:{value:d.y+d.padding},width:{value:d.viewWidth+2*d.padding},height:{value:d.viewHeight+2*d.padding}},root:{width:{value:d.width},height:{value:d.height},fill:{value:f.fill},stroke:{value:f.stroke}}}}return e[r.name]=i,e}),i)}(e,t),r=function(e){var t=[];return e.forEach((function(e){e.steps.forEach((function(e){var a=t.find((function(t){return t.time===e.sTime}));a?a.starting.push(e):t.push({time:e.sTime,starting:[e],ending:[]}),(a=t.find((function(t){return t.time===e.eTime})))?a.ending.push(e):t.push({time:e.eTime,starting:[],ending:[e]})}))})),t.sort((function(e,t){return e.time-t.time}))}(e);return e.moments=r,r.forEach((function(r){r.ending.forEach((function(r){var i=a[r.trackName];if("pause"!==r.compType){var o;i.data=i.data||function(e,t){var a=t.sVis.view,r=e.change,n=!r.initial&&!!r.final;if("axis"===r.compType)return n?{tick:[],label:[],grid:[]}:an(a,r.compName);if("legend"===r.compType)return n?en(r.final):tn(a,r.compName,r.initial);if("mark"===r.compType){if(n)return[];var i=e.marktypes?e.marktypes.initial:r.initial.type;return Xr(a,r.initial,r.compName,i)}return"view"===r.compType?a._runtime.data.root.values.value[0]:void 0}(r,t),r.enumerated&&(r.enumerated.forEach((function(e){var t=Vr(a.spec,e.def.filter);a.spec=Ur(a.spec,t,e.val)})),o=new d.b(Object(d.c)(a.spec),{renderer:"none"}).run());var s={sVis:t.sVis,eVis:Object.assign({},t.eVis,o?{view:o}:void 0)};if("view"===r.compType&&Object.assign(r.change,gn(s)),Object.assign(r,mn[r.compType](s,r,i)),Object.assign(r,function(e,t,a){var r=a,n=t.eVis.view,i=e.change,o=!i.initial&&!!i.final,s=!!i.initial&&!i.final,u=e.hasFacet,l=!1,c={};if("axis"===i.compType){var f={nextData:{},currData:{},computeDatumId:{}};if(f.nextData.axis=s?r.axis:[n._runtime.data[i.compName].values.value[0].datum],f.currData.axis=r.axis,f.computeDatumId.axis=function(e,t){return t},!1===i.scale||i.scale&&!1===i.scale.data){var d=function(e){return v(e.datum.value)};return["tick","label","grid"].reduce((function(t,a){var n=r[a].map((function(t,a){return cn(t,e,{animSet:"update",joinKey:d(t)}),t}));return t.nextData[a]=n,t.currData[a]=n,t.computeDatumId[a]=d,t}),f)}var p={tick:[],label:[],grid:[]};return s||(p=an(n,i.compName)),["tick","label","grid"].reduce((function(t,a){var n="tick"===a?"ticks":a;n="label"===n?"labels":n;var o=function(e){return v(e.datum.value)};if(i.encode&&!1===i.encode[n])return t.nextData[a]=r[a],t.currData[a]=r[a],t.computeDatumId[a]=o,t;var s=r[a]||[],u=p[a]||[];if(e.sameDomainDimension)nn(s,u,o,e);else{var l=un(o,"_exit"),c=un(o,"_enter");o={initial:l,final:c},s.forEach((function(t,a){cn(t,e,{animSet:"exit",joinKey:o.initial(t,a)})})),u.forEach((function(t,a){cn(t,e,{animSet:"enter",joinKey:o.final(t,a)})}))}var f=[],d=["enter","update"],m=s.filter((function(t){return f.indexOf(sn(t,e,"animSet"))>=0})).concat(u.filter((function(t){return d.indexOf(sn(t,e,"animSet"))>=0})));return t.nextData[a]=m,t.currData[a]=s,t.computeDatumId[a]=o,t}),f)}if("legend"===i.compType){var m=function(e){return"pairs"===e?function(e){return v(e.items.find((function(e){return"legend-label"===e.role})).items[0].datum.value)}:"title"===e?function(e){return e.text}:"gradient"===e?function(e){return JSON.stringify(e.fill.stops)}:function(e){return v(e.datum.value)}},h=Object.keys(r).reduce((function(t,a){c=m(a);var n=r[a].map((function(t,a){return cn(t,e,{animSet:"update",joinKey:c(t,a)}),t}));return t.nextData[a]=n,t.currData[a]=n,t.computeDatumId[a]=c,t}),{nextData:{},currData:{},computeDatumId:{}});if(!1===i.scale||i.scale&&!1===i.scale.data)return h;if(s)return h.nextData=en(i.initial),h;var y=tn(n,i.compName,i.final);return Object.keys(y).concat(Object.keys(r)).unique().reduce((function(t,a){var n=a;if(i.encode&&!1===i.encode[n])return t;c=m(a);var o=r[a]||[],s=y[a]||[];if("labels"===a&&e.legendTypes.initial!==e.legendTypes.final||!e.sameDomainDimension){var u=un(c,"_exit"),l=un(c,"_enter");c={initial:u,final:l},o.forEach((function(t,a){cn(t,e,{animSet:"exit",joinKey:c.initial(t,a)})})),s.forEach((function(t,a){cn(t,e,{animSet:"enter",joinKey:c.final(t,a)})}))}else nn(o,s,c,e);var f=[],d=["enter","update"],p=o.filter((function(t){return f.indexOf(sn(t,e,"animSet"))>=0})).concat(s.filter((function(t){return d.indexOf(sn(t,e,"animSet"))>=0})));return t.nextData[a]=p||[],t.currData[a]=o,t.computeDatumId[a]=c,t}),h)}if("mark"===i.compType){var g=e.marktypes,b=!s&&!o&&!1!==i.data,x=!s&&(o||!1!==i.data),E=!o&&(s||!1!==i.data),w=null;i.data&&(b=!1!==i.data.update&&b,x=!1!==i.data.enter&&x,E=!1!==i.data.exit&&E,w=Array.isArray(i.data)?i.data:i.data.keys);var k=e.aggregates,A={initial:Mr(g.initial||g.final),final:Mr(g.final||g.initial)},D={initial:u.initial?Ir(i.initial)||Ir(i.final):void 0,final:u.final?Ir(i.final)||Ir(i.initial):void 0};if(!1===i.marktype&&(A.final=A.initial),i.data||o||s){e.change.aggregate=k;var O=[];if(!s){var j=g.final||g.initial,S=!1===i.marktype?i.initial.parent.from?i.initial.parent.from.facet:void 0:i.final.parent.from?i.final.parent.from.facet:void 0;O=Xr(n,i.final,i.compName,j,S)}if(["initial","final"].forEach((function(e){i[e]&&D[e]?c[e]=rn(D[e].groupby):k[e]?c[e]=rn(k[e].groupby):c[e]=rn(w)})),A.initial&&A.final)if(i.final&&i.initial&&D.final&&D.initial&&D.initial.groupby.sort().toString()===D.final.groupby.sort().toString())c=c.initial,nn(r,O,c,e);else if(i.final&&i.initial&&!D.final&&!D.initial)c=c.initial,nn(r,O,c,e);else{var P=un(c.initial,"_exit"),F=un(c.final,"_enter");c={initial:P,final:F},r.forEach((function(t,a){cn(t,e,{animSet:"exit",joinKey:c.initial(t,a)})})),O.forEach((function(t,a){cn(t,e,{animSet:"enter",joinKey:c.final(t,a)})}))}else{var C,B;if(A.initial||A.final)return A.initial?(c.initial=rn(D.initial?i.initial.parent.from.facet.groupby:null),c.final=rn(w||null),nn(B=Yr(r),O,c.final,e),C=Gr(O,i.initial.parent.from?i.initial.parent.from.facet:void 0),nn(r,C,c.initial,e)):(c.initial=rn(w||null),c.final=rn(D.final?i.final.parent.from.facet.groupby:null),B=Yr(O),nn(r,B,c.initial,e),nn(C=Gr(r,i.final.parent.from?i.final.parent.from.facet:void 0),O,c.final,e)),{nextData:O,currData:r,computeDatumId:c,groupedData:C,unpackedData:B};if(k.initial&&k.final&&k.initial.groupby.sort().toString()===k.final.groupby.sort().toString())c=c.initial,nn(r,O,c,e);else if(k.initial||k.final){var T=un(c.initial,"_exit"),_=un(c.final,"_enter");c={initial:T,final:_},r.forEach((function(t,a){cn(t,e,{animSet:"exit",joinKey:c.initial(t,a)})})),O.forEach((function(t,a){cn(t,e,{animSet:"enter",joinKey:c.final(t,a)})})),!k.initial&&k.final?(on(O,r,c.final,k.final),l=!0):k.initial&&!k.final&&(on(r,O,c.initial,k.initial),l=!0)}else c=c.initial,nn(r,O,c,e)}var N=(E?[]:["exit"]).concat(b?[]:["update"]),I=(x?["enter"]:[]).concat(b?["update"]:[]),M=r.filter((function(t){return N.indexOf(sn(t,e,"animSet"))>=0}));return E||M.forEach((function(t){cn(t,e,{animSet:"update"})})),{nextData:M=M.concat(O.filter((function(t){return I.indexOf(sn(t,e,"animSet"))>=0}))),currData:r,computeDatumId:c,preFetchCurrData:l}}c=rn(null);var R,$,V=r.map((function(t,a){return cn(t,e,{animSet:"update",joinKey:c(t,a)}),t}));return A.initial!==A.final?A.initial?(($=Yr(r)).map((function(t,a){return cn(t,e,{animSet:"update",joinKey:c(t,a)}),t})),{nextData:$,currData:r,computeDatumId:c,groupedData:r,unpackedData:$}):((R=Gr(r,i.final.parent.from?i.final.parent.from.facet:void 0)).map((function(t,a){return cn(t,e,{animSet:"update",joinKey:c(t,a)}),t})),{nextData:R,currData:r,computeDatumId:c,groupedData:R,unpackedData:r}):{nextData:V,currData:V,computeDatumId:c}}return"view"===i.compType?{nextData:n._runtime.data.root.values.value[0]}:r}(r,s,i.data)),i.data=r.nextData,r.encodes&&(i.encode=g(r.encodes.final)||Object.keys(r.encodes).reduce((function(e,t){return e[t]=r.encodes[t].final,e}),{})),i.styleEncode=r.styleEncodes?r.styleEncodes.final:void 0,i.signal=r.signals?r.signals.final:void 0,i.scale=r.scales?r.scales.final:void 0,i.marktype=r.marktypes?r.marktypes.final:void 0,i.hasFacet=r.hasFacet?r.hasFacet.final:void 0,i.aggregate=r.aggregates?r.aggregates.final:void 0,i.isAdd=r.isAdd,i.isRemove=r.isRemove,i.sameDomainDimension=r.sameDomainDimension,a.spec=function(e,t,a){var r=g(e.spec);if("mark"===t.compType){var n=t.change.final,i=Nr(n)?n.parent.name:t.compName;if(!n&&i&&t.change.data){var o=r.marks.findIndex((function(e){return e.name===i}));r.marks.splice(o,1)}else{var s=Rr(r.marks,i);if(s){var u=Nr(n)?n.parent.from.facet.data:n.from.data;if(t.change.data){var l=r.data.findIndex((function(e){return e.name===u}));if(l>=0)r.data.splice(l,1,g($r(a,u)));else{var c=a.data.findIndex((function(e){return e.name===u}));r.data.splice(c,0,g($r(a,u)))}}s.encode.update=e[t.trackName].encode.update}else r.marks.push(Rr(a.marks,i))}}else if("axis"===t.compType){var f,d=r.axes.findIndex((function(e){return e.encode&&e.encode.axis&&e.encode.axis.name===t.compName}));d>=0&&r.axes.splice(d,1),(f=a.axes.find((function(e){return e.encode&&e.encode.axis&&e.encode.axis.name===t.compName})))&&r.axes.push(f)}else if("legend"===t.compType){var p=r.legends?r.legends.findIndex((function(e){return e.encode&&e.encode.legend&&e.encode.legend.name===t.compName})):-1;p>=0&&r.legends.splice(p,1);var m=a.legends?a.legends.find((function(e){return e.encode&&e.encode.legend&&e.encode.legend.name===t.compName})):void 0;m&&(r.legends?r.legends.push(m):r.legends=[m])}return r}(a,r,s.eVis.spec),"mark"===r.compType){var u=e.find((function(e){return e.name===r.trackName})).scaleOrderValid;u=void 0===u||u,Object.keys(i.encode.update).map((function(e){var t=i.scale[i.encode.update[e].scale];if(t&&i.encode.update[e].field){var a=i.encode.update[e].field,r=i.data.map((function(e){return e.datum[a]}));"group"===i.data[0].mark.marktype&&(r=i.data.reduce((function(e,t){return e.concat(t.items[0].items.map((function(e){return e.datum[a]})))}),[]));var o=t.domain();if("band"===t.type||"point"===t.type)u=u&&r.reduce((function(e,t){return e&&o.indexOf(t)>=0}),!0);else if("linear"===t.type){var s=Math.max.apply(Math,Object(n.a)(r)),l=Math.min.apply(Math,Object(n.a)(r));u=u&&o[0]<=l&&o[1]>=s}}})),e.find((function(e){return e.name===r.trackName})).scaleOrderValid=u}}})),r.starting.forEach((function(r){var i=a[r.trackName];if(k(r,"enumerator"))if("mark"===r.compType){r.enumeratorDef=r.enumerator;var o=r.enumerator=new zr(r.enumerator,a.spec,t),s=r.compName,u=(Array.isArray(r.change.data)?r.change.data:r.change.data.keys)||null;Nr(r.change.initial)&&Nr(r.change.final)&&(u=(r.change.final||r.change.final).parent.from.facet.groupby,s=(r.change.final||r.change.final).parent.name);var l=function(e){return e.data(s)};!Nr(r.change.initial)&&!Nr(r.change.final)&&Mr(r.change.initial)&&Mr(r.change.final)&&(l=function(e){return[{datum:{},mark:{role:"group",marktype:"group"},items:[{items:e._runtime.data[s].values.value}]}]}),o.joinData(l,(function(e,t){return Array.isArray(u)?u.map((function(t){return e.datum[t]})).join("-"):t.toString()}));for(var c=function(t){var a=function(e){return i.scale[e]};r.change.scale&&(a=o._getScales(t));var s=o.getData(t),u=e.find((function(e){return e.name===r.trackName})).scaleOrderValid;u=void 0===u||u,Object.keys(i.encode.update).map((function(e){var t=a(i.encode.update[e].scale);if(t&&i.encode.update[e].field){var r=i.encode.update[e].field,o=t.domain(),l=s.map((function(e){return e[r]}));if("group"===s[0].mark.marktype&&(l=s.reduce((function(e,t){return e.concat(t.items[0].items.map((function(e){return e.datum[r]})))}),[])),"band"===t.type||"point"===t.type)u=u&&l.reduce((function(e,t){return e&&o.indexOf(t)>=0}),!0);else if("linear"===t.type){var c=Math.max.apply(Math,Object(n.a)(l)),f=Math.min.apply(Math,Object(n.a)(l));u=u&&o[0]<=f&&o[1]>=c}}})),e.find((function(e){return e.name===r.trackName})).scaleOrderValid=u},f=1;f<o.stopN-1;f++)c(f)}else if("axis"===r.compType)r.enumeratorDef=r.enumerator,r.enumerator=["tick","label","grid"].reduce((function(e,n){var i=new zr(r.enumerator,a.spec,t),o=r.compName;return i.joinData((function(e){return e.data(o)[0].items.filter((function(e){return e.role==="axis-".concat(n)}))[0].items}),(function(e){return e.datum.value.toString()})),e[n]=i,e}),{});else if("legend"===r.compType){r.enumeratorDef=r.enumerator;var d=[];if("gradient"===r.change.initial.type&&"gradient"===r.change.initial.type)d=(r.change.initial.isBand?["bands","labels"]:["labels"]).map((function(e){return{subComp:e,extractData:function(t){return t._runtime.data[r.compName].values.value[0].items.find((function(e){return"legend-entry"===e.role})).items[0].items.find((function(t){return t.role==="legend-".concat(e.replace(/s$/g,""))})).items},identifyDatum:function(e){return e.datum.value.toString()}}}));else"symbol"===r.change.initial.type&&"symbol"===r.change.initial.type?(d.push({subComp:"pairs",extractData:function(e){return e._runtime.data[r.compName].values.value[0].items.find((function(e){return"legend-entry"===e.role})).items[0].items[0].items},identifyDatum:function(e){return e.items.find((function(e){return"legend-label"===e.role})).items[0].datum.value.toString()}}),d.push({subComp:"labels",extractData:function(e){return e._runtime.data[r.compName].values.value[0].items.find((function(e){return"legend-entry"===e.role})).items[0].items[0].items.map((function(e){return e.items.find((function(e){return"legend-label"===e.role})).items[0]}))},identifyDatum:function(e){return e.datum.value.toString()}}),d.push({subComp:"symbols",extractData:function(e){return e._runtime.data[r.compName].values.value[0].items.find((function(e){return"legend-entry"===e.role})).items[0].items[0].items.map((function(e){return e.items.find((function(e){return"legend-symbol"===e.role})).items[0]}))},identifyDatum:function(e){return e.datum.value.toString()}})):console.error("Cannot enumerate the changes when the legend type changes.");r.enumerator=d.reduce((function(e,n){var i=new zr(r.enumerator,a.spec,t);return i.joinData(n.extractData,n.identifyDatum),e[n.subComp]=i,e}),{})}}))})),e}function En(e){var t=e.baseline,a=wn(e);switch(t){case"top":return.79*a;case"middle":return.3*a;case"bottom":return-.21*a;case"line-top":return.29*a+.5*kn(e);case"line-bottom":return.29*a-.5*kn(e);default:return 0}}function wn(e){return null!=e.fontSize?+e.fontSize||0:11}function kn(e){return null!=e.lineHeight?e.lineHeight:wn(e)+2}function An(e){switch(e){case"font":return"font-family";case"fontSize":return"font-size";case"fontStyle":return"font-style";case"fontVariant":return"font-variant";case"fontWeight":return"font-weight";case"strokeWidth":return"stroke-width"}return e}function Dn(e){return"translate(".concat(e.x||0,", ").concat(e.y||0,")").concat(e.angle?" rotate(".concat(e.angle,")"):"")}var On={M:["x","y"],L:["x","y"],H:["x"],V:["y"],C:["x1","y1","x2","y2","x","y"],S:["x2","y2","x","y"],Q:["x1","y1","x","y"],T:["x","y"],A:["rx","ry","xAxisRotation","largeArcFlag","sweepFlag","x","y"]};function jn(e){var t=(e=e.trim().replace(/ /g,","))[0],a=e.substring(1).split(",");return On[t.toUpperCase()].reduce((function(e,t,r){return e[t]=["x","y"].indexOf(t)>=0?parseFloat(a[r]):a[r],e}),{type:t})}function Sn(e){var t=e.type,a=On[t.toUpperCase()];return"".concat(t).concat(a.map((function(t){return e[t]})).join(","))}function Pn(e,t){var a={x1:"x",y1:"y",x2:"x",y2:"y"},r=["xAxisRotation","largeArcFlag","sweepFlag"];if(e.type!==t.type&&"M"!==t.type.toUpperCase()){var n={};Object.keys(t).forEach((function(i){var o=t[i],s=e[i];void 0===s&&(r.includes(i)?s=o:(void 0===s&&a[i]&&(s=e[a[i]]),void 0===s&&(s=0))),n[i]=s})),n.type=t.type,e=n}return e}function Fn(e,t,a){var r;r=e.length>1&&"M"===e[0].type?1:0;for(var n=t.reduce((function(t,a,n){if(0===n&&"M"===a.type)return t[0]=1,t;for(var i=Math.abs(e[r].x-a.x),o=r,s=r+1;s<e.length;s++){var u=Math.abs(e[s].x-a.x);if(!(u<i))break;i=u,o=s}return t[o]=(t[o]||0)+1,t}),{}),i=[],o=0,s=0;s<e.length;s++){i.push(e[s]);for(var u=1;u<n[s]&&o<a;u++){var l=Object.assign({},e[s]);"M"===l.type?l.type="L":(void 0!==l.x1&&(l.x1=l.x,l.y1=l.y),void 0!==l.x2&&(l.x2=l.x,l.y2=l.y)),i.push(l),o+=1}}return i}function Cn(e,t,a){var n,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"x";n=e.length>1&&"M"===e[0].type?1:0;for(var o="x"===i?["x","y"]:["y","x"],s=Object(r.a)(o,2),u=s[0],l=s[1],c=t.reduce((function(t,a,r){if(0===r&&"M"===a.type)return t[0]=1,t;for(var i=Math.abs(e[n][u]-a[u]),o=Math.abs(e[n][l]-a[l]),s=n,c=n+1;c<e.length;c++){var f=Math.abs(e[c][u]-a[u]),d=Math.abs(e[c][l]-a[l]);if(f<i)i=f,s=c,o=d;else{if(f!==i)break;d<o&&(s=c,o=d)}}return t[s]=(t[s]||0)+1,t}),{}),f=[],d=0,p=0;p<e.length;p++){f.push(e[p]);for(var m=1;m<c[p]&&d<a;m++){var h=Object.assign({},e[p]);"M"===h.type?h.type="L":(void 0!==h.x1&&(h.x1=h.x,h.y1=h.y),void 0!==h.x2&&(h.x2=h.x,h.y2=h.y)),f.push(h),d+=1}}return f}function Bn(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"x",r=null==e?"":e.replace(/[Z]/gi,"").replace(/([MLCSTQAHV])\s*/gi,"$1"),n=null==t?"":t.replace(/[Z]/gi,"").replace(/([MLCSTQAHV])\s*/gi,"$1"),i=""===r?[]:r.split(/(?=[MLCSTQAHV])/gi),o=""===n?[]:n.split(/(?=[MLCSTQAHV])/gi);if(!i.length&&!o.length)return function(){return""};i.length?o.length||o.push(i[0]):i.push(o[0]);var s=i.map(jn),u=o.map(jn),l=Math.abs(o.length-i.length);0!==l&&(u.length>s.length?s=Cn(s,u,l,a):u.length<s.length&&(u=Cn(u,s,l,a)));var c=(s=s.map((function(e,t){return Pn(e,u[t])}))).map(Sn).join(""),f=u.map(Sn).join("");null!=e&&"Z"!==e[e.length-1]||null!=t&&"Z"!==t[t.length-1]||(c+="Z",f+="Z");var d=Object(p.interpolateString)(c,f);return function(e){return 1===e?null==t?"":t:d(e)}}function Tn(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"x",r=null==e?"":e.replace(/[Z]/gi,"").replace(/([MLCSTQAHV])\s*/gi,"$1"),n=null==t?"":t.replace(/[Z]/gi,"").replace(/([MLCSTQAHV])\s*/gi,"$1"),i=""===r?[]:r.split(/(?=[MLCSTQAHV])/gi),o=""===n?[]:n.split(/(?=[MLCSTQAHV])/gi);if(!i.length&&!o.length)return function(){return""};i.length?o.length||o.push(i[0]):i.push(o[0]);var s=i.map(jn),u=o.map(jn),l=!1;null!=e&&"Z"!==e[e.length-1]||null!=t&&"Z"!==t[t.length-1]||(l=!0);var c=Object(p.extent)(s,(function(e){return e[a]})),f=Object(p.extent)(u,(function(e){return e[a]}));if("x"===a){var d=s.findIndex((function(e){return e[a]===c[1]})),m=u.findIndex((function(e){return e[a]===f[1]})),h=s.slice(0,d+1),v=u.slice(0,m+1),y=s.slice(d+1).reverse(),g=u.slice(m+1).reverse(),b=y.length>0&&g.length>0;return function(e){return 1===e?null===t?"":t:j(h,v,c,f)(e)+(b?j(y,g,c,f,!0,!0)(e):"")+(l?"Z":"")}}var x=s.findIndex((function(e){return e[a]===c[0]})),E=u.findIndex((function(e){return e[a]===f[0]})),w=s.slice(0,x+1).reverse(),k=u.slice(0,E+1).reverse(),A=s.slice(x+1),D=u.slice(E+1),O=A.length>0&&D.length>0;return function(e){return 1===e?null===t?"":t:j(w,k,c,f,!0)(e)+(O?j(A,D,c,f,!1,!0)(e):"")+(l?"Z":"")};function j(e,t,r,n,i){var o,s,u,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(r[1]<n[0]||r[0]>n[1])u=S(e,t,i);else{if(r[1]>n[1]){var c=e.findIndex((function(e){return e[a]>n[1]}));o=P(e.slice(c-1),i,!0,l)}else if(r[1]<n[1]){var f=t.findIndex((function(e){return e[a]>r[1]}));o=P(t.slice(f-1),i,!1,l)}if(r[0]<n[0]){var d=e.findIndex((function(e){return e[a]>=n[0]}));s=F(e.slice(0,d+1),i,!0,l)}else if(r[0]>n[0]){var p=t.findIndex((function(e){return e[a]>=r[0]}));s=F(t.slice(0,p+1),i,!1,l)}var m=Math.max(r[0],n[0]),h=Math.min(r[1],n[1]);u=S(e.filter((function(e){return e[a]>=m&&e[a]<=h})),t.filter((function(e){return e[a]>=m&&e[a]<=h})),i,!l&&(i&&!o||!i&&!s))}return i?function(e){return(o?o(e):"")+u(e)+(s?s(e):"")}:function(e){return(s?s(e):"")+u(e)+(o?o(e):"")}}function S(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=Math.abs(t.length-e.length);if(e.length<=1&&t.length<=1)return function(e){return""};0!==n&&(t.length>e.length?e=Fn(e,t,n):t.length<e.length&&(t=Fn(t,e,n))),e=e.map((function(e,a){return Pn(e,t[a])})),e=a?e.reverse():e,t=a?t.reverse():t,r&&(e[0]=Object.assign({},e[0],{type:"M"}),t[0]=Object.assign({},t[0],{type:"M"}));var i=e.map(Sn).join(""),o=t.map(Sn).join(""),s=Object(p.interpolateString)(i,o);return function(e){return 1===e?null==o?"":o:s(e)}}function P(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=e.map(Sn).join(""),i=e.length,o=[],s=function(a){var n=e.slice(0,a).concat([e[a-1]]),i=e.slice(0,a+1);n=t?n.reverse():n,i=t?i.reverse():i;var s=n.map(Sn).join(""),u=i.map(Sn).join("");t&&!r&&(n[0]=Object.assign({},n[0],{type:"M"}),i[0]=Object.assign({},i[0],{type:"M"})),o.push((function(e){return Object(p.interpolateString)(s,u)(e)}))},u=1;u<=i-1;u++)s(u);return function(e){if(a&&(e=1-e),1===e)return null==n?"":n;var t=Math.floor(e*(i-1));return o[t](e*(i-1)-t)}}function F(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=e.map(Sn).join(""),i=e.length,o=[],s=function(a){var n=[e[i-a]].concat(e.slice(i-a,i)),s=e.slice(i-a-1,i);n=t?n.reverse():n,s=t?s.reverse():s,t||r||(n[0]=Object.assign({},n[0],{type:"M"}),s[0]=Object.assign({},s[0],{type:"M"}));var u=n.map(Sn).join(""),l=s.map(Sn).join("");o.push((function(e){return Object(p.interpolateString)(u,l)(e)}))},u=1;u<i;u++)s(u);return function(e){if(a&&(e=1-e),1===e)return null==n?"":n;var t=Math.floor(e*(i-1));return o[t](e*(i-1)-t)}}}function _n(e,t,a,r,n,i){var o=r.initial||n||Object(p.select)(this).datum(),s=r.final||r,u=t.initial||t,l=t.final||t,c={primary:e.initial||e,secondary:e.final||e},f={primary:e.final||e,secondary:e.initial||e},d=a.initial||a,m=a.final||a;return Bn(i(o,c,u,d).path,i(s,f,l,m).path)}function Nn(e,t,a,r,n,i){var o,s,u,l,c=r.initial||n||Object(p.select)(this).datum(),f=r.final||r,d=t.initial||t,m=t.final||t,h=e.initial||e,v=e.final||e,y=a.initial||a,g=a.final||a,b=!1;return o=i(c,h,d,y),s=i(f,v,m,g),o.meta.shape!==s.meta.shape&&(b=!0,u=i(c,h,d,y,!0),l=i(f,v,m,g,!0)),b?function(e){return e<.5?Bn(o.path,u.path)(2*e):Bn(l.path,s.path)(2*(e-.5))}:Bn(o.path,s.path)}function In(e,t,a,r,n,i,o,s,u){var l=t.initial||t,c=t.final||t,f=a.initial||a,d=a.final||a,p=e.initial||e,m=e.final||e,h=i.initial||i,v=i.final||i,y=r.initial||n,g=r.final||r,b=u.initial||u,x=u.final||u,E=o(Rn(y),p,l,h,f,b),w=o(Rn(y),m,l,h,f,b),k=o(Rn(g),p,c,v,d,x),A=o(Rn(g),m,c,v,d,x);if(Ln(E)&&Ln(w)&&Ln(k)&&Ln(A)){var D=Bn(E,w,b),O=Bn(k,A,x),j="update"===s?Tn:Bn;return function(e){return j(D(e),O(e),b)(e)}}return("update"===s?Tn:Bn)(E,A,b)}function Mn(e,t,a,r,n,i,o,s){var u="string"===typeof a?a:void 0;if("line"===u){return function(e,t,a,r,n,i,o){var s,u,l,c=Date.now(),f=r.initial&&r.final?r:{initial:r,final:r},d=function(e){return i(f.initial,e)},p=function(e){return i(f.final,e)},m=e.length,h=t.length,v=t.findIndex((function(t){return p(t)===d(e[0])})),y=t.findIndex((function(t){return p(t)===d(e[m-1])}));v>=0?y>=0?y<v?l=zn(e,t,a,f,n,o):(u=Vn(t.slice(0,v+1),!1,a,f,n,o),l=zn(e,t.slice(v,y+1),a,f,n,o,!1),s=$n(t.slice(y),!1,a,f,n,o)):(y=e.findIndex((function(e){return d(e)===p(t[h-1])})))>=0?(u=Vn(t.slice(0,v+1),!1,a,f,n,o),l=zn(e.slice(0,y+1),t.slice(v),a,f,n,o,!1),s=$n(e.slice(y),!0,a,f,n,o)):l=zn(e,t,a,f,n,o):y>=0?(v=e.findIndex((function(e){return d(e)===p(t[0])})))>=0?(u=Vn(e.slice(0,v+1),!0,a,f,n,o),l=zn(e.slice(v),t.slice(0,y+1),a,f,n,o,!1),s=$n(t.slice(y),!1,a,f,n,o)):l=zn(e,t,a,f,n,o):(v=e.findIndex((function(e){return d(e)===p(t[0])})),y=e.findIndex((function(e){return d(e)===p(t[h-1])})),v>=0&&y>=0?(u=Vn(e.slice(0,v+1),!0,a,f,n,o),l=zn(e.slice(v,y+1),t,a,f,n,o,!1),s=$n(e.slice(y),!0,a,f,n,o)):l=zn(e,t,a,f,n,o));if(console.log(Date.now()-c),s&&u&&l)return function(e){return 1===e?o(t,a.final,f.final,n.final):u(e)+l(e)+s(e)};return function(e){return 1===e?o(t,a.final,f.final,n.final):l(e)}}(Rn(r.initial||n),Rn(r.final||r),e,t,i,(function(e,t){return t?[t.datum[e.x.field],t.datum[e.y.field]].join(","):void 0}),(function(e,t,a,r){return o(e,t,a,r,"line")}))}if("area"===u||"trail"===u){var l={initial:"horizontal"===k(t,"initial","orient","value")?"y":"x",final:"horizontal"===k(t,"final","orient","value")?"y":"x"};return In.bind(this)(e,t,u,r,n,i,o,s,l)}if("line"===a.initial&&"area"===a.final){var c="horizontal"===k(t,"final","orient","value")?"y":"x";return In.bind(this)(e,t,"area",r,n,i,o,s,c)}var f="horizontal"===k(t,"initial","orient","value")?"y":"x",d=o(Rn(r.final||r),e.final||e,t.final||t,i.final||i,"line"),p=In.bind(this)(e,t,"area",r,n,i,o,s,f);return function(e){return e>=1?d:p(e)}}function Rn(e){if(e)return"group"!==e.mark.marktype?e.mark.items:e.items[0].items}function $n(e,t,a,r,n,i){var o=e.length;if(o<=1)return function(e){return""};var s=["initial","final"].map((function(s){for(var u=[],l=a[s],c=r[s],f=n[s]||n,d=function(t){var a=i(e.slice(0,t+1).concat(e.slice(t,t+1)),l,c,f).replace(/^M/g,"L"),r=i(e.slice(0,t+2),l,c,f).replace(/^M/g,"L");u.push((function(e){return Object(p.interpolateString)(a,r)(e)}))},m=0;m<=o-2;m++)d(m);return function(a){if(t&&(a=1-a),1===a)return i(e,l,c,f);var r=Math.floor(a*(o-1));return u[r](a*(o-1)-r)}}));return function(e){return Object(p.interpolateString)(s[0](e),s[1](e))(e)}}function Vn(e,t,a,r,n,i){var o=e.length;if(o<=1)return function(e){return""};var s=["initial","final"].map((function(s){for(var u=[],l=a[s],c=r[s],f=n[s]||n,d=function(t){var a=i(e.slice(t+1,t+2).concat(e.slice(t+1)),l,c,f).replace(/Z$/g,""),r=i(e.slice(t),l,c,f).replace(/Z$/g,"");u.push((function(e){return Object(p.interpolateString)(a,r)(e)}))},m=o-2;m>=0;m--)d(m);return function(a){if(t&&(a=1-a),1===a)return i(e,l,c,f);var r=Math.floor(a*(o-1));return u[r](a*(o-1)-r)}}));return function(e){return Object(p.interpolateString)(s[0](e),s[1](e))(e)}}function zn(e,t,a,r,n,i,o){var s=["initial","final"].map((function(s){var u=a[s],l=r[s],c=n[s]||n,f=i(e,u,l,c),d=i(t,u,l,c);return o&&(f=f.replace(/^M/g,"L").replace(/Z$/g,""),d=d.replace(/^M/g,"L").replace(/Z$/g,"")),[f,d]}));if(Ln(s[0][0])&&Ln(s[0][1])&&Ln(s[1][0])&&Ln(s[1][0])){var u=Bn(s[0][0],s[0][1]),l=Bn(s[1][0],s[1][1]);return function(e){return Object(p.interpolateString)(u(e),l(e))(e)}}return Object(p.interpolateString)(s[0][0],s[1][1])}function Ln(e){return e.indexOf("NaN")<0}function Un(e,t,a,r,n,i){t.forEach((function(t){Br(t).forEach((function(t){if("attrTween"===t.type)if(e.attrTween)e.attrTween(An(t.val),(function(e){var o=i?i.get(this):void 0;return qn.bind(this)(t,n,a,r,e,o)}));else{var o=Object.assign({},t,{type:"attr"});e.attr(o.val,(function(e){var t=i?i.get(this):void 0;return qn.bind(this)(o,n,a,r,e,t)}))}else"attr"===t.type?e.attr(An(t.val),(function(e){var o=i?i.get(this):void 0;return qn.bind(this)(t,n,a,r,e,o)})):"text"===t.type?e.text((function(e){var o=i?i.get(this):void 0;return qn.bind(this)(t,n,a,r,e,o)})):"style"===t.type&&(t.asTween?e.styleTween(An(t.val),(function(e){var o=i?i.get(this):void 0;return qn.bind(this)(t,n,a,r,e,o)})):e.style(An(t.val),(function(e){var o=i?i.get(this):void 0;return qn.bind(this)(t,n,a,r,e,o)})))}))}))}function qn(e,t,a,r,n,i){var o=this,s=r.final||r,u=t.final||t;if("text"===e.elmType){if("transform"===e.val){var l=Hn.bind(this)(u,a,s,n,!1),c=Kn.bind(this)("dx",u,a,s,n),f=Kn.bind(this)("dy",u,a,s,n);l.x=(l.x||0)+(c||0),l.y=(l.y||0)+(f||0);var m=Kn.bind(this)("baseline",u,a,s,n),h=Kn.bind(this)("fontSize",u,a,s,n);if(i&&i.align!==n.align){var v={right:-.5,center:0,left:.5};l.x+=this.getBBox().width*(v[n.align]-v[i.align])}return"".concat(Dn(l)," ").concat(Dn({y:En(Object.assign({baseline:m,fontSize:h},n))}))}if("text"===e.val)return u.text?Kn.bind(this)("text",u,a,s,n):n.text}else if("title"===e.elmType){if("transform"===e.val){var y=Hn.bind(this)(u,a,s,n),g=Kn.bind(this)("dx",u,a,s,n),b=Kn.bind(this)("dy",u,a,s,n);y.x=(y.x||0)+(g||0),y.y=(y.y||0)+(b||0);var x=Kn.bind(this)("baseline",u,a,s,n),E=Kn.bind(this)("fontSize",u,a,s,n);return"".concat(Dn(y)," ").concat(Dn({y:En(Object.assign({baseline:x,fontSize:E},n))}))}if("text"===e.val)return u.text?Kn.bind(this)("text",u,a,s,n):n.text}else if("tick"===e.elmType||"grid"===e.elmType||"domain"===e.elmType){if("transform"===e.val){var w=Hn.bind(this)(u,a,s,n,!1);w=0===Object.keys(w).length?n:w;var A=Kn.bind(this)("x2",u,a,s,n),O=Kn.bind(this)("y2",u,a,s,n);return i&&(0===A&&(i.y2-i.y)*O<0?w.y+=O:0===O&&(i.x2-i.x)*A<0&&(w.x+=A)),Dn(0===Object.keys(w).length?n:w)}if("x2"===e.val){var j=Kn.bind(this)("x2",u,a,s,n);return isNaN(j)?n.x2-n.x:(i&&(i.x2-i.x)*j<0&&(j=-j),isNaN(j)?n.x2-n.x:j)}if("y2"===e.val){var S=Kn.bind(this)("y2",u,a,s,n);return isNaN(S)?n.y2-n.y:(i&&(i.y2-i.y)*S<0&&(S=-S),S)}}else if("rect"===e.elmType){if("transform"===e.val)return"";if("d"===e.val)return"attrTween"===e.type?_n.bind(this)(a,t,r,n,i,Z):Z(n,a,t,s).path}else if("symbol"===e.elmType){if("d"===e.val)return"attrTween"===e.type?Nn.bind(this)(a,t,r,n,i,G):G(n,a,u,s).path;if("transform"===e.val){var P=Hn.bind(this)(u,a,s,n,!1);return Dn(0===Object.keys(P).length?n:P)}}else if("gradient"===e.elmType){if("d"===e.val){var F,C,B,T,_=Object.keys(u.primary||u).filter((function(e){return["x","x2","xc","width","y","y2","yc","height"].indexOf(e)>=0})).reduce((function(e,t){return e[t]=Kn.bind(o)(t,u,a,s,n),e}),{});return F=isNaN(_.x)?isNaN(_.xc-_.width/2)?_.x2:_.xc-_.width/2:_.x,B=isNaN(_.width)?isNaN(_.x2-_.x)?void 0:_.x2-_.x:_.width,isNaN(_.y2)||isNaN(_.y)?(C=isNaN(_.y)?_.y2:_.y,T=_.height):(C=Math.min(_.y2,_.y),T=Math.abs(_.y2-_.y)),Object(d.d)().x(F).y(C).width(B).height(T)()}if("transform"===e.val){var N=Hn.bind(this)(u,a,s,n,!1);return Dn(0===Object.keys(N).length?n:N)}if("fill"===e.val&&e.defs&&!e.isUpdate){var I=e.defs(Object(p.select)(this.closest("svg")),n);return'url("'.concat(I,'")')}}else if("rule"===e.elmType){if("transform"===e.val){var M=Hn.bind(this)(u,a,s,n,!1);return Dn(0===Object.keys(M).length?n:M)}if("x2"===e.val){var R=Kn.bind(this)("x2",u,a,s,n),$=Kn.bind(this)("x",u,a,s,n);return D(R-$)?R-$:n.x2||0}if("y2"===e.val){var V=Kn.bind(this)("y2",u,a,s,n),z=Kn.bind(this)("y",u,a,s,n);return D(V-z)?V-z:n.y2||0}}else if("group"===e.elmType){if("transform"===e.val){var L=Hn.bind(this)(u,a,s,n);return Dn(0===Object.keys(L).length?n:L)}}else if("background"===e.elmType){if("d"===e.val){var U={x:Kn.bind(this)("x",u,a,s,n)||0,y:Kn.bind(this)("y",u,a,s,n)||0,height:Kn.bind(this)("height",u,a,s,n),width:Kn.bind(this)("width",u,a,s,n)};return Object(d.d)().x(U.x).y(U.y).width(U.width).height(U.height)()}}else if(_r(e.elmType)){if("d"===e.val){if("attrTween"===e.type){var q=e.initialMarktype?{initial:e.initialMarktype,final:e.elmType}:e.elmType;return Mn.bind(this)(a,t,q,n,i,r,Y.bind(this),e.interpolateStyle)}return Y.bind(this)(Rn(n),a,u,s,e.elmType)}if("fill"===e.val&&e.asTween){var H=function(e){return Kn.bind(o)("fill",e,a,s,"group"!==n.mark.marktype?{datum:{}}:n)};if("area"===e.initialMarktype&&"line"===e.elmType){var K=H({fill:(t.initial||u).fill});return function(e){return e>=1?"none":K}}var W=H(u);return function(e){return W}}if("stroke"===e.val&&"line"===e.initialMarktype&&"area"===e.elmType){var Q={stroke:u.stroke||u.fill};return Kn.bind(this)("stroke",Q,a,s,"group"!==n.mark.marktype?{datum:{}}:n)}if(J(u,e))return Kn.bind(this)(e.val,u,a,s,"group"!==n.mark.marktype?{datum:{}}:n)+("strokeWidth"===e.val?"px":"")}if("text-anchor"===e.val){return{left:"start",center:"middle",right:"end"}[(i?i.align:n.align)||Kn.bind(this)("align",u,a,s,n)]}return J(u,e)?Kn.bind(this)(e.val,t,a,s,n):"text"===e.elmType&&"opacity"===e.val?n[e.val]:lr[e.elmType][e.val];function J(e,t){return k(e,"primary",t.val)||k(e,"secondary",t.val)||k(e,t.val)}function Z(e,t,a,r,n){var i,o,s,u,l,c=this,f=a.primary||a,p=a.secondary||a,m=["x","x2","xc","width","y","y2","yc","height","cornerRadius"].reduce((function(n,i){return(f[i]||p[i])&&(n[i]=Kn.bind(c)(i,a,t,r,e,!1)),n}),{});return D(m.xc)&&D(m.width)?(i=m.xc-m.width/2,s=m.width):D(m.x)&&D(m.x2)?(i=Math.min(m.x,m.x2),s=Math.abs(m.x-m.x2)):(i=D(m.x)?m.x:m.x2,s=m.width),D(m.yc)&&D(m.height)?(o=m.yc-m.height/2,u=m.height):D(m.y2)&&D(m.y)?(o=Math.min(m.y2,m.y),u=Math.abs(m.y2-m.y)):(o=D(m.y)?m.y:m.y2,u=m.height),l=D(m.cornerRadius)?m.cornerRadius:0,n?{path:Object(d.d)().x(0).y(0).width(1).height(1)(),meta:m}:{path:Object(d.d)().x(i).y(o).width(s).height(u).cornerRadius(l)(),meta:m}}function G(e,t,a,r){var n=this,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=a.primary||a,s=Object.keys(o).filter((function(e){return["size","shape"].indexOf(e)>=0})).reduce((function(i,o){return i[o]=Kn.bind(n)(o,a,t,r,e),i}),{}),u=Object(p.path)();return s={shape:s.shape||"circle",size:D(s.size)?s.size:D(e.size)?e.size:30},Object(d.e)(s.shape).draw(u,i?1:s.size),{path:u.toString(),meta:s}}function Y(e,t,a,r,n){var i=this,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"x",s=a.primary||a,u=e.map((function(e){var n=Object.keys(s).filter((function(e){return["x","x2","xc","width","y","y2","yc","height","size"].indexOf(e)>=0})).reduce((function(n,o){var u=Kn.bind(i)(o,a,t,r,e);return D(u)?(n[o]=u,t[o]&&"band"===t[o].type&&(n[o]+=Math.round(t[o].bandwidth()*(s.bandPosition||.5))),n):n}),{});return n.height=D(n.height)?n.height:Math.abs(n.y2-n.y),n.width=D(n.width)?n.width:Math.abs(n.x2-n.x),Object.assign(n)}));return"line"===n?Object(p.line)().x((function(e){return Math.floor(100*e.x)/100})).y((function(e){return Math.floor(100*e.y)/100}))(u)||"":"area"===n?"x"===o?(u.forEach((function(e){e.y2=D(e.y2)?e.y2:e.y})),Object(p.area)().x((function(e){return Math.floor(100*e.x)/100})).y1((function(e){return Math.floor(100*Math.min(e.y,e.y2))/100})).y0((function(e){return Math.floor(100*(Math.min(e.y,e.y2)+(e.height||0)))/100}))(u)||""):(u.forEach((function(e){e.x2=D(e.x2)?e.x2:e.x})),Object(p.area)().y((function(e){return Math.floor(100*e.y)/100})).x1((function(e){return Math.floor(100*Math.min(e.x,e.x2))/100})).x0((function(e){return Math.floor(100*(Math.min(e.x,e.x2)+(e.width||0)))/100}))(u)||""):"trail"===n?Object(d.f)().x((function(e){return e.x})).y((function(e){return e.y})).size((function(e){return D(e.size)?e.size:2})).defined((function(e){return e.defined||!0}))(u):void 0}}function Hn(e,t,a,r){var n=this,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=e.primary||e;return Object.assign({},Object.keys(o).filter((function(e){return["x","y","angle","yc","xc"].indexOf(e)>=0})).reduce((function(i,o){var s=Kn.bind(n)(o,e,t,a,r),u=o;return isNaN(s)||("xc"===o?u="x":"yc"===o&&(u="y"),i[u]=isNaN(i[u])?s:i[u]),i}),{}),i?r:{})}function Kn(e,t,a,r,n){var i=b(a);a.primary&&a.secondary?(i=a.secondary,a=a.primary):a.initial&&a.final&&(a=a.final);var o=g(t),s=g(t);t.primary&&t.secondary?(o=t.primary,s=t.secondary):t.initial&&t.final&&(s=o=t.final);var u=o[e],l=s[e];function c(e,t){if(e){if(Array.isArray(e)){for(var a=0;a<e.length-1;a++)if(Wn(e[a].test,r,t,n.datum))return e[a].value;e=g(e[e.length-1])}var i=e.value;if(e.field)if(e.scale){var o=e.scale;i=t[o]?t[o](n.datum[e.field]):void 0}else{if(e.field.group)return n.mark.group[e.field.group];i=n.datum[e.field]}if(e.signal){var s=Wn(e.signal,r,t,n.datum);if(e.scale){var u=e.scale;i=t[u]?t[u](s):void 0}else i=s}if(e.scale){var l=e.scale;if(void 0!==e.value&&(i=t[l]?t[l](e.value):void 0),e.band){var c=t[l],f=c&&"band"===c.type?c.bandwidth():0;f=Math.round(f*(!0===e.band||D(e.band)?e.band:.5)),i=D(i)?f+i:f}}return e.exp&&console.error("Todo decodeEncdoe with exp."),e.mult&&(D(e.mult)?i*=e.mult:i*=Kn("mult",{mult:e.mult},t,r,n)),e.offset&&(D(e.offset)?i+=e.offset:i+=Kn("offset",{offset:e.offset},t,r,n)),i}}var f=c(u,a),d=c(l,i);return void 0!==f?f:d}function Wn(e,t,a,r){var i=[{name:"scale",fn:function(e,t){return a[e]?a[e](t):void 0}},{name:"isValid",fn:function(e){return null!==e&&e===e}},{name:"timeFormat",fn:function(e,t){return Object(d.i)(t)(e)}},{name:"timeUnitSpecifier",fn:function(e,t){return Object(d.j)(e,t)}}],o=sr({whitelist:["datum"].concat(Object.keys(t||{})),globalvar:"global"});i.forEach((function(e){o.functions[e.name]=e.name}));var s=i.map((function(e){return e.fn})),u=i.map((function(e){return e.name})),l=o(Qa(e));return Function.apply(void 0,["datum"].concat(Object(n.a)(Object.keys(t||{})),Object(n.a)(u),["return (".concat(l.code,")")])).apply(void 0,[r].concat(Object(n.a)(Object.keys(t||{}).map((function(e){return t[e]}))),Object(n.a)(s)))}var Qn={ascending:p.ascending,descending:p.descending};function Jn(e,t){return e&&t?function(e,a){return Qn[t](Number(e),Number(a))}:Qn[t]}function Zn(e,t,a){var r,n,o=t.map((function(e,t){return Object(i.a)({},e,{__staggering_id__:t})})),s=e.staggering,u=e.by&&o.reduce((function(t,a){var r;if("string"===typeof e.by)r=(a.initial||a.final)[e.by];else if(e.by.initial||e.by.final){var n=e.by.initial?"initial":"final";r=("initial"===n?a.initial||a.final:a.final||a.initial)[e.by[n]]}return t&&(void 0===r||!isNaN(Number(r)))}),!0);if(e.by){if("string"===typeof e.by)n=Object(p.nest)().key((function(t){var a=(t.initial||t.final)[e.by];return void 0===a?"__empty__":a})).sortKeys(Jn(u,e.order)).entries(o);else if(e.by.initial||e.by.final){var l=e.by.initial?"initial":"final";n=Object(p.nest)().key((function(t){var a=("initial"===l?t.initial||t.final:t.final||t.initial)[e.by[l]];return void 0===a?"__empty__":a})).sortKeys(Jn(u,e.order)).entries(o)}}else n=Object(p.nest)().key((function(e){var t=e.__staggering_id__;return void 0===t?"__empty__":t})).sortKeys(Jn(!0,e.order)).entries(o);r=n.length;var c=Or(e.ease||"linear")||p.easeLinear,f=void 0===e.overlap?1:e.overlap,d=function(e){return c((e+1)/r)-c(e/r)},m=1/(d(0)*f+1-f),h=new Array(r).fill(0);h=h.map((function(e,t){return d(t)*m*a}));var v=0,y=h.map((function(e,t,a){var n=v;return t<r-1&&(v=v+e-a[t+1]*f),n}));if(s){var g=y.map((function(e,t){return{delay:e,duration:h[t]}}));return g.groups=n.map((function(e,t){return Zn(s,e.values,h[t])})),function e(t){if(!t.groups)return t;return x(t.map((function(a,r){return e(t.groups[r]).map((function(e){return Object.assign({},e,{delay:e.delay+a.delay})}))})))}(g)}return n.forEach((function(e,t){e.values.forEach((function(e){e.delay=y[t],e.duration=h[t]}))})),o}function Gn(e,t,a,r,n){var i=e.map((function(e,n){var i=r(e,n,"initial"),o=t.find((function(e,t){return i===r(e,t,"final")}));return{initial:e.datum,final:o?o.datum:null,set:o?"update":"exit",id:i,duration:a.duration,delay:a.delay}}));return i=i.concat(t.filter((function(e){return"enter"===n(e)})).map((function(e,t){var n=r(e,t,"final");return{initial:null,final:e.datum,set:"enter",id:n,duration:a.duration,delay:a.delay}}))),a.staggering&&(i=Zn(a.staggering,i,a.duration)),i}function Yn(e,t){var a=e.allKeys.map((function(a,r){for(var n=e.getDatum(a,0),i=e.getDatum(a,0),o=1;o<e.stopN;o++)n=n||e.getDatum(a,0),i=e.getDatum(a,o)||i;return{initial:n,final:i,set:"update",id:r,key:a,duration:t.duration,delay:t.delay}}));return t.staggering&&(a=Zn(t.staggering,a,t.duration)),a=a.sort((function(e,t){return e.id-t.id}))}function Xn(e){switch(e){case"rect":case"symbol":return"path";case"rule":return"line";case"text":return"text"}}function ei(e,t,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return r.hasGroup?e.insert("g",a).attr("class","mark-group role-scope ".concat(t.parent.name)):e.insert("g",a).attr("class","mark-".concat(t.type," role-mark ").concat(t.name))}var ti={update:!1,enter:!1,exit:!1};var ai=["fill","opacity","shape","size","stroke","strokeDash","strokeWidth"],ri={update:!1,enter:!1,exit:!1};var ni={legend:function(e,t,a){function r(e){return function(a,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"initial";return a?a.__gemini__?Sr(a,0,t,"joinKey"):"function"===typeof t.computeDatumId[e]?t.computeDatumId[e](a,r):t.computeDatumId[e][n](a,r):r.toString()}}var n=function(e,a){return e.__gemini__?Sr(e,0,t,"animSet"):void 0},i=e.eVis.view;return new Promise((function(e){var o,s,u,l,c=t.change,f=Or(t.timing.ease);o=s=u=l=!0,!1===c.encode?o=s=u=l=!1:c.encode&&(o=!(!1===c.encode.title),s=!(!1===c.encode.symbols),u=!(!1===c.encode.labels),l=!(!1===c.encode.gradient));var d=t.isRemove,m=t.isAdd,h=Object(p.select)("".concat(a," .role-legend.").concat(c.compName)),v=function(e,t,a){var r=e.reduce((function(e,t){return e[t]=g(ri),e}),{});return function(e,n){if(2===e.length?"all"===e[1]?r[e[0]].update=r[e[0]].enter=r[e[0]].exit=!0:r[e[0]][e[1]]=!0:"all"===e?r.update=r.enter=r.exit=!0:r[e]=!0,["title","labels","symbols","pairs","entries","legend"].reduce((function(e,t){return e&&r[t].update&&r[t].enter&&r[t].exit}),!0)||["title","labels","gradient","bands","entries","legend"].reduce((function(e,t){return e&&r[t].update&&r[t].enter&&r[t].exit}),!0)){if(t.final)if("gradient"===t.final)a.selectAll(".mark-group.role-scope").remove();else{var i=a.select(".role-legend-entry > g > g");a.select(".role-legend-entry > g > g > .mark-text.role-legend-label").remove(),i.select(".mark-text.role-legend-band").remove(),i.select(".mark-text.role-legend-gradient").remove()}n()}}}(["entries","title","labels","gradient","symbols","legend","pairs","bands"],t.legendTypes,h),y=c.compName,b=t.scales,x=t.signals,E=t.encodes,w=t.legendTypes;if(m){var k=Object(p.select)("".concat(a," .mark-group.root g g ")),A=i.scenegraph().root,D=jr(A,c.compName);!function(e,t){var a=t.name,r=Fr(t).getElementsByClassName("role-legend")[0];e.node().appendChild(r);var n=t.items[0].datum;n.title&&e.select(".".concat(a," .role-legend-title text")).remove();"symbol"===n.type?e.selectAll(".".concat(a," .role-legend-entry .role-scope > g")).remove():(e.selectAll(".".concat(a," .role-legend-entry .role-legend-label > text")).remove(),e.selectAll(".".concat(a," .role-legend-entry .role-legend-gradient > path")).remove(),e.selectAll(".".concat(a," .role-legend-entry .role-legend-band > path")).remove())}(k,Pr(A,c.compName,"legend")[0],D&&".".concat(D.name)),h=Object(p.selectAll)("".concat(a," .role-legend.").concat(c.compName)),v(["legend","all"],(function(){return e()})),v(["entries","all"],(function(){return e()}))}else if(d){var O=c.encode&&c.encode.legend?c.encode.legend.exit:{},j=h.select("g").transition();Un(j,["group"],b.final,x.final,Object.assign({},t.encodes.legend.final.exit,O)),j.duration(t.duration).end().then((function(){v(["legend","all"],(function(){return e()})),v(["entries","all"],(function(){return e()}))}))}else{var S=Pr(i.scenegraph().root,y,"legend")[0].items[0],P={x:{value:S.x},y:{value:S.y}},F=h.select("g"),C=[i._runtime.data[y].values.value[0].datum];F.data(C);var B=F.transition();Un(B,["group"],b.final,x.final,Object.assign({},t.encodes.legend.update,P)),B.duration(t.duration).end().then((function(){v(["legend","all"],(function(){return e()})),v(["entries","all"],(function(){return e()}))}))}var T={initial:[],final:[]};ai.forEach((function(e){c.initial&&c.initial[e]&&T.initial.push(c.initial[e]),c.final&&c.final[e]&&T.final.push(c.final[e])}));var _=[];if(!0===c.scale||m?_=T.final:Array.isArray(c.scale)?_=c.scale:"object"===typeof c.scale&&(_=Object.keys(c.scale).filter((function(e){return c.scale[e]}))),t.enumerator){var N;if(w.initial!==w.final&&console.error("Cannot enumerate the change of the legend type."),"symbol"===(w.initial||w.final)){var I=h.select(".role-legend-entry .role-scope").selectAll(".role-scope > g").data(t.enumerator.pairs.allKeys,(function(e){return e}));I.exit().remove();var M=I.enter().append("g").append("g");M.append("g").attr("class","mark-symbol role-legend-symbol").append("path").datum((function(e,a){return t.enumerator.symbols.allKeys[a]})),M.append("g").attr("class","mark-text role-legend-label").append("text").datum((function(e,a){return t.enumerator.labels.allKeys[a]})),N=[{name:"pairs",selection:h.select(".role-legend-entry .role-scope").selectAll(".role-scope > g"),props:["group"]},{name:"symbols",selection:h.select(".role-legend-entry .role-scope").selectAll(".role-legend-symbol > path"),props:["symbol"]},{name:"labels",selection:h.select(".role-legend-entry .role-scope").selectAll(".role-legend-label > text"),props:["text"]}]}else{var R=h.select(".role-legend-label").selectAll("text").data(t.enumerator.labels.allKeys,(function(e){return e}));if(R.exit().remove(),R.enter().append("text"),N=[{name:"labels",selection:h.select(".role-legend-label").selectAll("text"),svgElmType:"text",props:["text"]}],t.change.initial.isBand){var $=h.select(".role-legend-band ").selectAll("path").data(t.enumerator.bands.allKeys,(function(e){return e}));$.exit().remove(),$.enter().append("path"),N.push({name:"bands",selection:h.select(".role-legend-band ").selectAll("path"),svgElmType:"path",props:["rect"]})}else v(["bands","all"],(function(){e()}));v(["gradient","all"],(function(){e()}))}N.forEach((function(a){var r=t.enumerator[a.name],n=function(e,t,a,r,n){return{update:{initial:function(i,o,s){var u=r(t,n,o);return qn(i,e.initial.update,u.initial,a.initial,s)},final:function(i,o,s){var u=r(t,n,o);return qn(i,e.final.update,u.final,a.final,s)},custom:function(i,o,s,u){var l={initial:s,final:u},c=r(t,n,o);return qn.bind(this)(i,e.final.update,c,a.final,l)}},enter:{initial:function(i,o,s){var u=r(t,n,o);return qn(i,e.initial.enter,{primary:u.initial,secondary:u.final},a.initial,s)},final:function(i,o,s){var u=r(t,n,o);return qn(i,e.final.enter,u.final,a.final,s)},custom:function(i,o,s,u){var l={initial:s,final:u},c=r(t,n,o);return qn.bind(this)(i,e.final.enter,c,a.final,l)}},exit:{initial:function(i,o,s){var u=r(t,n,o);return qn(i,e.initial.exit,u.initial,a.initial,s)},final:function(i,o,s){var u=r(t,n,o);return qn(i,e.final.exit,{primary:u.final,secondary:u.initial},a.final,s)},custom:function(i,o,s,u){var l={initial:s,final:u},c=r(t,n,o);return qn.bind(this)(i,e.final.exit,c,a.final,l)}}}}(E[a.name],b,x,Tr,_),i=a.props.reduce((function(e,t){return e.concat(Br(t))}),[]),o=a.selection.filter((function(e){return["update","exit"].indexOf(r.set(e,0))>=0}));i.forEach((function(e){if("attrTween"===e.type){var t=Object.assign({},e,{type:"attr"});o[t.type](An(t.val),(function(e){return r.getPropVal(t,n,0,e)}))}else"text"===e.type?o[e.type]((function(t){return r.getPropVal(e,n,0,t)})):o[e.type](An(e.val),(function(t){return r.getPropVal(e,n,0,t)}))}));var s=a.selection.transition(),u=Yn(r,t.timing);i.forEach((function(e){"attr"===e.type?s.attrTween(e.val,(function(t){return r.interpolateAlongEnumMaker(e,n)(t)})):"attrTween"===e.type?s.attrTween(e.val,(function(t){return r.interpolateAlongEnumMaker(e,n,this)(t)})):"text"===e.type?s.tween("text",(function(t){var a=r.interpolateAlongEnumMaker(e,n)(t);return function(e){this.innerHTML=a(e)}})):"style"===e.type&&s.styleTween(An(e.val),(function(t){return r.interpolateAlongEnumMaker(e,n)(t)}))})),s.duration((function(e,t){return u[t].duration})).delay((function(e,t){return u[t].delay})).ease(f).end().then((function(){v([a.name,"all"],(function(){e()}))}))}))}else{if([w.initial,w.final].indexOf("symbol")>=0&&(s||u)){"symbol"!==w.initial&&h.select(" .role-legend-entry > g > g").append("g").attr("class","mark-group role-scope");var V=h.select(".role-legend-entry .role-scope").selectAll(".role-scope > g"),z={pairs:r("pairs"),symbols:r("symbols"),labels:r("labels")},L="symbol"!==w.final?[]:t.nextData.labels,U="symbol"!==w.initial?[]:t.currData.labels,q={pairs:Gn(t.currData.pairs,t.nextData.pairs,t.timing,z.pairs,n),symbols:Gn(t.currData.symbols,t.nextData.symbols,t.timing,z.symbols,n),labels:Gn(U,L,t.timing,z.labels,n)},H=Object(p.local)();if(V.selectAll(".role-legend-symbol > path").each((function(e){H.set(this,e)})),V=V.data(t.nextData.pairs,(function(e){return z.pairs(e)})),!d&&V.enter().data().length>0){var K=V.enter().append("g"),W=K.append("g"),Q=W.append("g").attr("class","mark-symbol role-legend-symbol").append("path").datum((function(e,a){return t.nextData.symbols[a]})),J=W.append("g").attr("class","mark-text role-legend-label").append("text").datum((function(e,a){return t.nextData.labels[a]})),Z=t.sameDomainDimension?{primary:b.initial,secondary:b.final}:{primary:b.final,secondary:b.initial};Un(K,["group"],Z,x.initial,E.pairs.initial.enter),Un(Q,["symbol"],Z,x.initial,E.symbols.initial.enter),Un(J,["text"],Z,x.initial,E.labels.initial.enter),K.data().length<=0&&(K=V.filter((function(e){return"enter"===n(e)})));var G=K.transition();Un(G,["group"],b.final,x.final,E.pairs.final.enter),G.duration((function(e,t){return q.pairs.find((function(a){return a.id===z.pairs(e,t,"final")})).duration})).delay((function(e,t){return q.pairs.find((function(a){return a.id===z.pairs(e,t,"final")})).delay})).ease(f).end().then(v(["pairs","enter"],(function(){return e()}))),Q.data().length<=0&&(Q=V.selectAll(".role-legend-symbol > path").filter((function(e){return"enter"===n(e)})));var Y=Q.transition();Un(Y,["symbol"],b,x.final,E.symbols.final.enter),Y.duration((function(e,t){return q.symbols.find((function(a){return a.id===z.symbols(e,t,"final")})).duration})).delay((function(e,t){return q.symbols.find((function(a){return a.id===z.symbols(e,t,"final")})).delay})).ease(f).end().then(v(["symbols","enter"],(function(){return e()}))),J.data().length<=0&&(J=V.selectAll(".role-legend-label > text").filter((function(e){return"enter"===n(e)})));var X=J.transition();Un(X,["text"],b.final,x.final,E.labels.final.enter),X.duration((function(e,t){return q.labels.find((function(a){return a.id===z.labels(e,t,"final")})).duration})).delay((function(e,t){return q.labels.find((function(a){return a.id===z.labels(e,t,"final")})).delay})).ease(f).end().then(v(["labels","enter"],(function(){return e()})))}else v(["pairs","enter"],(function(){return e()})),v(["symbols","enter"],(function(){return e()})),v(["labels","enter"],(function(){return e()}));if(!m&&V.exit().data().length>0){var ee=V.exit();ee.data().length<=0&&(ee=V.filter((function(e){return"exit"===n(e)})));var te=t.sameDomainDimension?{primary:b.final,secondary:b.initial}:{primary:b.initial,secondary:b.final},ae=ee.transition();Un(ae,["group"],te,x.final,E.pairs.final.exit),ae.duration((function(e,t){return q.pairs.find((function(a){return a.id===z.pairs(e,t,"initial")})).duration})).delay((function(e,t){return q.pairs.find((function(a){return a.id===z.pairs(e,t,"initial")})).delay})).ease(f).remove().end().then(v(["pairs","exit"],(function(){return e()})));var re=ee.selectAll(".role-legend-symbol > path").transition();Un(re,["symbol"],Object.assign({},b,{primary:b.final,secondary:b.initial}),x.final,E.symbols.final.exit),re.duration((function(e,t){return q.symbols.find((function(a){return a.id===z.symbols(e,t,"initial")})).duration})).delay((function(e,t){return q.symbols.find((function(a){return a.id===z.symbols(e,t,"initial")})).delay})).ease(f).remove().end().then(v(["symbols","exit"],(function(){return e()})));var ne=ee.selectAll(".role-legend-label > text").transition();Un(ne,["text"],te,x.final,E.labels.final.exit),ne.duration((function(e,t){return q.labels.find((function(a){return a.id===z.labels(e,t,"initial")})).duration})).delay((function(e,t){return q.labels.find((function(a){return a.id===z.labels(e,t,"initial")})).delay})).ease(f).remove().end().then(v(["labels","exit"],(function(){return e()})))}else v(["pairs","exit"],(function(){return e()})),v(["labels","exit"],(function(){return e()})),v(["symbols","exit"],(function(){return e()}));if(V.data().length>0){var ie=V.filter((function(e){return"update"===n(e)})).transition();Un(ie,["group"],b.final,x.final,E.pairs.final.update),ie.duration((function(e,t){return q.pairs.find((function(a){return a.id===z.pairs(e,t)})).duration})).delay((function(e,t){return q.pairs.find((function(a){return a.id===z.pairs(e,t)})).delay})).ease(f).end().then(v(["pairs","update"],(function(){return e()})));var oe=V.select(".role-legend-symbol > path").datum((function(e,a){return t.nextData.symbols[a]})).transition();Un(oe,["symbol"],b,x.final,{initial:E.symbols.initial.update,final:E.symbols.final.update},H),oe.duration((function(e,t){return q.symbols.find((function(a){return a.id===z.symbols(e,t)})).duration})).delay((function(e,t){return q.symbols.find((function(a){return a.id===z.symbols(e,t)})).delay})).ease(f).end().then(v(["symbols","update"],(function(){return e()})));var se=V.select(".role-legend-label > text").datum((function(e,a){return t.nextData.labels[a]})).transition();Un(se,["text"],b.final,x.final,E.labels.final.update),se.duration((function(e,t){return q.labels.find((function(a){return a.id===z.labels(e,t)})).duration})).delay((function(e,t){return q.labels.find((function(a){return a.id===z.labels(e,t)})).delay})).ease(f).end().then(v(["labels","update"],(function(){return e()})))}else v(["pairs","update"],(function(){return e()})),v(["symbols","update"],(function(){return e()})),v(["labels","update"],(function(){return e()}))}if([w.initial,w.final].indexOf("gradient")>=0&&(l||u)){var ue=h.select(" .role-legend-entry > g > g");"gradient"!==w.initial&&(ue.append("g").attr("class","mark-text role-legend-label"),t.change.final.isBand?ue.append("g").attr("class","mark-rect role-legend-band"):ue.append("g").attr("class","mark-rect role-legend-gradient")),t.change.initial.isBand&&!t.change.final.isBand?ue.append("g").attr("class","mark-rect role-legend-gradient"):!t.change.initial.isBand&&t.change.final.isBand&&ue.append("g").attr("class","mark-rect role-legend-band");var le=h.select(" .role-legend-entry > g > g > .role-legend-label");u&&!le.empty()?be("labels",le,"text",["text"]):v(["labels","all"],(function(){return e()}));var ce=h.select(".role-legend-gradient");l&&!ce.empty()?be("gradient",ce,"path",["gradient"]):v(["gradient","all"],(function(){return e()}));var fe=h.select(".role-legend-band");l&&!fe.empty()?be("bands",fe,"path",["rect"]):v(["bands","all"],(function(){return e()}))}}var de=h.select(".role-legend-title");if(!de.empty()&&o){var pe=de.selectAll("text"),me=r("title"),he=Gn(t.currData.title,t.nextData.title,t.timing,me,n),ve=(pe=pe.data(t.nextData.title,(function(e){return e.text}))).enter().append("text");Un(ve,["title","align"],{},x.initial,E.title.initial.enter);var ye=ve.transition();Un(ye,["title","align"],{},x.final,E.title.final.enter),ye.duration((function(e,t){return he.find((function(a){return a.id===me(e,t,"final")})).duration})).delay((function(e,t){return he.find((function(a){return a.id===me(e,t,"final")})).delay})).ease(f).end().then(v(["title","enter"],(function(){return e()})));var ge=pe.exit().transition();Un(ge,["title","align"],{},x.final,E.title.final.exit),ge.duration((function(e,t){return he.find((function(a){return a.id===me(e,t,"initial")})).duration})).delay((function(e,t){return he.find((function(a){return a.id===me(e,t,"initial")})).delay})).ease(f).remove().end().then(v(["title","exit"],(function(){return e()}))),Un(pe=pe.transition(),["title","align"],{},x.final,E.title.final.update),pe.duration((function(e,t){return he.find((function(a){return a.id===me(e,t)})).duration})).delay((function(e,t){return he.find((function(a){return a.id===me(e,t)})).delay})).ease(f).end().then(v(["title","update"],(function(){return e()})))}function be(a,i,o,s){var u=Object(p.local)(),l=i.selectAll(o),c=r(a),h="labels"===a&&"gradient"!==w.final?[]:t.nextData[a],y=Gn("labels"===a&&"gradient"!==w.initial?[]:t.currData[a],h,t.timing,c,n);if(l.each((function(e){u.set(this,e)})),l=l.data(h,(function(e,t){return c(e,t)})),!d&&l.enter().data().length>0){var g=l.enter().append(o);Un(g,s,t.sameDomainDimension?{primary:b.initial,secondary:b.final}:{primary:b.final,secondary:b.initial},x.initial,E[a].initial.enter),g.data().length<=0&&(g=i.selectAll(o).filter((function(e){return"enter"===n(e)})));var k=g.transition();Un(k,s,b,x.final,E[a].final.enter,u),k.duration((function(e,t){return y.find((function(a){return a.id===c(e,t,"final")})).duration})).delay((function(e,t){return y.find((function(a){return a.id===c(e,t,"final")})).delay})).ease(f).end().then(v([a,"enter"],(function(){return e()})))}else v([a,"enter"],(function(){return e()}));if(!m&&l.exit().data().length>0){var A=l.exit().transition();Un(A,s,t.sameDomainDimension?{primary:b.final,secondary:b.initial}:{primary:b.initial,secondary:b.final},x.final,E[a].final.exit,u),A.duration((function(e,t){return y.find((function(a){return a.id===c(e,t,"initial")})).duration})).delay((function(e,t){return y.find((function(a){return a.id===c(e,t,"initial")})).delay})).ease(f).remove().end().then(v([a,"exit"],(function(){return e()})))}else v([a,"exit"],(function(){return e()}));if(l.data().length>0){var D=l.transition();Un(D,"gradient"===a?[{name:"gradient",excludes:[{type:"style",val:"fill"}]}]:s,b,x.final,{initial:E[a].initial.update,final:E[a].final.update},u),"gradient"===a&&function(e,t){var a=e.node().style.fill.replace(/^url\(['"]/,"").replace(/['"]\)$/,""),r=e.data()[0],n=a.split("#").pop(),i=Object(p.select)("#".concat(n));i.selectAll("stop").data(r.fill.stops,(function(e){return(e||{}).offset})).transition().attr("stop-color",(function(e){return e.color})).duration(t.duration).delay(t.delay),i.transition().attr("x1",r.fill.x1).attr("x2",r.fill.x2).attr("y1",r.fill.y1).attr("y2",r.fill.y2).duration(t.duration).delay(t.delay)}(l,t),D.duration((function(e,t){return y.find((function(a){return a.id===c(e,t)})).duration})).delay((function(e,t){return y.find((function(a){return a.id===c(e,t)})).delay})).ease(f).end().then(v([a,"update"],(function(){return e()})))}else v([a,"update"],(function(){return e()}))}}))},axis:function(e,t,a){function r(e){return function(a,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"initial";return a?a.__gemini__?Sr(a,0,t,"joinKey"):"function"===typeof t.computeDatumId[e]?t.computeDatumId[e](a,r):t.computeDatumId[e][n](a,r):r.toString()}}var n=function(e,a){return Sr(e,0,t,"animSet")},i=a,o=e.eVis.view,s=function(e){var t=e.reduce((function(e,t){return e[t]=g(ti),e}),{});return function(e,a){2===e.length?"all"===e[1]?(t[e[0]].exit=!0,t[e[0]].enter=!0,t[e[0]].update=!0):t[e[0]][e[1]]=!0:"all"===e?(t.update=!0,t.enter=!0,t.exit=!0):t[e]=!0,Object.keys(t).reduce((function(e,a){return e&&t[a].update&&t[a].enter&&t[a].exit}),!0)&&a()}}(["tick","label","grid","title","domain"]);return new Promise((function(e){var a=t.change,u=Or(t.timing.ease),l=!0;!1===a.encode&&(l=!1);var c=l,f=l,d=l,m=l,h=l,v=l;a.encode&&(c=!(!1===a.encode.ticks),f=!(!1===a.encode.labels),d=!(!1===a.encode.axis),m=!(!1===a.encode.title),v=!(!1===a.encode.grid),h=!(!1===a.encode.domain));var y=!1,g=Object(p.selectAll)("".concat(i," .role-axis.").concat(a.compName)),b=a.compName,x=t.scales,E=t.signals;if(null===a.initial){var w=Object(p.select)("".concat(i," .mark-group.root g g ")),k=o.scenegraph().root,A=jr(k,a.compName);!function(e,t,a){var r=t.name,n=e.insert("g",a).attr("class","mark-group role-axis ".concat(r)).append("g").attr("transform",Dn(t.items[0])),i=t.items[0].datum;i.ticks&&n.append("g").attr("class","mark-rule role-axis-tick"),i.labels&&n.append("g").attr("class","mark-text role-axis-label"),i.grid&&n.append("g").attr("class","mark-rule role-axis-grid"),i.domain&&n.append("g").attr("class","mark-rule role-axis-domain"),i.title&&n.append("g").attr("class","mark-text role-axis-title")}(w,Pr(k,b,"axis")[0],A?".".concat(A.name):void 0),g=Object(p.selectAll)("".concat(i," .role-axis.").concat(a.compName))}else null===a.final&&(y=!0);if(y){var D=a.encode&&a.encode.axis?a.encode.axis.exit:{},O=g.select("g").transition();Un(O,["group"],x.final,E.final,Object.assign({},Dr.axis.axis.exit,D)),O.duration(t.duration)}else if(d){var j=g.select("g");j.data(t.nextData.axis);var S=j.transition();Un(S,["group"],x.final,E.final,t.encodes.axis.final.update),S.delay(t.delay).duration(t.duration).ease(u)}function P(e){return{update:{initial:function(t,a,r){var n=Tr(x,[b],a);return qn(t,e.initial.update,n.initial,E.initial,r)},final:function(t,a,r){var n=Tr(x,[b],a);return qn(t,e.final.update,n.final,E.final,r)}},enter:{initial:function(t,a,r){var n=Tr(x,[b],a);return qn(t,e.initial.enter,n.initial[b]?n.initial:n.final,E.initial,r)},final:function(t,a,r){var n=Tr(x,[b],a);return qn(t,e.final.enter,n.final,E.final,r)}},exit:{initial:function(t,a,r){var n=Tr(x,[b],a);return qn(t,e.initial.exit,n.initial,E.initial,r)},final:function(t,a,r){var n=Tr(x,[b],a);return qn(t,e.final.exit,n.final,E.final,r)}}}}if(c){var F=g.selectAll(".role-axis-tick"),C=t.encodes.ticks,B=["tick"];if(t.enumerator){var T=t.enumerator.tick,_=P(C),N=F.selectAll("line").data(T.allKeys,(function(e){return e}));N.exit().remove(),N.enter().append("line");var I=B.reduce((function(e,t){return e.concat(Br(t))}),[]),M=F.selectAll("line").filter((function(e){return["update","exit"].indexOf(T.set(e,0))>=0}));I.forEach((function(e){if("attrTween"===e.type){var t=Object.assign({},e,{type:"attr"});M[t.type](An(t.val),(function(e){return T.getPropVal(t,_,0,e)}))}else"text"===e.type?M[e.type]((function(t){return T.getPropVal(e,_,0,t)})):M[e.type](An(e.val),(function(t){return T.getPropVal(e,_,0,t)}))}));var R=Yn(T,t.timing),$=F.selectAll("line").transition();I.forEach((function(e){"attr"===e.type?$.attrTween(e.val,(function(t){return T.interpolateAlongEnumMaker(e,_)(t)})):"text"===e.type?$.tween("text",(function(t){var a=T.interpolateAlongEnumMaker(e,_)(t);return function(e){this.innerHTML=a(e)}})):"style"===e.type&&$.styleTween(An(e.val),(function(t){return T.interpolateAlongEnumMaker(e,_)(t)}))})),$.duration((function(e,t){return R[t].duration})).delay((function(e,t){return R[t].delay})).ease(u).end().then((function(){s(["tick","all"],(function(){e()}))}))}else{var V=F.selectAll("line"),z=t.currData.tick,L=t.nextData.tick,U=r("tick"),q=Gn(z,L,t.timing,U,n),H=(V=V.data(L,(function(e){return U(e)}))).enter().append("line");Un(H,B,t.sameDomainDimension?{primary:x.initial,secondary:x.final}:{primary:x.final,secondary:x.initial},E.initial,C.initial.enter),H.data().length<=0&&(H=V.filter((function(e){return"enter"===n(e)})));var K=H.transition();Un(K,B,x.final,E.final,C.final.enter),K.duration((function(e,t){return q.find((function(a){return a.id===U(e,t,"final")})).duration})).delay((function(e,t){return q.find((function(a){return a.id===U(e,t,"final")})).delay})).ease(u).end().then(s(["tick","enter"],(function(){return e()})));var W=V.exit();W.data().length<=0&&(W=V.filter((function(e){return"exit"===n(e)})));var Q=W.transition();Un(Q,B,t.sameDomainDimension?{primary:x.final,secondary:x.initial}:{primary:x.initial,secondary:x.final},E.final,C.final.exit),Q.duration((function(e,t){return q.find((function(a){return a.id===U(e,t,"initial")})).duration})).delay((function(e,t){return q.find((function(a){return a.id===U(e,t,"initial")})).delay})).ease(u).remove().end().then(s(["tick","exit"],(function(){return e()}))),V.data().length>0?(Un(V=V.filter((function(e){return"update"===n(e)})).transition(),B,x.final,E.final,C.final.update),V.duration((function(e,t){return q.find((function(a){return a.id===U(e,t)})).duration})).delay((function(e,t){return q.find((function(a){return a.id===U(e,t)})).delay})).ease(u).end().then(s(["tick","update"],(function(){return e()})))):s(["tick","update"],(function(){return e()}))}}else s(["tick","enter"],(function(){return e()})),s(["tick","exit"],(function(){return e()})),s(["tick","update"],(function(){return e()}));var J=g.selectAll(".role-axis-label"),Z=["text","align"];if(!J.empty()&&f){var G=t.encodes.labels;if(t.enumerator){var Y=t.enumerator.label,X=P(G),ee=J.selectAll("text").data(Y.allKeys,(function(e){return e}));ee.exit().remove(),ee.enter().append("text");var te=Z.reduce((function(e,t){return e.concat(Br(t))}),[]),ae=J.selectAll("text").filter((function(e){return["update","exit"].indexOf(Y.set(e,0))>=0}));te.forEach((function(e){if("attrTween"===e.type){var t=Object.assign({},e,{type:"attr"});ae[t.type](An(t.val),(function(e){return Y.getPropVal(t,X,0,e)}))}else"text"===e.type?ae[e.type]((function(t){return Y.getPropVal(e,X,0,t)})):ae[e.type](An(e.val),(function(t){return Y.getPropVal(e,X,0,t)}))}));var re=J.selectAll("text").transition(),ne=Yn(Y,t.timing);te.forEach((function(e){"attr"===e.type?re.attrTween(e.val,(function(t){return Y.interpolateAlongEnumMaker(e,X)(t)})):"text"===e.type?re.tween("text",(function(t){var a=Y.interpolateAlongEnumMaker(e,X)(t);return function(e){this.innerHTML=a(e)}})):"style"===e.type&&re.styleTween(An(e.val),(function(t){return Y.interpolateAlongEnumMaker(e,X)(t)}))})),re.duration((function(e,t){return ne[t].duration})).delay((function(e,t){return ne[t].delay})).ease(u).end().then((function(){s(["label","all"],(function(){e()}))}))}else{var ie=J.selectAll("text"),oe=t.currData.label,se=t.nextData.label,ue=r("label"),le=Gn(oe,se,t.timing,ue,n),ce=Object(p.local)();ie.each((function(e){ce.set(this,e)}));var fe=(ie=ie.data(se,(function(e){return ue(e)}))).enter().append("text");Un(fe,Z,t.sameDomainDimension?{primary:x.initial,secondary:x.final}:{primary:x.final,secondary:x.initial},E.initial,G.initial.enter),fe.data().length<=0&&(fe=ie.filter((function(e){return"enter"===n(e)})));var de=fe.transition();Un(de,Z,x.final,E.final,G.final.enter),de.duration((function(e,t){return le.find((function(a){return a.id===ue(e,t,"final")})).duration})).delay((function(e,t){return le.find((function(a){return a.id===ue(e,t,"final")})).delay})).ease(u).end().then(s(["label","enter"],(function(){return e()})));var pe=ie.exit();pe.data().length<=0&&(pe=ie.filter((function(e){return"exit"===n(e)})));var me=pe.transition();Un(me,Z,t.sameDomainDimension?{primary:x.final,secondary:x.initial}:{primary:x.initial,secondary:x.final},E.final,G.final.exit,ce),me.duration((function(e,t){return le.find((function(a){return a.id===ue(e,t,"initial")})).duration})).delay((function(e,t){return le.find((function(a){return a.id===ue(e,t,"initial")})).delay})).ease(u).remove().end().then(s(["label","exit"],(function(){return e()}))),ie.data().length>0?(Un(ie=ie.filter((function(e){return"update"===n(e)})).transition(),Z,x.final,E.final,G.final.update,ce),ie.duration((function(e,t){return le.find((function(a){return a.id===ue(e,t)})).duration})).delay((function(e,t){return le.find((function(a){return a.id===ue(e,t)})).delay})).ease(u).end().then(s(["label","update"],(function(){return e()})))):s(["label","update"],(function(){return e()}))}}else s(["label","enter"],(function(){return e()})),s(["label","exit"],(function(){return e()})),s(["label","update"],(function(){return e()}));var he=g.selectAll(".role-axis-grid"),ve=["grid"];if(t.change.initial&&!1!==t.change.initial.grid||!t.change.final||!0!==t.change.final.grid||(he=g.select("g").select("g").append("g").attr("class","mark-rule role-axis-grid")),!he.empty()&&v){var ye=t.encodes.grid;if(t.enumerator){var ge=t.enumerator.grid,be=P(ye),xe=he.selectAll("line").data(ge.allKeys,(function(e){return e}));xe.exit().remove(),xe.enter().append("line");var Ee=he.selectAll("line").filter((function(e){return["update","exit"].indexOf(ge.set(e,0))>=0})),we=ve.reduce((function(e,t){return e.concat(Br(t))}),[]);we.forEach((function(e){if("attrTween"===e.type){var t=Object.assign({},e,{type:"attr"});Ee[t.type](An(t.val),(function(e){return ge.getPropVal(t,be,0,e)}))}else"text"===e.type?Ee[e.type]((function(t){return ge.getPropVal(e,be,0,t)})):Ee[e.type](An(e.val),(function(t){return ge.getPropVal(e,be,0,t)}))}));var ke=he.selectAll("line").transition(),Ae=Yn(ge,t.timing);we.forEach((function(e){"attr"===e.type?ke.attrTween(e.val,(function(t){return ge.interpolateAlongEnumMaker(e,be)(t)})):"text"===e.type?ke.tween("text",(function(t){var a=ge.interpolateAlongEnumMaker(e,be)(t);return function(e){this.innerHTML=a(e)}})):"style"===e.type&&ke.styleTween(An(e.val),(function(t){return ge.interpolateAlongEnumMaker(e,be)(t)}))})),ke.duration((function(e,t){return Ae[t].duration})).delay((function(e,t){return Ae[t].delay})).ease(u).end().then((function(){s(["grid","all"],(function(){e()}))}))}else{var De=he.selectAll("line"),Oe=t.currData.grid,je=t.nextData.grid,Se=r("grid"),Pe=Gn(Oe,je,t.timing,Se,n),Fe=Object(p.local)();De.each((function(e){Fe.set(this,e)}));var Ce=(De=De.data(je,(function(e){return Se(e)}))).enter().append("line");Un(Ce,ve,t.sameDomainDimension?{primary:x.initial,secondary:x.final}:{primary:x.final,secondary:x.initial},E.initial,ye.initial.enter),Ce.data().length<=0&&(Ce=De.filter((function(e){return"enter"===n(e)})));var Be=Ce.transition();Un(Be,ve,x.final,E.final,ye.final.enter),Be.duration((function(e,t){return Pe.find((function(a){return a.id===Se(e,t,"final")})).duration})).delay((function(e,t){return Pe.find((function(a){return a.id===Se(e,t,"final")})).delay})).ease(u).end().then(s(["grid","enter"],(function(){return e()})));var Te=De.exit();Te.data().length<=0&&(Te=De.filter((function(e){return"exit"===n(e)})));var _e=Te.transition();Un(_e,ve,t.sameDomainDimension?{primary:x.final,secondary:x.initial}:{primary:x.initial,secondary:x.final},E.final,ye.final.exit,Fe),_e.duration((function(e,t){return Pe.find((function(a){return a.id===Se(e,t,"initial")})).duration})).delay((function(e,t){return Pe.find((function(a){return a.id===Se(e,t,"initial")})).delay})).ease(u).remove().end().then(s(["grid","exit"],(function(){return e()}))),Un(De=De.filter((function(e){return"update"===n(e)})).transition(),ve,x.final,E.final,ye.final.update,Fe),De.duration((function(e,t){return Pe.find((function(a){return a.id===Se(e,t)})).duration})).delay((function(e,t){return Pe.find((function(a){return a.id===Se(e,t)})).delay})).ease(u).end().then(s(["grid","update"],(function(){return e()})))}}else s(["grid","enter"],(function(){return e()})),s(["grid","exit"],(function(){return e()})),s(["grid","update"],(function(){return e()}));var Ne=["title","align"],Ie=g.selectAll(".role-axis-title");if(!Ie.empty()&&m){var Me=t.encodes.title,Re=Ie.selectAll("text"),$e=Re.data(),Ve=[];y||(Ve=!1===t.change.scale?$e:o._runtime.data[b].values.value[0].items.filter((function(e){return"axis-title"===e.role}))[0].items),Re.data($e,(function(e){return e.text}));var ze=(Re=Re.data(Ve,(function(e){return e.text}))).enter().append("text");Un(ze,Ne,{},E.initial,Me.initial.enter);var Le=ze.transition();Un(Le,Ne,{},E.final,Me.final.enter),Le.duration(t.duration).delay(t.delay).ease(u).end().then(s(["title","enter"],(function(){return e()})));var Ue=Re.exit().transition();Un(Ue,Ne,{},E.final,Me.final.exit),Ue.duration(t.duration).delay(t.delay).ease(u).end().then(s(["title","exit"],(function(){return e()}))),Un(Re=Re.transition(),Ne,{},E.final,Me.final.update),Re.duration(t.duration).delay(t.delay).ease(u).end().then(s(["title","update"],(function(){return e()})))}else s(["title","enter"],(function(){return e()})),s(["title","exit"],(function(){return e()})),s(["title","update"],(function(){return e()}));var qe=["domain"],He=g.selectAll(".role-axis-domain");if(!He.empty()&&h){var Ke=t.encodes.domain,We=[];y||(We=o._runtime.data[b].values.value[0].items.filter((function(e){return"axis-domain"===e.role}))[0].items);var Qe=He.selectAll("line").data(We),Je=Qe.enter().append("line");Un(Je,qe,{},E.initial,Ke.initial.enter);var Ze=Je.transition();Un(Ze,qe,{},E.final,Ke.final.enter),Ze.duration(t.duration).delay(t.delay).ease(u).end().then(s(["domain","enter"],(function(){return e()})));var Ge=Qe.exit();Un(Ge,qe,{},E.initial,Ke.initial.exit);var Ye=Ge.transition();Un(Ye,qe,{},E.final,Ke.final.exit),Ye.duration(t.duration).delay(t.delay).ease(u).end().then(s(["domain","exit"],(function(){return e()}))),Un(Qe,qe,x.initial,E.initial,Ke.initial.update),Un(Qe=Qe.transition(),qe,x.final,E.final,Ke.final.update),Qe.duration(t.duration).delay(t.delay).ease(u).end().then(s(["domain","update"],(function(){return e()})))}else s(["domain","enter"],(function(){return e()})),s(["domain","exit"],(function(){return e()})),s(["domain","update"],(function(){return e()}))}))},mark:{interpolate:{others:function(e,t,a){var r=this,n=function(e,a,r){return e.__gemini__?Sr(e,0,t,"joinKey"):"function"===typeof t.computeDatumId?t.computeDatumId(e,a):t.computeDatumId[r||"initial"](e,a)},i=function(e,a){return e.__gemini__?Sr(e,0,t,"animSet"):void 0},o=a,s=e.eVis.view,u={rect:["rect"],symbol:["symbol"],rule:["rule"],text:["text","align"]};return new Promise((function(e){var a,c,f,d,m=function(){var e={update:!1,enter:!1,exit:!1};return function(t,a,r){"all"===t?e.update=e.enter=e.exit=!0:e[t]=!0,e.update&&e.enter&&e.exit&&a(r)}}(),h=Gn(t.currData,t.nextData,t.timing,n,i),v=t.change,y=t.marktypes,g=t.scales,b=t.encodes,x=t.signals,E=!v.initial&&!!v.final,w=!!v.initial&&!v.final,k=Or(t.timing.ease),A=Xn(a=w?y.initial:E?y.final:y.initial&&y.final&&y.initial!==y.final?!1===v.marktype?y.initial:y.final:y.initial||y.final),D={initial:Xn(y.initial),final:Xn(y.final)},O=Object(p.select)("".concat(o," .mark-").concat(a,".role-mark.").concat(v.compName));if(E||y.initial!==y.final&&l(y.final)){var j=jr(s.scenegraph().root,v.compName);c=Object(p.select)("".concat(o," .").concat(v.final.parent.name," > g > g")),f=v.final,d=j?".".concat(j.name):void 0,O=c.insert("g",d).attr("class","mark-".concat(f.type," role-mark ").concat(f.name))}if(t.enumerator){v.data||console.error("Cannot apply enumerator for a mark interpolation without data change!");var S=t.enumerator,P=[];!0===v.scale?P=Object.keys(s._runtime.scales):Array.isArray(v.scale)&&(P=v.scale);var F={update:{initial:function(e,t,a){var r=Tr(g,P,t);return qn.bind(this)(e,b.initial.update,r.initial,x.initial,a)},final:function(e,t,a){var r=Tr(g,P,t);return qn.bind(this)(e,b.final.update,r.final,x.initial,a)},custom:function(e,t,a,r){var n={initial:a,final:r},i=Tr(g,P,t);return qn.bind(this)(e,b.final.update,i,x.final,n)}},enter:{initial:function(e,t,a){var r=Tr(g,P,t);return qn.bind(this)(e,b.initial.enter,{primary:r.initial,secondary:r.final},x.initial,a)},final:function(e,t,a){var r=Tr(g,P,t);return qn.bind(this)(e,b.final.enter,r.final,x.initial,a)},custom:function(e,t,a,r){var n={initial:a,final:r},i=Tr(g,P,t);return qn.bind(this)(e,b.final.enter,i,x.final,n)}},exit:{initial:function(e,t,a){var r=Tr(g,P,t);return qn.bind(this)(e,b.initial.exit,r.initial,x.initial,a)},final:function(e,t,a){var r=Tr(g,P,t);return qn.bind(this)(e,b.final.exit,{primary:r.final,secondary:r.initial},x.final,a)},custom:function(e,t,a,r){var n={initial:a,final:r},i=Tr(g,P,t);return qn.bind(this)(e,b.final.exit,i,x.final,n)}}},C=O.selectAll(A).data(S.allKeys,(function(e){return e}));C.exit().remove(),C.enter().append(A);var B=O.selectAll(A).filter((function(e){return["update","exit"].indexOf(S.set(e,0))>=0})),T=u[a].reduce((function(e,t){return e.concat(Br(t))}),[]);T.forEach((function(e){if("attrTween"===e.type){var t=Object.assign({},e,{type:"attr"});B[t.type](An(t.val),(function(e){return S.getPropVal(t,F,0,e)}))}else"text"===e.type?B[e.type]((function(t){return S.getPropVal(e,F,0,t)})):B[e.type](An(e.val),(function(t){return S.getPropVal(e,F,0,t)}))}));var _=Yn(S,t.timing),N=O.selectAll(A).transition();T.forEach((function(e){"attr"===e.type||"attrTween"===e.type?N.attrTween(e.val,(function(t){return S.interpolateAlongEnumMaker(e,F,this)(t)})):"text"===e.type?N.tween("text",(function(t){var a=S.interpolateAlongEnumMaker(e,F,this)(t);return function(e){this.setAttribute("text",a(e))}})):"style"===e.type&&N.styleTween(An(e.val),(function(t){return S.interpolateAlongEnumMaker(e,F,r)(t)}))})),N.duration((function(e,t){return _[t].duration})).delay((function(e,t){return _[t].delay})).ease(k).end().then((function(){O.selectAll(A).data(t.nextData),m("all",(function(){e()}))}))}else if(y.initial!==y.final){var I,M;if(l(y.initial)){I=Object(p.select)(o+" .mark-".concat(y.initial,".role-mark.").concat(v.compName)).selectAll(D.initial);var R=y.final&&!l(y.final)?Gn(t.currData,t.unpackedData,t.timing,n,i):h,$=Object(p.local)(),V=y.final&&!l(y.final)?t.unpackedData:t.nextData;v.data||E||w?((I=I.data(t.currData)).each((function(e){$.set(this,e)})),I=I.data(V,(function(e,t){return n(e,t,"initial")}))):I.each((function(e){$.set(this,e)})),Q(R,I,y.initial,{initial:b.initial.exit,final:b.final.exit},x,$),J(R,I,y.initial,{initial:b.initial.update,final:b.initial.intermediate},x,$,!1,!1)}else m("exit",(function(){e()}));if(l(y.final)){var z=Object(p.local)(),L=y.initial&&!l(y.initial)?Gn(t.unpackedData,t.nextData,t.timing,n,i):h,U=y.initial?l(y.initial)?I.data():t.unpackedData:[],q=Object(p.select)(o+" .mark-".concat(y.final,".role-mark.").concat(v.compName));Un((M=q.selectAll(D.final).filter((function(e){return!e})).data(U)).enter().append(D.final),u[y.final],{primary:g.initial,secondary:g.final},x.initial,b.final.intermediate),(M=q.selectAll(D.final)).each((function(e){z.set(this,e)})),(v.data||E||w)&&(M=M.data(t.nextData,(function(e,t){return n(e,t,"final")}))),W(L,M,y.final),J(L,M,y.final,{initial:b.final.intermediate,final:b.final.update},x,z,!0,!0)}else m("update",(function(){e()})),m("enter",(function(){e()}))}else{var H=O.selectAll(A),K=Object(p.local)();H.each((function(e){K.set(this,e)})),(v.data||E||w)&&(t.preFetchCurrData&&(H=H.data(t.currData)),H=H.data(t.nextData,(function(e,t){return n(e,t)}))),W(h,H,a),Q(h,H,a,{initial:b.initial.exit,final:b.final.exit},x,K),J(h,H,a,{initial:b.initial.update,final:b.final.update},x,K)}function W(t,a,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:b.initial.enter,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:b.final.enter,l=a.enter().append(Xn(r));if(Un(l,u[r],{primary:g.initial,secondary:g.final},x.initial,{primary:o,secondary:Object.assign({},s,{opacity:{value:0}})}),l.data().length<=0&&(l=a.filter((function(e,t){return"enter"===i(e)}))),l.data().length>0){var c="final",f=l.transition();Un(f,u[r],g.final,x.final,{initial:{primary:o,secondary:Object.assign({},s,{opacity:{value:0}})},final:s}),f.duration((function(e,a){return t.find((function(t){return t.id===n(e,a,c)})).duration})).delay((function(e,a){return t.find((function(t){return t.id===n(e,a,c)})).delay})).ease(k).end().then((function(){m("enter",(function(){e()}))}))}else m("enter",(function(){e()}))}function Q(t,a,r,o,s,l){var c=a.exit();if(c.data().length<=0&&(c=a.filter((function(e,t){return"exit"===i(e)}))),c.data().length>0){var f=c.transition();Un(f,u[r],Object.assign({},g,{primary:g.final,secondary:g.initial}),s,o||b.final.exit,l),f.duration((function(e,a){return t.find((function(t){return t.id===n(e,a,"initial")})).duration})).delay((function(e,a){return t.find((function(t){return t.id===n(e,a,"initial")})).delay})).ease(k).remove().end().then((function(){m("exit",(function(){e()}))}))}else m("exit",(function(){e()}))}function J(t,a,r,o,s,l){var c=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],f=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],d=f?a.filter((function(e,t){return"update"===i(e)})):a;if(!1===v.data&&0===d.data().length&&(d=a),d.data().length>0){var p="initial";Un(d=d.transition(),u[r],g,s,o,l),d.duration((function(e,a){return t.find((function(t){return t.id===n(e,a,p)})).duration})).delay((function(e,a){return t.find((function(t){return t.id===n(e,a,p)})).delay})).ease(k).end().then((function(){c&&m("update",(function(){e()}))}))}else c&&m("update",(function(){e()}))}}));function l(e){return!!u[e]}},areaLine:function(e,t,a){var r=this,n=function(e,a,r){return e.__gemini__?Sr(e,0,t,"joinKey"):"function"===typeof t.computeDatumId?t.computeDatumId(e,a):t.computeDatumId[r||"final"](e,a)},i=function(e,a){return e.__gemini__?Sr(e,0,t,"animSet"):void 0},o={area:[{name:"area",tweaks:[]}],line:[{name:"line",tweaks:[]}],trail:[{name:"trail",tweaks:[]}]},s=[{type:"attrTween",val:"d",interpolateStyle:"update"}],u={area:[{name:"area",tweaks:s}],line:[{name:"line",tweaks:s}],trail:[{name:"trail",tweaks:s}]},l=a,c=e.eVis.view,f={update:!1,enter:!1,exit:!1};function d(e,t,a){"all"===e?f.update=f.enter=f.exit=!0:f[e]=!0,f.update&&f.enter&&f.exit&&t(a)}function m(e){return!!o[e]}return new Promise((function(e){var a,s=Gn(t.currData,t.nextData,t.timing,n,i),f=t.change,h=Or(t.timing.ease),v=t.marktypes,y=!f.initial&&!!f.final,g=!!f.initial&&!f.final;a=v.initial&&v.final&&v.initial!==v.final?!1===f.marktype?v.initial:v.final:g?v.initial:y?v.final:v.initial||v.final;var b=t.hasFacet,x=t.scales,E=t.encodes,w=t.signals;if(y||!m(v.initial))if(b.final){var k=jr(c.scenegraph().root,f.final.parent.name);ei(Object(p.select)("".concat(l," .").concat(f.final.parent.parent.name," > g > g")),f.final,k?".".concat(k.name):void 0,{hasGroup:!0})}else{var A=jr(c.scenegraph().root,f.compName);ei(Object(p.select)("".concat(l," .").concat(f.final.parent.name," > g > g")),f.final,A?".".concat(A.name):void 0)}if(t.enumerator){var D=[];!0===f.scale?D=Object.keys(c._runtime.scales):Array.isArray(f.scale)&&(D=f.scale);var O=t.enumerator,j={update:{initial:function(e,t,a){var r=Tr(x,D,t);return qn(e,E.initial.update,r.initial,w.initial,a)},final:function(e,t,a){var r=Tr(x,D,t);return qn(e,E.final.update,r.final,w.final,a)},custom:function(e,t,a,n){var i={initial:a.items[0].items[0],final:n.items[0].items[0]},o=Object.assign({},e,{interpolateStyle:"update"}),s=Tr(x,D,t);return qn.bind(r)(f.scale?e:o,E.final.update,f.scale?s:s.final,w.final,i)}},enter:{initial:function(e,t,a){var r=Tr(x,D,t);return qn(e,E.initial.enter,{primary:r.initial,secondary:r.final},w.initial,a)},final:function(e,t,a){var r=Tr(x,D,t);return qn(e,E.final.enter,r.final,w.final,a)},custom:function(e,t,a,r){var n={initial:f.scale?r.items[0].items[0]:{mark:{items:[]}},final:r.items[0].items[0]},i=Object.assign({},e,{interpolateStyle:"update"}),o=Tr(x,D,t);return qn.bind(this)(f.scale?e:i,E.final.update,f.scale?o:o.final,w.final,n)}},exit:{initial:function(e,t,a){var r=Tr(x,D,t);return qn(e,E.initial.exit,r.initial,w.initial,a)},final:function(e,t,a){var r=Tr(x,D,t);return qn(e,E.final.exit,{primary:r.final,secondary:r.initial},w.final,a)},custom:function(e,t,a){var n={initial:a.items[0].items[0],final:f.scale?a.items[0].items[0]:{mark:{items:[]}}},i=Tr(x,D,t),o=Object.assign({},e,{interpolateStyle:"update"});return qn.bind(r)(f.scale?e:o,E.final.exit,f.scale?i:i.initial,w.final,n)}}};if(b.initial&&b.final){var S=Object(p.selectAll)(l+" .role-scope.".concat(f.final.parent.name," > g")).attr("class","__sub");(S=(S=Object(p.select)(l+" .role-scope.".concat(f.final.parent.name)).selectAll(".__sub")).data(O.allKeys,(function(e){return e}))).exit().remove(),(S=S.enter().append("g")).append("path").attr("class","background");var P=S.append("g").append("g").attr("class","".concat(a,"-mark role-mark ").concat(f.compName)).append("path"),F=P.filter((function(e){return["update","exit"].indexOf(O.set(e,0))>=0})),C=o[a].reduce((function(e,t){return e.concat(Br(t))}),[]);C.forEach((function(e){if("attrTween"===e.type){var t=Object.assign({},e,{type:"attr"});F[t.type](An(t.val),(function(e){return O.getPropVal(t,j,0,e)}))}else F[e.type](An(e.val),(function(t){return O.getPropVal(e,j,0,t)}))}));var B=Yn(O,t.timing);P=P.transition(),C.forEach((function(e){"attr"===e.type||"attrTween"===e.type?P.attrTween(e.val,(function(t){return O.interpolateAlongEnumMaker(e,j,this)(t)})):"text"===e.type?P.tween("text",(function(t){var a=O.interpolateAlongEnumMaker(e,j,this)(t);return function(e){this.innerHTML=a(e)}})):"style"===e.type&&P.styleTween(An(e.val),(function(t){return O.interpolateAlongEnumMaker(e,j,this)(t)}))})),P.duration((function(e,t){return B[t].duration})).delay((function(e,t){return B[t].delay})).ease(h).end().then((function(){d("all",(function(){e()}))}))}else if(!b.initial&&!b.final){var T=Object(p.select)(l+" .mark-".concat(a,".role-mark.").concat(f.compName)).selectAll("path");(T=T.data(O.allKeys,(function(e){return e}))).exit().remove(),T=T.enter().append("path");var _=o[a].reduce((function(e,t){return e.concat(Br(t))}),[]);_.forEach((function(e){if("attrTween"===e.type){var t=Object.assign({},e,{type:"attr"});T[t.type](An(t.val),(function(e){return O.getPropVal(t,j,0,e)}))}else T[e.type](An(e.val),(function(t){return O.getPropVal(e,j,0,t)}))}));var N=Yn(O,t.timing);T=T.transition(),_.forEach((function(e){"attr"===e.type||"attrTween"===e.type?T.attrTween(e.val,(function(t){return O.interpolateAlongEnumMaker(e,j,this)(t)})):"text"===e.type?T.tween("text",(function(t){var a=O.interpolateAlongEnumMaker(e,j,this)(t);return function(e){this.innerHTML=a(e)}})):"style"===e.type&&T.styleTween(An(e.val),(function(t){return O.interpolateAlongEnumMaker(e,j,this)(t)}))})),T.duration((function(e,t){return N[t].duration})).delay((function(e,t){return N[t].delay})).ease(h).end().then((function(){d("all",(function(){e()}))}))}}else if(v.initial&&!m(v.initial)){var I=v.final,M=Object(p.local)();if(b.final){var R=Gn(t.groupedData,t.nextData,t.timing,n,i),$=Object(p.selectAll)(l+" .role-scope.".concat(f.final.parent.name," > g")),V=($=Object(p.select)("".concat(l," .role-scope.").concat(f.final.parent.name)).selectAll(".role-scope.".concat(f.final.parent.name," > g")).data(t.groupedData,(function(e,t){return n(e,t,"final")}))).enter().append("g");V.append("path").attr("class","background"),Un(V.append("g").append("g").attr("class","mark-".concat(I," role-mark ").concat(f.compName)).append("path"),o[I],{primary:x.initial,secondary:x.final},w.initial,E.final.intermediate),($=Object(p.select)("".concat(l," .role-scope.").concat(f.final.parent.name)).selectAll(".role-scope.".concat(f.final.parent.name," > g"))).each((function(e){M.set(this,e)})),xe(R,$=$.data(t.nextData,(function(e,t){return n(e,t,"final")})),I,{initial:E.final.intermediate,final:E.final.update},M),Ee(R,$,I),d("exit",(function(){return e()}))}else{var z=Object(p.select)(l+" .mark-".concat(I,".role-mark.").concat(f.compName)).selectAll("path");Un((z=z.data(t.groupedData)).enter().append("path"),o[I],{primary:x.initial,secondary:x.final},w.initial,E.final.intermediate);var L=Object(p.select)(l+" .mark-".concat(v.final,".role-mark.").concat(f.compName)).selectAll("path");L.each((function(e){M.set(this,e)})),Un(L=L.data(t.nextData).transition(),o[v.final],x,w.final,E.final.update,M),L.duration(t.timing.duration).delay(t.timing.delay).ease(h).end().then((function(){d("all",(function(){e()}))}))}}else if(v.final&&!m(v.final)){var U=Gn(t.currData,t.groupedData,t.timing,n,i),q=Object(p.local)(),H=v.initial;if(b.initial){var K=Object(p.selectAll)(l+" .role-scope.".concat(f.initial.parent.name," > g"));(K=Object(p.select)("".concat(l," .role-scope.").concat(f.initial.parent.name)).selectAll(".role-scope.".concat(f.initial.parent.name," > g"))).each((function(e){q.set(this,e)})),be(U,K=K.data(t.groupedData,(function(e,t){return n(e,t,"initial")})),H,{initial:E.initial.exit,final:E.final.exit},q,"initial"),xe(U,K,H,{initial:E.initial.update,final:E.initial.intermediate},q),d("enter",(function(){return e()}))}else{var W=Object(p.select)(l+" .mark-".concat(H,".role-mark.").concat(f.compName)).selectAll("path");W.each((function(e){q.set(this,e)})),Un(W=W.data(t.groupedData).transition(),o[H],Object.assign({},x,{primary:x.final,secondary:x.initial}),w.final,{initial:E.initial.update,final:E.initial.intermediate},q),W.duration(t.duration).delay(t.delay).ease(h).end().then((function(){d("all",(function(){e()}))}))}}else if((g||b.final)&&(y||b.initial)){var Q=y?f.final.parent.name:g||f.initial.type===v.initial?f.initial.parent.name:f.final.parent.name,J=Object(p.selectAll)(l+" .role-scope.".concat(Q," > g")).attr("class","__sub");J=Object(p.select)(l+" .role-scope.".concat(Q)).selectAll(".__sub");var Z=Object(p.local)();J.each((function(e){Z.set(this,e)})),(f.data||y||g)&&(J=J.data(t.nextData,(function(e,t){return n(e,t)}))),Ee(s,J,v.final),be(s,J,v.initial,{initial:E.initial.exit,final:E.final.exit},Z,"initial"),xe(s,J,v,{initial:E.initial.update,final:E.final.update},Z)}else if(!g&&b.final||!y&&b.initial){if(!b.initial&&b.final){var G=Object(p.local)(),Y=Object(p.select)(l+" .mark-".concat(v.initial,".role-mark.").concat(f.compName)).selectAll("path");Un(Y=Y.each((function(e){G.set(this,e)})).transition(),o[v.initial],Object.assign({},x,{primary:x.final,secondary:x.initial}),w.final,Object.assign({},E.initial.exit,{opacity:{value:0}}),G),Y.duration((function(e,t){return s.find((function(e){return"exit"===e.set})).duration})).delay((function(e,t){return s.find((function(e){return"exit"===e.set})).delay})).ease(h).remove().end().then((function(){Object(p.select)("".concat(l," .mark-").concat(v.initial,".role-mark.").concat(f.compName)).remove(),d("exit",(function(){e()}))}));var X=f.final.parent,ee=jr(c.scenegraph().root,X.name);ei(Object(p.select)("".concat(l," .").concat(X.parent.name," > g > g")),f.final,ee?".".concat(ee.name):void 0,{hasGroup:!0});var te=Object(p.select)(l+" .role-scope.".concat(X.name)).selectAll("g").data(t.nextData).enter().append("g");te.append("path").attr("class","background");var ae=te.append("g").append("g").attr("class","".concat(v.final,"-mark role-mark ").concat(f.compName)).append("path");Un(ae,o[v.final],{primary:x.initial,secondary:x.final},w.initial,Object.assign({},E.final.enter,{opacity:{value:0}}));var re=ae.each((function(e){G.set(this,e)})).transition();Un(re,o[v.final],x,w.final,E.final.enter,G),re.duration((function(e,t){return s.find((function(a){return a.id===n(e,t,"final")})).duration})).delay((function(e,t){return s.find((function(a){return a.id===n(e,t,"final")})).delay})).ease(h).end().then((function(){d("enter",(function(){e()}))})),d("update",(function(){e()}))}else if(b.initial&&!b.final){var ne=f.initial.parent,ie=Object(p.local)(),oe=Object(p.select)(l+" .role-scope.".concat(ne.name)).selectAll(" .role-scope.".concat(ne.name," > g")).data(t.currData).select(".".concat(f.compName," > path")).each((function(e){ie.set(this,e)}));Un(oe=oe.transition(),o[v.initial],Object.assign({},x,{primary:x.final,secondary:x.initial}),w.final,Object.assign({},E.initial.exit,{opacity:{value:0}}),ie),oe.duration((function(e,t){return s.find((function(a){return a.id===n(e,t,"initial")})).duration})).delay((function(e,t){return s.find((function(a){return a.id===n(e,t,"initial")})).delay})).ease(h).remove().end().then((function(){d("exit",(function(){e()}))}));var se=jr(c.scenegraph().root,f.compName),ue=ei(Object(p.select)("".concat(l," .").concat(f.final.parent.name," > g > g")),f.final,se?".".concat(se.name):void 0);Un(ue=ue.selectAll("path").data(t.nextData).enter().append("path"),o[v.final],{primary:x.initial,secondary:x.final},w.initial,Object.assign({},E.final.enter,{opacity:{value:0}})),ue.each((function(e){ie.set(this,e)}));var le=ue.transition();Un(le,o[v.final],x,w.final,E.final.enter,ie),le.duration((function(e,t){return s.find((function(e){return"enter"===e.set})).duration})).delay((function(e,t){return s.find((function(e){return"enter"===e.set})).delay})).ease(h).end().then((function(){d("enter",(function(){e()}))})),d("update",(function(){e()}))}}else{var ce=Object(p.select)(l+" .mark-".concat(v.initial,".role-mark.").concat(f.compName)),fe=ce.selectAll("path"),de=Object(p.local)();fe.each((function(e){de.set(this,e)})),(f.data||y||g)&&(fe=fe.data(t.nextData));var pe=fe.enter().append("path");if(Un(pe,o[a],{primary:x.initial,secondary:x.final},w.initial,E.initial.enter),pe.data().length>0){var me=pe.transition();Un(me,o[a],x.final,w.final,E.final.enter),me.duration(t.timing.duration).delay(t.timing.delay).ease(h).end().then((function(){d("enter",(function(){e()}))}))}else d("enter",(function(){e()}));var he=fe.exit();if(he.data().length>0){var ve=he.transition();Un(ve,o[a],{primary:x.final,secondary:x.initial},w.final,E.final.exit),ve.duration((function(e,a){return t.timing.duration})).delay((function(e,a){return t.timing.delay})).ease(h).end().then((function(){d("exit",(function(){e()}))}))}else d("exit",(function(){e()}));if(fe.data().length>0){v.initial!==v.final&&(ce.classed("mark-".concat(v.initial),!1),ce.classed("mark-".concat(v.final),!0));var ye=fe.transition();Un(ye,ge(v),x,w.final,{initial:E.initial.update,final:E.final.update},de),ye.duration(t.timing.duration).delay(t.timing.delay).ease(h).end().then((function(){d("update",(function(){e()}))}))}else d("update",(function(){e()}))}function ge(e){var t="string"===typeof e?e:e.final,a=f.data&&_r(t)?u[t]:o[t];return m(e.initial)&&m(e.final)&&e.final!==e.initial&&(a[0].tweaks.push({type:"attrTween",val:"d",initialMarktype:e.initial,interpolateStyle:"update"}),a[0].tweaks.push({type:"style",val:"fill",initialMarktype:e.initial,asTween:!0}),a[0].tweaks.push({type:"style",val:"stroke",initialMarktype:e.initial})),a}function be(t,a,r,s,u,l){var c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],p=a.exit();if(0!==p.data().length&&(f.data||y||g)||(p=a.filter((function(e){return"exit"===i(e)}))),p.data().length>0){var m=p.select(".".concat(f.compName," > path")),v=m.transition();Un(v,o[r],Object.assign({},x,{primary:x.final,secondary:x.initial}),w.final,s,u),v.duration((function(e,a){return t.find((function(t){return t.id===n(e,a,l)})).duration})).delay((function(e,a){return t.find((function(t){return t.id===n(e,a,l)})).delay})).ease(h).remove().end().then((function(){p.remove(),d(c?"all":"exit",(function(){e()}))}))}else d(c?"all":"exit",(function(){e()}))}function xe(t,a,r,o,s){var u=a.filter((function(e){return"update"===i(e)}));!1===f.data&&0===u.data().length&&(u=a);var l=u.select(".".concat(f.compName));(r.initial!==r.final&&(l.classed("mark-".concat(r.initial),!1),l.classed("mark-".concat(r.final),!0)),(l=l.select("path")).data().length>0)?(Un(l=l.transition(),ge(r),x,w.final,o,s),l.duration((function(e,a){return t.find((function(t){return t.id===n(e,a)})).duration})).delay((function(e,a){return t.find((function(t){return t.id===n(e,a)})).delay})).ease(h).end().then((function(){d("update",(function(){e()}))}))):d("update",(function(){e()}))}function Ee(t,a,r){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E.initial.enter,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:E.final.enter,l=a.enter().append("g");l.append("path").attr("class","background");var c=l.append("g").append("g").attr("class","mark-".concat(r," role-mark ").concat(f.compName)).append("path");if(Un(c,o[r],{primary:x.initial,secondary:x.final},w.initial,s),0!==l.data().length&&(f.data||y||g)||(c=a.filter((function(e){return"enter"===i(e)})).selectAll(".".concat(f.compName," > path"))),c.data().length>0){var m=Object(p.local)();c.each((function(e){m.set(this,e)}));var v=c.transition();Un(v,o[r],x,w.final,u,m),v.duration((function(e,a){return t.find((function(t){return t.id===n(e,a,"final")})).duration})).delay((function(e,a){return t.find((function(t){return t.id===n(e,a,"final")})).delay})).ease(h).end().then((function(){d("enter",(function(){e()}))}))}else d("enter",(function(){e()}))}}))}},marktypeChange:function(e,t,a){return ii.apply(this,arguments)}},view:function(e,t,a){var r=a;return new Promise((function(e){var a=Or(t.timing.ease);!1===t.change.signal&&e();var n=Object(p.select)("".concat(r," svg")),i=t.encodes.final.svg;n.transition().tween("resize",(function(){var e=Object(p.interpolate)(this.getAttribute("width"),i.width.value),t=Object(p.interpolate)(this.getAttribute("height"),i.height.value);return function(a){var r=Math.round(1*e(a))/1,n=Math.round(1*t(a))/1;this.setAttribute("width",r),this.setAttribute("height",n),this.setAttribute("viewBox","0 0 ".concat(r," ").concat(n))}})).duration(t.duration).delay(t.delay).ease(a).end().then((function(){e()})),n.select("g").transition().attr("transform",Dn({x:i.x.value,y:i.y.value})).duration(t.duration).delay(t.delay).ease(a);var o=n.select(".root g > .background"),s=t.encodes.final.root,u=Object.keys(s).reduce((function(e,t){return e[t]=s[t].value,e}),{});Un(o=o.data([u]).transition(),["background","fill","stroke"],{},t.signals.final,s),o.duration(t.duration).delay(t.delay).ease(a)}))},pause:function(e){return new Promise((function(t){setTimeout((function(){t()}),e.duration+e.delay)}))}};function ii(){return(ii=Object(l.a)(u.a.mark((function e(t,a,r){var n,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.marktypes.initial,!_r(i=a.marktypes.final)||!_r(n)){e.next=4;break}return e.abrupt("return",ni.mark.interpolate.areaLine(t,a,r));case 4:if(!(_r(n)&&["rule","rect","symbol","text"].indexOf(i)>=0||_r(i)&&["rule","rect","symbol","text"].indexOf(n)>=0)){e.next=6;break}return e.abrupt("return",Promise.all([ni.mark.interpolate.others(t,a,r),ni.mark.interpolate.areaLine(t,a,r)]));case 6:return e.abrupt("return",ni.mark.interpolate.others(t,a,r));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function oi(e,t,a){for(var r=e.getTimeline(":main"),n=xn(r,a),i=t.filter((function(e){return e.autoScaleOrder})),o=e.getTimelineAlternator(i);!si(i,n);){var s=o();if(!s){n=xn(r,a);break}n=xn(s,a)}return n}function si(e,t){var a=!0;return e.forEach((function(e){e.autoScaleOrder.forEach((function(e){var r=t.find((function(t){return t.compName===e}));r&&!1===r.scaleOrderValid&&(a=!1)}))})),a}function ui(e){return e.forEach((function(e){e.steps=e.steps.map((function(e){var t=function(e){var t=e.marktypes;return"mark"===e.compType?t.final&&t.initial&&t.initial!==e.marktypes.final?ni.mark.marktypeChange:_r(t.initial)||_r(t.final)?ni.mark.interpolate.areaLine:ni.mark.interpolate.others:ni[e.compType]}(e);return t||console.error("There is no such animation template for ".concat(e.compType,".")),e.template=t,e}))})),e}var li=function(){function e(){Object(c.a)(this,e)}return Object(f.a)(e,null,[{key:"animate",value:function(){var e=Object(l.a)(u.a.mark((function e(t,a,r){var n,i,o,s,l,c,f;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new d.b(Object(d.c)(a),{renderer:"svg"}).runAsync();case 2:return n=e.sent,e.next=5,new d.b(Object(d.c)(t),{renderer:"svg"}).runAsync();case 5:return i=e.sent,s=Hr(r,o={sVis:{view:i,spec:t},eVis:{view:n,spec:a}}),l=s.schedule,c=s.resolves,l.tracks=bn(o,l.tracks),f=oi(l,c,o),e.abrupt("return",new h(ui(f),o,r));case 11:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}()}]),e}(),ci=[{channel:"x",attrs:["x","x2","xc","width"]},{channel:"y",attrs:["y","y2","yc","height"]},{channel:"color",attrs:["stroke","fill"]},{channel:"shape",attrs:["shape"]},{channel:"size",attrs:["size"]},{channel:"opacity",attrs:["opacity"]},{channel:"text",attrs:["text"]},{channel:"others",attrs:["tooltip","define","strokeWidth"]}],fi=["x","y","color","shape","size","opacity","text"],di={x:["x","x2","xc","width"],y:["y","y2","yc","height"],color:["stroke","fill"],shape:["shape"],size:["size"],opacity:["opacity"],text:["text"],others:["tooltip","define","strokeWidth"]};function pi(e,t){var a={};if("others"===t){var r=g(e);return ci.reduce((function(e,t){return e.concat(t.attrs)}),[]).forEach((function(e){delete r[e]})),r}return di[t].forEach((function(t){a[t]=e[t]})),a}function mi(e,t,a){if(e){if("color"===t){var r=["line","rule","symbol"].indexOf(a)>=0?e.stroke:e.fill;return"symbol"===r&&e.fill&&"transparent"!==e.fill.value&&(r=e.fill),r}return"x"===t?e.x||e.xc:"y"===t?e.y||e.yc:e[t]}}function hi(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=wi(e),r=yn(vn(e.sVis.spec),vn(e.eVis.spec)),n=r.filter((function(e){return"scale"===e.compType})).reduce((function(a,r){return a[r.compName]=r,a[r.compName].meta=gi(r,e,t.scales),a}),{}),i=r.filter((function(e){return["root","pathgroup"].indexOf(e.compName)<0&&"scale"!==e.compType})).map((function(t){switch(t.compType){case"mark":t.meta=yi(t,e,n);break;case"axis":t.meta=xi(t,e,n);break;case"legend":t.meta=bi(t,e,n)}return t})),o=Ei(e);return{compDiffs:i,scaleDiffs:n,signalDiffs:a,viewDiffs:o}}function vi(e,t){var a={},r=!1;return e.forEach((function(e){a[e]=t[e].meta,r=r||t[e].meta}),{}),!!r&&a}function yi(e,t,a){var r={view:{deltaW:0,deltaH:0}};e.initial?e.final||(r.remove=!0,r.view={deltaW:10,deltaH:10}):(r.add=!0,r.view={deltaW:10,deltaH:10}),r.marktype=!e.initial||!e.final||e.initial.type!==e.final.type;var n=Object.keys(k(e,"initial","encode","update")||{}),i=Object.keys(k(e,"final","encode","update")||{});r.usedEnAttrs=n.concat(i).unique(),r.encode=fi.reduce((function(t,a){var n=pi(k(e,"initial","encode","update")||{},a),i=pi(k(e,"final","encode","update")||{},a);if(t[a]=!y(n,i),"opacity"===a&&(k(n,"opacity","value")||void 0===k(n,"opacity"))&&(k(i,"opacity","value")||void 0===k(i,"opacity"))){var o=k(n,"opacity","value")||1,s=k(i,"opacity","value")||1;Math.abs(o-s)<.5&&(t.opacity=!1)}if(r.marktype&&t[a]){var u=k(e,"initial","type"),l=k(e,"final","type");y(mi(n,a,u),mi(i,a,l))&&(t[a]="byMarktypeChange")}return t}),{});var o=[];["update"].forEach((function(t){[e.initial&&e.initial.encode[t],e.final&&e.final.encode[t]].forEach((function(e){Object.keys(e||{}).map((function(t){e[t].scale&&o.push(e[t].scale)}))}))})),r.usedScales=o.unique(),r.scale=vi(r.usedScales,a),r.scNames=Object.keys(r.scale),r.view={deltaW:r.scale.x?r.scale.x.rangeDelta:r.view.deltaW,deltaH:r.scale.y?r.scale.y.rangeDelta:r.view.deltaH},r.scale.y&&r.scale.y.add?r.view.deltaH=10:r.scale.y&&r.scale.y.remove&&(r.view.deltaH=-10),r.scale.x&&r.scale.x.add?r.view.deltaW=10:r.scale.x&&r.scale.x.remove&&(r.view.deltaW=-10);var s=e.initial?Xr(t.sVis.view,e.initial,e.compName):[],u=e.final?Xr(t.eVis.view,e.final,e.compName):[];return Nr(e.initial)&&Nr(e.final)&&(r.data=ki(Yr(s),Yr(u))),r.data||(s=Nr(e.initial)?Yr(s):s,u=Nr(e.final)?Yr(u):u,r.data=ki(s,u)),r}function gi(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e.initial)return{add:!0};if(!e.final)return{remove:!0};var r=!y(e.initial,e.final)&&{},n=t.sVis.view.scale(e.initial.name).range(),i=t.eVis.view.scale(e.final.name).range(),o=0;y(n,i)||2===n.length&&D(n[0])&&D(n[1])&&2===i.length&&D(i[0])&&D(i[1])&&(o=Math.abs(i[0]-i[1])-Math.abs(n[0]-n[1]));var s=t.sVis.view.scale(e.initial.name).domain(),u=t.eVis.view.scale(e.final.name).domain();if(!r&&y(s,u)&&0===o)return!1;r={rangeDelta:o,domainValueDiff:!y(s,u)};var l=k(a[e.initial.name],"domainDimension");return r.domainSpaceDiff="diff"===l||"same"!==l&&!y(e.initial.domain,e.final.domain),["band","point","ordinal"].indexOf(e.initial.type)>=0&&["band","point","ordinal"].indexOf(e.final.type)>=0&&(r.stayDiscrete=!0),r}function bi(e,t,a){var r={usedScales:[],view:{deltaW:0,deltaH:0,x:0,y:0}};e.initial?e.final||(r.remove=!0,r.view={deltaW:-10,deltaH:-10,x:-10,y:-10}):(r.add=!0,r.view={deltaW:10,deltaH:10,x:10,y:10});var n=g(e.initial||{}),i=g(e.final||{});if(["fill","opacity","shape","size","stroke","strokeDash","strokeWidth"].forEach((function(t){e.initial&&e.initial[t]&&r.usedScales.push(e.initial[t]),e.final&&e.final[t]&&r.usedScales.push(e.final[t]),delete n[t],delete i[t]}),!1),r.usedScales=r.usedScales.unique(),r.scale=vi(r.usedScales,a),r.scNames=Object.keys(r.scale),r.encode=!y(n,i),e.initial&&e.final){var o={initial:Pr(t.sVis.view.scenegraph().root,e.compName,"legend")[0].items[0],final:Pr(t.eVis.view.scenegraph().root,e.compName,"legend")[0].items[0]};r.view.x=o.final.x-o.initial.x,r.view.y=o.final.y-o.initial.y}return r}function xi(e,t,a){var r={view:{deltaW:0,deltaH:0,x:0,y:0}};if(e.initial?e.final||(r.remove=!0,r.view={deltaW:-10,deltaH:-10,x:-10,y:-10}):(r.add=!0,r.view={deltaW:10,deltaH:10,x:10,y:10}),r.usedScales=[],e.initial?r.usedScales.push(e.initial.scale):e.final&&r.usedScales.push(e.final.scale),r.scale=vi(r.usedScales,a),r.scNames=Object.keys(r.scale),e.final&&e.initial&&(r.view={deltaW:r.scale.x?r.scale.x.rangeDelta:0,deltaH:r.scale.y?r.scale.y.rangeDelta:0},e.initial.scale===e.final.scale))if(!!e.initial.grid!==!!e.final.grid)"x"===e.final.scale?r.view.deltaH=e.initial.grid?-10:10:"y"===e.final.scale&&(r.view.deltaW=e.initial.grid?-10:10);else if(e.initial.grid&&e.final.grid){var n=k(a,e.initial.gridScale,"meta","rangeDelta")||0;"left"===e.final.orient||"right"===e.final.orient?r.view.deltaW=n:r.view.deltaH=n}var i=g(e.initial)||{},o=g(e.final||{});if(delete i.scale,delete o.scale,r.encode=!y(i,o),e.initial&&e.final){var s={initial:Pr(t.sVis.view.scenegraph().root,e.compName,"axis")[0].items[0],final:Pr(t.eVis.view.scenegraph().root,e.compName,"axis")[0].items[0]};r.view.x=s.final.x-s.initial.x,r.view.y=s.final.y-s.initial.y}return r}function Ei(e){var t=gn(e),a=t.final.padding-t.initial.padding;return t.deltaW=t.final.viewWidth-t.initial.viewWidth+a,t.deltaH=t.final.viewHeight-t.initial.viewHeight+a,t.width={},t.height={},Math.abs(t.deltaW)>5&&(t.width[t.deltaW>0?"increase":"decrease"]=!0),Math.abs(t.deltaH)>5&&(t.height[t.deltaH>0?"increase":"decrease"]=!0),t.scNames=[],t}function wi(e){var t={initial:e.sVis.view._runtime.signals,final:e.eVis.view._runtime.signals,meta:{update:[],exit:[],enter:[],same:[]}};return Object.keys(t.initial).concat(Object.keys(t.final)).unique().forEach((function(e){var a=t.final[e],r=t.initial[e];a?r?y(a.value,r.value)?t.meta.same.push(e):t.meta.update.push(e):t.meta.enter.push(e):t.meta.exit.push(e)})),t}function ki(e,t){var a={column:!1,row:!1},r=e[0]?Object.keys(e[0].datum):[],n=t[0]?Object.keys(t[0].datum):[],i=[];if(y(r,n)?i=r:r.containAll(n)?(a.column="removed",i=n):n.containAll(r)?(a.column="added",i=r):(a.column="changed",i=r.filter((function(e){return n.indexOf(e)>=0}))),i.length>0){var o=e.map((function(e){return i.map((function(t){return e.datum[t]})).join(",")})),s=t.map((function(e){return i.map((function(t){return e.datum[t]})).join(",")}));a.row=!y(o,s)}else a.row=e.length!==t.length;return!(!a.column&&!a.row)&&(a.sharedFields=i,a)}var Ai=function(){function e(t,a){Object(c.a)(this,e);var r=a.sVis.view,n=Xr(r,t.initial,t.compName),i=t.initial?Nr(t.initial):void 0;n=i?Yr(n):n,this.markDiff=t,this.rawInfo=a,this.isEmpty=t.add,this.marktype=k(t,"initial","type"),this.encode=k(t,"initial","encode","update")||{},this.data={hasFacet:i,fields:n[0]?Object.keys(n[0].datum):[],values:n},this.scales=t.meta.usedScales.reduce((function(e,t){var a=r._runtime.scales[t];return a&&(e[t]=a.value),e}),{}),this.style=k(t,"initial","style")}return Object(f.a)(e,[{key:"applyDiff",value:function(e,t){var a=this;if("add"===e&&(this.isEmpty=!0),"remove"===e&&(this.isEmpty=!1),"marktype"===e)this.marktype=k(this.markDiff,"final","type"),t.forEach((function(e){a.applyDiff(e)}));else if("data"===e){this.data={hasFacet:this.markDiff.final?Nr(this.markDiff.final):void 0};var r=Xr(this.rawInfo.eVis.view,this.markDiff.final,this.markDiff.compName);r=this.data.hasFacet?Yr(r):r,this.data.fields=r[0]?Object.keys(r[0].datum):[],this.data.values=r}else if(e.indexOf("encode.")>=0){var n=e.replace("encode.","");this.encode=Object.assign({},this.encode,this.markDiff.final?pi(this.markDiff.final.encode.update,n):{})}else if(e.indexOf("scale.")>=0){var i=e.replace("scale.",""),o=this.rawInfo.eVis.view._runtime.scales[i];o?this.scales[i]=o.value:delete this.scales[i]}else"style"===e&&(this.style=k(this.markDiff,"final","style"));return this}}]),e}();function Di(e,t){return e.reduce((function(e,a){var r=a.reduce((function(e,a){return e&&t[a]}),!0);return e||r}),!1)}function Oi(e,t){return function(e){var t,a,i=[];e.concat.forEach((function(e,r){e.sync.forEach((function(e){var n=k(e,"diff","meta","view","x"),o=k(e,"diff","meta","view","y");"axis"!==e.diff.compType||"x"!==e.diff.compName||a||(a={width:n>=10?"inc":n<=-10&&"dec",height:o>=10?"inc":o<=-10&&"dec",orient:k(e,"diff","initial","orient")||k(e,"diff","final","orient"),when:r}),"axis"!==e.diff.compType||"y"!==e.diff.compName||t||(t={width:n>=10?"inc":n<=-10&&"dec",height:o>=10?"inc":o<=-10&&"dec",orient:k(e,"diff","initial","orient")||k(e,"diff","final","orient"),when:r}),"mark"===e.diff.compType&&i.push({width:n>=10?"inc":n<=-10&&"dec",height:o>=10?"inc":o<=-10&&"dec",when:r})}))}));for(var o=0,s=[[a,t,"bottom","height"],[t,a,"right","width"]];o<s.length;o++){var u=s[o],l=Object(r.a)(u,4),c=l[0],f=l[1],d=l[2],p=l[3];if(k(c,"orient")===d)if("inc"===c[p]){if(c.when>k(f,"when"))return!1;if(i.length>0&&c.when>Math.min.apply(Math,Object(n.a)(i.map((function(e){return e.when})))))return!1}else if("dec"===c[p]){if(c.when<k(f,"when"))return!1;if(i.length>0&&c.when<Math.max.apply(Math,Object(n.a)(i.map((function(e){return e.when})))))return!1}}return!0}(e)&&function(e){var t={marks:[],legends:[]};if(e.concat.forEach((function(e,a){e.sync.forEach((function(e){var r=k(e,"diff","meta","view","x"),n=k(e,"diff","meta","view","y"),i=k(e,"diff","meta","view","deltaW"),o=k(e,"diff","meta","view","deltaH");if(["legend","mark"].indexOf(e.diff.compType)>=0){var s={x:r>=10?"inc":r<=-10&&"dec",y:n>=10?"inc":n<=-10&&"dec",width:i>=10?"inc":i<=-10&&"dec",height:o>=10?"inc":o<=-10&&"dec",when:a};(s.x||s.y||s.width||s.height)&&("legend"===e.diff.compType?(s.orient=k(e,"diff","initial","orient")||k(e,"diff","final","orient")||"right",t.legends.push(s)):t.marks.push(s))}}))})),0===t.marks.length||0===t.legends.length)return!0;var a,r=Object(o.a)(t.marks);try{for(r.s();!(a=r.n()).done;){var i=a.value,s=t.legends.filter((function(e){return"right"===e.orient}));if(s.length>0)if("inc"===i.width){if(i.when<Math.min.apply(Math,Object(n.a)(s.filter((function(e){return"inc"===e.x})).map((function(e){return e.when})))))return!1}else if("dec"===i.width&&i.when>Math.max.apply(Math,Object(n.a)(s.filter((function(e){return"dec"===e.x})).map((function(e){return e.when})))))return!1;var u=t.legends.filter((function(e){return"bottom"===e.orient}));if(u.length>0)if("inc"===i.height){if(i.when<Math.min.apply(Math,Object(n.a)(u.filter((function(e){return"inc"===e.y})).map((function(e){return e.when})))))return!1}else if("dec"===i.height&&i.when>Math.max.apply(Math,Object(n.a)(u.filter((function(e){return"dec"===e.y})).map((function(e){return e.when})))))return!1}}catch(l){r.e(l)}finally{r.f()}return!0}(e)&&!e.concat.find((function(e){return 0===e.sync.length}))&&e.concat.length===t&&function(e){var t,a=Object(o.a)(e.concat);try{for(a.s();!(t=a.n()).done;)for(var r=t.value.sync.filter((function(e){return"mark"===e.diff.compType})),n=0;n<r.length;n++){var i=r[n];if((y(i.factorSets.current,["data"])||y(i.factorSets.current,["data","marktype"]))&&!1===i.diff.meta.data.row)return!1}}catch(s){a.e(s)}finally{a.f()}return!0}(e)}function ji(e,t,a,r){var s,u=e.compDiffs.filter((function(e){return"mark"===e.compType})).map((function(e){for(var r=function(e){var t=[],a=e.meta,r=[];a.add&&t.push("add");if(a.remove)return t.push("remove"),{allFactors:t,extraFactorsByMarktype:r};a.marktype&&(t.push("marktype"),r.push("encode.others"));a.data&&(!1===a.data.row&&"removed"===a.data.column||t.push("data"));a.scale&&Object.keys(a.scale).forEach((function(e){a.scale[e]&&t.push("scale.".concat(e))}));return Object.keys(a.encode).forEach((function(e){var n=a.encode[e];!0===n?t.push("encode.".concat(e)):"byMarktypeChange"===n&&r.push("encode.".concat(e))})),{allFactors:t,extraFactorsByMarktype:r}}(e),i=r.allFactors,o=r.extraFactorsByMarktype,s=new Fi,u=[],l=function(r){for(var l=function(e,t,a){for(var r=e,n=new Array(t),i=0;i<t;i++)n[i]=r%a,r=Math.floor(r/a);return n}(r,i.length,t),c=!0,f=[],d=function(r){var u=i.filter((function(e,a){return l[a]>=t-r-1}));if(s.check(u))return c=!1,"break";var d=function(e){var t=e.encode,a=e.marktype,r=e.data,i=e.scales;if(e.isEmpty)return{result:!0};if("rect"===a){var o=Di([["x","x2"],["x","width"],["xc","width"]],t),s=Di([["y","y2"],["y","height"],["yc","height"]],t);if(!o||!s)return{result:!1,reasons:["encode","marktype"]}}else if("area"===a){if(!(t.orient&&"horizontal"===t.orient.value?Di([["x","x2","y"],["x","y","width"]],t):Di([["x","y2","y"],["x","y","height"]],t)))return{result:!1,reasons:["encode","marktype"]}}else if("line"===a){if(Di([["x2","x"],["y2","y"],["y","height"],["yc","height"],["x","width"],["xc","width"]],t))return{result:!1,reasons:["encode","marktype"]}}else if("text"===a){if(!t.text)return{result:!1,reasons:["encode","marktype"]}}else if("rule"===a){if(!Di([["x","x2","y"],["y","y2","x"]],t))return{result:!1,reasons:["encode","marktype"]}}else if(!a)return{result:!1,reasons:["marktype"]};var u=Object.keys(t),l=!0;if(Object.keys(i||{}).forEach((function(e){u.find((function(a){return t[a]&&t[a].scale===e}))||(l=!1)})),!l)return{reasons:["encode","scale"],result:!1};for(var c=function(e){var a=t[u[e]];if(a&&a.scale){if(!i[a.scale])return{v:{reasons:["encode","scale"],result:!1}};if(a.band&&"band"!==i[a.scale].type)return{v:{reasons:["encode","scale"],result:!1}}}if(a&&a.field){if(r.fields.indexOf(a.field)<0)return{v:{result:!1,reasons:["encode","data"]}};if(a.scale){var o=i[a.scale],s=r.values.map((function(e){return e.datum[a.field]})),l=o.domain(),c=!0;if(["band","ordinal","point"].indexOf(o.type)>=0)c=c&&s.reduce((function(e,t){return e&&l.indexOf(t)>=0}),!0);else if("linear"===o.type){var f=Math.max.apply(Math,Object(n.a)(s)),d=Math.min.apply(Math,Object(n.a)(s));c=c&&l[0]<=d&&l[1]>=f}else if("time"===o.type){var p=Math.max.apply(Math,Object(n.a)(s)),m=Math.min.apply(Math,Object(n.a)(s));c=c&&l[0]<=m&&l[1]>=p}if(!c)return{v:{reasons:["encode","data","scale"],result:!1}}}}},f=0;f<u.length;f++){var d=c(f);if("object"===typeof d)return d.v}return{result:!0}}(function(e,t,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],n=new Ai(e,a);return t.forEach((function(e){n.applyDiff(e,r)})),n}(e,u,a,o)).reasons;if(d){var p=i.filter((function(e){return d.find((function(t){return e.indexOf(t)>=0}))})).map((function(e){return{factor:e,include:u.indexOf(e)>=0}}));return s.register(p),c=!1,"break"}f.find((function(e){return e.toString()===u.toString()}))||f.push(u)},p=0;p<t-1;p++){if("break"===d(p))break}c&&(f.push(i),u.find((function(e){return e.toString()===f.toString()}))||u.push(f))},c=0;c<Math.pow(t,i.length);c++)l(c);return u.map((function(t){var a;return t.map((function(t){var r={diff:e,factorSets:{current:a?t.exclude(a):t,applied:t,all:i,extraByMarktype:o}};return a=t,r}))}))})),l=function(e){return e.compDiffs.filter((function(e){return"axis"===e.compType&&(e.meta.scale||e.meta.encode||e.meta.add||e.meta.remove||Math.abs(e.meta.view.x)-10>0||Math.abs(e.meta.view.y)-10>0||Math.abs(e.meta.view.deltaH)-10>0||Math.abs(e.meta.view.deltaW)-10>0)})).filter((function(e){if(e.meta.scale[e.meta.usedScales[0]]){var t=e.meta.scale[e.meta.usedScales[0]];return!(0===t.rangeDelta&&!t.domainValueDiff&&t.stayDiscrete)}return!0})).map((function(e){var t=[];return e.meta.add?t=["add.".concat(e.compName)]:e.meta.remove?t=["remove.".concat(e.compName)]:(e.meta.scale&&(t=t.concat(Object.keys(e.meta.scale).map((function(e){return"scale.".concat(e)})))).push("encode"),0===e.meta.view.x&&0===e.meta.view.y||t.push("encode.position")),{diff:e,factorSets:{current:t,applied:t,all:t}}}))}(e),c=function(e){return e.compDiffs.filter((function(e){return"legend"===e.compType&&(e.meta.scale||e.meta.encode||e.meta.add||e.meta.remove||Math.abs(e.meta.view.x)-10>0||Math.abs(e.meta.view.y)-10>0||Math.abs(e.meta.view.deltaH)-10>0||Math.abs(e.meta.view.deltaW)-10>0)})).reduce((function(e,t){var a=[];return t.meta.add?a=["add.".concat(t.meta.usedScales.sort().join("_"))]:t.meta.remove?a=["remove.".concat(t.meta.usedScales.sort().join("_"))]:(t.meta.scale&&(a=a.concat(Object.keys(t.meta.scale).map((function(e){return"scale.".concat(e)})))),t.meta.encode&&a.push("encode"),0===t.meta.view.x&&0===t.meta.view.y||a.push("encode.position")),e.concat({diff:t,factorSets:{current:a,all:a}})}),[])}(e);return 1===u.length?s=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w,r=g(e);return t.forEach((function(e){r=r.reduce((function(t,r){return t.concat(a(r,e))}),[])})),r}(u[0],c.concat(l),Pi).map((function(e){return{concat:e.map((function(e){return{sync:Array.isArray(e)?e:[e]}}))}})):(console.error("Currently, Gemini Recommendation only supports a single mark without adding or removing."),console.error("TODO: cross join the pseudo timelines of each mark.")),s.map((function(e){return e.concat=e.concat.map((function(e){var t=e.sync;return{sync:t=t.filter((function(e){return"mark"!==e.diff.compType||!(0===e.factorSets.applied.length||0===e.factorSets.current.length)&&!(e.factorSets.all.indexOf("add")>=0&&e.factorSets.applied.indexOf("add")<0)&&!(e.factorSets.all.indexOf("remove")>=0&&e.factorSets.applied.length!==e.factorSets.current.length)}))}})),e})).filter((function(e){return Oi(e,t)})).map((function(t){return function(e,t){var a={increase:{width:!1,height:!1},decrease:{width:!1,height:!1}};function r(e,r){for(var n=0,i=["width","height"];n<i.length;n++){var o=i[n];if(t[o][r]&&Si(e.sync,r,o)&&!a[r][o]){var s=e.sync.find((function(e){return"view"===e.diff.compType}));s?s.factorSets.current.push(o):e.sync.push({diff:{compName:t.compName,compType:t.compType,meta:t},factorSets:{current:[o]}}),a[r][o]=!0}}return e}return{concat:e.concat.map((function(e,t){return r(e,"increase")})).reverse().map((function(e){return r(e,"decrease")})).reverse()}}(t,e.viewDiffs)})).map((function(e){return function(e){var t,a;if(e.concat.forEach((function(e){t=t||e.sync.find((function(e){return!e.diff.meta.add&&!e.diff.meta.remove&&"axis"===e.diff.compType&&"x"===e.diff.meta.scNames[0]})),a=a||e.sync.find((function(e){return!e.diff.meta.add&&!e.diff.meta.remove&&"axis"===e.diff.compType&&"y"===e.diff.meta.scNames[0]}))})),!t&&!a)return e;return Object(i.a)({},e,{concat:e.concat.map((function(e){var r=g(e);if(e.sync.find((function(e){return["mark","axis"].indexOf(e.diff.compType)>=0&&0!==e.diff.meta.view.deltaH}))&&t&&!e.sync.find((function(e){return"axis"===e.diff.compType&&"x"===e.diff.meta.scNames[0]}))){t.factorSets.all.push("encode.only.grid");var n=Object(i.a)({},t,{factorSets:{all:g(t.factorSets.all),applied:["encode.only.grid"],current:["encode.only.grid"]}});t.factorSets.applied.push("encode.only.grid"),r.sync.push(n)}if(e.sync.find((function(e){return["mark","axis"].indexOf(e.diff.compType)>=0&&0!==e.diff.meta.view.deltaW}))&&a&&!e.sync.find((function(e){return"axis"===e.diff.compType&&"y"===e.diff.meta.scNames[0]}))){a.factorSets.all.push("encode.only.grid");var o=Object(i.a)({},a,{factorSets:{all:g(a.factorSets.all),applied:["encode.only.grid"],current:["encode.only.grid"]}});a.factorSets.applied.push("encode.only.grid"),r.sync.push(o)}return r}))})}(e)})).map((function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.totalDuration||2e3;return e.concat.forEach((function(t){var a,r=Object(o.a)(t.sync);try{for(r.s();!(a=r.n()).done;){a.value.timing={duration:{ratio:Math.floor(100/e.concat.length)/100}}}}catch(n){r.e(n)}finally{r.f()}})),e.totalDuration=a,e}(e,r)}))}function Si(e,t,a){var r,n=Object(o.a)(e.filter((function(e){return["mark","axis","legend"].indexOf(e.diff.compType)>=0})));try{for(n.s();!(r=n.n()).done;){var i=r.value,s="width"===a?"x":"y";("mark"===i.diff.compType||"axis"===i.diff.compType&&["left","top"].indexOf((i.diff.initial||i.diff.final).orient)>=0)&&(s="width"===a?"deltaW":"deltaH");var u=!0;if("mark"===i.diff.compType&&(u=i.factorSets.current.indexOf("width"===a?"scale.x":"scale.y")>=0),i.diff.meta.view[s]>=10&&"increase"===t&&u)return!0;if(i.diff.meta.view[s]<=-10&&"decrease"===t&&u)return!0}}catch(l){n.e(l)}finally{n.f()}return!1}function Pi(e,t){for(var a=[],r=0;r<e.length;r++){var n=g(e);Array.isArray(n[r])||(n[r]=[n[r]]);var i=n[r].find((function(e){return e.diff.compName===t.diff.compName}));i?i.factorSets.current=i.factorSets.current.concat(t.factorSets.current):n[r].push(t),a.push(n)}return a}var Fi=function(){function e(){Object(c.a)(this,e),this.registered=[]}return Object(f.a)(e,[{key:"register",value:function(e){this.registered.push(e)}},{key:"check",value:function(e){for(var t=0;t<this.registered.length;t++){if(this.registered[t].reduce((function(t,a){return t&&e.indexOf(a.factor)>=0===a.include}),!0))return!0}return!1}}]),e}();var Ci=function(e,t){return!1===k(e,"diff","meta","scale",t.split(".")[1],"domainSpaceDiff")},Bi=function(e,t){return!0===k(e,"diff","meta","scale",t.split(".")[1],"domainSpaceDiff")},Ti=function(e){return function(t){var a,r=Object(o.a)(e);try{for(r.s();!(a=r.n()).done;){var n=a.value;if(t.factorSets.current.indexOf(n)>=0)return!1}}catch(i){r.e(i)}finally{r.f()}return!0}},_i={mark:[{factor:"marktype",cost:.3},{factor:"data",cost:.5},{factor:"scale.y",cost:.4,with:[Ci]},{factor:"scale.x",cost:.4,with:[Ci]},{factor:"scale.color",cost:.4,with:[Ci]},{factor:"scale.shape",cost:.4,with:[Ci]},{factor:"scale.size",cost:.4,with:[Ci]},{factor:"scale.y",cost:.65,without:[Ci]},{factor:"scale.x",cost:.65,without:[Ci]},{factor:"scale.color",cost:.65,without:[Ci]},{factor:"scale.shape",cost:.65,without:[Ci]},{factor:"scale.size",cost:.65,without:[Ci]},{factor:"encode.x",cost:.3},{factor:"encode.y",cost:.3},{factor:"encode.color",cost:.3},{factor:"encode.shape",cost:.3},{factor:"encode.size",cost:.3},{factor:"encode.opacity",cost:.2}],axis:[{factor:"encode",cost:.3},{factor:"scale",cost:.5,with:[Ci]},{factor:"add",cost:.7},{factor:"remove",cost:.7},{factor:"scale",cost:1,without:[Ci]}],legend:[{factor:"encode",cost:.3},{factor:"scale",cost:.5,with:[Ci]},{factor:"add",cost:.7},{factor:"remove",cost:.7},{factor:"scale",cost:1,without:[Ci]}]},Ni=[{chunks:[[{compType:"mark",factor:"scale.y",with:[Bi,Ti(["encode.y"])]}]],cost:1},{chunks:[[{compType:"mark",factor:"scale.x",with:[Bi,Ti(["encode.x"])]}]],cost:1},{chunks:[[{compType:"mark",factor:"scale.size",with:[Bi,Ti(["encode.size"])]}]],cost:1},{chunks:[[{compType:"mark",factor:"scale.color",with:[Bi,Ti(["encode.color"])]}]],cost:1}],Ii=[{chunks:[[{compType:"mark",factor:"scale.y",with:[Ci]},{compType:"mark",factor:"scale.x",with:[Ci]}]],cost:-.2},{chunks:[[{compType:"mark",factor:"scale.size"},{compType:"mark",factor:"scale.shape"}],[{compType:"mark",factor:"scale.color"},{compType:"mark",factor:"scale.shape"}],[{compType:"mark",factor:"scale.color"},{compType:"mark",factor:"scale.size"}],[{compType:"mark",factor:"scale.size"},{compType:"mark",factor:"scale.opacity"}],[{compType:"mark",factor:"scale.opacity"},{compType:"mark",factor:"scale.shape"}],[{compType:"mark",factor:"scale.color"},{compType:"mark",factor:"scale.opacity"}],[{compType:"mark",factor:"scale.color"},{compType:"mark",factor:"scale.size"},{compType:"mark",factor:"scale.shape"}],[{compType:"mark",factor:"scale.size"},{compType:"mark",factor:"scale.shape"},{compType:"mark",factor:"scale.opacity"}],[{compType:"mark",factor:"scale.color"},{compType:"mark",factor:"scale.shape"},{compType:"mark",factor:"scale.opacity"}],[{compType:"mark",factor:"scale.color"},{compType:"mark",factor:"scale.size"},{compType:"mark",factor:"scale.opacity"}],[{compType:"mark",factor:"scale.color"},{compType:"mark",factor:"scale.size"},{compType:"mark",factor:"scale.opacity"},{compType:"mark",factor:"scale.shape"}]],cost:-.1},{chunks:[[{compType:"mark",factor:"scale.y",with:[Ci]},{compType:"axis",factor:"scale.y",with:[Ci]}]],cost:-.5},{chunks:[[{compType:"mark",factor:"scale.y",with:[Bi]},{compType:"axis",factor:"scale.y",with:[Bi]}]],cost:-1},{chunks:[[{compType:"mark",factor:"encode.y"},{compType:"axis",factor:"add.y"}],[{compType:"mark",factor:"encode.y"},{compType:"axis",factor:"remove.y"}]],cost:-.7},{chunks:[[{compType:"mark",factor:"scale.x",with:[Ci]},{compType:"axis",factor:"scale.x",with:[Ci]}]],cost:-.5},{chunks:[[{compType:"mark",factor:"scale.x",with:[Bi]},{compType:"axis",factor:"scale.x",with:[Bi]}]],cost:-1},{chunks:[[{compType:"mark",factor:"encode.x"},{compType:"axis",factor:"add.x"}],[{compType:"mark",factor:"encode.x"},{compType:"axis",factor:"remove.x"}]],cost:-.7},{chunks:[[{compType:"mark",factor:"scale.color"},{compType:"legend",contain:"color"}]],cost:-.5},{chunks:[[{compType:"mark",factor:"scale.size"},{compType:"legend",contain:"size"}]],cost:-.5},{chunks:[[{compType:"mark",factor:"scale.shape"},{compType:"legend",contain:"shape"}]],cost:-.5}];function Mi(e){var t=[],a=[],r=e.concat.length,n=e.concat.reduce((function(n,i,s){var u,l=i.sync.reduce((function(e,t){return t.meta={cost:Ri(t)},e+Ri(t)}),0),c=function(e){var t=function(e,t){return t.find((function(t){return t===e.factor||t.indexOf(e.contain)>=0}))};return Ii.concat(Ni).reduce((function(a,r){var n,i=Object(o.a)(r.chunks);try{for(i.s();!(n=i.n()).done;){if(n.value.reduce((function(a,r){var n=e.find((function(e){return e.diff.compType===r.compType&&t(r,e.factorSets.current)}));return!!n&&(r.with&&(a=r.with.reduce((function(e,t){return e&&t(n,r.factor)}),a)),a&&!!n)}),!0)){a+=r.cost;break}}}catch(s){i.e(s)}finally{i.f()}return a}),0)}(i.sync),f=e.totalDuration/e.concat.length,d=(u=f,1.4/(1+Math.exp(-(u-1200)/300))*Math.pow(.99,r-1-s));return i.meta={totalCost:O(l),comboCost:O(c),cap:d,cost:O(Math.max(l+c-d,0))},t.push(Math.max(l+c)),a.push(Math.max(l+c-d,0)),n+Math.max(l+c-d,0)}),0);return{cost:O(n),tiebreaker:S(t),tiebreaker2:j(a)}}function Ri(e){if("view"===e.diff.compType||"pause"===e.diff.compType)return 0;var t,a=0,r=Object(o.a)(_i[e.diff.compType]);try{var n=function(){var r=t.value,n=e.factorSets.current.find((function(e){return e.indexOf(r.factor)>=0})),i=!0;n&&r.with?i=r.with.reduce((function(t,a){return t&&a(e,n)}),!0):n&&r.without&&(i=r.without.reduce((function(t,a){return t&&!a(e,n)}),!0)),a+=n&&i?r.cost:0};for(r.s();!(t=r.n()).done;)n()}catch(i){r.e(i)}finally{r.f()}return a}function $i(e,t,a){var r,n={timing:{duration:{ratio:Math.floor(100/e.concat.length)/100}}};return t.global&&(n=Object.assign(n,t.global)),{concat:e.concat.map((function(e){return Object(i.a)({sync:e.sync.map((function(e){var i;switch(e.diff.compType){case"mark":i=function(e,t){var a=e.diff,r=e.factorSets,n={component:{mark:a.compName},change:(i=r.all,["scale","signal","data","encode","marktype"].reduce((function(e,t){return i.find((function(e){return e.indexOf(t)>=0}))&&(e[t]=!1),e}),{})),timing:e.timing||g(t.timing)};var i;if(r.applied.indexOf("remove")>=0)return delete n.change,n;var o=r.applied.filter((function(e){return e.indexOf("scale")>=0}));o.length>0&&(n.change.scale=o.map((function(e){return e.replace("scale.","")})));r.applied.indexOf("data")>=0&&(n.change.data=k(t,"change","data")||!0);var s=r.applied.filter((function(e){return e.indexOf("encode")>=0})),u=function(e){var t=e.filter((function(e){return e.indexOf("encode")>=0})).map((function(e){return di[e.replace("encode.","")]})).reduce((function(e,t){return t.forEach((function(t){e[t]=!1})),e}),{}),a=g(t);return delete a.opacity,{update:g(t),enter:a,exit:a}}(r.all.concat(r.extraByMarktype));s.length>0&&s.forEach((function(e){var t=e.replace("encode.","");di[t].forEach((function(e){delete u.update[e],delete u.exit[e],delete u.enter[e]}))}));n.change.encode=u,r.applied.indexOf("marktype")>=0&&(n.change.marktype=!0,r.extraByMarktype.forEach((function(e){var t=e.replace("encode.","");di[t].forEach((function(e){delete n.change.encode.update[e],delete n.change.encode.exit[e],delete n.change.encode.enter[e]}))})));return["update","enter","exit"].forEach((function(e){P(k(n,"change","encode",e))||(n.change.encode[e]=Object.keys(n.change.encode[e]).filter((function(e){return a.meta.usedEnAttrs.indexOf(e)>=0})).reduce((function(t,a){return t[a]=n.change.encode[e][a],t}),{})),P(k(n,"change","encode",e))&&(n.change.encode[e]=!0)})),n}(e,r=Object.assign({},n,k(t,"marks",e.diff.compName)||{}));break;case"axis":i=function(e,t){var a=k(t,"change","scale","domainDimension"),r=e.factorSets,n={component:{axis:e.diff.compName},change:{},timing:e.timing||g(t.timing)};void 0!==a&&(n.change={scale:{domainDimension:a}});(r.all.indexOf("scale.y")>=0&&r.applied.indexOf("scale.y")<0||r.all.indexOf("scale.x")>=0&&r.applied.indexOf("scale.x")<0)&&(n.change.scale=!1);r.applied.indexOf("encode")<0&&r.all.indexOf("encode")>=0&&(n.change.encode=!1);!1===n.change.encode&&r.applied.indexOf("encode.only.grid")>=0&&(n.change.encode={grid:!0,axis:!1,labels:!1,title:!1,ticks:!1,domain:!1});(!1===n.change.encode||!1===k(n,"change","encode","axis"))&&r.applied.indexOf("encode.position")>=0&&(n.change.encode?n.change.encode.axis=!1:n.change.encode={axis:!1});P(n.change)&&delete n.change;return n}(e,r=Object.assign({},n,k(t,"axes",e.diff.compName)||{}));break;case"legend":i=function(e,t){return{component:{legend:e.diff.compName},timing:e.timing||g(t.timing)}}(e,r=Object.assign({},n,k(t,"legends",e.diff.compName)||{}));break;case"view":i=function(e,t){return{component:"view",change:{signal:e.factorSets.current},timing:e.timing||g(t.timing)}}(e,r)}return a&&(i.meta=e.meta),i}))},a?{meta:e.meta}:{})}))}}function Vi(e,t){return zi.apply(this,arguments)}function zi(){return(zi=Object(l.a)(u.a.mark((function e(t,a){var r,n,i,o,s,l,c,f,p,m,h,v=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(l in r=v.length>2&&void 0!==v[2]?v[2]:{marks:{},axes:{},legends:{},scales:{}},n=r,i=Number(r.stageN)||2,o=r.includeMeta,s={totalDuration:n.totalDuration||2e3},n.axes=n.axes||{},n.scales||{})n.axes[l]=n.axes[l]||{},n.axes[l].change=n.axes[l].change||{},n.axes[l].change.scale=n.axes[l].change.scale||{},!1!==n.axes[l].change.scale&&(n.axes[l].change.scale.domainDimension=n.scales[l].domainDimension);return e.next=9,new d.b(Object(d.c)(a),{renderer:"svg"}).runAsync();case 9:return c=e.sent,e.next=12,new d.b(Object(d.c)(t),{renderer:"svg"}).runAsync();case 12:return f=e.sent,p={sVis:{spec:g(t),view:f},eVis:{spec:g(a),view:c}},m=hi(p,n),h=(h=ji(m,i,p,s)).map((function(e){return e.eval=Mi(e),e})).sort((function(e,t){return Li(e.eval,t.eval)})),e.abrupt("return",h.map((function(e){var t=o?e.eval:void 0;return{spec:{timeline:$i(e,n,o),totalDuration:s.totalDuration,meta:t},pseudoTimeline:e}})));case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Li(e,t){return e.cost===t.cost?e.tiebreaker===t.tiebreaker?e.tiebreaker2-t.tiebreaker2:e.tiebreaker-t.tiebreaker:e.cost-t.cost}function Ui(e){var t=Object(m.a)(e).spec;return t.axes=function(e){if(!e||e.length<=0)return[];var t=e.filter((function(e){return e.grid})).map((function(e){return e.scale}));return Object(p.nest)().key((function(e){return e.scale})).rollup((function(e){var t=e.find((function(e){return e.grid})),a=Object(i.a)({},e.find((function(e){return!e.grid})));return t&&(a.grid=!0,t.gridScale&&(a.gridScale=t.gridScale),a.zindex=0),a})).entries(e).map((function(e){return e.value})).sort((function(e,a){return t.indexOf(e.scale)-t.indexOf(a.scale)}))}(t.axes),function(e){e.axes&&e.axes.forEach((function(e){e.encode?e.encode.axis=Object(i.a)({},e.encode.axis,{name:e.scale}):e.encode={axis:{name:e.scale}}}));e.legends&&e.legends.forEach((function(e,t){e.encode?e.encode.legend=Object.assign({},e.encode.legend,{name:"legend".concat(t)}):e.encode={legend:{name:"legend".concat(t)}}}))}(t),t}var qi=li.animate}).call(this,a(240))},422:function(e,t,a){e.exports=a(552)},427:function(e,t,a){},432:function(e,t,a){},546:function(e,t,a){},549:function(e,t,a){},552:function(e,t,a){"use strict";a.r(t);var r=a(10),n=a.n(r),i=a(192),o=a.n(i),s=(a(427),a(21)),u=a.n(s),l=a(53),c=a(37),f=a(15),d=a(16),p=a(23),m=a(22),h=a(193);function v(e){var t;try{t=JSON.parse(e)}catch(a){return!1}return t}function y(e,t){return JSON.stringify(e)===JSON.stringify(t)}a(432);var g=a(237),b=a(150),x=a(287);function E(e){var t=""===e.dataJoinKey?void 0:e.dataJoinKey.split(";").map((function(e){return e.trim()})),a="default"===e.xScaleDomainDimension?void 0:e.xScaleDomainDimension,r="default"===e.yScaleDomainDimension?void 0:e.yScaleDomainDimension;return{marks:{marks:{change:{data:t}}},scales:{x:a?{domainDimension:a}:{},y:r?{domainDimension:r}:{}},stageN:e.stageN,includeMeta:!1,totalDuration:e.duration||2e3}}function w(e){var t={xScaleDomainDimension:"default",yScaleDomainDimension:"default"};e&&e.marks&&e.marks.marks&&e.marks.marks.change&&(t.dataJoinKey=(e.marks.marks.change.data||[]).join(";")),e&&e.scales&&e.scales.x&&e.scales.x.domainDimension&&(t.xScaleDomainDimension=e.scales.x.domainDimension),e&&e.scales&&e.scales.y&&e.scales.y.domainDimension&&(t.yScaleDomainDimension=e.scales.y.domainDimension),this.setState({recomParameters:Object(l.a)({},this.state.recomParameters,{},t)})}function k(e){return JSON.parse(JSON.stringify(e))}function A(e){return D.apply(this,arguments)}function D(){return(D=Object(c.a)(u.a.mark((function e(t){var a,r,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=[],r=0;case 2:if(!(r<t.length)){e.next=11;break}return e.next=5,g.a(t[r]);case 5:(n=e.sent).value=t[r],a.push(n);case 8:r++,e.next=2;break;case 11:return e.abrupt("return",a);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e,t,a,r){return j.apply(this,arguments)}function j(){return(j=Object(c.a)(u.a.mark((function e(t,a,r,n){var i,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a&&r&&n){e.next=2;break}return e.abrupt("return");case 2:if(i=t,"string"!==typeof t){e.next=7;break}return e.next=6,g.a(t);case 6:i=e.sent;case 7:if(!i.sSpecURL){e.next=11;break}return e.next=10,g.a(i.sSpecURL);case 10:i.sSpec=e.sent;case 11:if(!i.eSpecURL){e.next=15;break}return e.next=14,g.a(i.eSpecURL);case 14:i.eSpec=e.sent;case 15:return i.data&&(i.sSpec.data.find((function(e){return"source_0"===e.name})).values=k(i.data),i.eSpec.data.find((function(e){return"source_0"===e.name})).values=k(i.data)),a.setValue(b(i.gemSpecs[0],null,2)),r.setValue(b(i.sSpec,null,2)),n.setValue(b(i.eSpec,null,2)),e.next=21,Object(x.a)("#sView",i.sSpec,{renderer:"svg",actions:!1});case 21:return e.next=23,Object(x.a)("#eView",i.eSpec,{renderer:"svg",actions:!1});case 23:if(o=[],i.noRecom){e.next=29;break}return i.userInput&&w.bind(this,i.userInput)(),e.next=28,h.b(i.sSpec,i.eSpec,i.userInput);case 28:o=e.sent;case 29:return this.setState({gemSpecs:i.gemSpecs,currExample:i,recoms:o,selectedSpecIndex:0}),e.abrupt("return",i);case 31:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}var S=a(342),P=a.n(S),F=(a(546),a(413)),C=a(607),B=a(599),T=a(600),_=function(e){Object(m.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(f.a)(this,a),(r=t.call(this,e)).state={recomModalShow:!1,currTab:"gemini-tab"},r}return Object(d.a)(a,[{key:"editorWillMount",value:function(){var e=Object(c.a)(u.a.mark((function e(t){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.a("".concat("","/schema.json"));case 2:a=e.sent,t.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0,schemas:[{uri:"".concat("","/schema.json"),fileMatch:["*"],schema:a}]});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"genEditorDidMount",value:function(e){var t=this.props.attachEditorRefs;return function(a,r){a.layout();var n={};n[e]=a.getModel(),t(n)}}},{key:"genChangeHandler",value:function(e){var t=this;return function(a,r){t.props.onSpecChange(e,a)}}},{key:"onTabChange",value:function(e,t){var a=this,r={"gemini-tab":"geminiEditor","start-tab":"sVisEditor","end-tab":"eVisEditor"};this.setState({currTab:e},(function(){r[e]&&a.refs[r[e]].editor.layout()}))}},{key:"genToVegaBtnClickHandler",value:function(e){var t=this,a=v("sSpec"===e?this.props.sSpecText:this.props.eSpecText);return function(){a&&t.props.onSpecChange(e,b(h.c(a)))}}},{key:"render",value:function(){var e={lineNumbersMinChars:4,minimap:{enabled:!1},scrollBeyondLastLine:!1,selectOnLineNumbers:!0,indentSize:2,tabSize:2,wordWrap:"wordWrapColumn",wordWrapColumn:100,wordWrapMinified:!0,wrappingIndent:"indent",language:"json"},t=v(this.props.sSpecText),a=v(this.props.eSpecText),r=t&&t.$schema&&t.$schema.indexOf("https://vega.github.io/schema/vega-lite")>=0,i=a&&a.$schema&&a.$schema.indexOf("https://vega.github.io/schema/vega-lite")>=0;return n.a.createElement(F.a,{className:"mt-3",id:"code-col",xs:6},n.a.createElement(C.a,{transition:!1,onSelect:this.onTabChange.bind(this),activeKey:this.state.currTab},n.a.createElement(B.a,{eventKey:"gemini-tab",title:"Gemini"},n.a.createElement(P.a,{ref:"geminiEditor",language:"json",theme:"vs-light",options:e,value:this.props.gemSpecText,onChange:this.genChangeHandler("gemSpec"),editorDidMount:this.genEditorDidMount("editor"),editorWillMount:this.editorWillMount})),n.a.createElement(B.a,{eventKey:"start-tab",title:"Start Vis"},n.a.createElement(T.a,{size:"sm",variant:"secondary",className:"vl2vgBtn",id:"sViewVgBtn",disabled:!r,onClick:this.genToVegaBtnClickHandler("sSpec").bind(this)},"To Vega"),n.a.createElement(P.a,{ref:"sVisEditor",language:"json",theme:"vs-light",options:e,value:this.props.sSpecText,onChange:this.genChangeHandler("sSpec"),editorDidMount:this.genEditorDidMount("sVisEditor")})),n.a.createElement(B.a,{eventKey:"end-tab",title:"End Vis"},n.a.createElement(T.a,{size:"sm",variant:"secondary",className:"vl2vgBtn",id:"eViewVgBtn",disabled:!i,onClick:this.genToVegaBtnClickHandler("eSpec").bind(this)},"To Vega"),n.a.createElement(P.a,{ref:"eVisEditor",language:"json",theme:"vs-light",options:e,value:this.props.eSpecText,onChange:this.genChangeHandler("eSpec"),editorDidMount:this.genEditorDidMount("eVisEditor")})),n.a.createElement(B.a,{eventKey:"notice-tab",title:"Notice",className:"p-3"},n.a.createElement("h5",null,"Things that you need to know to play with this"),n.a.createElement("ul",null,n.a.createElement("li",null,"The start/end visualizations should be Vega specifications having unique names on marks/axes/legend components."),n.a.createElement("li",null,'You can use Vega-Lite specs and compile though "To Vega" button on the top-right corner of the Start/End Vis editors. The buttons compile the VL specs into vega specs with placing names on the axes ("x", "y") and legends ("legend0", "legend1", ...).'),n.a.createElement("li",null,"Currently, Gemini only supports the single-view chart having at most one y-axis and x-axis."),n.a.createElement("li",null,"The recommendation feature only supports the dimension-specification VL charts.")))))}}]),a}(r.Component),N=a(86);function I(e,t){return M.apply(this,arguments)}function M(){return(M=Object(c.a)(u.a.mark((function e(t,a){var r,n,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(r=document.querySelector(t).querySelector(".vegaEmbed-error"))&&r.remove(),e.next=5,Object(x.a)(t,a,{renderer:"svg",actions:!1});case 5:e.next=15;break;case 7:e.prev=7,e.t0=e.catch(0),(n=document.querySelector(t)).innerHTML="",(i=document.createElement("div")).classList.add("text-danger","vegaEmbed-error"),i.innerHTML=e.t0.message,n.append(i);case 15:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}var R=a(167),$=function(e){Object(m.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(f.a)(this,a),(r=t.call(this,e)).state={status:"ready"},r.updateAnimViewWithDebounce=Object(R.debounce)(700,r.updateAnimView.bind(Object(N.a)(r))),r}return Object(d.a)(a,[{key:"render",value:function(){var e="Error!",t="danger",a=!0;return"ready"===this.state.status?(e="Play",t="primary",a=!1):"in progress"===this.state.status?(e="Playing...",t="primary",a=!0):"done"===this.state.status&&(e="Reset",t="secondary",a=!1),n.a.createElement("div",null,n.a.createElement("div",{className:"text-center",style:{height:this.props.height||350}},n.a.createElement(T.a,{variant:t,size:"sm",className:"controlBtn",id:"".concat(this.props.id,"ControlBtn"),"data-target-id":"".concat(this.props.id,"Anim"),onClick:this.onControlBtnClick.bind(this),disabled:a},e),this.state.hasBuffer?"*":"",n.a.createElement("br",null),n.a.createElement("div",{style:{overflow:"scroll"}},n.a.createElement("div",{id:"".concat(this.props.id,"Anim"),className:"mt-3"}),n.a.createElement("div",{id:"".concat(this.props.id,"AnimBuffer"),className:"mt-3 d-none"}))),this.props.showMetaInfo?n.a.createElement("p",{className:"card-text",style:{whiteSpace:"pre-line"}},"Complexity: ".concat(this.props.meta.cost,"\n          Stage: ").concat(this.props.meta.stageN)):"")}},{key:"componentDidUpdate",value:function(){var e=Object(c.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.sSpec===this.props.sSpec&&t.eSpec===this.props.eSpec&&t.gemSpec===this.props.gemSpec||this.updateAnimViewWithDebounce();case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateAnimView",value:function(){var e=Object(c.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("in progress"!==this.state.status){e.next=6;break}return e.next=3,I("#".concat(this.props.id,"AnimBuffer"),this.props.sSpec);case 3:this.setState({hasBuffer:!0}),e.next=9;break;case 6:return this.setState({status:"ready"}),e.next=9,I("#".concat(this.props.id,"Anim"),this.props.sSpec);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=Object(c.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({status:"ready"}),e.next=3,I("#".concat(this.props.id,"Anim"),this.props.sSpec);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onControlBtnClick",value:function(){var e=Object(c.a)(u.a.mark((function e(t){var a,r,n,i=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.target,"ready"!==this.state.status){e.next=8;break}return this.setState({status:"in progress"}),e.next=5,this.play.bind(a)(this.props.gemSpec,this.props.sSpec,this.props.eSpec,(function(e){return i.props.onEnd&&i.props.onEnd(e),!0}));case 5:this.state.hasBuffer?(r=document.getElementById(this.props.id+"Anim"),n=document.getElementById(this.props.id+"AnimBuffer"),r.innerHTML=n.innerHTML,n.innerHTML="",this.setState({hasBuffer:!1,status:"ready"})):this.setState({status:"done"}),e.next=12;break;case 8:if("done"!==this.state.status){e.next=12;break}return e.next=11,this.reset.bind(a)(this.props.sSpec);case 11:this.setState({status:"ready"});case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(c.a)(u.a.mark((function e(t,a,r,n){var i,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="#".concat(this.dataset.targetId),e.next=3,h.a(a,r,t);case 3:return o=e.sent,console.log("Start!"),e.next=7,o.play(i);case 7:return console.log("Done!"),n&&n(o),e.abrupt("return",!0);case 10:case"end":return e.stop()}}),e,this)})));return function(t,a,r,n){return e.apply(this,arguments)}}()},{key:"reset",value:function(){var e=Object(c.a)(u.a.mark((function e(t){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="#".concat(this.dataset.targetId),e.next=3,I("".concat(a),t);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),a}(r.Component),V=a(601),z=function(e){Object(m.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(f.a)(this,a),(r=t.call(this,e)).debouncedUpdateSVis=Object(R.debounce)(700,r.updateSVis.bind(Object(N.a)(r))),r.debouncedUpdateEVis=Object(R.debounce)(700,r.updateEVis.bind(Object(N.a)(r))),r}return Object(d.a)(a,[{key:"render",value:function(){return n.a.createElement(F.a,{xs:6},n.a.createElement(V.a,null,n.a.createElement(F.a,null,n.a.createElement($,{sSpec:this.props.sSpec||{},eSpec:this.props.eSpec||{},gemSpec:this.props.gemSpec||{},showMetaInfo:!1,id:"animView"}))),n.a.createElement(V.a,{className:"mt-3"},n.a.createElement(F.a,{xs:6},n.a.createElement("h6",null,"Start Vis"),n.a.createElement("div",{id:"sView"})),n.a.createElement(F.a,{xs:6},n.a.createElement("h6",null,"End Vis"),n.a.createElement("div",{id:"eView"}))))}},{key:"componentDidUpdate",value:function(){var e=Object(c.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.sSpec!==this.props.sSpec&&this.debouncedUpdateSVis(),t.eSpec!==this.props.eSpec&&this.debouncedUpdateEVis();case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateSVis",value:function(){var e=Object(c.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I("#sView",this.props.sSpec);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateEVis",value:function(){var e=Object(c.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I("#eView",this.props.eSpec);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),a}(r.Component),L=a(417),U=a.n(L),q=a(604),H=a(602),K=a(605),W=a(609),Q=(a(549),function(e){Object(m.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(f.a)(this,a),(r=t.call(this,e)).debouncedUpdateDuration=Object(R.debounce)(700,r.updateRecomParam.bind(Object(N.a)(r))),r.debouncedUpdateDataJoinKey=Object(R.debounce)(700,r.updateRecomParam.bind(Object(N.a)(r))),r}return Object(d.a)(a,[{key:"render",value:function(){var e=this;return n.a.createElement(q.a,{size:"lg",show:this.props.modalShow,onHide:this.props.onHide,"aria-labelledby":"example-modal-sizes-title-lg",id:"recom-modal"},n.a.createElement(q.a.Header,{closeButton:!0},n.a.createElement(q.a.Title,{id:"example-modal-sizes-title-lg"},"Recommendations")),n.a.createElement(q.a.Body,null,n.a.createElement("div",{className:"mb-3 d-inline-flex felx-row"},n.a.createElement(H.a,{size:"sm",className:"mr-2",style:{maxWidth:155}},n.a.createElement(H.a.Prepend,null,n.a.createElement(H.a.Text,{htmlFor:"stageNSelect"},"# of Stages")),n.a.createElement(K.a.Control,{as:"select",value:this.props.recomParameters.stageN,id:"stageNSelect",onChange:this.onChangeStageN.bind(this),style:{maxWidth:55}},n.a.createElement("option",{value:"1"},"1"),n.a.createElement("option",{value:"2"},"2"),n.a.createElement("option",{value:"3"},"3"))),n.a.createElement(H.a,{size:"sm",className:"mr-2",style:{maxWidth:150}},n.a.createElement(H.a.Prepend,null,n.a.createElement(H.a.Text,{htmlFor:"duration"},"Duration")),n.a.createElement(K.a.Control,{id:"duration",placeholder:"Milliseconds","aria-label":"duration","aria-describedby":"duration",type:"number",min:0,defaultValue:this.props.recomParameters.duration,onChange:this.onChangeDuration.bind(this)})),n.a.createElement(H.a,{size:"sm",className:"mr-2"},n.a.createElement(H.a.Prepend,null,n.a.createElement(H.a.Text,{htmlFor:"dataJoinKey"},"Data Join By")),n.a.createElement(K.a.Control,{id:"dataJoinKey",placeholder:'e.g., "name; year"',"aria-label":"dataJoinKey","aria-describedby":"dataJoinKey",type:"text",defaultValue:this.props.recomParameters.dataJoinKey,onChange:this.onChangeDataJoinKey.bind(this)})),n.a.createElement(H.a,{size:"sm",className:"mr-2"},n.a.createElement(H.a.Prepend,null,n.a.createElement(H.a.Text,{htmlFor:"x-domain-dimension"},"X Domain Dimension")),n.a.createElement(K.a.Control,{as:"select",value:this.props.recomParameters.xScaleDomainDimension||"default",id:"x-domain-dimension",onChange:this.onChangeXScaleDomainDimension.bind(this),style:{minWidth:70}},n.a.createElement("option",{value:"default"},"Default"),n.a.createElement("option",{value:"diff"},"Change"),n.a.createElement("option",{value:"same"},"UnChange"))),n.a.createElement(H.a,{size:"sm",className:"mr-2"},n.a.createElement(H.a.Prepend,null,n.a.createElement(H.a.Text,{htmlFor:"y-domain-dimension"},"Y Domain Dimension")),n.a.createElement(K.a.Control,{as:"select",value:this.props.recomParameters.yScaleDomainDimension||"default",id:"y-domain-dimension",onChange:this.onChangeYScaleDomainDimension.bind(this),style:{minWidth:70}},n.a.createElement("option",{value:"default"},"Default"),n.a.createElement("option",{value:"diff"},"Change"),n.a.createElement("option",{value:"same"},"UnChange")))),n.a.createElement(V.a,{id:"recommendations"},0===this.props.recoms.length?n.a.createElement(F.a,null,"There is no recommendation with the given parameters."):this.props.recoms.map((function(t,a){return n.a.createElement(F.a,{md:4,key:"recom".concat(a,"Card-").concat(U()(JSON.stringify(e.props.recomParameters)))},n.a.createElement(W.a,null,n.a.createElement(W.a.Body,null,n.a.createElement($,{sSpec:e.props.sSpec,eSpec:e.props.eSpec,gemSpec:t.spec,showMetaInfo:!0,meta:{cost:t.pseudoTimeline.eval.cost,stageN:t.spec.timeline.concat.length},id:"recom".concat(a)}),n.a.createElement(T.a,{variant:"primary",size:"sm",onClick:e.getCustomizeBtnClickHandler(t.spec)},"Customize"))))})))),n.a.createElement(q.a.Footer,null,n.a.createElement(T.a,{variant:"secondary",size:"sm",onClick:this.props.onHide},"Close")))}},{key:"componentDidUpdate",value:function(){var e=document.getElementById("dataJoinKey"),t=document.getElementById("duration");e&&e.value!==this.props.recomParameters.dataJoinKey&&(e.value=this.props.recomParameters.dataJoinKey),t&&1*t.value!==this.props.recomParameters.duration&&(t.value=this.props.recomParameters.duration)}},{key:"updateRecomParam",value:function(e){this.props.updateRecomParameters(e)}},{key:"onChangeStageN",value:function(e){this.props.updateRecomParameters({stageN:e.target.value})}},{key:"onChangeDuration",value:function(e){var t=1*e.target.value;this.debouncedUpdateDuration.bind(this)({duration:t})}},{key:"onChangeDataJoinKey",value:function(e){var t=e.target.value;this.debouncedUpdateDataJoinKey.bind(this)({dataJoinKey:t})}},{key:"onChangeXScaleDomainDimension",value:function(e){this.props.updateRecomParameters({xScaleDomainDimension:e.target.value})}},{key:"onChangeYScaleDomainDimension",value:function(e){this.props.updateRecomParameters({yScaleDomainDimension:e.target.value})}},{key:"getCustomizeBtnClickHandler",value:function(e){var t=this;return function(a){t.props.setValueOnEditor(b(e,null,2)),t.props.onHide()}}}]),a}(r.Component)),J=function(e){Object(m.a)(a,e);var t=Object(p.a)(a);function a(e){return Object(f.a)(this,a),t.call(this,e)}return Object(d.a)(a,[{key:"render",value:function(){return n.a.createElement("select",{id:"example-select",className:"custom-select custom-select-sm mr-1",style:{maxWidth:"300px"},onChange:this.onChange.bind(this)},n.a.createElement("option",{value:""},"Select the example"),this.props.examples.map((function(e,t){return n.a.createElement("option",{key:t,value:e.value},e.title)})))}},{key:"onChange",value:function(e){var t=this.props.editor,a=this.props.sVisEditor,r=this.props.eVisEditor,n=this.props.setupExample,i=e.target.value;""!==i&&n(this.props.examples.find((function(e){return e.value===i})),t,a,r,this.props.recomParameters)}}]),a}(r.Component),Z=function(e){Object(m.a)(a,e);var t=Object(p.a)(a);function a(){return Object(f.a)(this,a),t.apply(this,arguments)}return Object(d.a)(a,[{key:"render",value:function(){return n.a.createElement("select",{id:"gemspec-select",className:"custom-select custom-select-sm mr-1",value:this.props.selectedSpecIndex,style:{maxWidth:"300px"},onChange:this.onChange.bind(this)},this.props.gemSpecs.map((function(e,t){return n.a.createElement("option",{key:t,value:t},e.meta&&e.meta.name?e.meta.name:t.toString())})))}},{key:"onChange",value:function(){var e=Object(c.a)(u.a.mark((function e(t){var a,r,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=t.target.value,r=this.props.gemSpecs[a],n=b(r,null,2),this.props.onSpecChange("gemSpec",n),this.props.updateSelectedSpecIndex(a);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),a}(r.Component),G=a(603),Y=function(e){Object(m.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(f.a)(this,a),(r=t.call(this,e)).exampleList=["".concat("./examples","/stimuli/1.json"),"".concat("./examples","/stimuli/2.json"),"".concat("./examples","/stimuli/3.json"),"".concat("./examples","/stimuli/4.json"),"".concat("./examples","/unstackingBars.json"),"".concat("./examples","/sortWithFilter.json"),"".concat("./examples","/line.json"),"".concat("./examples","/r2d3.json"),"".concat("./examples","/r2d3-v2.json"),"".concat("./examples","/democracy.json"),"".concat("./examples","/scatterPlot.json"),"".concat("./examples","/introducing-bars.json"),"".concat("./examples","/addYAxis.json"),"".concat("./examples","/removeYAxis.json"),"".concat("./examples","/addLayer.json"),"".concat("./examples","/removeLayer.json"),"".concat("./examples","/autoScaleOrder-A.json"),"".concat("./examples","/autoScaleOrder-B.json"),"".concat("./examples","/autoScaleOrder-Line.json"),"".concat("./examples","/staggering.json"),"".concat("./examples","/enumerator2.json"),"".concat("./examples","/budget.json"),"".concat("./examples","/aggregate.json"),"".concat("./examples","/disaggregate.json"),"".concat("./examples","/reaggregate.json"),"".concat("./examples","/barToPoint.json"),"".concat("./examples","/nbaAllstar.json"),"".concat("./examples","/areaToLine.json")],r.state={recom:{sSpec:{},eSpec:{}},sVisEditor:void 0,eVisEditor:void 0,editor:void 0,recomModalShow:!1,currExample:void 0,selectedSpecIndex:0,examples:[],recoms:[],recomParameters:{duration:2e3,dataJoinKey:"",stageN:2,xScaleDomainDimension:"default",yScaleDomainDimension:"default"}},r}return Object(d.a)(a,[{key:"updateRecomParameters",value:function(){var e=Object(c.a)(u.a.mark((function e(t){var a,r,n,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(l.a)({},this.state.recomParameters,{},t),r=v(this.state.sSpecText)||{},n=v(this.state.eSpecText)||{},e.next=4,h.b(r,n,E(a));case 4:i=e.sent,this.setState({recomParameters:a,recoms:i,recom:{sSpec:r,eSpec:n}});case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onSpecChange",value:function(e,t){if(t!==this.state[e+"Text"]){var a={};a[e+"Text"]=t,this.setState(a)}}},{key:"onRecomHide",value:function(){this.setState({recomModalShow:!1})}},{key:"showRecom",value:function(){var e=Object(c.a)(u.a.mark((function e(){var t,a,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=v(this.state.sSpecText)||{},a=v(this.state.eSpecText)||{},y(this.state.recom.sSpec,t)&&y(this.state.recom.eSpec,a)){e.next=8;break}return e.next=4,h.b(t,a,E(this.state.recomParameters));case 4:r=e.sent,this.setState({recoms:r,recom:{sSpec:t,eSpec:a},recomModalShow:!0}),e.next=9;break;case 8:this.setState({recomModalShow:!0});case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=!!this.state.currExample&&this.state.currExample.noRecom;return n.a.createElement("div",null,n.a.createElement(Q,{modalShow:this.state.recomModalShow,onHide:this.onRecomHide.bind(this),recomParameters:this.state.recomParameters,recoms:this.state.recoms,sSpec:this.state.recom.sSpec,eSpec:this.state.recom.eSpec,updateRecomParameters:this.updateRecomParameters.bind(this),setValueOnEditor:this.setValueOnEditor.bind(this)}),n.a.createElement(G.a,{fluid:!0},n.a.createElement(V.a,{className:"mt-1"},n.a.createElement(F.a,null,n.a.createElement("span",null,"Example : "),n.a.createElement(J,{examples:this.state.examples,setupExample:O.bind(this),editor:this.state.editor,sVisEditor:this.state.sVisEditor,eVisEditor:this.state.eVisEditor,recomParameters:this.state.recomParameters}),n.a.createElement(Z,{gemSpecs:this.state.gemSpecs||[],selectedSpecIndex:this.state.selectedSpecIndex,updateSelectedSpecIndex:function(t){e.setState({selectedSpecIndex:t})},onSpecChange:this.onSpecChange.bind(this)}),n.a.createElement(T.a,{id:"recomBtn",size:"sm",variant:"primary",onClick:this.showRecom.bind(this),disabled:t},"\ud83d\udca1Recommendation"),n.a.createElement("small",{id:"noRecomLabel",className:"text-secondary ".concat(t?"":"d-none")},"This example does not support the recommendation currently."))),n.a.createElement(V.a,{id:"main"},n.a.createElement(_,{attachEditorRefs:this.attachEditorRefs.bind(this),sSpecText:this.state.sSpecText,eSpecText:this.state.eSpecText,gemSpecText:this.state.gemSpecText,onSpecChange:this.onSpecChange.bind(this)}),n.a.createElement(z,{gemSpec:v(this.state.gemSpecText)||{},sSpec:v(this.state.sSpecText)||{},eSpec:v(this.state.eSpecText)||{}}))))}},{key:"componentDidMount",value:function(){var e=Object(c.a)(u.a.mark((function e(){var t,a=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A(this.exampleList);case 2:t=e.sent,window.addEventListener("message",(function(e){if(["http://localhost"].find((function(t){return e.origin.indexOf(t)>=0}))&&"string"===typeof e.data){var t=v(e.data);t&&t.sSpec&&t.eSpec&&(window.opener.postMessage("ack","*"),O.bind(a)(t,a.state.editor,a.state.sVisEditor,a.state.eVisEditor))}})),this.setState({examples:t});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"attachEditorRefs",value:function(e){this.setState(e)}},{key:"setValueOnEditor",value:function(e){this.state.editor&&this.state.editor.setValue(e)}}]),a}(n.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(550);o.a.render(n.a.createElement(Y,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[422,1,2]]]);
//# sourceMappingURL=main.5292fd06.chunk.js.map